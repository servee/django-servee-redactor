function load_wysiwyg(t){t.find("textarea:not(.no_wysiwyg)").redactor({focus:!0,replaceDivs:!1,toolbarFixed:!0,buttonSource:!0,imageUpload:"/servee_image/upload/",imageManagerJson:"/servee_image/recent/",fileUpload:"/servee_document/upload/",fileManagerJson:"/servee_document/recent/",imageResizable:!0,imagePosition:!0,overrideStyles:!1,plugins:["imagemanager","filemanager","table","video","codemirror"],codemirror:{lineNumbers:!1,lineWrapping:!0,mode:"htmlmixed",matchBrackets:!0,indentUnit:4},buttons:["format","bold","italic","lists","image","file","link","video","table","horizontalrule","html"],initCallback:function(){"function"==typeof $.fn.matchHeight&&$.fn.matchHeight._update()},changeCallback:function(){"function"==typeof $.fn.matchHeight&&$.fn.matchHeight._update()}})}!function($){"use strict";function t(e,i){return new t.prototype.init(e,i)}Function.prototype.bind||(Function.prototype.bind=function(t){var e=this;return function(){return e.apply(t)}});var e=0;$.fn.redactor=function(e){var i=[],r=Array.prototype.slice.call(arguments,1);return"string"==typeof e?this.each(function(){var t=$.data(this,"redactor"),o;if("-1"!==e.search(/\./)?(o=e.split("."),"undefined"!=typeof t[o[0]]&&(o=t[o[0]][o[1]])):o=t[e],"undefined"!=typeof t&&$.isFunction(o)){var s=o.apply(t,r);void 0!==s&&s!==t&&i.push(s)}else $.error('No such method "'+e+'" for Redactor')}):this.each(function(){$.data(this,"redactor",{}),$.data(this,"redactor",t(this,e))}),0===i.length?this:1===i.length?i[0]:i},$.Redactor=t,$.Redactor.VERSION="1.4",$.Redactor.modules=["air","autosave","block","buffer","build","button","caret","clean","code","core","detect","dropdown","events","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","linkify","list","marker","modal","observe","offset","paragraphize","paste","placeholder","progress","selection","shortcuts","storage","toolbar","upload","uploads3","utils","browser"],$.Redactor.settings={},$.Redactor.opts={animation:!1,lang:"en",direction:"ltr",spellcheck:!0,overrideStyles:!0,scrollTarget:document,focus:!1,focusEnd:!1,clickToEdit:!1,structure:!1,tabindex:!1,minHeight:!1,maxHeight:!1,maxWidth:!1,plugins:!1,callbacks:{},placeholder:!1,linkify:!0,enterKey:!0,pastePlainText:!1,pasteImages:!0,pasteLinks:!0,pasteBlockTags:["pre","h1","h2","h3","h4","h5","h6","table","tbody","thead","tfoot","th","tr","td","ul","ol","li","blockquote","p","figure","figcaption"],pasteInlineTags:["br","strong","ins","code","del","span","samp","kbd","sup","sub","mark","var","cite","small","b","u","em","i"],preClass:!1,preSpaces:4,tabAsSpaces:!1,tabKey:!0,autosave:!1,autosaveName:!1,autosaveFields:!1,imageUpload:null,imageUploadParam:"file",imageUploadFields:!1,imageUploadForms:!1,imageTag:"figure",imageEditable:!0,imageCaption:!0,imagePosition:!1,imageResizable:!1,imageFloatMargin:"10px",dragImageUpload:!0,multipleImageUpload:!0,clipboardImageUpload:!0,fileUpload:null,fileUploadParam:"file",fileUploadFields:!1,fileUploadForms:!1,dragFileUpload:!0,s3:!1,linkNewTab:!1,linkTooltip:!0,linkNofollow:!1,linkSize:30,pasteLinkTarget:!1,videoContainerClass:"video-container",toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,air:!1,airWidth:!1,formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,buttons:["format","bold","italic","deleted","lists","image","file","link"],buttonsHide:[],buttonsHideOnMobile:[],script:!0,removeNewlines:!1,removeComments:!0,replaceTags:{b:"strong",i:"em",strike:"del"},shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,activeButtons:["deleted","italic","bold"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted"},langs:{en:{format:"Format",image:"Image",file:"File",link:"Link",bold:"Bold",italic:"Italic",deleted:"Strikethrough",underline:"Underline","bold-abbr":"B","italic-abbr":"I","deleted-abbr":"S","underline-abbr":"U",lists:"Lists","link-insert":"Insert link","link-edit":"Edit link","link-in-new-tab":"Open link in new tab",unlink:"Unlink",cancel:"Cancel",close:"Close",insert:"Insert",save:"Save",delete:"Delete",text:"Text",edit:"Edit",title:"Title",paragraph:"Normal text",quote:"Quote",code:"Code",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",heading4:"Heading 4",heading5:"Heading 5",heading6:"Heading 6",filename:"Name",optional:"optional",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",horizontalrule:"Line","upload-label":"Drop file here or ",caption:"Caption",bulletslist:"Bullets",numberslist:"Numbers","image-position":"Position",none:"None",left:"Left",right:"Right",center:"Center","accessibility-help-label":"Rich text editor"}},type:"textarea",inline:!1,buffer:[],rebuffer:[],inlineTags:["a","span","strong","strike","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],blockTags:["pre","ul","ol","li","p","h1","h2","h3","h4","h5","h6","dl","dt","dd","div","td","blockquote","output","figcaption","figure","address","section","header","footer","aside","article","iframe"],paragraphize:!0,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],userAgent:navigator.userAgent.toLowerCase(),observe:{dropdowns:[]},regexps:{linkyoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,linkvimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,linkimage:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},t.fn=$.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,UP:38,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(t,i){return this.$element=$(t),this.uuid=e++,this.loadOptions(i),this.loadModules(),this.opts.clickToEdit&&!this.$element.hasClass("redactor-click-to-edit")?this.loadToEdit(i):(this.$element.hasClass("redactor-click-to-edit")&&this.$element.removeClass("redactor-click-to-edit"),this.reIsBlock=new RegExp("^("+this.opts.blockTags.join("|").toUpperCase()+")$","i"),this.reIsInline=new RegExp("^("+this.opts.inlineTags.join("|").toUpperCase()+")$","i"),this.opts.dragImageUpload=null!==this.opts.imageUpload&&this.opts.dragImageUpload,this.opts.dragFileUpload=null!==this.opts.fileUpload&&this.opts.dragFileUpload,this.formatting={},this.lang.load(),$.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.$editor=this.$element,this.detectType(),this.core.callback("start"),this.core.callback("startToEdit"),this.start=!0,void this.build.start())},detectType:function(){this.build.isInline()||this.opts.inline?this.opts.type="inline":this.build.isTag("DIV")?this.opts.type="div":this.build.isTag("PRE")&&(this.opts.type="pre")},loadToEdit:function(t){this.$element.on("click.redactor-click-to-edit",$.proxy(function(){this.initToEdit(t)},this)),this.$element.addClass("redactor-click-to-edit")},initToEdit:function(t){$.extend(t.callbacks,{startToEdit:function(){this.insert.node(this.marker.get(),!1)},initToEdit:function(){this.selection.restore(),this.clickToCancelStorage=this.code.get(),$(this.opts.clickToCancel).off(".redactor-click-to-edit"),$(this.opts.clickToCancel).show().on("click.redactor-click-to-edit",$.proxy(function(e){e.preventDefault(),this.core.destroy(),this.events.syncFire=!1,this.$element.html(this.clickToCancelStorage),this.core.callback("cancel",this.clickToCancelStorage),this.events.syncFire=!0,this.clickToCancelStorage="",$(this.opts.clickToCancel).hide(),$(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",$.proxy(function(){this.initToEdit(t)},this)),this.$element.addClass("redactor-click-to-edit")},this)),$(this.opts.clickToSave).off(".redactor-click-to-edit"),$(this.opts.clickToSave).show().on("click.redactor-click-to-edit",$.proxy(function(e){e.preventDefault(),this.core.destroy(),this.core.callback("save",this.code.get()),$(this.opts.clickToCancel).hide(),$(this.opts.clickToSave).hide(),this.$element.on("click.redactor-click-to-edit",$.proxy(function(){this.initToEdit(t)},this)),this.$element.addClass("redactor-click-to-edit")},this))}}),this.$element.redactor(t),this.$element.off(".redactor-click-to-edit")},loadOptions:function(t){var e={};"undefined"!=typeof $.Redactor.settings.namespace?this.$element.hasClass($.Redactor.settings.namespace)&&(e=$.Redactor.settings):e=$.Redactor.settings,this.opts=$.extend({},$.extend(!0,{},$.Redactor.opts),$.extend(!0,{},e),this.$element.data(),t)},getModuleMethods:function(t){return Object.getOwnPropertyNames(t).filter(function(e){return"function"==typeof t[e]})},loadModules:function(){for(var t=$.Redactor.modules.length,e=0;e<t;e++)this.bindModuleMethods($.Redactor.modules[e])},bindModuleMethods:function(t){if("undefined"!=typeof this[t]){this[t]=this[t]();for(var e=this.getModuleMethods(this[t]),i=e.length,r=0;r<i;r++)this[t][e[r]]=this[t][e[r]].bind(this)}},air:function(){return{enabled:!1,collapsed:function(){this.opts.air&&this.selection.get().collapseToStart()},collapsedEnd:function(){this.opts.air&&this.selection.get().collapseToEnd()},build:function(){this.detect.isMobile()||(this.button.hideButtons(),this.button.hideButtonsOnMobile(),0!==this.opts.buttons.length&&(this.$air=this.air.createContainer(),this.opts.airWidth!==!1&&this.$air.css("width",this.opts.airWidth),this.air.append(),this.button.$toolbar=this.$air,this.button.setFormatting(),this.button.load(this.$air),this.core.editor().on("mouseup.redactor",this,$.proxy(function(t){""!==this.selection.text()&&this.air.show(t)},this))))},append:function(){this.$air.appendTo("body")},createContainer:function(){return $("<ul>").addClass("redactor-air").attr({id:"redactor-air-"+this.uuid,role:"toolbar"}).hide()},show:function(t){this.marker.remove(),this.selection.save(),this.selection.restore(!1),$(".redactor-air").hide();var e=0,i=this.$air.innerWidth();$(window).width()<t.clientX+i&&(e=200),this.$air.css({left:t.clientX-e+"px",top:t.clientY+10+$(document).scrollTop()+"px"}).show(),this.air.enabled=!0,this.air.bindHide()},bindHide:function(){$(document).on("mousedown.redactor-air."+this.uuid,$.proxy(function(t){var e=$(t.target).closest(".redactor-dropdown").length;if(0===$(t.target).closest(this.$air).length&&0===e){var i=this.air.hide(t);i!==!1&&this.marker.remove()}},this)).on("keydown.redactor-air."+this.uuid,$.proxy(function(t){var e=t.which;if((this.utils.isRedactorParent(t.target)||$(t.target).hasClass("redactor-in"))&&0===$(t.target).closest("#redactor-modal").length){if(e===this.keyCode.ESC)this.selection.get().collapseToStart(),this.marker.remove();else if(e===this.keyCode.BACKSPACE||e===this.keyCode.DELETE){var i=this.selection.get(),r=this.selection.range(i);r.deleteContents(),this.marker.remove()}else e===this.keyCode.ENTER&&(this.selection.get().collapseToEnd(),this.marker.remove());this.air.enabled?this.air.hide(t):(this.selection.get().collapseToStart(),this.marker.remove())}},this))},hide:function(t){var e=t.ctrlKey||t.metaKey||t.shiftKey&&t.altKey;return!e&&(this.button.setInactiveAll(),this.$air.fadeOut(100),this.air.enabled=!1,$(document).off("mousedown.redactor-air."+this.uuid),void $(document).off("keydown.redactor-air."+this.uuid))}}},autosave:function(){return{enabled:!1,html:!1,init:function(){this.opts.autosave&&(this.autosave.enabled=!0,this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name"))},is:function(){return this.autosave.enabled},send:function(){if(this.opts.autosave&&(this.autosave.source=this.code.get(),this.autosave.html!==this.autosave.source)){var t={};t.name=this.autosave.name,t[this.autosave.name]=this.autosave.source,t=this.autosave.getHiddenFields(t);var e=$.ajax({url:this.opts.autosave,type:"post",data:t});e.done(this.autosave.success)}},getHiddenFields:function(t){return this.opts.autosaveFields===!1||"object"!=typeof this.opts.autosaveFields?t:($.each(this.opts.autosaveFields,$.proxy(function(e,i){null!==i&&0===i.toString().indexOf("#")&&(i=$(i).val()),t[e]=i},this)),t)},success:function(t){var e;try{e=$.parseJSON(t)}catch(i){e=t}var i="undefined"==typeof e.error?"autosave":"autosaveError";this.core.callback(i,this.autosave.name,e),this.autosave.html=this.autosave.source},disable:function(){this.autosave.enabled=!1,clearInterval(this.autosaveTimeout)}}},block:function(){return{format:function(t,e,i,r){if(t="quote"===t?"blockquote":t,this.block.tags=["p","blockquote","pre","h1","h2","h3","h4","h5","h6","div","figure"],$.inArray(t,this.block.tags)!==-1)return"p"===t&&"undefined"==typeof e&&(e="class"),this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.block.formatCollapsed(t,e,i,r):this.block.formatUncollapsed(t,e,i,r)},formatCollapsed:function(t,e,i,r){this.selection.save();var o=this.selection.block(),s=o.tagName.toLowerCase();if($.inArray(s,this.block.tags)===-1)return void this.selection.restore();s===t&&(t="p");var n;if("blockquote"===s&&this.utils.isEndOfElement(o)){this.marker.remove(),n=document.createElement("p"),n.innerHTML=this.opts.invisibleSpace,$(o).after(n),this.caret.start(n);var a=$(o).children().last();0!==a.length&&"BR"===a[0].tagName&&a.remove()}else n=this.utils.replaceToTag(o,t);if("object"==typeof e){r=i;for(var l in e)n=this.block.setAttr(n,l,e[l],r)}else n=this.block.setAttr(n,e,i,r);return"pre"===t&&1===n.length&&$(n).html($.trim($(n).html())),this.selection.restore(),this.block.removeInlineTags(n),n},formatUncollapsed:function(t,e,i,r){this.selection.save();var o=[],s=this.selection.blocks();s[0]&&$(s[0]).hasClass("redactor-in")&&(s=$(s[0]).find(this.opts.blockTags.join(", ")));for(var n=s.length,a=0;a<n;a++){var l=s[a].tagName.toLowerCase();if($.inArray(l,this.block.tags)!==-1&&"figure"!==l){var c=this.utils.replaceToTag(s[a],t);if("object"==typeof e){r=i;for(var d in e)c=this.block.setAttr(c,d,e[d],r)}else c=this.block.setAttr(c,e,i,r);o.push(c),this.block.removeInlineTags(c)}}if(this.selection.restore(),"pre"===t&&0!==o.length){var h=o[0];$.each(o,function(t,e){0!==t&&($(h).append("\n"+$.trim(e.html())),$(e).remove())}),o=[],o.push(h)}return o},removeInlineTags:function(t){t=t[0]||t;var e=this.opts.inlineTags,i=["PRE","H1","H2","H3","H4","H5","H6"];if($.inArray(t.tagName,i)!==-1){if("PRE"!==t.tagName){var r=e.indexOf("a");e.splice(r,1)}$(t).find(e.join(",")).not(".redactor-selection-marker").contents().unwrap()}},setAttr:function(t,e,i,r){if("undefined"==typeof e)return t;var o="undefined"==typeof r?"replace":r;return t="class"===e?this.block[o+"Class"](i,t):"remove"===o?this.block[o+"Attr"](e,t):"removeAll"===o?this.block[o+"Attr"](e,t):this.block[o+"Attr"](e,i,t)},getBlocks:function(t){return"undefined"==typeof t?this.selection.blocks():t},replaceClass:function(t,e){return $(this.block.getBlocks(e)).removeAttr("class").addClass(t)[0]},toggleClass:function(t,e){return $(this.block.getBlocks(e)).toggleClass(t)[0]},addClass:function(t,e){return $(this.block.getBlocks(e)).addClass(t)[0]},removeClass:function(t,e){return $(this.block.getBlocks(e)).removeClass(t)[0]},removeAllClass:function(t){return $(this.block.getBlocks(t)).removeAttr("class")[0]},replaceAttr:function(t,e,i){return i=this.block.removeAttr(t,i),$(i).attr(t,e)[0]},toggleAttr:function(t,e,i){i=this.block.getBlocks(i);var r=this,o=[];return $.each(i,function(i,s){var n=$(s);n.attr(t)?o.push(r.block.removeAttr(t,s)):o.push(r.block.addAttr(t,e,s))}),o},addAttr:function(t,e,i){return $(this.block.getBlocks(i)).attr(t,e)[0]},removeAttr:function(t,e){return $(this.block.getBlocks(e)).removeAttr(t)[0]},removeAllAttr:function(t){t=this.block.getBlocks(t);var e=[];return $.each(t,function(t,i){"undefined"==typeof i.attributes&&e.push(i);for(var r=$(i),o=i.attributes.length,s=0;s<o;s++)r.removeAttr(i.attributes[s].name);e.push(r[0])}),e}}},buffer:function(){return{set:function(t){"undefined"==typeof t&&this.buffer.clear(),"undefined"==typeof t||"undo"===t?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){this.selection.save();var t=this.opts.buffer[this.opts.buffer.length-1],e=this.core.editor().html();t!==e&&this.opts.buffer.push(e),this.selection.restore()},setRedo:function(){this.selection.save(),this.opts.rebuffer.push(this.core.editor().html()),this.selection.restore()},getUndo:function(){this.core.editor().html(this.opts.buffer.pop())},getRedo:function(){this.core.editor().html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.core.editor().html())},undo:function(){0!==this.opts.buffer.length&&(this.buffer.set("redo"),this.buffer.getUndo(),this.selection.restore())},redo:function(){0!==this.opts.rebuffer.length&&(this.buffer.set("undo"),this.buffer.getRedo(),this.selection.restore())},clear:function(){this.opts.rebuffer=[]}}},build:function(){return{start:function(){if("inline"===this.opts.type)this.opts.type="inline";else if("div"===this.opts.type){var t=$.trim(this.$editor.html());""===t&&this.$editor.html(this.opts.emptyHtml)}else"textarea"===this.opts.type&&this.build.startTextarea();this.build.setIn(),this.build.setId(),this.build.enableEditor(),this.build.setOptions(),this.build.callEditor()},createContainerBox:function(){this.$box=$('<div class="redactor-box" role="application" />')},setIn:function(){this.core.editor().addClass("redactor-in")},setId:function(){var t="textarea"===this.opts.type?"redactor-uuid-"+this.uuid:this.$element.attr("id");this.core.editor().attr("id","undefined"==typeof t?"redactor-uuid-"+this.uuid:t)},getName:function(){var t=this.$element.attr("name");return"undefined"==typeof t?"content-"+this.uuid:t},loadFromTextarea:function(){this.$editor=$("<div />"),this.$textarea=this.$element,this.$element.attr("name",this.build.getName()),this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.$editor.addClass("redactor-editor"),this.opts.overrideStyles&&this.$editor.addClass("redactor-styles"),this.$element.hide(),this.$box.prepend('<span class="redactor-voice-label" id="redactor-voice-'+this.uuid+'" aria-hidden="false">'+this.lang.get("accessibility-help-label")+"</span>"),this.$editor.attr({"aria-labelledby":"redactor-voice-"+this.uuid,role:"presentation"})},startTextarea:function(){this.build.createContainerBox(),this.build.loadFromTextarea(),this.code.start(this.core.textarea().val()),this.core.textarea().val(this.clean.onSync(this.$editor.html()))},isTag:function(t){return this.$element[0].tagName===t},isInline:function(){return!this.build.isTag("TEXTAREA")&&!this.build.isTag("DIV")&&!this.build.isTag("PRE")},enableEditor:function(){this.core.editor().attr({contenteditable:!0})},setOptions:function(){"inline"===this.opts.type&&(this.opts.enterKey=!1),"inline"!==this.opts.type&&"pre"!==this.opts.type||(this.opts.toolbarMobile=!1,this.opts.toolbar=!1,this.opts.air=!1,this.opts.linkify=!1),this.core.editor().attr("spellcheck",this.opts.spellcheck),this.opts.structure&&this.core.editor().addClass("redactor-structure"),"textarea"===this.opts.type&&(this.core.box().attr("dir",this.opts.direction),this.core.editor().attr("dir",this.opts.direction),this.opts.tabindex&&this.core.editor().attr("tabindex",this.opts.tabindex),this.opts.minHeight?this.core.editor().css("min-height",this.opts.minHeight):this.core.editor().css("min-height","40px"),this.opts.maxHeight&&this.core.editor().css("max-height",this.opts.maxHeight),this.opts.maxWidth&&this.core.editor().css({"max-width":this.opts.maxWidth,margin:"auto"}))},callEditor:function(){this.build.disableBrowsersEditing(),this.events.init(),this.build.setHelpers(),(this.opts.toolbar||this.opts.air)&&(this.toolbarsButtons=this.button.init()),this.opts.air?this.air.build():this.opts.toolbar&&this.toolbar.build(),this.detect.isMobile()&&this.opts.toolbarMobile&&this.opts.air&&(this.opts.toolbar=!0,this.toolbar.build()),(this.opts.air||this.opts.toolbar)&&(this.core.editor().on("mouseup.redactor-observe."+this.uuid+" keyup.redactor-observe."+this.uuid+" focus.redactor-observe."+this.uuid+" touchstart.redactor-observe."+this.uuid,$.proxy(this.observe.toolbar,this)),this.core.element().on("blur.callback.redactor",$.proxy(function(){this.button.setInactiveAll()},this))),this.modal.templates(),this.build.plugins(),this.autosave.init(),this.code.html=this.code.cleaned(this.core.editor().html()),this.core.callback("init"),this.core.callback("initToEdit"),this.storage.observe(),this.start=!1},setHelpers:function(){this.opts.linkify&&this.linkify.format(),this.placeholder.init(),this.opts.focus?setTimeout(this.focus.start,100):this.opts.focusEnd&&setTimeout(this.focus.end,100)},disableBrowsersEditing:function(){try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1),document.execCommand("AutoUrlDetect",!1,!1)}catch(t){}},plugins:function(){this.opts.plugins&&$.each(this.opts.plugins,$.proxy(function(e,i){var r="undefined"!=typeof RedactorPlugins&&"undefined"!=typeof RedactorPlugins[i]?RedactorPlugins:t.fn;if($.isFunction(r[i])){this[i]=r[i]();for(var o=this.getModuleMethods(this[i]),s=o.length,n=0;n<s;n++)this[i][o[n]]=this[i][o[n]].bind(this);if("undefined"!=typeof this[i].langs){var a={};"undefined"!=typeof this[i].langs[this.opts.lang]?a=this[i].langs[this.opts.lang]:"undefined"==typeof this[i].langs[this.opts.lang]&&"undefined"!=typeof this[i].langs.en&&(a=this[i].langs.en);var l=this;$.each(a,function(t,e){"undefined"==typeof l.opts.curLang[t]&&(l.opts.curLang[t]=e)})}$.isFunction(this[i].init)&&this[i].init()}},this))}}},button:function(){return{toolbar:function(){return"undefined"!=typeof this.button.$toolbar&&this.button.$toolbar?this.button.$toolbar:this.$toolbar},init:function(){return{format:{title:this.lang.get("format"),dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("heading1"),func:"block.format"},h2:{title:this.lang.get("heading2"),func:"block.format"},h3:{title:this.lang.get("heading3"),func:"block.format"},h4:{title:this.lang.get("heading4"),func:"block.format"},h5:{title:this.lang.get("heading5"),func:"block.format"},h6:{title:this.lang.get("heading6"),func:"block.format"}}},bold:{title:this.lang.get("bold-abbr"),label:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic-abbr"),label:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted-abbr"),label:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline-abbr"),label:this.lang.get("underline"),func:"inline.format"},lists:{title:this.lang.get("lists"),dropdown:{unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease",observe:{element:"li",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase",observe:{element:"li",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},ul:{title:"&bull; "+this.lang.get("bulletslist"),func:"list.toggle"},ol:{title:"1. "+this.lang.get("numberslist"),func:"list.toggle"},outdent:{title:this.lang.get("outdent"),func:"indent.decrease"},indent:{title:this.lang.get("indent"),func:"indent.increase"},image:{title:this.lang.get("image"),func:"image.show"},file:{title:this.lang.get("file"),func:"file.show"},link:{title:this.lang.get("link"),dropdown:{link:{title:this.lang.get("link-insert"),func:"link.show",observe:{element:"a",in:{title:this.lang.get("link-edit")},out:{title:this.lang.get("link-insert")}}},unlink:{title:this.lang.get("unlink"),func:"link.unlink",observe:{element:"a",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}}}},horizontalrule:{title:this.lang.get("horizontalrule"),func:"line.insert"}}},setFormatting:function(){$.each(this.toolbarsButtons.format.dropdown,$.proxy(function(t,e){$.inArray(t,this.opts.formatting)===-1&&delete this.toolbarsButtons.format.dropdown[t]},this))},hideButtons:function(){0!==this.opts.buttonsHide.length&&this.button.hideButtonsSlicer(this.opts.buttonsHide)},hideButtonsOnMobile:function(){this.detect.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&this.button.hideButtonsSlicer(this.opts.buttonsHideOnMobile)},hideButtonsSlicer:function(t){$.each(t,$.proxy(function(t,e){var i=this.opts.buttons.indexOf(e);i!==-1&&this.opts.buttons.splice(i,1)},this))},load:function(t){this.button.buttons=[],$.each(this.opts.buttons,$.proxy(function(e,i){!this.toolbarsButtons[i]||"file"===i&&!this.file.is()||"image"===i&&!this.image.is()||t.append($("<li>").append(this.button.build(i,this.toolbarsButtons[i])))},this))},build:function(t,e){if(this.opts.toolbar!==!1){var i=$('<a href="javascript:void(null);" class="re-button re-'+t+'" title="'+e.title+'" rel="'+t+'" />').html(e.title);if(i.attr({role:"button","aria-label":e.title,tabindex:"-1"}),"undefined"!=typeof e.label&&(i.attr("aria-label",e.label),i.attr("title",e.label)),(e.func||e.command||e.dropdown)&&this.button.setEvent(i,t,e),e.dropdown){i.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var r=$('<ul class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+t+'" style="display: none;">');i.data("dropdown",r),this.dropdown.build(t,r,e.dropdown)}return this.button.buttons.push(i),i}},getButtons:function(){return this.button.toolbar().find("a.re-button")},getButtonsKeys:function(){return this.button.buttons},setEvent:function(t,e,i){t.on("mousedown",$.proxy(function(r){if(r.preventDefault(),t.hasClass("redactor-button-disabled"))return!1;var o="func",s=i.func;return i.command?(o="command",s=i.command):i.dropdown&&(o="dropdown",s=!1),this.button.toggle(r,e,o,s),!1},this))},toggle:function(t,e,i,r,o){!this.detect.isIe()&&this.detect.isDesktop()||(this.utils.freezeScroll(),t.returnValue=!1),"command"===i?this.inline.format(r):"dropdown"===i?this.dropdown.show(t,e):this.button.clickCallback(t,r,e,o),"dropdown"!==i&&this.dropdown.hideAll(!1),this.opts.air&&"dropdown"!==i&&this.air.hide(t),!this.detect.isIe()&&this.detect.isDesktop()||this.utils.unfreezeScroll()},clickCallback:function(t,e,i,r){var o;if(r="undefined"==typeof r?i:r,$.isFunction(e))e.call(this,i);else if("-1"!==e.search(/\./)){if(o=e.split("."),"undefined"==typeof this[o[0]])return;"object"==typeof r?this[o[0]][o[1]].apply(this,r):this[o[0]][o[1]].call(this,r)}else"object"==typeof r?this[e].apply(this,r):this[e].call(this,r);this.observe.buttons(t,i)},all:function(){return this.button.buttons},get:function(t){if(this.opts.toolbar!==!1)return this.button.toolbar().find("a.re-"+t)},set:function(t,e){if(this.opts.toolbar!==!1){var i=this.button.toolbar().find("a.re-"+t);return i.html(e).attr("aria-label",e),i}},add:function(t,e){if(this.button.isAdded(t)!==!0)return $();var i=this.button.build(t,{title:e});return this.button.toolbar().append($("<li>").append(i)),i},addFirst:function(t,e){if(this.button.isAdded(t)!==!0)return $();var i=this.button.build(t,{title:e});return this.button.toolbar().prepend($("<li>").append(i)),i},addAfter:function(t,e,i){if(this.button.isAdded(e)!==!0)return $();var r=this.button.build(e,{title:i}),o=this.button.get(t);return 0!==o.length?o.parent().after($("<li>").append(r)):this.button.toolbar().append($("<li>").append(r)),r},addBefore:function(t,e,i){if(this.button.isAdded(e)!==!0)return $();var r=this.button.build(e,{title:i}),o=this.button.get(t);return 0!==o.length?o.parent().before($("<li>").append(r)):this.button.toolbar().append($("<li>").append(r)),r},isAdded:function(t){var e=this.opts.buttonsHideOnMobile.indexOf(t);return!(this.opts.toolbar===!1||e!==-1&&this.detect.isMobile())},setIcon:function(t,e){t.html(e)},addCallback:function(t,e){if("undefined"!=typeof t&&this.opts.toolbar!==!1){var i="dropdown"===e?"dropdown":"func",r=t.attr("rel");t.on("mousedown",$.proxy(function(o){return!t.hasClass("redactor-button-disabled")&&void this.button.toggle(o,r,i,e)},this))}},addDropdown:function(t,e){if(this.opts.toolbar!==!1){t.addClass("redactor-toolbar-link-dropdown").attr("aria-haspopup",!0);var i=t.attr("rel");this.button.addCallback(t,"dropdown");var r=$('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+i+'" style="display: none;">');return t.data("dropdown",r),e&&this.dropdown.build(i,r,e),r}},setActive:function(t){this.button.get(t).addClass("redactor-act")},setInactive:function(t){this.button.get(t).removeClass("redactor-act")},setInactiveAll:function(t){var e=this.button.toolbar().find("a.re-button");"undefined"!=typeof t&&(e=e.not(".re-"+t)),e.removeClass("redactor-act")},disable:function(t){this.button.get(t).addClass("redactor-button-disabled")},enable:function(t){this.button.get(t).removeClass("redactor-button-disabled")},disableAll:function(t){var e=this.button.toolbar().find("a.re-button");"undefined"!=typeof t&&(e=e.not(".re-"+t)),e.addClass("redactor-button-disabled")},enableAll:function(){this.button.toolbar().find("a.re-button").removeClass("redactor-button-disabled")},remove:function(t){this.button.get(t).remove()}}},caret:function(){return{set:function(t,e,i){this.core.editor().focus(),i="undefined"==typeof i?0:1,t=t[0]||t,e=e[0]||e;var r=this.selection.get(),o=this.selection.range(r);try{o.setStart(t,0),o.setEnd(e,i)}catch(t){}this.selection.update(r,o)},prepare:function(t){return this.detect.isFirefox()&&"undefined"!=typeof this.start&&this.core.editor().focus(),t[0]||t},start:function(t){var e,i;if(t=this.caret.prepare(t)){if("BR"===t.tagName)return this.caret.before(t);var r=this.utils.isInlineTag(t.tagName);if(""===t.innerHTML||r){e=window.getSelection(),i=document.createRange();var o=document.createTextNode("​");i.setStart(t,0),i.insertNode(o),i.setStartAfter(o),i.collapse(!0),e.removeAllRanges(),e.addRange(i),r||this.core.editor().on("keydown.redactor-remove-textnode",function(){$(o).remove(),$(this).off("keydown.redactor-remove-textnode")})}else e=window.getSelection(),e.removeAllRanges(),i=document.createRange(),i.selectNodeContents(t),i.collapse(!0),e.addRange(i)}},end:function(t){var e,i;if(t=this.caret.prepare(t)){if("BR"!==t.tagName&&""===t.innerHTML)return this.caret.start(t);if("BR"===t.tagName){var r=document.createElement("span");return r.className="redactor-invisible-space",r.innerHTML="&#x200b;",$(t).after(r),e=window.getSelection(),e.removeAllRanges(),i=document.createRange(),i.setStartBefore(r),i.setEndBefore(r),e.addRange(i),void $(r).replaceWith(function(){return $(this).contents()})}if(t.lastChild&&1===t.lastChild.nodeType)return this.caret.after(t.lastChild);e=window.getSelection(),e.removeAllRanges(),i=document.createRange(),i.selectNodeContents(t),i.collapse(!1),e.addRange(i)}},after:function(t){var e,i;if(t=this.caret.prepare(t)){if("BR"===t.tagName)return this.caret.end(t);if(this.utils.isBlockTag(t.tagName)){var r=this.caret.next(t);return void("undefined"==typeof r?this.caret.end(t):("TABLE"===r.tagName?r=$(r).find("th, td").first()[0]:"UL"!==r.tagName&&"OL"!==r.tagName||(r=$(r).find("li").first()[0]),
this.caret.start(r)))}var o=document.createTextNode("​");e=window.getSelection(),e.removeAllRanges(),i=document.createRange(),i.setStartAfter(t),i.insertNode(o),i.setStartAfter(o),i.collapse(!0),e.addRange(i)}},before:function(t){var e,i;if(t=this.caret.prepare(t)){if(this.utils.isBlockTag(t.tagName)){var r=this.caret.prev(t);return void("undefined"==typeof r?this.caret.start(t):("TABLE"===r.tagName?r=$(r).find("th, td").last()[0]:"UL"!==r.tagName&&"OL"!==r.tagName||(r=$(r).find("li").last()[0]),this.caret.end(r)))}e=window.getSelection(),e.removeAllRanges(),i=document.createRange(),i.setStartBefore(t),i.collapse(!0),e.addRange(i)}},next:function(t){var e=$(t).next();return e.hasClass("redactor-script-tag, redactor-selection-marker")?e.next()[0]:e[0]},prev:function(t){var e=$(t).prev();return e.hasClass("redactor-script-tag, redactor-selection-marker")?e.prev()[0]:e[0]},offset:function(t){return this.offset.get(t)}}},clean:function(){return{onSet:function(t){t=this.clean.savePreCode(t),t=this.clean.saveFormTags(t),this.opts.script&&(t=t.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" $1>$2</pre>')),t=t.replace(/\$/g,"&#36;"),t=t.replace(/&amp;/g,"&"),t=t.replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">'),t=t.replace(/<span id="selection-marker-1"(.*?[^>]?)>​<\/span>/gi,"###marker1###"),t=t.replace(/<span id="selection-marker-2"(.*?[^>]?)>​<\/span>/gi,"###marker2###");var e=this,i=$("<div/>").html($.parseHTML(t,document,!0)),r=this.opts.replaceTags;if(r){var o=Object.keys(this.opts.replaceTags);i.find(o.join(",")).each(function(t,i){e.utils.replaceToTag(i,r[i.tagName.toLowerCase()])})}i.find("span").attr("data-redactor-span",!0),t=i.html();var s=["font","html","head","link","body","meta","applet"];return this.opts.script||s.push("script"),t=this.clean.stripTags(t,s),this.opts.removeComments&&(t=t.replace(/<!--[\s\S]*?-->/gi,"")),t=this.paragraphize.load(t),t=t.replace("###marker1###",'<span id="selection-marker-1" class="redactor-selection-marker">​</span>'),t=t.replace("###marker2###",'<span id="selection-marker-2" class="redactor-selection-marker">​</span>'),t.search(/^(||\s||<br\s?\/?>||&nbsp;)$/i)!==-1?this.opts.emptyHtml:t},onGet:function(t){return this.clean.onSync(t)},onSync:function(t){if(t=t.replace(/\u200B/g,""),t=t.replace(/&#x200b;/gi,""),t.search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i)!==-1)return"";t=t.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>"),t=t.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,""),t=t.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,""),t=t.replace(/<img(.*?)style="(.*?)opacity: 0\.5;(.*?)"(.*?)>/gi,'<img$1style="$2$3"$4>');var e=$("<div/>").html($.parseHTML(t,document,!0));e.find('*[style=""]').removeAttr("style"),e.find('*[class=""]').removeAttr("class"),e.find('*[rel=""]').removeAttr("rel"),e.find(".redactor-invisible-space").each(function(){$(this).contents().unwrap()}),e.find("span").removeAttr("data-redactor-span").each(function(){0===this.attributes.length&&$(this).contents().unwrap()}),e.find("img").removeAttr("rel"),e.find(".redactor-selection-marker, #redactor-insert-marker").remove(),t=e.html(),this.opts.script&&(t=t.replace(/<pre class="redactor-script-tag"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>")),t=this.clean.restoreFormTags(t),t=t.replace(new RegExp("<br\\s?/?></h","gi"),"</h"),t=t.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>"),t=t.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>"),t=t.replace(/<pre>/gi,"<pre>\n"),this.opts.preClass&&(t=t.replace(/<pre>/gi,'<pre class="'+this.opts.preClass+'">')),this.opts.linkNofollow&&(t=t.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>"),t=t.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">'));var i={"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"};return $.each(i,function(e,i){t=t.replace(new RegExp(e,"g"),i)}),t=t.replace(/&amp;/g,"&"),t=t.replace(/<p><\/p>/gi,""),t=t.replace(/\n{2,}/g,"\n"),this.opts.removeNewlines&&(t=t.replace(/\n/g,""),t=t.replace(/\r\n/g,"")),t},onPaste:function(t,e,i){if(i!==!0){t=t.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),t=t.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),t=t.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>"),t=t.replace(/<span[^>]*(font-style: italic; font-weight: 700|font-weight: 700; font-style: italic)[^>]*>([\w\W]*?)<\/span>/gi,"<b><i>$2</i></b>"),t=t.replace(/<span[^>]*font-style: italic[^>]*>([\w\W]*?)<\/span>/gi,"<i>$1</i>"),t=t.replace(/<span[^>]*font-weight: bold[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>"),t=t.replace(/<span[^>]*font-weight: 700[^>]*>([\w\W]*?)<\/span>/gi,"<b>$1</b>");var r=this.clean.isHtmlMsWord(t);r&&(t=this.clean.cleanMsWord(t))}return t=$.trim(t),e.pre?this.opts.preSpaces&&(t=t.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))):(t=this.clean.replaceBrToNl(t),t=this.clean.removeTagsInsidePre(t)),i!==!0&&(t=this.clean.removeEmptyInlineTags(t),e.encode===!1&&(t=t.replace(/&/g,"&amp;"),t=this.clean.convertTags(t,e),t=this.clean.getPlainText(t),t=this.clean.reconvertTags(t,e))),e.text&&(t=this.clean.replaceNbspToSpaces(t),t=this.clean.getPlainText(t)),e.lists&&(t=t.replace("\n","<br>")),e.encode&&(t=this.clean.encodeHtml(t)),e.paragraphize&&(t=this.paragraphize.load(t)),t},getCurrentType:function(t,e){var i=this.selection.blocks(),r={text:!1,encode:!1,paragraphize:!0,line:this.clean.isHtmlLine(t),blocks:this.clean.isHtmlBlocked(t),pre:!1,lists:!1,block:!0,inline:!0,links:!0,images:!0};return 1===i.length&&this.utils.isCurrentOrParent(["h1","h2","h3","h4","h5","h6","a","figcaption"])?(r.text=!0,r.paragraphize=!1,r.inline=!1,r.images=!1,r.links=!1,r.line=!0):"inline"===this.opts.type||this.opts.enterKey===!1?(r.paragraphize=!1,r.block=!1,r.line=!0):1===i.length&&this.utils.isCurrentOrParent(["li"])?(r.lists=!0,r.block=!1,r.paragraphize=!1,r.images=!1):1===i.length&&this.utils.isCurrentOrParent(["th","td","blockquote"])?(r.block=!1,r.paragraphize=!1):("pre"===this.opts.type||1===i.length&&this.utils.isCurrentOrParent("pre"))&&(r.inline=!1,r.block=!1,r.encode=!0,r.pre=!0,r.paragraphize=!1,r.images=!1,r.links=!1),r.line===!0&&(r.paragraphize=!1),e===!0&&(r.text=!1),r},isHtmlBlocked:function(t){var e=t.match(new RegExp("</("+this.opts.blockTags.join("|").toUpperCase()+")>","gi")),i=t.match(new RegExp("<hr(.*?[^>])>","gi"));return null!==e||null!==i},isHtmlLine:function(t){if(this.clean.isHtmlBlocked(t))return!1;var e=t.match(/<br\s?\/?>/gi),i=t.match(/\n/gi);return!e&&!i},isHtmlMsWord:function(t){return t.match(/class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i)},removeEmptyInlineTags:function(t){var e=this.opts.inlineTags,i=$("<div/>").html($.parseHTML(t,document,!0)),r=this,o=i.find("span"),s=i.find(e.join(","));return s.removeAttr("style"),s.each(function(){var t=$(this).html();0===this.attributes.length&&r.utils.isEmpty(t)&&$(this).replaceWith(function(){return $(this).contents()})}),o.each(function(){var t=$(this).html();0===this.attributes.length&&$(this).replaceWith(function(){return $(this).contents()})}),t=i.html(),i.remove(),t},cleanMsWord:function(t){t=t.replace(/<!--[\s\S]*?-->/g,""),t=t.replace(/<o:p>[\s\S]*?<\/o:p>/gi,""),t=t.replace(/\n/g," "),t=t.replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n\n");var e=$("<div/>").html(t),i=!1,r=1,o=[];return e.find("p[style]").each(function(){var t=$(this).attr("style").match(/mso\-list\:l([0-9]+)\slevel([0-9]+)/);if(t){var s=parseInt(t[1]),n=parseInt(t[2]),a=$(this).html().match(/^[\w]+\./)?"ol":"ul",l=$("<li/>").html($(this).html());if(l.html(l.html().replace(/^([\w\.]+)</,"<")),l.find("span:first").remove(),1==n&&$.inArray(s,o)==-1){var c=$("<"+a+"/>").attr({"data-level":n,"data-list":s}).html(l);$(this).replaceWith(c),i=s,o.push(s)}else{if(n>r){for(var d=e.find('[data-level="'+r+'"][data-list="'+i+'"]'),h=d,u=r;u<n;u++)c=$("<"+a+"/>"),c.appendTo(h.find("li").last()),h=c;h.attr({"data-level":n,"data-list":s}).html(l)}else{var d=e.find('[data-level="'+n+'"][data-list="'+s+'"]').last();d.append(l)}r=n,i=s,$(this).remove()}}}),e.find("[data-level][data-list]").removeAttr("data-level data-list"),t=e.html()},replaceNbspToSpaces:function(t){return t.replace("&nbsp;"," ")},replaceBrToNl:function(t){return t.replace(/<br\s?\/?>/gi,"\n")},replaceNlToBr:function(t){return t.replace(/\n/g,"<br />")},convertTags:function(t,e){var i=$("<div>").html(t);i.find("iframe").remove();var r=i.find("a");if(r.removeAttr("style"),this.opts.pasteLinkTarget!==!1&&r.attr("target",this.opts.pasteLinkTarget),e.links&&this.opts.pasteLinks&&i.find("a").each(function(t,e){if(e.href){for(var i='##%a href="'+e.href+'"',r,o=0,s=e.attributes.length;o<s;o++)r=e.attributes.item(o),"href"!==r.name&&(i+=" "+r.name+'="'+r.value+'"');e.outerHTML=i+"%##"+e.innerHTML+"##%/a%##"}}),t=i.html(),e.images&&this.opts.pasteImages&&(t=t.replace(/<img(.*?)src="(.*?)"(.*?[^>])>/gi,'##%img$1src="$2"$3%##')),this.opts.pastePlainText)return t;var o=e.lists?["ul","ol","li"]:this.opts.pasteBlockTags,s;s=e.block||e.lists?e.inline?o.concat(this.opts.pasteInlineTags):o:e.inline?this.opts.pasteInlineTags:[];for(var n=s.length,a=0;a<n;a++)t=t.replace(new RegExp("</"+s[a]+">","gi"),"###/"+s[a]+"###"),t="td"===s[a]||"th"===s[a]?t.replace(new RegExp("<"+s[a]+'(.*?[^>])((colspan|rowspan)="(.*?[^>])")?(.*?[^>])>',"gi"),"###"+s[a]+" $2###"):"span"===s[a]?t.replace(new RegExp("<"+s[a]+'(.*?[^>])(class="(.*?[^>])")?(.*?[^>])>',"gi"),"###"+s[a]+" $2###"):t.replace(new RegExp("<"+s[a]+"[^>]*>","gi"),"###"+s[a]+"###");return t},reconvertTags:function(t,e){if((e.links&&this.opts.pasteLinks||e.images&&this.opts.pasteImages)&&(t=t.replace(new RegExp("##%","gi"),"<"),t=t.replace(new RegExp("%##","gi"),">")),this.opts.pastePlainText)return t;var i=e.lists?["ul","ol","li"]:this.opts.pasteBlockTags,r;r=e.block||e.lists?e.inline?i.concat(this.opts.pasteInlineTags):i:e.inline?this.opts.pasteInlineTags:[];for(var o=r.length,s=0;s<o;s++)t=t.replace(new RegExp("###/"+r[s]+"###","gi"),"</"+r[s]+">");for(var s=0;s<o;s++)t=t.replace(new RegExp("###"+r[s]+"###","gi"),"<"+r[s]+">");for(var s=0;s<o;s++)"td"!==r[s]&&"th"!==r[s]&&"span"!==r[s]||(t=t.replace(new RegExp("###"+r[s]+"s?(.*?[^#])###","gi"),"<"+r[s]+"$1>"));return t},cleanPre:function(t){t="undefined"==typeof t?$(this.selection.block()).closest("pre",this.core.editor()[0]):t,$(t).find("br").replaceWith(function(){return document.createTextNode("\n")}),$(t).find("p").replaceWith(function(){return $(this).contents()})},removeTagsInsidePre:function(t){var e=$("<div />").append(t);return e.find("pre").replaceWith(function(){var t=$(this).html();return t=t.replace(/<br\s?\/?>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n"),t=t.replace(/(<([^>]+)>)/gi,""),$("<pre />").append(t)}),t=e.html(),e.remove(),t},getPlainText:function(t){t=t.replace(/<!--[\s\S]*?-->/gi,""),t=t.replace(/<style[\s\S]*?style>/gi,""),t=t.replace(/<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n"),t=t.replace(/<\/H[1-6]>/gi,"\n\n");var e=document.createElement("div");return e.innerHTML=t,t=e.textContent||e.innerText,$.trim(t)},savePreCode:function(t){return t=this.clean.savePreFormatting(t),t=this.clean.saveCodeFormatting(t),t=this.clean.restoreSelectionMarkers(t)},savePreFormatting:function(t){var e=t.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null===e?t:($.each(e,$.proxy(function(e,i){var r=[],o=!1,s,n,a;i.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>/i)?(r=i.match(/<pre(.*?)>(([\n\r\s]+)?)<code(.*?)>([\w\W]*?)<\/code><\/pre>/i),o=!0,s=r[5],n=r[1],a=r[4]):(r=i.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i),s=r[2],n=r[1]),s=s.replace(/<br\s?\/?>/g,"\n"),s=s.replace(/&nbsp;/g," "),this.opts.preSpaces&&(s=s.replace(/\t/g,new Array(this.opts.preSpaces+1).join(" "))),s=this.clean.encodeEntities(s),s=s.replace(/\$/g,"&#36;"),t=o?t.replace(i,"<pre"+n+"><code"+a+">"+s+"</code></pre>"):t.replace(i,"<pre"+n+">"+s+"</pre>")},this)),t)},saveCodeFormatting:function(t){var e=t.match(/<code(.*?)>([\w\W]*?)<\/code>/gi);return null===e?t:($.each(e,$.proxy(function(e,i){var r=i.match(/<code(.*?)>([\w\W]*?)<\/code>/i);r[2]=r[2].replace(/&nbsp;/g," "),r[2]=this.clean.encodeEntities(r[2]),r[2]=r[2].replace(/\$/g,"&#36;"),t=t.replace(i,"<code"+r[1]+">"+r[2]+"</code>")},this)),t)},restoreSelectionMarkers:function(t){return t=t.replace(/&lt;span id=&quot;selection-marker-([0-9])&quot; class=&quot;redactor-selection-marker&quot;&gt;​&lt;\/span&gt;/g,'<span id="selection-marker-$1" class="redactor-selection-marker">​</span>')},saveFormTags:function(t){return t.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(t){return t.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")},encodeHtml:function(t){return t=t.replace(/”/g,'"'),t=t.replace(/“/g,'"'),t=t.replace(/‘/g,"'"),t=t.replace(/’/g,"'"),t=this.clean.encodeEntities(t)},encodeEntities:function(t){return t=String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},stripTags:function(t,e){if("undefined"==typeof e)return t.replace(/(<([^>]+)>)/gi,"");var i=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return t.replace(i,function(t,i){return e.indexOf(i.toLowerCase())===-1?t:""})},removeMarkers:function(t){return t.replace(/<span(.*?[^>]?)class="redactor-selection-marker"(.*?[^>]?)>([\w\W]*?)<\/span>/gi,"")},removeSpaces:function(t){return t=$.trim(t),t=t.replace(/\n/g,""),t=t.replace(/[\t]*/g,""),t=t.replace(/\n\s*\n/g,"\n"),t=t.replace(/^[\s\n]*/g," "),t=t.replace(/[\s\n]*$/g," "),t=t.replace(/>\s{2,}</g,"> <"),t=t.replace(/\n\n/g,"\n"),t=t.replace(/\u200B/g,"")},removeSpacesHard:function(t){return t=$.trim(t),t=t.replace(/\n/g,""),t=t.replace(/[\t]*/g,""),t=t.replace(/\n\s*\n/g,"\n"),t=t.replace(/^[\s\n]*/g,""),t=t.replace(/[\s\n]*$/g,""),t=t.replace(/>\s{2,}</g,"><"),t=t.replace(/\n\n/g,"\n"),t=t.replace(/\u200B/g,"")},normalizeCurrentHeading:function(){var t=this.selection.block();this.utils.isCurrentOrParentHeader()&&t&&t.normalize()}}},code:function(){return{syncFire:!0,html:!1,start:function(t){t=$.trim(t),t=t.replace(/^(<span id="selection-marker-1" class="redactor-selection-marker">​<\/span>)/,""),"textarea"===this.opts.type?t=this.clean.onSet(t):"div"===this.opts.type&&""===t&&(t=this.opts.emptyHtml),this.events.stopDetectChanges(),this.core.editor().html(t),this.observe.load(),this.events.startDetectChanges()},set:function(t,e){t=$.trim(t),e=e||{},e.start&&(this.start=e.start),"textarea"===this.opts.type?t=this.clean.onSet(t):"div"===this.opts.type&&""===t&&(t=this.opts.emptyHtml),this.core.editor().html(t),"textarea"===this.opts.type&&this.code.sync(),this.placeholder.enable()},get:function(){if("textarea"===this.opts.type)return this.core.textarea().val();var t=this.core.editor().html();return t=this.clean.onGet(t)},sync:function(){if(this.code.syncFire){var t=this.core.editor().html(),e=this.code.cleaned(t);if(!this.code.isSync(e))return this.code.html=e,"textarea"!==this.opts.type?(this.core.callback("sync",t),void this.core.callback("change",t)):void("textarea"===this.opts.type&&setTimeout($.proxy(function(){this.code.startSync(t)},this),10))}},startSync:function(t){t=this.core.callback("syncBefore",t),t=this.clean.onSync(t),this.core.textarea().val(t),this.core.callback("sync",t),this.start===!1&&this.core.callback("change",t),this.start=!1},isSync:function(t){var e=this.code.html!==!1&&this.code.html;return e!==!1&&e===t},cleaned:function(t){return t=t.replace(/\u200B/g,""),this.clean.removeMarkers(t)}}},core:function(){return{id:function(){return this.$editor.attr("id")},element:function(){return this.$element},editor:function(){return"undefined"==typeof this.$editor?$():this.$editor},textarea:function(){return this.$textarea},box:function(){return"textarea"===this.opts.type?this.$box:this.$element},toolbar:function(){return!!this.$toolbar&&this.$toolbar},air:function(){return!!this.$air&&this.$air},object:function(){return $.extend({},this)},structure:function(){this.core.editor().toggleClass("redactor-structure")},addEvent:function(t){this.core.event=t},getEvent:function(){return this.core.event},callback:function(t,e,i){var r="redactor",o=!1,s=$._data(this.core.element()[0],"events");if("undefined"!=typeof s&&"undefined"!=typeof s[t])for(var n=s[t].length,a=0;a<n;a++){var l=s[t][a].namespace;if(l==="callback."+r){var c=s[t][a].handler,d="undefined"==typeof i?[e]:[e,i];o="undefined"==typeof d?c.call(this,e):c.call(this,e,d)}}if(o)return o;if("undefined"==typeof this.opts.callbacks[t])return"undefined"==typeof i?e:i;var h=this.opts.callbacks[t];return $.isFunction(h)?"undefined"==typeof i?h.call(this,e):h.call(this,e,i):"undefined"==typeof i?e:i},destroy:function(){this.opts.destroyed=!0,this.core.callback("destroy"),this.placeholder.destroy(),this.progress.destroy(),$("#redactor-voice-"+this.uuid).remove(),this.core.editor().removeClass("redactor-in redactor-styles redactor-structure redactor-editor-img-edit"),this.core.editor().off("keydown.redactor-remove-textnode"),this.core.editor().off(".redactor-observe."+this.uuid),this.$element.off(".redactor").removeData("redactor"),this.core.editor().off(".redactor"),$(document).off(".redactor-dropdown"),$(document).off(".redactor-air."+this.uuid),$(document).off("mousedown.redactor-blur."+this.uuid),$(document).off("mousedown.redactor."+this.uuid),$(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),$(window).off(".redactor-toolbar."+this.uuid),$(window).off("touchmove.redactor."+this.uuid),$("body").off("scroll.redactor."+this.uuid),$(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid);var t=this;this.opts.plugins!==!1&&$.each(this.opts.plugins,function(e,i){$(window).off(".redactor-plugin-"+i),$(document).off(".redactor-plugin-"+i),$("body").off(".redactor-plugin-"+i),t.core.editor().off(".redactor-plugin-"+i)}),this.$element.off("click.redactor-click-to-edit"),this.$element.removeClass("redactor-click-to-edit"),this.core.editor().removeClass("redactor-editor"),this.core.editor().removeAttr("contenteditable");var e=this.code.get();this.opts.toolbar&&this.$toolbar&&this.$toolbar.find("a").each(function(){var t=$(this);t.data("dropdown")&&(t.data("dropdown").remove(),t.data("dropdown",{}))}),"textarea"===this.opts.type&&(this.$box.after(this.$element),this.$box.remove(),this.$element.val(e).show()),this.opts.air&&this.$air.remove(),this.opts.toolbar&&this.$toolbar&&this.$toolbar.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),$(".redactor-link-tooltip").remove(),clearInterval(this.autosaveTimeout)}}},detect:function(){return{isWebkit:function(){return/webkit/.test(this.opts.userAgent)},isFirefox:function(){return this.opts.userAgent.indexOf("firefox")>-1},isIe:function(t){if(document.documentMode||/Edge/.test(navigator.userAgent))return"edge";var e;return e=RegExp("msie"+(isNaN(t)?"":"\\s"+t),"i").test(navigator.userAgent),e||(e=!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)),e},isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isIpad:function(){return/iPad/.test(navigator.userAgent)}}},dropdown:function(){return{active:!1,button:!1,key:!1,position:[],getDropdown:function(){return this.dropdown.active},build:function(t,e,i){i=this.dropdown.buildFormatting(t,i),$.each(i,$.proxy(function(i,r){var o=this.dropdown.buildItem(i,r);this.observe.addDropdown(o,i,r),e.attr("rel",t).append(o)},this))},buildFormatting:function(t,e){return"format"!==t||this.opts.formattingAdd===!1?e:($.each(this.opts.formattingAdd,$.proxy(function(t,i){var r=this.utils.isBlockTag(i.args[0])?"block":"inline";e[t]={func:"block"===r?"block.format":"inline.format",args:i.args,title:i.title}},this)),e)},buildItem:function(t,e){var i=$("<li />");if("undefined"!=typeof e.classname&&i.addClass(e.classname),t.search(/^divider/i)!==-1)return i.addClass("redactor-dropdown-divider"),i;var r=$('<a href="#" class="redactor-dropdown-'+t+'" role="button" />'),o=$("<span />").html(e.title);return r.append(o),r.on("mousedown",$.proxy(function(i){i.preventDefault(),this.dropdown.buildClick(i,t,e)},this)),i.append(r),i},buildClick:function(t,e,i){if(!$(t.target).hasClass("redactor-dropdown-link-inactive")){var r=this.dropdown.buildCommand(i);" undefined"!=typeof i.args?this.button.toggle(t,e,r.type,r.callback,i.args):this.button.toggle(t,e,r.type,r.callback)}},buildCommand:function(t){var e={};return e.type="func",e.callback=t.func,t.command?(e.type="command",e.callback=t.command):t.dropdown&&(e.type="dropdown",e.callback=t.dropdown),e},show:function(t,e){return this.detect.isDesktop()&&this.core.editor().focus(),this.dropdown.hideAll(!1,e),this.dropdown.key=e,this.dropdown.button=this.button.get(this.dropdown.key),this.dropdown.button.hasClass("dropact")?void this.dropdown.hide():(this.dropdown.active=this.dropdown.button.data("dropdown").appendTo(document.body),this.core.callback("dropdownShow",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button}),this.button.setActive(this.dropdown.key),this.dropdown.button.addClass("dropact"),this.dropdown.getButtonPosition(),this.button.toolbar().hasClass("toolbar-fixed-box")&&this.detect.isDesktop()?this.dropdown.showIsFixedToolbar():this.dropdown.showIsUnFixedToolbar(),this.detect.isDesktop()&&!this.detect.isFirefox()&&(this.dropdown.active.on("mouseover.redactor-dropdown",$.proxy(this.utils.disableBodyScroll,this)),this.dropdown.active.on("mouseout.redactor-dropdown mousedown.redactor-dropdown",$.proxy(this.utils.enableBodyScroll,this))),void t.stopPropagation())},showIsFixedToolbar:function(){var t=this.dropdown.button.position().top+this.dropdown.button.innerHeight()+this.opts.toolbarFixedTopOffset,e="fixed";this.opts.toolbarFixedTarget!==document&&(t=this.dropdown.button.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,e="absolute"),this.dropdown.active.css({position:e,left:this.dropdown.position.left+"px",top:t+"px"}).show(),this.dropdown.active.redactorAnimation("slideDown",{duration:.2},$.proxy(function(){this.dropdown.enableCallback(),this.dropdown.enableEvents()},this))},showIsUnFixedToolbar:function(){this.dropdown.active.css({position:"absolute",left:this.dropdown.position.left+"px",top:this.dropdown.button.innerHeight()+this.dropdown.position.top+"px"}).show(),this.dropdown.active.redactorAnimation(this.opts.animation?"slideDown":"show",{duration:.2},$.proxy(function(){this.dropdown.enableCallback(),this.dropdown.enableEvents()},this))},enableEvents:function(){$(document).on("mousedown.redactor-dropdown",$.proxy(this.dropdown.hideAll,this)),this.core.editor().on("touchstart.redactor-dropdown",$.proxy(this.dropdown.hideAll,this)),$(document).on("keyup.redactor-dropdown",$.proxy(this.dropdown.closeHandler,this))},enableCallback:function(){this.core.callback("dropdownShown",{dropdown:this.dropdown.active,key:this.dropdown.key,button:this.dropdown.button})},getButtonPosition:function(){this.dropdown.position=this.dropdown.button.offset();var t=this.dropdown.active.width();this.dropdown.position.left+t>$(document).width()&&(this.dropdown.position.left=Math.max(0,this.dropdown.position.left-t+parseInt(this.dropdown.button.innerWidth())))},closeHandler:function(t){t.which===this.keyCode.ESC&&(this.dropdown.hideAll(t),this.core.editor().focus())},hideAll:function(t,e){if(this.detect.isDesktop()&&this.utils.enableBodyScroll(),t===!1||0===$(t.target).closest(".redactor-dropdown").length){var i="undefined"==typeof e?this.button.toolbar().find("a.dropact"):this.button.toolbar().find("a.dropact").not(".re-"+e),r="undefined"==typeof e?$(".redactor-dropdown-"+this.uuid):$(".redactor-dropdown-"+this.uuid).not(".redactor-dropdown-box-"+e);0!==r.length&&($(document).off(".redactor-dropdown"),this.core.editor().off(".redactor-dropdown"),$.each(r,$.proxy(function(t,e){var i=$(e);this.core.callback("dropdownHide",i),i.hide(),i.off("mouseover mouseout").off(".redactor-dropdown")},this)),i.removeClass("redactor-act dropact"))}},hide:function(){this.dropdown.active!==!1&&(this.detect.isDesktop()&&this.utils.enableBodyScroll(),this.dropdown.active.redactorAnimation(this.opts.animation?"slideUp":"hide",{duration:.2},$.proxy(function(){$(document).off(".redactor-dropdown"),this.core.editor().off(".redactor-dropdown"),this.dropdown.hideOut()},this)))},hideOut:function(){this.core.callback("dropdownHide",this.dropdown.active),this.dropdown.button.removeClass("redactor-act dropact"),this.dropdown.active.off("mouseover mouseout").off(".redactor-dropdown"),this.dropdown.button=!1,this.dropdown.key=!1,this.dropdown.active=!1}}},events:function(){return{focused:!1,blured:!0,dropImage:!1,stopChanges:!1,stopDetectChanges:function(){this.events.stopChanges=!0},startDetectChanges:function(){var t=this;setTimeout(function(){t.events.stopChanges=!1},1)},dragover:function(t){t.preventDefault(),t.stopPropagation(),"IMG"===t.target.tagName&&$(t.target).addClass("redactor-image-dragover")},dragleave:function(t){this.core.editor().find("img").removeClass("redactor-image-dragover")},drop:function(t){return t=t.originalEvent||t,this.core.editor().find("img").removeClass("redactor-image-dragover"),"inline"===this.opts.type||"pre"===this.opts.type?(t.preventDefault(),!1):void 0===window.FormData||!t.dataTransfer||(0===t.dataTransfer.files.length?this.events.onDrop(t):(this.events.onDropUpload(t),void this.core.callback("drop",t)))},click:function(t){var e=this.core.getEvent(),i="click"!==e&&"arrow"!==e&&"click";this.core.addEvent(i),this.utils.disableSelectAll(),this.core.callback("click",t)},focus:function(t){if(!this.rtePaste&&(this.events.isCallback("focus")&&this.core.callback("focus",t),this.events.focused=!0,this.events.blured=!1,this.selection.current()===!1)){var e=this.selection.get(),i=this.selection.range(e);i.setStart(this.core.editor()[0],0),i.setEnd(this.core.editor()[0],0),this.selection.update(e,i)}},blur:function(t){this.start||this.rtePaste||0===$(t.target).closest("#"+this.core.id()+", .redactor-toolbar, .redactor-dropdown, #redactor-modal-box").length&&(!this.events.blured&&this.events.isCallback("blur")&&this.core.callback("blur",t),this.events.focused=!1,this.events.blured=!0)},touchImageEditing:function(){var t=-1;this.events.imageEditing=!1,$(window).on("touchmove.redactor."+this.uuid,$.proxy(function(){this.events.imageEditing=!0,t!==-1&&clearTimeout(t),t=setTimeout($.proxy(function(){this.events.imageEditing=!1},this),500)},this))},init:function(){this.core.editor().on("dragover.redactor dragenter.redactor",$.proxy(this.events.dragover,this)),this.core.editor().on("dragleave.redactor",$.proxy(this.events.dragleave,this)),this.core.editor().on("drop.redactor",$.proxy(this.events.drop,this)),this.core.editor().on("click.redactor",$.proxy(this.events.click,this)),this.core.editor().on("paste.redactor",$.proxy(this.paste.init,this)),this.core.editor().on("keydown.redactor",$.proxy(this.keydown.init,this)),this.core.editor().on("keyup.redactor",$.proxy(this.keyup.init,this)),this.core.editor().on("focus.redactor",$.proxy(this.events.focus,this)),$(document).on("mousedown.redactor-blur."+this.uuid,$.proxy(this.events.blur,this)),this.events.touchImageEditing(),this.events.createObserver(),this.events.setupObserver()},createObserver:function(){var t=this;this.events.observer=new MutationObserver(function(e){e.forEach($.proxy(t.events.iterateObserver,t))})},iterateObserver:function(t){var e=!1;(("textarea"===this.opts.type||"div"===this.opts.type)&&!this.detect.isFirefox()&&t.target===this.core.editor()[0]||"class"===t.attributeName&&t.target===this.core.editor()[0])&&(e=!0),e||(this.observe.load(),this.events.changeHandler())},setupObserver:function(){this.events.observer.observe(this.core.editor()[0],{attributes:!0,subtree:!0,childList:!0,characterData:!0,characterDataOldValue:!0})},changeHandler:function(){this.events.stopChanges||(this.code.sync(),this.autosave.is()&&(clearTimeout(this.autosaveTimeout),this.autosaveTimeout=setTimeout($.proxy(this.autosave.send,this),300)))},onDropUpload:function(t){if(t.preventDefault(),t.stopPropagation(),(this.opts.dragImageUpload||this.opts.dragFileUpload)&&(null!==this.opts.imageUpload||null!==this.opts.fileUpload)){"IMG"===t.target.tagName&&(this.events.dropImage=t.target);for(var e=t.dataTransfer.files,i=e.length,r=0;r<i;r++)this.upload.directUpload(e[r],t)}},onDrop:function(t){this.core.callback("drop",t)},isCallback:function(t){return"undefined"!=typeof this.opts.callbacks[t]&&$.isFunction(this.opts.callbacks[t])},stopDetect:function(){this.events.stopDetectChanges()},startDetect:function(){this.events.startDetectChanges()}}},file:function(){return{is:function(){return!(!this.opts.fileUpload||!this.opts.fileUpload&&!this.opts.s3)},show:function(){this.modal.load("file",this.lang.get("file"),700),this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert),$("#redactor-filename").val(this.selection.get().toString()),this.modal.show()},insert:function(t,e,i){if("undefined"!=typeof t.error)return this.modal.close(),void this.core.callback("fileUploadError",t);this.file.release(i,e),this.buffer.set(),this.air.collapsed();var r=this.file.text(t),o=$("<a />").attr("href",t.url).text(r),s="undefined"==typeof t.id?"":t.id,n="undefined"==typeof t.s3?"file":"s3";o.attr("data-"+n,s),o=$(this.insert.node(o)),this.caret.after(o),this.storage.add({type:n,node:o[0],url:o[0].href,id:s}),null!==e&&this.core.callback("fileUpload",o,t)},release:function(t,e){e?(this.marker.remove(),this.insert.nodeToPoint(t,this.marker.get()),this.selection.restore()):this.modal.close()},text:function(t){var e=$("#redactor-filename").val();return"undefined"==typeof e||""===e?t.name:e}}},focus:function(){return{start:function(){if(this.core.editor().focus(),"inline"!==this.opts.type){var t=this.focus.first();t!==!1&&this.caret.start(t)}},end:function(){this.core.editor().focus();var t=this.opts.inline?this.core.editor():this.focus.last();if(0!==t.length){var e=this.focus.lastChild(t);if(this.detect.isWebkit()||e===!1){var i=this.selection.get(),r=this.selection.range(i);null!==r?(r.selectNodeContents(t[0]),r.collapse(!1),this.selection.update(i,r)):this.caret.end(t)}else this.caret.end(e)}},first:function(){var t=this.core.editor().children().first();return(0!==t.length||0!==t[0].length&&"BR"!==t[0].tagName&&"HR"!==t[0].tagName&&3!==t[0].nodeType)&&("UL"===t[0].tagName||"OL"===t[0].tagName?t.find("li").first():t)},last:function(){return this.core.editor().children().last()},lastChild:function(t){var e=t[0].lastChild;return!(null===e||!this.utils.isInlineTag(e.tagName))&&e},is:function(){return this.core.editor()[0]===document.activeElement}}},image:function(){return{is:function(){return!(!this.opts.imageUpload||!this.opts.imageUpload&&!this.opts.s3)},show:function(){this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.modal.show()},insert:function(t,e,i){var r;if("undefined"!=typeof t.error)return this.modal.close(),this.events.dropImage=!1,void this.core.callback("imageUploadError",t,i);if(this.events.dropImage!==!1)return r=$(this.events.dropImage),this.core.callback("imageDelete",r[0].src,r),r.attr("src",t.url),this.events.dropImage=!1,void this.core.callback("imageUpload",r,t);this.placeholder.hide();var o=$("<"+this.opts.imageTag+">");r=$("<img>"),r.attr("src",t.url);var s="undefined"==typeof t.id?"":t.id,n="undefined"==typeof t.s3?"image":"s3";r.attr("data-"+n,s),o.append(r);var a=this.utils.isTag(this.selection.current(),"pre");if(e){this.air.collapsed(),this.marker.remove();var l=this.insert.nodeToPoint(i,this.marker.get()),c=$(l).next();
this.selection.restore(),this.buffer.set(),"undefined"!=typeof c&&0!==c.length&&"IMG"===c[0].tagName?(this.core.callback("imageDelete",c[0].src,c),c.closest("figure, p",this.core.editor()[0]).replaceWith(o),this.caret.after(o)):(a?$(a).after(o):this.insert.node(o),this.caret.after(o))}else this.modal.close(),this.buffer.set(),this.air.collapsed(),a?$(a).after(o):this.insert.node(o),this.caret.after(o);this.events.dropImage=!1,this.storage.add({type:n,node:r[0],url:r[0].src,id:s}),null!==e?this.core.callback("imageUpload",r,t):this.core.callback("imageInserted",r,t)},setEditable:function(t){if(t.on("dragstart",function(t){t.preventDefault()}),this.opts.imageResizable){var e=$.proxy(function(e){this.observe.image=t,this.image.resizer=this.image.loadEditableControls(t),$(document).on("mousedown.redactor-image-resize-hide."+this.uuid,$.proxy(this.image.hideResize,this)),this.image.resizer.on("mousedown.redactor touchstart.redactor",$.proxy(function(e){this.image.setResizable(e,t)},this))},this);t.off("mousedown.redactor").on("mousedown.redactor",$.proxy(this.image.hideResize,this)),t.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",e)}else t.off("click.redactor touchstart.redactor").on("click.redactor touchstart.redactor",$.proxy(function(e){setTimeout($.proxy(function(){this.image.showEdit(t)},this),200)},this))},setResizable:function(t,e){t.preventDefault(),this.image.resizeHandle={x:t.pageX,y:t.pageY,el:e,ratio:e.width()/e.height(),h:e.height()},t=t.originalEvent||t,t.targetTouches&&(this.image.resizeHandle.x=t.targetTouches[0].pageX,this.image.resizeHandle.y=t.targetTouches[0].pageY),this.image.startResize()},startResize:function(){$(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",$.proxy(this.image.moveResize,this)),$(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",$.proxy(this.image.stopResize,this))},moveResize:function(t){t.preventDefault(),t=t.originalEvent||t;var e=this.image.resizeHandle.h;e+=t.targetTouches?t.targetTouches[0].pageY-this.image.resizeHandle.y:t.pageY-this.image.resizeHandle.y;var i=Math.round(e*this.image.resizeHandle.ratio);if(!(e<50||i<100)){var e=Math.round(this.image.resizeHandle.el.width()/this.image.resizeHandle.ratio);this.image.resizeHandle.el.attr({width:i,height:e}),this.image.resizeHandle.el.width(i),this.image.resizeHandle.el.height(e),this.code.sync()}},stopResize:function(){this.handle=!1,$(document).off(".redactor-image-resize"),this.image.hideResize()},hideResize:function(t){if(!t||0===$(t.target).closest("#redactor-image-box",this.$editor[0]).length){if(t&&"IMG"==t.target.tagName)var e=$(t.target);var i=this.$editor.find("#redactor-image-box");0!==i.length&&($("#redactor-image-editter").remove(),$("#redactor-image-resizer").remove(),i.find("img").css({marginTop:i[0].style.marginTop,marginBottom:i[0].style.marginBottom,marginLeft:i[0].style.marginLeft,marginRight:i[0].style.marginRight}),i.css("margin",""),i.find("img").css("opacity",""),i.replaceWith(function(){return $(this).contents()}),$(document).off("mousedown.redactor-image-resize-hide."+this.uuid),"undefined"!=typeof this.image.resizeHandle&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")))}},loadResizableControls:function(t,e){if(this.opts.imageResizable&&!this.detect.isMobile()){var i=$('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.detect.isDesktop()||i.css({width:"15px",height:"15px"}),i.attr("contenteditable",!1),e.append(i),e.append(t),i}return e.append(t),!1},loadEditableControls:function(t){var e=$('<span id="redactor-image-box" data-redactor="verified">');if(e.css("float",t.css("float")).attr("contenteditable",!1),"auto"!=t[0].style.margin?(e.css({marginTop:t[0].style.marginTop,marginBottom:t[0].style.marginBottom,marginLeft:t[0].style.marginLeft,marginRight:t[0].style.marginRight}),t.css("margin","")):e.css({display:"block",margin:"auto"}),t.css("opacity",".5").after(e),this.opts.imageEditable){this.image.editter=$('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",$.proxy(function(){this.image.showEdit(t)},this)),e.append(this.image.editter);var i=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+i/2+"px")}return this.image.loadResizableControls(t,e)},showEdit:function(t){if(!this.events.imageEditing){this.observe.image=t;var e=t.closest("a",this.$editor[0]),i=t.closest("figure",this.$editor[0]),r=0!==i.length?i:t;if(this.modal.load("image-edit",this.lang.get("edit"),705),this.image.buttonDelete=this.modal.getDeleteButton().text(this.lang.get("delete")),this.image.buttonSave=this.modal.getActionButton().text(this.lang.get("save")),this.image.buttonDelete.on("click",$.proxy(this.image.remove,this)),this.image.buttonSave.on("click",$.proxy(this.image.update,this)),this.opts.imageCaption===!1)$("#redactor-image-caption").val("").hide().prev().hide();else{var o=t.closest(this.opts.imageTag,this.$editor[0]),s=o.find("figcaption");0!==s&&$("#redactor-image-caption").val(s.text()).show()}if(this.opts.imagePosition){var n=0!==i.length?"center"===r.css("text-align"):"block"==r.css("display")&&"none"==r.css("float"),a=n?"center":r.css("float");$("#redactor-image-align").val(a)}else $(".redactor-image-position-option").hide();$("#redactor-image-preview").html($('<img src="'+t.attr("src")+'" style="max-width: 100%;">')),$("#redactor-image-title").val(t.attr("alt"));var l=$("#redactor-image-link");l.attr("href",t.attr("src")),0!==e.length&&(l.val(e.attr("href")),"_blank"===e.attr("target")&&$("#redactor-image-link-blank").prop("checked",!0)),$(".redactor-link-tooltip").remove(),this.modal.show(),this.detect.isDesktop()&&$("#redactor-image-title").focus()}},update:function(){var t=this.observe.image,e=t.closest("a",this.core.editor()[0]),i=$("#redactor-image-title").val().replace(/(<([^>]+)>)/gi,"");t.attr("alt",i).attr("title",i),this.image.setFloating(t);var r=$.trim($("#redactor-image-link").val()).replace(/(<([^>]+)>)/gi,"");if(""!==r){var o="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",s=new RegExp("^(http|ftp|https)://"+o,"i"),n=new RegExp("^"+o,"i");r.search(s)===-1&&0===r.search(n)&&this.opts.linkProtocol&&(r=this.opts.linkProtocol+"://"+r);var a=!!$("#redactor-image-link-blank").prop("checked");if(0===e.length){var l=$('<a href="'+r+'" id="redactor-img-tmp">'+this.utils.getOuterHtml(t)+"</a>");a&&l.attr("target","_blank"),t=t.replaceWith(l),e=this.core.editor().find("#redactor-img-tmp"),e.removeAttr("id")}else e.attr("href",r),a?e.attr("target","_blank"):e.removeAttr("target")}else 0!==e.length&&e.replaceWith(this.utils.getOuterHtml(t));this.image.addCaption(t,e),this.modal.close(),this.buffer.set()},setFloating:function(t){var e=t.closest("figure",this.$editor[0]),i=0!==e.length?e:t,r=$("#redactor-image-align").val(),o="",s="",n="",a="";switch(r){case"left":o="left",n="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":o="right",n="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":0!==e.length?a="center":(s="block",n="auto")}i.css({float:o,display:s,margin:n,"text-align":a}),i.attr("rel",t.attr("style"))},addCaption:function(t,e){var i=$("#redactor-image-caption").val(),r=0!==e.length?e:t,o=r.next();0!==o.length&&"FIGCAPTION"===o[0].tagName||(o=!1),""!==i?o===!1?(o=$("<figcaption />").text(i),r.after(o)):o.text(i):o!==!1&&o.remove()},remove:function(t,e,i){e="undefined"==typeof e?$(this.observe.image):e,"boolean"!=typeof t&&this.buffer.set(),this.events.stopDetectChanges();var r=e.closest("a",this.core.editor()[0]),o=e.closest(this.opts.imageTag,this.core.editor()[0]),s=e.parent();0!==$("#redactor-image-box").length&&(s=$("#redactor-image-box").parent());var n;0!==o.length?(n=o.next(),o.remove()):0!==r.length?(s=r.parent(),r.remove()):e.remove(),$("#redactor-image-box").remove(),t!==!1&&(0!==o.length&&0!==n.length?this.caret.start(n):0!==s.length&&this.caret.start(s)),"boolean"!=typeof t&&this.modal.close(),this.utils.restoreScroll(),this.observe.image=!1,this.events.startDetectChanges(),this.placeholder.enable(),this.code.sync()}}},indent:function(){return{increase:function(){if(this.list.get()){var t=$(this.selection.current()).closest("li"),e=t.closest("ul, ol",this.core.editor()[0]),i=t.closest("li"),r=i.prev();if(0!==r.length&&"LI"===r[0].tagName)if(this.buffer.set(),this.utils.isCollapsed()){var o=e[0].tagName,s=$("<"+o+" />");this.selection.save(),s.append(t),r.append(s),this.selection.restore()}else document.execCommand("indent"),this.selection.save(),this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore()}},decrease:function(){if(this.list.get()){var t=$(this.selection.current()).closest("li"),e=t.closest("ul, ol",this.core.editor()[0]);this.buffer.set(),document.execCommand("outdent");var i=$(this.selection.current()).closest("li",this.core.editor()[0]);if(this.utils.isCollapsed()&&this.indent.repositionItem(i),0===i.length){document.execCommand("formatblock",!1,"p"),i=$(this.selection.current());var r=i.next();0!==r.length&&"BR"===r[0].tagName&&r.remove()}this.selection.save(),this.indent.removeEmpty(),this.indent.normalize(),this.selection.restore()}},repositionItem:function(t){var e=t.next();0===e.length||"UL"===e[0].tagName&&"OL"===e[0].tagName||t.append(e);var i=t.prev();if(0!==i.length&&"LI"!==i[0].tagName){this.selection.save();var r=t.parents("li",this.core.editor()[0]);r.after(t),this.selection.restore()}},normalize:function(){this.core.editor().find("li").each($.proxy(function(t,e){var i=$(e);i.find(this.opts.inlineTags.join(",")).each(function(){$(this).removeAttr("style")});var r=i.parent();if(0!==r.length&&"LI"===r[0].tagName)return void r.after(i);var o=i.next();0===o.length||"UL"!==o[0].tagName&&"OL"!==o[0].tagName||i.append(o)},this))},removeEmpty:function(t){var e=this.core.editor().find("ul, ol"),i=this.core.editor().find("li");i.each($.proxy(function(t,e){this.indent.removeItemEmpty(e)},this)),e.each($.proxy(function(t,e){this.indent.removeItemEmpty(e)},this)),i.each($.proxy(function(t,e){this.indent.removeItemEmpty(e)},this))},removeItemEmpty:function(t){var e=t.innerHTML.replace(/[\t\s\n]/g,"");e=e.replace(/<span><\/span>/g,""),""===e&&$(t).remove()}}},inline:function(){return{getClearedNodes:function(){for(var t=this.selection.nodes(),e=[],i=t.length,r=i,o=0;o<i;o++)o>r&&!this.utils.isBlockTag(t[o].tagName)&&e.push(t[o]),$(t[o]).hasClass("redactor-selection-marker")&&(r=o+1);return e},isConvertableAttr:function(t,e,i){var r=$(t).attr(e);if(r)if("style"===e){i=$.trim(i).replace(/;$/,"");for(var o=i.split(";"),s=0,n=0;n<o.length;n++){var a=o[n].split(":"),l=$.trim(a[0]),c=$.trim(a[1]);if(l.search(/color/)!==-1){var d=$(t).css(l);!d||d!==c&&this.utils.rgb2hex(d)!==c||s++}else $(t).css(l)===c&&s++}if(s===o.length)return 1}else if(r===i)return 1;return 0},isConvertable:function(t,e,i,r){if(e===i){if(!r)return!0;var o=0;for(var s in r)o+=this.inline.isConvertableAttr(t,s,r[s]);if(o===Object.keys(r).length)return!0}return!1},setNodesStriked:function(t,e,i){for(var r=0;r<t.length;r++){var o=t[r].tagName?t[r].tagName.toLowerCase():void 0,s=t[r].parentNode,n=s&&s.tagName?s.tagName.toLowerCase():void 0,a=this.inline.isConvertable(s,n,e,i);if(a){var l=$(s).replaceWith(function(){return $("<strike>").append($(this).contents())});l.attr("data-redactor-inline-converted")}var a=this.inline.isConvertable(t[r],o,e,i);if(a)var l=$(t[r]).replaceWith(function(){return $("<strike>").append($(this).contents())})}},format:function(t,e,i,r){if("undefined"!=typeof e&&"object"!=typeof e){var o={};o[e]=i,e=o}if(t=t.toLowerCase(),!this.utils.isCurrentOrParent(["PRE","CODE"])){for(var s=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],n=["strong","strong","em","em","u","del","del","sup","sub"],a=0;a<s.length;a++)t===s[a]&&(t=n[a]);this.placeholder.hide(),this.buffer.set(),this.utils.isCollapsed()?this.inline.formatCollapsed(t,e,i,r):this.inline.formatUncollapsed(t,e,i,r)}},formatUncollapsed:function(t,e,i,r){this.selection.save();var o=this.inline.getClearedNodes();this.inline.setNodesStriked(o,t,e),this.selection.restore(),document.execCommand("strikethrough"),this.selection.save();var s=this;this.core.editor().find("strike").each(function(){var i=s.utils.replaceToTag(this,t);for(var o in e)s.inline.setAttr(i,o,e[o],r)}),this.selection.restore()},formatCollapsed:function(t,e,i,r){var o=this.selection.inline();if(o){var s=o.tagName.toLowerCase();if(s===t)if(this.utils.isEmpty(o.innerHTML))this.caret.after(o),$(o).remove();else{var n=this.inline.insertBreakpoint(o,s);this.caret.after(n)}else 0===$(o).closest(t).length?this.inline.insertInline(t,e,i,r):this.caret.start(o)}else this.inline.insertInline(t,e,i,r)},insertBreakpoint:function(t,e){var i=document.createElement("span");i.id="redactor-inline-breakpoint",i=this.insert.node(i);var r=this.utils.isEndOfElement(t),o=this.utils.getOuterHtml(t),s=r?"":"<"+e+">";o=o.replace(/<span\sid="redactor-inline-breakpoint">​<\/span>/i,"</"+e+">"+s);var n=$(o);return $(t).replaceWith(n),""!==s&&this.utils.cloneAttributes(t,n.last()),n.first()},insertInline:function(t,e,i,r){var o=document.createElement(t);o=this.inline.setAttr(o,e,i,r),this.insert.node(o),this.caret.start(o)},setAttr:function(t,e,i,r){if("undefined"==typeof e)return t;var o="undefined"==typeof r?"toggle":r;return"class"===e?t=this.inline[o+"Class"](i,t):"remove"===o?t=this.inline[o+"Attr"](e,t):"removeAll"===o?t=this.inline[o+"Attr"](t):(t=this.inline[o+"Attr"](e,i,t),"style"===e&&"SPAN"===t[0].tagName&&$(t).attr("data-redactor-span",!0)),t},getInlines:function(t){return"undefined"==typeof t?this.selection.inlines():t},update:function(t,e,i,r){var o=this.selection.inlines(),s=[],n=this;return $.each(o,function(o,a){if($.isArray(t)){if($.inArray(a.tagName.toLowerCase(),t)===-1)return}else if("*"!==t&&a.tagName.toLowerCase()!==t)return;s.push(n.inline.setAttr(a,e,i,r))}),s},replaceClass:function(t,e){return $(this.inline.getInlines(e)).removeAttr("class").addClass(t)[0]},toggleClass:function(t,e){return $(this.inline.getInlines(e)).toggleClass(t)[0]},addClass:function(t,e){return $(this.inline.getInlines(e)).addClass(t)[0]},removeClass:function(t,e){return $(this.inline.getInlines(e)).removeClass(t)[0]},removeAllClass:function(t){return $(this.inline.getInlines(t)).removeAttr("class")[0]},replaceAttr:function(t,e,i){return t=this.inline.removeAttr(e,this.inline.getInlines(t)),$(t).attr(e,i)[0]},toggleAttr:function(t,e,i){i=this.inline.getInlines(i);var r=this,o=[];return $.each(i,function(i,s){var n=$(s);n.attr(t)?o.push(r.inline.removeAttr(t,s)):o.push(r.inline.addAttr(t,e,s))}),o},addAttr:function(t,e,i){return $(this.inline.getInlines(i)).attr(t,e)[0]},removeAttr:function(t,e){return $(this.inline.getInlines(e)).removeAttr(t)[0]},removeAllAttr:function(t){t=this.inline.getInlines(t);var e=[];return $.each(t,function(t,i){"undefined"==typeof i.attributes&&e.push(i);for(var r=$(i),o=i.attributes.length,s=0;s<o;s++)r.removeAttr(i.attributes[s].name);e.push(r[0])}),e},removeFormat:function(){document.execCommand("removeFormat")},removeStyleRule:function(t){this.buffer.set();var e=this.selection.parent(),i=this.selection.inlines();if(this.selection.save(),e&&"SPAN"===e.tagName){var r=$(e);r.css(t,""),r.removeAttr("data-redactor-span"),this.utils.removeEmptyAttr(r,"style"),0===r[0].attributes.length&&r.replaceWith(r.contents())}$.each(i,$.proxy(function(e,i){var r=$(i);$.inArray(i.tagName.toLowerCase(),this.opts.inlineTags)==-1||r.hasClass("redactor-selection-marker")||(r.css(t,""),this.utils.removeEmptyAttr(r,"style"),0===r[0].attributes.length&&r.replaceWith(r.contents()))},this)),this.selection.restore()}}},insert:function(){return{set:function(t){this.placeholder.hide(),this.code.set(t),this.focus.end(),this.placeholder.enable()},html:function(t,e){this.placeholder.hide(),this.core.editor().focus();var i=this.selection.block(),r=this.selection.inline();"undefined"==typeof e&&(e=this.clean.getCurrentType(t,!0),t=this.clean.onPaste(t,e,!0)),t=$.parseHTML(t);var o=this.selection.get(),s=this.selection.range(o);if(s.deleteContents(),this.selection.update(o,s),e.lists){var n=$(t);if(0!==n.length&&("UL"===n[0].tagName||"OL"===n[0].tagName))return void this.insert.appendLists(i,n)}if(e.blocks&&i)if(this.utils.isSelectAll())this.core.editor().html(t),this.focus.end();else{var a=this.utils.breakBlockTag();if(a===!1)this.insert.placeHtml(t);else{var l=$(t).children().last();l.append(this.marker.get()),"start"===a.type?a.$block.before(t):a.$block.after(t),this.selection.restore(),this.core.editor().find("p").each(function(){""===$.trim(this.innerHTML)&&$(this).remove()})}}else{if(r){var c=$("<div/>").html(t);c.find(r.tagName.toLowerCase()).each(function(){$(this).contents().unwrap()}),t=c.html()}if(this.utils.isSelectAll()){var d=$(this.opts.emptyHtml);this.core.editor().html("").append(d),d.html(t),this.caret.end(d)}else this.insert.placeHtml(t)}this.utils.disableSelectAll(),this.linkify.format(),e.pre&&this.clean.cleanPre()},text:function(t){t=t.toString(),t=$.trim(t);var e=document.createElement("div");if(e.innerHTML=t,t=e.textContent||e.innerText,"undefined"!=typeof t){this.placeholder.hide(),this.core.editor().focus();var i=this.selection.blocks();if(t=t.replace(/\n/g," "),this.utils.isSelectAll()){var r=$(this.opts.emptyHtml);this.core.editor().html("").append(r),r.html(t),this.caret.end(r)}else{var o=this.selection.get(),s=document.createTextNode(t);if(o.getRangeAt&&o.rangeCount){var n=o.getRangeAt(0);n.deleteContents(),n.insertNode(s),n.setStartAfter(s),n.collapse(!0),this.selection.update(o,n)}i.length>1&&($(s).wrap("<p>"),this.caret.after(s))}this.utils.disableSelectAll(),this.linkify.format(),this.clean.normalizeCurrentHeading()}},raw:function(t){this.placeholder.hide(),this.core.editor().focus();var e=this.selection.get(),i=this.selection.range(e);i.deleteContents();var r=document.createElement("div");r.innerHTML=t;for(var o=document.createDocumentFragment(),s,n;s=r.firstChild;)n=o.appendChild(s);i.insertNode(o),n&&(i=i.cloneRange(),i.setStartAfter(n),i.collapse(!0),e.removeAllRanges(),e.addRange(i))},node:function(t,e){this.placeholder.hide(),"undefined"!=typeof this.start&&this.core.editor().focus(),t=t[0]||t;var i=this.selection.block(),r=this.utils.isBlockTag(t.tagName),o=!0;if(this.utils.isSelectAll())r?this.core.editor().html(t):this.core.editor().html($("<p>").html(t)),this.code.sync();else if(r&&i){var s=this.utils.breakBlockTag();s===!1?this.insert.placeNode(t,e):("start"===s.type?s.$block.before(t):s.$block.after(t),this.core.editor().find("p:empty").remove())}else o=this.insert.placeNode(t,e);return this.utils.disableSelectAll(),o&&this.caret.end(t),t},appendLists:function(t,e){var i=$(t),r,o=this.utils.isEmpty(t.innerHTML);if(o||this.utils.isEndOfElement(t))r=i,e.find("li").each(function(){r.after(this),r=$(this)}),o&&i.remove();else if(this.utils.isStartOfElement(t))e.find("li").each(function(){i.before(this),r=$(this)});else{var s=this.selection.extractEndOfNode(t);i.after($("<li>").append(s)),i.append(e),r=e}this.marker.remove(),r&&this.caret.end(r),this.linkify.format()},placeHtml:function(t){var e=document.createElement("span");e.id="redactor-insert-marker",e=this.insert.node(e),$(e).before(t),this.selection.restore(),this.caret.after(e),$(e).remove()},placeNode:function(t,e){var i=this.selection.get(),r=this.selection.range(i);return null!=r&&(e!==!1&&r.deleteContents(),r.insertNode(t),r.collapse(!1),void this.selection.update(i,r))},nodeToPoint:function(t,e){if(this.placeholder.hide(),e=e[0]||e,this.utils.isEmpty())return e=this.utils.isBlock(e)?e:$("<p />").append(e),this.core.editor().html(e),e;var i,r=t.clientX,o=t.clientY;if(document.caretPositionFromPoint){var s=document.caretPositionFromPoint(r,o),n=document.getSelection();i=n.getRangeAt(0),i.setStart(s.offsetNode,s.offset),i.collapse(!0),i.insertNode(e)}else if(document.caretRangeFromPoint)i=document.caretRangeFromPoint(r,o),i.insertNode(e);else if("undefined"!=typeof document.body.createTextRange){i=document.body.createTextRange(),i.moveToPoint(r,o);var a=i.duplicate();a.moveToPoint(r,o),i.setEndPoint("EndToEnd",a),i.select()}return e},nodeToCaretPositionFromPoint:function(t,e){this.insert.nodeToPoint(t,e)},marker:function(){this.marker.insert()}}},keydown:function(){return{init:function(t){if(!this.rtePaste){var e=t.which,i=e>=37&&e<=40;this.keydown.ctrl=t.ctrlKey||t.metaKey,this.keydown.parent=this.selection.parent(),this.keydown.current=this.selection.current(),this.keydown.block=this.selection.block(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.keydown.figure=this.utils.isTag(this.keydown.current,"figure");var r=this.core.callback("keydown",t);if(r===!1)return t.preventDefault(),!1;if(this.shortcuts.init(t,e),this.keydown.checkEvents(i,e),this.keydown.setupBuffer(t,e),this.utils.isSelectAll()&&(e===this.keyCode.ENTER||e===this.keyCode.BACKSPACE||e===this.keyCode.DELETE))return t.preventDefault(),void this.code.set(this.opts.emptyHtml);if(this.keydown.addArrowsEvent(i),this.keydown.setupSelectAll(t,e),!this.opts.enterKey&&e===this.keyCode.ENTER){t.preventDefault();var o=this.selection.get(),s=this.selection.range(o);return void(s.collapsed||s.deleteContents())}if(this.opts.enterKey&&e===this.keyCode.DOWN&&this.keydown.onArrowDown(),this.opts.enterKey&&e===this.keyCode.UP&&this.keydown.onArrowUp(),("textarea"===this.opts.type||"div"===this.opts.type)&&this.keydown.current&&3===this.keydown.current.nodeType&&$(this.keydown.parent).hasClass("redactor-in")&&this.keydown.wrapToParagraph(),e===this.keyCode.SPACE&&(t.ctrlKey||t.shiftKey))return t.preventDefault(),this.keydown.onShiftSpace();if(e===this.keyCode.ENTER&&(t.ctrlKey||t.shiftKey))return t.preventDefault(),this.keydown.onShiftEnter(t);if(e===this.keyCode.ENTER&&!t.shiftKey&&!t.ctrlKey&&!t.metaKey)return this.keydown.onEnter(t);if(e===this.keyCode.TAB||t.metaKey&&221===e||t.metaKey&&219===e)return this.keydown.onTab(t,e);if(e!==this.keyCode.BACKSPACE&&e!==this.keyCode.DELETE||this.keydown.onBackspaceAndDeleteBefore(),e===this.keyCode.DELETE){var n=$(this.keydown.block).next();if(this.utils.isEndOfElement(this.keydown.block)&&0!==n.length&&"FIGURE"===n[0].tagName)return n.remove(),!1;var a=!(!this.keydown.block||"LI"!==this.keydown.block.tagName)&&this.keydown.block;if(a){var l=$(this.keydown.block).parents("ul, ol").last(),c=l.next();if(this.utils.isRedactorParent(l)&&this.utils.isEndOfElement(l)&&0!==c.length&&("UL"===c[0].tagName||"OL"===c[0].tagName))return t.preventDefault(),l.append(c.contents()),c.remove(),!1}if(this.utils.isEndOfElement(this.keydown.block)&&0!==n.length&&"PRE"===n[0].tagName)return $(this.keydown.block).append(n.text()),n.remove(),!1}if(e===this.keyCode.DELETE&&0!==$("#redactor-image-box").length&&this.image.remove(),e===this.keyCode.BACKSPACE){if(this.detect.isFirefox()&&this.line.removeOnBackspace(t),this.list.combineAfterAndBefore(this.keydown.block))return void t.preventDefault();var d=this.selection.block();if(d&&"LI"===d.tagName&&this.utils.isCollapsed()&&this.utils.isStartOfElement())return this.indent.decrease(),void t.preventDefault();this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(t)}e!==this.keyCode.BACKSPACE&&e!==this.keyCode.DELETE||this.keydown.onBackspaceAndDeleteAfter(t)}},onShiftSpace:function(){return this.buffer.set(),this.insert.raw("&nbsp;"),!1},onShiftEnter:function(t){return this.buffer.set(),this.keydown.pre?this.keydown.insertNewLine(t):this.insert.raw("<br>")},onBackspaceAndDeleteBefore:function(){this.utils.saveScroll()},onBackspaceAndDeleteAfter:function(t){setTimeout($.proxy(function(){this.code.syncFire=!1,this.keydown.removeEmptyLists(),this.core.editor().find("*[style]").not("img, #redactor-image-box, #redactor-image-editter, [data-redactor-span]").removeAttr("style"),this.keydown.formatEmpty(t),this.code.syncFire=!0},this),1)},onEnter:function(t){var e=this.core.callback("enter",t);if(e===!1)return t.preventDefault(),!1;if(this.keydown.blockquote&&this.keydown.exitFromBlockquote(t)===!0)return!1;if(this.keydown.pre)return this.keydown.insertNewLine(t);if(this.keydown.blockquote||this.keydown.figcaption)return this.keydown.insertBreakLine(t);if(this.keydown.figure)setTimeout($.proxy(function(){this.keydown.replaceToParagraph("FIGURE")},this),1);else if(this.keydown.block){if(setTimeout($.proxy(function(){this.keydown.replaceToParagraph("DIV")},this),1),"LI"===this.keydown.block.tagName){var i=this.selection.current(),r=$(i).closest("li",this.$editor[0]),o=r.parents("ul,ol",this.$editor[0]).last();if(0!==r.length&&this.utils.isEmpty(r.html())&&0===o.next().length&&this.utils.isEmpty(o.find("li").last().html())){o.find("li").last().remove();var s=$(this.opts.emptyHtml);return o.after(s),this.caret.start(s),!1}}}else if(!this.keydown.block)return this.keydown.insertParagraph(t);return this.detect.isFirefox()&&this.utils.isInline(this.keydown.parent)?void this.keydown.insertBreakLine(t):void setTimeout($.proxy(function(){var t=this.selection.inline();if(t&&this.utils.isEmpty(t.innerHTML)){var e=this.selection.block();$(t).remove();var i=document.createRange();i.setStart(e,0);var r=document.createTextNode("​");i.insertNode(r),i.setStartAfter(r),i.collapse(!0);var o=window.getSelection();o.removeAllRanges(),o.addRange(i)}},this),1)},checkEvents:function(t,e){t||"click"!==this.core.getEvent()&&"arrow"!==this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(e)&&this.buffer.set())},checkKeyEvents:function(t){var e=this.keyCode,i=[e.BACKSPACE,e.DELETE,e.ENTER,e.ESC,e.TAB,e.CTRL,e.META,e.ALT,e.SHIFT];return $.inArray(t,i)===-1},addArrowsEvent:function(t){if(t)return"click"===this.core.getEvent()||"arrow"===this.core.getEvent()?void this.core.addEvent(!1):void this.core.addEvent("arrow")},setupBuffer:function(t,e){return this.keydown.ctrl&&90===e&&!t.shiftKey&&!t.altKey&&this.opts.buffer.length?(t.preventDefault(),void this.buffer.undo()):this.keydown.ctrl&&90===e&&t.shiftKey&&!t.altKey&&0!==this.opts.rebuffer.length?(t.preventDefault(),void this.buffer.redo()):void(this.keydown.ctrl||e!==this.keyCode.SPACE&&e!==this.keyCode.BACKSPACE&&e!==this.keyCode.DELETE&&(e!==this.keyCode.ENTER||t.ctrlKey||t.shiftKey)||this.buffer.set())},exitFromBlockquote:function(t){if(this.utils.isEndOfElement(this.keydown.blockquote)){var e=this.clean.removeSpacesHard($(this.keydown.blockquote).html());if(e.search(/(<br\s?\/?>){3}$/i)!==-1){t.preventDefault();var i=$(this.keydown.blockquote).children().last().prev();i.prev().filter("br").remove(),i.filter("br").remove(),$(this.keydown.blockquote).children().last().filter("br").remove(),$(this.keydown.blockquote).children().last().filter("span").remove();var r=$(this.opts.emptyHtml);return $(this.keydown.blockquote).after(r),this.caret.start(r),!0}}},onArrowDown:function(){for(var t=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],e=0;e<t.length;e++)if(t[e])return this.keydown.insertAfterLastElement(t[e]),!1},onArrowUp:function(){for(var t=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],e=0;e<t.length;e++)if(t[e])return this.keydown.insertBeforeFirstElement(t[e]),!1},insertAfterLastElement:function(t){if(this.utils.isEndOfElement(t)){var e=this.core.editor().contents().last(),i="FIGCAPTION"===t.tagName?$(this.keydown.block).parent().next():$(this.keydown.block).next();if(0===i.length){if(0===e.length&&e[0]!==t)return void this.caret.start(e);var r=$(this.opts.emptyHtml);"FIGCAPTION"===t.tagName?$(t).parent().after(r):$(t).after(r),this.caret.start(r)}}},insertBeforeFirstElement:function(t){if(this.utils.isStartOfElement()&&!(this.core.editor().contents().length>1&&this.core.editor().contents().first()[0]!==t)){var e=$(this.opts.emptyHtml);$(t).before(e),this.caret.start(e)}},onTab:function(t,e){if(!this.opts.tabKey)return!0;var i=this.keydown.block&&"LI"===this.keydown.block.tagName;if(this.utils.isEmpty(this.code.get())||!i&&!this.keydown.pre&&this.opts.tabAsSpaces===!1)return!0;t.preventDefault(),this.buffer.set();var r=i&&this.utils.isStartOfElement(this.keydown.block),o;return this.keydown.pre&&!t.shiftKey?(o=this.opts.preSpaces?document.createTextNode(Array(this.opts.preSpaces+1).join(" ")):document.createTextNode("\t"),this.insert.node(o)):this.opts.tabAsSpaces===!1||r?t.metaKey&&219===e?this.indent.decrease():t.metaKey&&221===e?this.indent.increase():t.shiftKey?this.indent.decrease():this.indent.increase():(o=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" ")),this.insert.node(o)),!1},setupSelectAll:function(t,e){this.keydown.ctrl&&65===e?this.utils.enableSelectAll():e===this.keyCode.LEFT_WIN||this.keydown.ctrl||this.utils.disableSelectAll()},insertNewLine:function(t){t.preventDefault();var e=document.createTextNode("\n"),i=this.selection.get(),r=this.selection.range(i);return r.deleteContents(),r.insertNode(e),this.caret.after(e),!1},insertParagraph:function(t){t.preventDefault();var e=document.createElement("p");e.innerHTML=this.opts.invisibleSpace;var i=this.selection.get(),r=this.selection.range(i);return r.deleteContents(),r.insertNode(e),this.caret.start(e),!1},insertBreakLine:function(t){return this.keydown.insertBreakLineProcessing(t)},insertDblBreakLine:function(t){return this.keydown.insertBreakLineProcessing(t,!0)},insertBreakLineProcessing:function(t,e){t.stopPropagation();var i=document.createElement("br");if(this.insert.node(i),e===!0){var r=document.createElement("br");this.insert.node(r)}return!1},wrapToParagraph:function(){var t=$(this.keydown.current),e=$("<p>").append(t.clone());t.replaceWith(e);var i=$(e).next();"undefined"!=typeof i[0]&&"BR"===i[0].tagName&&i.remove(),this.caret.end(e)},replaceToParagraph:function(t){var e=this.selection.block(),i=$(e).prev(),r=e.innerHTML.replace(/<br\s?\/?>/gi,"");if(e.tagName===t&&this.utils.isEmpty(r)&&!$(e).hasClass("redactor-in")){var o=document.createElement("p");return $(e).replaceWith(o),this.keydown.setCaretToParagraph(o),!1}if("P"===e.tagName)return $(e).removeAttr("class").removeAttr("style"),this.detect.isIe()&&this.utils.isEmpty(r)&&this.utils.isInline(this.keydown.parent)&&$(e).on("input",$.proxy(function(){var t=this.selection.parent();if(this.utils.isInline(t)){var i=$(t).html();$(e).html(i),this.caret.end(e)}$(e).off("keyup")},this)),!1;if(i.hasClass(this.opts.videoContainerClass)){i.removeAttr("class");var o=document.createElement("p");return i.replaceWith(o),this.keydown.setCaretToParagraph(o),!1}},setCaretToParagraph:function(t){var e=document.createRange();e.setStart(t,0);var i=document.createTextNode("​");e.insertNode(i),e.setStartAfter(i),e.collapse(!0);var r=window.getSelection();r.removeAllRanges(),r.addRange(e)},removeInvisibleSpace:function(){var t=$(this.keydown.current);0===t.text().search(/^\u200B$/g)&&t.remove()},removeEmptyListInTable:function(t){var e=$(this.keydown.current),i=$(this.keydown.parent),r=e.closest("td",this.$editor[0]);if(0!==r.length&&e.closest("li",this.$editor[0])&&1===i.children("li").length){if(!this.utils.isEmpty(e.text()))return;t.preventDefault(),e.remove(),i.remove(),this.caret.start(r)}},removeEmptyLists:function(){var t=function(){var t=$.trim(this.innerHTML).replace(/\/t\/n/g,"");""===t&&$(this).remove()};this.core.editor().find("li").each(t),this.core.editor().find("ul, ol").each(t)},formatEmpty:function(t){var e=$.trim(this.core.editor().html());if(this.utils.isEmpty(e))return t.preventDefault(),"inline"===this.opts.type||"pre"===this.opts.type?(this.core.editor().html(this.marker.html()),this.selection.restore()):(this.core.editor().html(this.opts.emptyHtml),this.focus.start()),!1}}},keyup:function(){return{init:function(t){if(!this.rtePaste){var e=t.which;this.keyup.block=this.selection.block(),
this.keyup.current=this.selection.current(),this.keyup.parent=this.selection.parent();var i=this.core.callback("keyup",t);if(i===!1)return t.preventDefault(),!1;if(e===this.keyCode.ENTER&&this.keyup.block&&"FIGURE"===this.keyup.block.tagName){var r=$(this.keyup.block).prev();if(0!==r.length&&"FIGURE"===r[0].tagName){var o=this.utils.replaceToTag(r,"p");return void this.caret.start(o)}}if(e===this.keyCode.BACKSPACE||e===this.keyCode.DELETE){if(this.utils.isSelectAll())return void this.focus.start();if(this.keyup.block&&this.keydown.block&&"FIGURE"===this.keyup.block.tagName&&this.utils.isStartOfElement(this.keydown.block)){t.preventDefault(),this.selection.save(),$(this.keyup.block).find("figcaption").remove(),$(this.keyup.block).find("img").first().remove(),this.utils.replaceToTag(this.keyup.block,"p");var s=this.marker.find();return $("html, body").animate({scrollTop:s.position().top+20},500),void this.selection.restore()}if(this.keyup.block&&"P"===this.keyup.block.tagName){var n=$(this.keyup.block).find("img").length,a=$(this.keyup.block).text().replace(/\u200B/g,"");""===a&&0!==n&&this.utils.replaceToTag(this.keyup.block,"figure")}this.keyup.block&&"FIGURE"===this.keyup.block.tagName&&0===$(this.keyup.block).find("img").length&&(this.selection.save(),this.utils.replaceToTag(this.keyup.block,"p"),this.selection.restore())}this.linkify.isKey(e)&&this.linkify.format()}}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(t){return"undefined"!=typeof this.opts.curLang[t]?this.opts.curLang[t]:""}}},line:function(){return{insert:function(){this.buffer.set(),this.insert.html(this.line.getLineHtml());var t=this.core.editor().find("#redactor-hr-tmp-id");return t.removeAttr("id"),this.core.callback("insertedLine",t),t},getLineHtml:function(){var t='<hr id="redactor-hr-tmp-id" />';return!this.detect.isFirefox()&&this.utils.isEmpty()&&(t+="<p>"+this.opts.emptyHtml+"</p>"),t},removeOnBackspace:function(t){if(this.utils.isCollapsed()){var e=$(this.selection.block());if(0!==e.length&&this.utils.isStartOfElement(e)){var i=e.prev();i&&"HR"===i[0].tagName&&(t.preventDefault(),i.remove())}}}}},link:function(){return{get:function(){return $(this.selection.inlines("a"))},is:function(){var t=this.selection.nodes(),e=$(this.selection.current()).closest("a",this.core.editor()[0]);return!(0===e.length||t.length>1)&&e},unlink:function(t){"undefined"!=typeof t&&t.preventDefault&&t.preventDefault(),this.buffer.set();var e=this.selection.inlines("a");if(0!==e.length){var i=this.link.replaceLinksToText(e);this.observe.closeAllTooltip(),this.core.callback("deletedLink",i)}},insert:function(t,e){var i=this.link.is();if(e!==!0&&(t=this.link.buildLinkFromObject(i,t),t===!1))return!1;if(this.buffer.set(),t=this.core.callback("beforeInsertingLink",t),i===!1){i=$("<a />"),i=this.link.update(i,t),i=$(this.insert.node(i));var r=i.parent();this.utils.isRedactorParent(r)===!1&&i.wrap("<p>"),r.hasClass("redactor-unlink")&&r.replaceWith(function(){return $(this).contents()}),this.caret.after(i),this.core.callback("insertedLink",i)}else i=this.link.update(i,t),this.caret.after(i)},update:function(t,e){return t.text(e.text),t.attr("href",e.url),this.link.target(t,e.target),t},target:function(t,e){return e?t.attr("target","_blank"):t.removeAttr("target")},show:function(t){"undefined"!=typeof t&&t.preventDefault&&t.preventDefault(),this.observe.closeAllTooltip();var e=this.link.is();this.link.buildModal(e);var i=this.link.buildLinkFromElement(e);i.url=this.link.removeSelfHostFromUrl(i.url),this.opts.linkNewTab&&!e&&(i.target=!0),this.link.setModalValues(i),this.modal.show(),this.detect.isDesktop()&&$("#redactor-link-url").focus()},setModalValues:function(t){$("#redactor-link-blank").prop("checked",t.target),$("#redactor-link-url").val(t.url),$("#redactor-link-url-text").val(t.text)},buildModal:function(t){this.modal.load("link",this.lang.get(t===!1?"link-insert":"link-edit"),600);var e=this.modal.getActionButton();e.text(this.lang.get(t===!1?"insert":"save")).on("click",$.proxy(this.link.callback,this))},callback:function(){var t=this.link.buildLinkFromModal();return t!==!1&&(this.modal.close(),void this.link.insert(t,!0))},cleanUrl:function(t){return"undefined"==typeof t?"":$.trim(t.replace(/[^\W\w\D\d+&\'@#\/%?=~_|!:,.;\(\)]/gi,""))},cleanText:function(t){return"undefined"==typeof t?"":$.trim(t.replace(/(<([^>]+)>)/gi,""))},getText:function(t){return""===t.text&&""!==t.url?this.link.truncateUrl(t.url.replace(/<|>/g,"")):t.text},isUrl:function(t){var e="((xn--)?[\\W\\w\\D\\d]+(-[\\W\\w\\D\\d]+)*\\.)+[\\W\\w]{2,}",i=new RegExp("^(http|ftp|https)://"+e,"i"),r=new RegExp("^"+e,"i"),o=new RegExp(".(html|php)$","i"),s=new RegExp("^/","i"),n=new RegExp("^tel:(.*?)","i");return t.search(i)===-1&&t.search(r)!==-1&&t.search(o)===-1&&"/"!==t.substring(0,1)&&(t="http://"+t),(t.search(i)!==-1||t.search(o)!==-1||t.search(s)!==-1||t.search(n)!==-1)&&t},isMailto:function(t){return t.search("@")!==-1&&/(http|ftp|https):\/\//i.test(t)===!1},isEmpty:function(t){return""===t.url||""===t.text&&""===t.url},truncateUrl:function(t){return t.length>this.opts.linkSize?t.substring(0,this.opts.linkSize)+"...":t},parse:function(t){return this.link.isMailto(t.url)?t.url="mailto:"+t.url.replace("mailto:",""):0!==t.url.search("#")&&(t.url=this.link.isUrl(t.url)),!this.link.isEmpty(t)&&t.url!==!1&&t},buildLinkFromModal:function(){var t={};return t.url=this.link.cleanUrl($("#redactor-link-url").val()),t.text=this.link.cleanText($("#redactor-link-url-text").val()),t.text=this.link.getText(t),t.target=!!$("#redactor-link-blank").prop("checked"),this.link.parse(t)},buildLinkFromObject:function(t,e){return e.url=this.link.cleanUrl(e.url),e.text="undefined"==typeof e.text&&this.selection.is()?this.selection.text():this.link.cleanText(e.text),e.text=this.link.getText(e),e.target=t===!1?e.target:this.link.buildTarget(t),this.link.parse(e)},buildLinkFromElement:function(t){var e={url:"",text:this.selection.is()?this.selection.text():"",target:!1};return t!==!1&&(e.url=t.attr("href"),e.text=t.text(),e.target=this.link.buildTarget(t)),e},buildTarget:function(t){return"undefined"!=typeof t.attr("target")&&"_blank"===t.attr("target")},removeSelfHostFromUrl:function(t){var e=self.location.href.replace("#","").replace(/\/$/i,"");return t.replace(/^\/\#/,"#").replace(e,"").replace("mailto:","")},replaceLinksToText:function(t){var e,i=$.each(t,function(t,i){var r=$(i),o=$('<span class="redactor-unlink" />').append(r.contents());return r.replaceWith(o),0===t&&(e=o),r});return 1===t.length&&this.selection.isCollapsed()&&this.caret.after(e),i}}},linkify:function(){return{isKey:function(t){return t===this.keyCode.ENTER||t===this.keyCode.SPACE},isLink:function(t){return t.nodeValue.match(this.opts.regexps.linkyoutube)||t.nodeValue.match(this.opts.regexps.linkvimeo)||t.nodeValue.match(this.opts.regexps.linkimage)||t.nodeValue.match(this.opts.regexps.url)},isFiltered:function(t,e){return 3===e.nodeType&&""!==$.trim(e.nodeValue)&&!$(e).parent().is("pre")&&this.linkify.isLink(e)},handler:function(t,e){var i=$(e),r=i.text(),o=r;o=o.match(this.opts.regexps.linkyoutube)||o.match(this.opts.regexps.linkvimeo)?this.linkify.convertVideoLinks(o):o.match(this.opts.regexps.linkimage)?this.linkify.convertImages(o):this.linkify.convertLinks(o),i.before(r.replace(r,o)).remove()},format:function(){if(this.opts.linkify&&!this.utils.isCurrentOrParent("pre")){this.core.editor().find(":not(iframe,img,a,pre,code,.redactor-unlink)").addBack().contents().filter($.proxy(this.linkify.isFiltered,this)).each($.proxy(this.linkify.handler,this));var t=this.core.editor().find(".redactor-linkify-object").each($.proxy(function(t,e){var i=$(e);return i.removeClass("redactor-linkify-object"),""===i.attr("class")&&i.removeAttr("class"),"DIV"===e.tagName?this.linkify.breakBlockTag(i,"video"):"IMG"===e.tagName?this.linkify.breakBlockTag(i,"image"):"A"===e.tagName&&this.core.callback("insertedLink",i),i},this));setTimeout($.proxy(function(){this.code.sync(),this.core.callback("linkify",t)},this),100)}},breakBlockTag:function(t,e){var i=this.utils.breakBlockTag();if(i!==!1){var r=t;"image"===e&&(r=$("<figure />").append(t)),"start"===i.type?i.$block.before(r):i.$block.after(r),"image"===e&&this.caret.after(r)}},convertVideoLinks:function(t){var e='<div class="'+this.opts.videoContainerClass+' redactor-linkify-object"><iframe class="redactor-linkify-object" width="500" height="281" src="',i='" frameborder="0" allowfullscreen></iframe></div>';return t.match(this.opts.regexps.linkyoutube)&&(t=t.replace(this.opts.regexps.linkyoutube,e+"//www.youtube.com/embed/$1"+i)),t.match(this.opts.regexps.linkvimeo)&&(t=t.replace(this.opts.regexps.linkvimeo,e+"//player.vimeo.com/video/$2"+i)),t},convertImages:function(t){var e=t.match(this.opts.regexps.linkimage);return e?t.replace(t,'<img src="'+e+'" class="redactor-linkify-object" />'):t},convertLinks:function(t){var e=t.match(this.opts.regexps.url);if(!e)return t;e=$.grep(e,function(t,i){return $.inArray(t,e)===i});for(var i=e.length,r=0;r<i;r++){var o=e[r],s=o,n=null!==o.match(/(https?|ftp):\/\//i)?"":"http://";s.length>this.opts.linkSize&&(s=s.substring(0,this.opts.linkSize)+"..."),s.search("%")===-1&&(s=decodeURIComponent(s));var a="\\b";$.inArray(o.slice(-1),["/","&","="])!==-1&&(a="");var l=new RegExp("("+o.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+a+")","g");t=t.replace(l,'<a href="'+n+$.trim(o)+'" class="redactor-linkify-object">'+$.trim(s)+"</a>")}return t}}},list:function(){return{toggle:function(t){if(!this.utils.inBlocks(["table","td","th","tr"])){var e="orderedlist"===t||"ol"===t?"OL":"UL";t="OL"===e?"orderedlist":"unorderedlist";var i=$(this.selection.current()).parentsUntil(".redactor-in","ul, ol").first();if(this.placeholder.hide(),this.buffer.set(),0!==i.length&&i[0].tagName===e&&this.utils.isRedactorParent(i))return this.selection.save(),i.find("ul, ol").each(function(){var t=$(this).closest("li");$(this).find("li").each(function(){$(t).after(this)})}),i.find("ul, ol").remove(),i.find("li").each(function(){return $(this).replaceWith(function(){return $("<p />").append($(this).contents())})}),i.replaceWith(function(){return $(this).contents()}),void this.selection.restore();this.selection.save(),0!==i.length&&i[0].tagName!==e?i.each($.proxy(function(t,i){this.utils.replaceToTag(i,e)},this)):document.execCommand("insert"+t),this.selection.restore();var r=this.list.get();if(!r)return void(this.selection.block()||document.execCommand("formatblock",!1,"p"));r.find("span").replaceWith(function(){return $(this).contents()}),r.find(this.opts.inlineTags.join(",")).each(function(){$(this).removeAttr("style")});var o=r.parent();this.utils.isRedactorParent(o)&&"LI"!==o[0].tagName&&this.utils.isBlock(o)&&(this.selection.save(),o.replaceWith(o.contents()),this.selection.restore())}},get:function(){var t=this.selection.current(),e=$(t).closest("ul, ol",this.core.editor()[0]);return 0!==e.length&&e},combineAfterAndBefore:function(t){var e=$(t).prev(),i=$(t).next(),r=t&&"P"===t.tagName&&("<br>"===t.innerHTML||""===t.innerHTML),o=1===e.closest("ol, ul",this.core.editor()[0]).length&&1===i.closest("ol, ul",this.core.editor()[0]).length;return!(!r||!o)&&(e.children("li").last().append(this.marker.get()),e.append(i.contents()),this.selection.restore(),!0)}}},marker:function(){return{get:function(t){t="undefined"==typeof t?1:t;var e=document.createElement("span");return e.id="selection-marker-"+t,e.className="redactor-selection-marker",e.innerHTML=this.opts.invisibleSpace,e},html:function(t){return this.utils.getOuterHtml(this.marker.get(t))},find:function(t){return t="undefined"==typeof t?1:t,this.core.editor().find("span#selection-marker-"+t)},insert:function(){var t=this.selection.get(),e=this.selection.range(t);this.marker.insertNode(e,this.marker.get(1),!0),e&&e.collapsed===!1&&this.marker.insertNode(e,this.marker.get(2),!1)},remove:function(){this.core.editor().find(".redactor-selection-marker").each(this.marker.iterateRemove)},insertNode:function(t,e,i){var r=this.selection.parent();if(null!==t&&0!==$(r).closest(".redactor-in").length){t=t.cloneRange();try{t.collapse(i),t.insertNode(e)}catch(t){this.focus.start()}}},iterateRemove:function(t,e){var i=$(e),r=i.text().replace(/\u200B/g,"");return""===r?i.remove():i.replaceWith(function(){return $(this).contents()})}}},modal:function(){return{callbacks:{},templates:function(){this.opts.modal={"image-edit":String()+'<div class="redactor-modal-tab redactor-group" data-title="General"><div id="redactor-image-preview" class="redactor-modal-tab-side"></div><div class="redactor-modal-tab-area"><section><label>'+this.lang.get("title")+'</label><input type="text" id="redactor-image-title" /></section><section><label>'+this.lang.get("caption")+'</label><input type="text" id="redactor-image-caption" aria-label="'+this.lang.get("caption")+'" /></section><section><label>'+this.lang.get("link")+'</label><input type="text" id="redactor-image-link" aria-label="'+this.lang.get("link")+'" /></section><section><label class="redactor-image-position-option">'+this.lang.get("image-position")+'</label><select class="redactor-image-position-option" id="redactor-image-align" aria-label="'+this.lang.get("image-position")+'"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+'</option></select></section><section><label class="checkbox"><input type="checkbox" id="redactor-image-link-blank" aria-label="'+this.lang.get("link-in-new-tab")+'"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+'</button><button id="redactor-modal-button-delete" class="redactor-modal-button-offset">'+this.lang.get("delete")+"</button></section></div></div>",image:String()+'<div class="redactor-modal-tab" data-title="Upload"><section><div id="redactor-modal-image-droparea"></div></section></div>',file:String()+'<div class="redactor-modal-tab" data-title="Upload"><section><label>'+this.lang.get("filename")+' <span class="desc">('+this.lang.get("optional")+')</span></label><input type="text" id="redactor-filename" aria-label="'+this.lang.get("filename")+'" /><br><br></section><section><div id="redactor-modal-file-upload"></div></section></div>',link:String()+'<div class="redactor-modal-tab" data-title="General"><section><label>URL</label><input type="url" id="redactor-link-url" aria-label="URL" /></section><section><label>'+this.lang.get("text")+'</label><input type="text" id="redactor-link-url-text" aria-label="'+this.lang.get("text")+'" /></section><section><label class="checkbox"><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link-in-new-tab")+'</label></section><section><button id="redactor-modal-button-action">'+this.lang.get("insert")+'</button><button id="redactor-modal-button-cancel">'+this.lang.get("cancel")+"</button></section></div>"},$.extend(this.opts,this.opts.modal)},addCallback:function(t,e){this.modal.callbacks[t]=e},addTemplate:function(t,e){this.opts.modal[t]=e},getTemplate:function(t){return this.opts.modal[t]},getModal:function(){return this.$modalBody},getActionButton:function(){return this.$modalBody.find("#redactor-modal-button-action")},getCancelButton:function(){return this.$modalBody.find("#redactor-modal-button-cancel")},getDeleteButton:function(){return this.$modalBody.find("#redactor-modal-button-delete")},load:function(t,e,i){"undefined"!=typeof this.$modalBox&&this.$modalBox.hasClass("open")||(this.modal.templateName=t,this.modal.width=i,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(e),this.modal.setDraggable(),this.modal.setContent(),"undefined"!=typeof this.modal.callbacks[t]&&this.modal.callbacks[t].call(this))},show:function(){this.detect.isDesktop()||document.activeElement.blur(),this.selection.save(),this.modal.buildTabber(),this.detect.isMobile()&&(this.modal.width="96%"),setTimeout($.proxy(this.modal.buildWidth,this),0),$(window).on("resize.redactor-modal",$.proxy(this.modal.buildWidth,this)),this.$modalOverlay.redactorAnimation("fadeIn",{duration:.25}),this.$modalBox.addClass("open").show(),this.$modal.redactorAnimation("fadeIn",{timing:"cubic-bezier(0.175, 0.885, 0.320, 1.105)"},$.proxy(function(){this.utils.saveScroll(),this.utils.disableBodyScroll(),this.core.callback("modalOpened",this.modal.templateName,this.$modal),$(document).off("focusin.modal");var t=this.$modal.find("input[type=text],input[type=url],input[type=email]");t.on("keydown.redactor-modal",$.proxy(this.modal.setEnter,this))},this))},buildWidth:function(){var t=$(window).height(),e=$(window).width(),i="number"==typeof this.modal.width;!i&&this.modal.width.match(/%$/)?this.$modal.css({width:this.modal.width,"margin-bottom":"16px"}):parseInt(this.modal.width)>e?this.$modal.css({width:"96%","margin-bottom":"2%"}):(i&&(this.modal.width+="px"),this.$modal.css({width:this.modal.width,"margin-bottom":"16px"}));var r=this.$modal.outerHeight(),o=t/2-r/2+"px";this.detect.isMobile()?o="2%":r>t&&(o="16px"),this.$modal.css("margin-top",o)},buildTabber:function(){this.modal.tabs=this.$modal.find(".redactor-modal-tab"),this.modal.tabs.length<2||(this.modal.$tabsBox=$('<div id="redactor-modal-tabber" />'),$.each(this.modal.tabs,$.proxy(function(t,e){var i=$('<a href="#" rel="'+t+'" />').text($(e).attr("data-title"));i.on("click",$.proxy(this.modal.showTab,this)),0===t&&i.addClass("active"),this.modal.$tabsBox.append(i)},this)),this.$modalBody.prepend(this.modal.$tabsBox))},showTab:function(t){t.preventDefault();var e=$(t.target),i=e.attr("rel");return this.modal.tabs.hide(),this.modal.tabs.eq(i).show(),$("#redactor-modal-tabber").find("a").removeClass("active"),e.addClass("active"),!1},setTitle:function(t){this.$modalHeader.html(t)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName)),this.modal.getCancelButton().on("mousedown",$.proxy(this.modal.close,this))},setDraggable:function(){"undefined"!=typeof $.fn.draggable&&(this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move"))},setEnter:function(t){13===t.which&&(t.preventDefault(),this.modal.getActionButton().click())},build:function(){this.modal.buildOverlay(),this.$modalBox=$('<div id="redactor-modal-box"/>').hide(),this.$modal=$('<div id="redactor-modal" role="dialog" />'),this.$modalHeader=$('<div id="redactor-modal-header" />'),this.$modalClose=$('<button type="button" id="redactor-modal-close" aria-label="'+this.lang.get("close")+'" />').html("&times;"),this.$modalBody=$('<div id="redactor-modal-body" />'),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalClose),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=$('<div id="redactor-modal-overlay">').hide(),$("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("mousedown.redactor-modal",$.proxy(this.modal.close,this)),$(document).on("keyup.redactor-modal",$.proxy(this.modal.closeHandler,this)),this.core.editor().on("keyup.redactor-modal",$.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",$.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("mousedown.redactor-modal"),$(document).off("keyup.redactor-modal"),this.core.editor().off("keyup.redactor-modal"),this.$modalBox.off("click§.redactor-modal"),$(window).off("resize.redactor-modal")},closeHandler:function(t){t.which===this.keyCode.ESC&&this.modal.close(!1)},close:function(t){if(t){if("redactor-modal-button-cancel"!==$(t.target).attr("id")&&t.target!==this.$modalClose[0]&&t.target!==this.$modalBox[0])return;t.preventDefault()}this.$modalBox&&(this.selection.restore(),this.modal.disableEvents(),this.utils.enableBodyScroll(),this.utils.restoreScroll(),this.$modalOverlay.redactorAnimation("fadeOut",{duration:.4},$.proxy(function(){this.$modalOverlay.remove()},this)),this.$modal.redactorAnimation("fadeOut",{duration:.3,timing:"cubic-bezier(0.175, 0.885, 0.320, 1.175)"},$.proxy(function(){"undefined"!=typeof this.$modalBox&&(this.$modalBox.remove(),this.$modalBox=void 0),$(document.body).css("overflow",this.modal.bodyOveflow),this.core.callback("modalClosed",this.modal.templateName)},this)))}}},observe:function(){return{load:function(){"undefined"==typeof this.opts.destroyed&&(this.observe.links(),this.observe.images())},isCurrent:function(t,e){return"undefined"==typeof e&&(e=$(this.selection.current())),e.is(t)||e.parents(t).length>0},toolbar:function(){this.observe.buttons(),this.observe.dropdowns()},buttons:function(t,e){var i=this.selection.current(),r=this.selection.parent();return t!==!1?this.button.setInactiveAll():this.button.setInactiveAll(e),t===!1&&"html"!==e?void($.inArray(e,this.opts.activeButtons)!==-1&&this.button.toggleActive(e)):void(this.utils.isRedactorParent(i)&&(this.utils.isCurrentOrParentHeader()||this.utils.isCurrentOrParent(["table","pre","blockquote","li"])?this.button.disable("horizontalrule"):this.button.enable("horizontalrule"),$.each(this.opts.activeButtonsStates,$.proxy(function(t,e){var o=$(r).closest(t,this.$editor[0]),s=$(i).closest(t,this.$editor[0]);(0===o.length||this.utils.isRedactorParent(o))&&this.utils.isRedactorParent(s)&&(0===o.length&&0===s.closest(t,this.$editor[0]).length||this.button.setActive(e))},this))))},dropdowns:function(){var t=$("<div />").html(this.selection.html()).find("a").length,e=$(this.selection.current()),i=this.utils.isRedactorParent(e);$.each(this.opts.observe.dropdowns,$.proxy(function(r,o){var s=o.observe,n=s.element,a=o.item,l="undefined"!=typeof s.in&&s.in,c="undefined"!=typeof s.out&&s.out;e.closest(n).length>0&&i||"a"===n&&0!==t?this.observe.setDropdownProperties(a,l,c):this.observe.setDropdownProperties(a,c,l)},this))},setDropdownProperties:function(t,e,i){i&&"undefined"!=typeof i.attr&&this.observe.setDropdownAttr(t,i.attr,!0),"undefined"!=typeof e.attr&&this.observe.setDropdownAttr(t,e.attr),"undefined"!=typeof e.title&&t.find("span").text(e.title)},setDropdownAttr:function(t,e,i){$.each(e,function(e,r){"class"===e?i?t.removeClass(r):t.addClass(r):i?t.removeAttr(e):t.attr(e,r)})},addDropdown:function(t,e,i){"undefined"!=typeof i.observe&&(i.item=t,this.opts.observe.dropdowns.push(i))},images:function(){this.opts.imageEditable&&(this.core.editor().addClass("redactor-editor-img-edit"),this.core.editor().find("img").each($.proxy(function(t,e){var i=$(e);i.closest("a",this.$editor[0]).on("click",function(t){t.preventDefault()}),this.image.setEditable(i)},this)))},links:function(){this.opts.linkTooltip&&this.core.editor().find("a").each($.proxy(function(t,e){var i=$(e);i.data("cached")!==!0&&(i.data("cached",!0),i.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,$.proxy(this.observe.showTooltip,this)))},this))},getTooltipPosition:function(t){return t.offset()},showTooltip:function(t){var e=$(t.target);if("IMG"!==e[0].tagName&&("A"!==e[0].tagName&&(e=e.closest("a",this.$editor[0])),"A"===e[0].tagName)){var i=e,r=this.observe.getTooltipPosition(i),o=$('<span class="redactor-link-tooltip"></span>'),s=i.attr("href");void 0===s&&(s=""),s.length>24&&(s=s.substring(0,24)+"...");var n=$('<a href="'+i.attr("href")+'" target="_blank" />').html(s).addClass("redactor-link-tooltip-action"),a=$('<a href="#" />').html(this.lang.get("edit")).on("click",$.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),l=$('<a href="#" />').html(this.lang.get("unlink")).on("click",$.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");o.append(n).append(" | ").append(a).append(" | ").append(l);var c=parseInt(i.css("line-height"),10),d=Math.ceil((t.pageY-r.top)/c),h=r.top+d*c;o.css({top:h+"px",left:r.left+"px"}),$(".redactor-link-tooltip").remove(),$("body").append(o),this.core.editor().on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,$.proxy(this.observe.closeTooltip,this)),$(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,$.proxy(this.observe.closeTooltip,this))}},closeAllTooltip:function(){$(".redactor-link-tooltip").remove()},closeTooltip:function(t){t=t.originalEvent||t;var e=t.target,i=$(e).closest("a",this.$editor[0]);0!==i.length&&"A"===i[0].tagName&&"A"!==e.tagName||"A"===e.tagName&&this.utils.isRedactorParent(e)||$(e).hasClass("redactor-link-tooltip-action")||(this.observe.closeAllTooltip(),this.core.editor().off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,$.proxy(this.observe.closeTooltip,this)),$(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,$.proxy(this.observe.closeTooltip,this)))}}},offset:function(){return{get:function(t){var e=this.offset.clone(t);if(e===!1)return 0;var i=document.createElement("div");i.appendChild(e.cloneContents()),i.innerHTML=i.innerHTML.replace(/<img(.*?[^>])>$/gi,"i");var r=$.trim($(i).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,"");return r.length},clone:function(t){var e=this.selection.get(),i=this.selection.range(e);if(null===i&&"undefined"==typeof t)return!1;if(t="undefined"==typeof t?this.$editor:t,t===!1)return!1;t=t[0]||t;var r=i.cloneRange();return r.selectNodeContents(t),r.setEnd(i.endContainer,i.endOffset),r},set:function(t,e){e="undefined"==typeof e?t:e,this.focus.is()||this.focus.start();for(var i=this.selection.get(),r=this.selection.range(i),o,s=0,n=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);null!==(o=n.nextNode());)if(s+=o.nodeValue.length,s>t&&(r.setStart(o,o.nodeValue.length+t-s),t=1/0),s>=e){r.setEnd(o,o.nodeValue.length+e-s);break}r.collapse(!1),this.selection.update(i,r)}}},paragraphize:function(){return{load:function(t){return this.opts.paragraphize===!1||"inline"===this.opts.type||"pre"===this.opts.type?t:""===t||"<p></p>"===t?this.opts.emptyHtml:(t+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,t=t.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),t=t.replace(/<\/pre>/gi,"</pre>\n\n"),t=t.replace(/<p>\s<br><\/p>/gi,"<p></p>"),t=this.paragraphize.getSafes(t),t=t.replace("<br>","\n"),t=this.paragraphize.convert(t),t=this.paragraphize.clear(t),t=this.paragraphize.restoreSafes(t),t=t.replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),$.trim(t))},getSafes:function(t){var e=$("<div />").append(t);return e.find("blockquote p").replaceWith(function(){return $(this).append("<br />").contents()}),e.find(this.opts.paragraphizeBlocks.join(", ")).each($.proxy(function(t,e){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=e.outerHTML,$(e).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")},this)),e.find("span.redactor-selection-marker").each($.proxy(function(t,e){return this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=e.outerHTML,$(e).replaceWith("\n#####replace"+this.paragraphize.z+"#####\n\n")},this)),e.html()},restoreSafes:function(t){return $.each(this.paragraphize.safes,function(e,i){i="undefined"!=typeof i?i.replace(/\$/g,"&#36;"):i,t=t.replace("#####replace"+e+"#####",i)}),t},convert:function(t){t=t.replace(/\r\n/g,"xparagraphmarkerz"),t=t.replace(/\n/g,"xparagraphmarkerz"),t=t.replace(/\r/g,"xparagraphmarkerz");var e=/\s+/g;t=t.replace(e," "),t=$.trim(t);var i=/xparagraphmarkerzxparagraphmarkerz/gi;t=t.replace(i,"</p><p>");var r=/xparagraphmarkerz/gi;return t=t.replace(r,"<br>"),t="<p>"+t+"</p>",t=t.replace("<p></p>",""),t=t.replace("\r\n\r\n",""),t=t.replace(/<\/p><p>/g,"</p>\r\n\r\n<p>"),t=t.replace(new RegExp("<br\\s?/?></p>","g"),"</p>"),t=t.replace(new RegExp("<p><br\\s?/?>","g"),"<p>"),t=t.replace(new RegExp("<p><br\\s?/?>","g"),"<p>"),t=t.replace(new RegExp("<br\\s?/?></p>","g"),"</p>"),t=t.replace(/<p>&nbsp;<\/p>/gi,""),t=t.replace(/<p>\s?<br>&nbsp;<\/p>/gi,""),t=t.replace(/<p>\s?<br>/gi,"<p>")},clear:function(t){return t=t.replace(/<p>(.*?)#####replace(.*?)#####\s?<\/p>/gi,"<p>$1</p>#####replace$2#####"),t=t.replace(/(<br\s?\/?>){2,}<\/p>/gi,"</p>"),t=t.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>"),t=t.replace(new RegExp("<p></blockquote>","gi"),"</blockquote>"),t=t.replace(new RegExp("<p><blockquote>","gi"),"<blockquote>"),t=t.replace(new RegExp("<blockquote></p>","gi"),"<blockquote>"),t=t.replace(new RegExp("<p><p ","gi"),"<p "),t=t.replace(new RegExp("<p><p>","gi"),"<p>"),t=t.replace(new RegExp("</p></p>","gi"),"</p>"),t=t.replace(new RegExp("<p>\\s?</p>","gi"),""),t=t.replace(new RegExp("\n</p>","gi"),"</p>"),t=t.replace(new RegExp("<p>\t?\t?\n?<p>","gi"),"<p>"),t=t.replace(new RegExp("<p>\t*</p>","gi"),"")}}},paste:function(){return{init:function(t){this.rtePaste=!0;var e=!("pre"!==this.opts.type&&!this.utils.isCurrentOrParent("pre"));return this.detect.isDesktop()&&!this.paste.pre&&this.opts.clipboardImageUpload&&this.opts.imageUpload&&this.paste.detectClipboardUpload(t)?void(this.detect.isIe()&&setTimeout($.proxy(this.paste.clipboardUpload,this),100)):(this.utils.saveScroll(),this.selection.save(),this.paste.createPasteBox(e),$(window).on("scroll.redactor-freeze",$.proxy(function(){$(window).scrollTop(this.saveBodyScroll)},this)),void setTimeout($.proxy(function(){var t=this.paste.getPasteBoxCode(e);this.buffer.set(),this.selection.restore(),this.utils.restoreScroll();var i=this.clean.getCurrentType(t);t=this.clean.onPaste(t,i);var r=this.core.callback("paste",t);t="undefined"==typeof r?t:r,this.paste.insert(t,i),this.rtePaste=!1,e&&this.clean.cleanPre(),$(window).off("scroll.redactor-freeze")},this),1))},getPasteBoxCode:function(t){var e=t?this.$pasteBox.val():this.$pasteBox.html();return this.$pasteBox.remove(),e},createPasteBox:function(t){var e={position:"fixed",width:"1px",top:0,left:"-9999px"};this.$pasteBox=t?$("<textarea>").css(e):$("<div>").attr("contenteditable","true").css(e),this.paste.appendPasteBox(),this.$pasteBox.focus()},appendPasteBox:function(){if(this.detect.isIe())this.core.box().append(this.$pasteBox);else{var t=$(".modal-body:visible");t.length>0?t.append(this.$pasteBox):$("body").prepend(this.$pasteBox)}},detectClipboardUpload:function(t){t=t.originalEvent||t;var e=t.clipboardData;if(this.detect.isIe())return!0;if(this.detect.isFirefox())return!1;var i=e.types;if(i.indexOf("public.tiff")!==-1)return t.preventDefault(),!1;if(e.items&&e.items.length){var r=e.items[0].getAsFile();if(null===r)return!1;var o=new FileReader;return o.readAsDataURL(r),o.onload=$.proxy(this.paste.insertFromClipboard,this),!0}},clipboardUpload:function(){var t=this.$editor.find("img");$.each(t,$.proxy(function(t,e){if(e.src.search(/^data\:image/i)!==-1){var i=window.FormData?new FormData:null;if(window.FormData){this.buffer.set(),this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=$.proxy(function(t){if(this.detect.isIe())$(e).wrap($("<figure />"));else{var i=$(e).parent();this.utils.replaceToTag(i,"figure")}e.src=t.url,this.core.callback("imageUpload",$(e),t)},this);var r=this.utils.dataURItoBlob(e.src);i.append("clipboard",1),i.append(this.opts.imageUploadParam,r),this.progress.show(),this.upload.send(i,!1),this.code.sync()}}},this))},insertFromClipboard:function(t){var e=window.FormData?new FormData:null;if(window.FormData){this.buffer.set(),this.upload.direct=!0,this.upload.type="image",this.upload.url=this.opts.imageUpload,this.upload.callback=this.image.insert;var i=this.utils.dataURItoBlob(t.target.result);e.append("clipboard",1),e.append(this.opts.imageUploadParam,i),this.progress.show(),this.upload.send(e,t)}},insert:function(t,e){e.pre?this.insert.raw(t):e.text?this.insert.text(t):this.insert.html(t,e),this.detect.isFirefox()&&this.opts.clipboardImageUpload&&setTimeout($.proxy(this.paste.clipboardUpload,this),100)}}},placeholder:function(){return{
enable:function(){setTimeout($.proxy(function(){return this.placeholder.isEditorEmpty()?this.placeholder.show():this.placeholder.hide()},this),5)},show:function(){this.core.editor().addClass("redactor-placeholder")},update:function(t){this.opts.placeholder=t,this.core.editor().attr("placeholder",t)},hide:function(){this.core.editor().removeClass("redactor-placeholder")},is:function(){return this.core.editor().hasClass("redactor-placeholder")},init:function(){this.placeholder.enabled()&&(this.utils.isEditorRelative()||this.utils.setEditorRelative(),this.placeholder.build(),this.placeholder.buildPosition(),this.placeholder.enable(),this.placeholder.enableEvents())},enabled:function(){return this.opts.placeholder?this.core.element().attr("placeholder",this.opts.placeholder):this.placeholder.isAttr()},enableEvents:function(){this.core.editor().on("keydown.redactor-placeholder."+this.uuid,$.proxy(this.placeholder.enable,this))},disableEvents:function(){this.core.editor().off(".redactor-placeholder."+this.uuid)},build:function(){this.core.editor().attr("placeholder",this.core.element().attr("placeholder"))},buildPosition:function(){var t=$("<style />");t.addClass("redactor-placeholder-style-tag"),t.html("#"+this.core.id()+".redactor-placeholder::after "+this.placeholder.getPosition()),$("head").append(t)},getPosition:function(){return"{ top: "+this.core.editor().css("padding-top")+"; left: "+this.core.editor().css("padding-left")+"; }"},isEditorEmpty:function(){var t=$.trim(this.core.editor().html()).replace(/[\t\n]/g,""),e=["","<p>​</p>","<p>​<br></p>"];return $.inArray(t,e)!==-1},isAttr:function(){return"undefined"!=typeof this.core.element().attr("placeholder")&&""!==this.core.element().attr("placeholder")},destroy:function(){this.core.editor().removeAttr("placeholder"),this.placeholder.hide(),this.placeholder.disableEvents(),$(".redactor-placeholder-style-tag").remove()}}},progress:function(){return{$box:null,$bar:null,target:document.body,show:function(){this.progress.is()?this.progress.$box.show():(this.progress.build(),this.progress.$box.redactorAnimation("fadeIn"))},hide:function(){this.progress.is()&&this.progress.$box.redactorAnimation("fadeOut",{duration:.35},$.proxy(this.progress.destroy,this))},update:function(t){this.progress.show(),this.progress.$bar.css("width",t+"%")},is:function(){return null!==this.progress.$box},build:function(){this.progress.$bar=$("<span />"),this.progress.$box=$('<div id="redactor-progress" />'),this.progress.$box.append(this.progress.$bar),$(this.progress.target).append(this.progress.$box)},destroy:function(){this.progress.is()&&this.progress.$box.remove(),this.progress.$box=null,this.progress.$bar=null}}},selection:function(){return{get:function(){return window.getSelection?window.getSelection():document.selection&&"Control"!==document.selection.type?document.selection:null},range:function(t){return"undefined"==typeof t&&(t=this.selection.get()),t.getRangeAt&&t.rangeCount?t.getRangeAt(0):null},is:function(){return!this.selection.isCollapsed()},isRedactor:function(){var t=this.selection.range();if(null!==t){var e=t.startContainer.parentNode;if($(e).hasClass("redactor-in")||0!==$(e).parents(".redactor-in").length)return!0}return!1},isCollapsed:function(){var t=this.selection.get();return null!==t&&t.isCollapsed},update:function(t,e){null!==e&&(t.removeAllRanges(),t.addRange(e))},current:function(){var t=this.selection.get();return null!==t&&t.anchorNode},parent:function(){var t=this.selection.current();return null!==t&&t.parentNode},block:function(t){for(t=t||this.selection.current();t;){if(this.utils.isBlockTag(t.tagName))return!$(t).hasClass("redactor-in")&&t;t=t.parentNode}return!1},inline:function(t){for(t=t||this.selection.current();t;){if(this.utils.isInlineTag(t.tagName))return!$(t).hasClass("redactor-in")&&t;t=t.parentNode}return!1},element:function(t){for(t||(t=this.selection.current());t;){if(1===t.nodeType)return!$(t).hasClass("redactor-in")&&t;t=t.parentNode}return!1},prev:function(){var t=this.selection.current();return null!==t&&this.selection.current().previousSibling},next:function(){var t=this.selection.current();return null!==t&&this.selection.current().nextSibling},blocks:function(t){var e=[],i=this.selection.nodes(t);$.each(i,$.proxy(function(t,i){this.utils.isBlock(i)&&e.push(i)},this));var r=this.selection.block();return 0===e.length&&r===!1?[]:0===e.length&&r!==!1?[r]:e},inlines:function(t){var e=[],i=this.selection.nodes(t);$.each(i,$.proxy(function(t,i){this.utils.isInline(i)&&e.push(i)},this));var r=this.selection.inline();return 0===e.length&&r===!1?[]:0===e.length&&r!==!1?[r]:e},nodes:function(t){var e="undefined"==typeof t?[]:$.isArray(t)?t:[t],i=this.selection.get(),r=this.selection.range(i);if(this.utils.isCollapsed())return[this.selection.current()];var o=r.startContainer,s=r.endContainer;if(o===s)return[o];for(var n=[];o&&o!==s;)n.push(o=this.selection.nextNode(o));for(o=r.startContainer;o&&o!==r.commonAncestorContainer;)n.unshift(o),o=o.parentNode;var a=[];return $.each(n,function(t,i){if(i){var r=1===i.nodeType&&i.tagName.toLowerCase();if($(i).hasClass("redactor-script-tag, redactor-selection-marker"))return;if(r&&0!==e.length&&$.inArray(r,e)===-1)return;a.push(i)}}),0===a.length?[]:a},nextNode:function(t){if(t.hasChildNodes())return t.firstChild;for(;t&&!t.nextSibling;)t=t.parentNode;return t?t.nextSibling:null},save:function(){this.marker.insert(),this.savedSel=this.core.editor().html()},restore:function(t){var e=this.marker.find(1),i=this.marker.find(2);this.detect.isFirefox()&&this.core.editor().focus(),0!==e.length&&0!==i.length?this.caret.set(e,i):0!==e.length?this.caret.start(e):this.core.editor().focus(),t!==!1&&(this.marker.remove(),this.savedSel=!1)},node:function(t){$(t).prepend(this.marker.get(1)),$(t).append(this.marker.get(2)),this.selection.restore()},all:function(){this.core.editor().focus();var t=this.selection.get(),e=this.selection.range(t);e.selectNodeContents(this.core.editor()[0]),this.selection.update(t,e)},remove:function(){this.selection.get().removeAllRanges()},replace:function(t){this.insert.html(t)},text:function(){return this.selection.get().toString()},html:function(){var t="",e=this.selection.get();if(e.rangeCount){for(var i=document.createElement("div"),r=e.rangeCount,o=0;o<r;++o)i.appendChild(e.getRangeAt(o).cloneContents());t=this.clean.onGet(i.innerHTML)}return t},extractEndOfNode:function(t){var e=this.selection.get(),i=this.selection.range(e),r=i.cloneRange();return r.selectNodeContents(t),r.setStart(i.endContainer,i.endOffset),r.extractContents()},removeMarkers:function(){this.marker.remove()},marker:function(t){return this.marker.get(t)},markerHtml:function(t){return this.marker.html(t)}}},shortcuts:function(){return{hotkeysSpecialKeys:{8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},hotkeysShiftNums:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"},init:function(t,e){return this.opts.shortcuts===!1?(!t.ctrlKey&&!t.metaKey||66!==e&&73!==e||t.preventDefault(),!1):void $.each(this.opts.shortcuts,$.proxy(function(e,i){this.shortcuts.build(t,e,i)},this))},build:function(t,e,i){for(var r=$.proxy(function(){this.shortcuts.buildHandler(i)},this),o=e.split(","),s=o.length,n=0;n<s;n++)"string"==typeof o[n]&&this.shortcuts.handler(t,$.trim(o[n]),r)},buildHandler:function(t){var e;"-1"!==t.func.search(/\./)?(e=t.func.split("."),"undefined"!=typeof this[e[0]]&&this[e[0]][e[1]].apply(this,t.params)):this[t.func].apply(this,t.params)},handler:function(t,e,i){e=e.toLowerCase().split(" ");var r=this.shortcuts.hotkeysSpecialKeys[t.keyCode],o=String.fromCharCode(t.which).toLowerCase(),s="",n={};$.each(["alt","ctrl","meta","shift"],function(e,i){t[i+"Key"]&&r!==i&&(s+=i+"+")}),r&&(n[s+r]=!0),o&&(n[s+o]=!0,n[s+this.shortcuts.hotkeysShiftNums[o]]=!0,"shift+"===s&&(n[this.shortcuts.hotkeysShiftNums[o]]=!0));for(var a=e.length,l=0;l<a;l++)if(n[e[l]])return t.preventDefault(),i.apply(this,arguments)}}},storage:function(){return{data:[],add:function(t){t.status=!0,t.url=decodeURI(this.link.removeSelfHostFromUrl(t.url)),this.storage.data[t.url]=t},status:function(t,e){this.storage.data[decodeURI(t)].status=e},observe:function(){var t=this,e=this.core.editor().find("[data-image]");e.each(function(e,i){t.storage.add({type:"image",node:i,url:i.src,id:$(i).attr("data-image")})});var i=this.core.editor().find("[data-file]");i.each(function(e,i){t.storage.add({type:"file",node:i,url:i.href,id:$(i).attr("data-file")})});var r=this.core.editor().find("[data-s3]");r.each(function(e,i){var r="IMG"===i.tagName?i.src:i.href;t.storage.add({type:"s3",node:i,url:r,id:$(i).attr("data-s3")})})},changes:function(){for(var t in this.storage.data){var e=this.storage.data[t],i="IMG"===e.node.tagName?"src":"href",r=this.core.editor().find("[data-"+e.type+"]["+i+'="'+e.url+'"]');0===r.length?this.storage.status(e.url,!1):this.storage.status(e.url,!0)}return this.storage.data}}},toolbar:function(){return{build:function(){this.button.hideButtons(),this.button.hideButtonsOnMobile(),this.$toolbar=this.toolbar.createContainer(),this.toolbar.append(),this.button.$toolbar=this.$toolbar,this.button.setFormatting(),this.button.load(this.$toolbar),this.toolbar.setFixed()},createContainer:function(){return $("<ul>").addClass("redactor-toolbar").attr({id:"redactor-toolbar-"+this.uuid,role:"toolbar"})},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),$(this.opts.toolbarExternal).html(this.$toolbar)):"textarea"===this.opts.type?this.$box.prepend(this.$toolbar):this.$element.before(this.$toolbar)},setFixed:function(){if(this.opts.toolbarFixed&&!this.opts.toolbarExternal){if(this.opts.toolbarFixedTarget!==document){var t=$(this.opts.toolbarFixedTarget);this.toolbarOffsetTop=0===t.length?0:this.core.box().offset().top-t.offset().top}var e=0!==this.core.box().closest(".modal-body").length?1e3:0;setTimeout($.proxy(function(){if(this.toolbar.observeScroll(!1),this.detect.isDesktop())$(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,$.proxy(this.toolbar.observeScroll,this));else{var t=this;$(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,function(){t.core.toolbar().hide(),clearTimeout($.data(this,"scrollCheck")),$.data(this,"scrollCheck",setTimeout(function(){t.core.toolbar().show(),t.toolbar.observeScroll()},250))})}},this),e)}},getBoxTop:function(){return this.opts.toolbarFixedTarget===document?this.core.box().offset().top:this.toolbarOffsetTop},observeScroll:function(t){var e=0;t!==!1&&(e=this.opts.toolbarFixedTarget===document?20:0);var i=$(this.opts.toolbarFixedTarget).scrollTop(),r=this.toolbar.getBoxTop();i!==r&&(i+this.opts.toolbarFixedTopOffset+e>r?this.toolbar.observeScrollEnable(i,r):this.toolbar.observeScrollDisable())},observeScrollResize:function(){this.$toolbar.css({width:this.core.box().innerWidth(),left:this.core.box().offset().left})},observeScrollEnable:function(t,e){if("undefined"!=typeof this.fullscreen&&this.fullscreen.isOpened===!1)return void this.toolbar.observeScrollDisable();var i=e+this.core.box().outerHeight()-32,r=this.core.box().innerWidth(),o=this.detect.isDesktop()?"fixed":"absolute",s=this.detect.isDesktop()?this.opts.toolbarFixedTopOffset:$(this.opts.toolbarFixedTarget).scrollTop()-e,n=this.detect.isDesktop()?this.core.box().offset().left:0;this.opts.toolbarFixedTarget!==document&&(o="absolute",s=this.opts.toolbarFixedTopOffset+$(this.opts.toolbarFixedTarget).scrollTop()-e,n=0),this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:o,width:r,top:s,left:n}),t>i&&$(".redactor-dropdown-"+this.uuid+":visible").hide(),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",t<i?"visible":"hidden"),$(window).on("resize.redactor-toolbar."+this.uuid,$.proxy(this.toolbar.observeScrollResize,this))},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box"),$(window).off("resize.redactor-toolbar."+this.uuid)},setDropdownsFixed:function(){var t=this.opts.toolbarFixedTarget===document&&this.detect.isDesktop()?"fixed":"absolute";this.toolbar.setDropdownPosition(t)},unsetDropdownsFixed:function(){this.toolbar.setDropdownPosition("absolute")},setDropdownPosition:function(t){var e=this;$(".redactor-dropdown-"+this.uuid).each(function(){var i=$(this),r=e.button.get(i.attr("rel")),o="fixed"===t?e.opts.toolbarFixedTopOffset:r.offset().top;i.css({position:t,top:r.innerHeight()+o+"px"})})}}},upload:function(){return{init:function(t,e,i){this.upload.direct=!1,this.upload.callback=i,this.upload.url=e,this.upload.$el=$(t),this.upload.$droparea=$('<div id="redactor-droparea" />'),this.upload.$placeholdler=$('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload-label")),this.upload.$input=$('<input type="file" name="file" />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",$.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",$.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",$.proxy(function(t){t=t.originalEvent||t,this.upload.traverseFile(this.upload.$input[0].files[0],t)},this)),this.upload.$droparea.on("drop.redactor.upload",$.proxy(function(t){t.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(t)},this))},directUpload:function(t,e){this.upload.direct=!0,this.upload.traverseFile(t,e)},onDrop:function(t){t=t.originalEvent||t;var e=t.dataTransfer.files;if(this.opts.multipleImageUpload)for(var i=e.length,r=0;r<i;r++)this.upload.traverseFile(e[r],t);else this.upload.traverseFile(e[0],t)},traverseFile:function(t,e){if(this.opts.s3)return this.upload.setConfig(t),void this.uploads3.send(t,e);var i=window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(t);var r="image"===this.upload.type?this.opts.imageUploadParam:this.opts.fileUploadParam;i.append(r,t)}this.progress.show(),this.core.callback("uploadStart",e,i),this.upload.send(i,e)},setConfig:function(t){this.upload.getType(t),this.upload.direct&&(this.upload.url="image"===this.upload.type?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback="image"===this.upload.type?this.image.insert:this.file.insert)},getType:function(t){this.upload.type=this.opts.imageTypes.indexOf(t.type)===-1?"file":"image",null===this.opts.imageUpload&&null!==this.opts.fileUpload&&(this.upload.type="file")},getHiddenFields:function(t,e){return t===!1||"object"!=typeof t?e:($.each(t,$.proxy(function(t,i){null!==i&&0===i.toString().indexOf("#")&&(i=$(i).val()),e.append(t,i)},this)),e)},send:function(t,e){"image"===this.upload.type?(t=this.utils.appendFields(this.opts.imageUploadFields,t),t=this.utils.appendForms(this.opts.imageUploadForms,t),t=this.upload.getHiddenFields(this.upload.imageFields,t)):(t=this.utils.appendFields(this.opts.fileUploadFields,t),t=this.utils.appendForms(this.opts.fileUploadForms,t),t=this.upload.getHiddenFields(this.upload.fileFields,t));var i=new XMLHttpRequest;i.open("POST",this.upload.url),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.onreadystatechange=$.proxy(function(){if(4===i.readyState){var t=i.responseText;t=t.replace(/^\[/,""),t=t.replace(/\]$/,"");var r;try{r="string"==typeof t?$.parseJSON(t):t}catch(t){r={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(r,this.upload.direct,e)}},this),i.send(t)},onDrag:function(t){t.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(t){t.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(t,e){this.upload.imageFields[t]=e},removeImageFields:function(t){delete this.upload.imageFields[t]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(t,e){this.upload.fileFields[t]=e},removeFileFields:function(t){delete this.upload.fileFields[t]}}},uploads3:function(){return{send:function(t,e){this.uploads3.executeOnSignedUrl(t,$.proxy(function(i){this.uploads3.sendToS3(t,i,e)},this))},executeOnSignedUrl:function(t,e){var i=new XMLHttpRequest,r=this.opts.s3.search(/\?/)===-1?"?":"&";i.open("GET",this.opts.s3+r+"name="+t.name+"&type="+t.type,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined");var o=this;i.onreadystatechange=function(t){4===this.readyState&&200===this.status&&(o.progress.show(),e(decodeURIComponent(this.responseText)))},i.send()},createCORSRequest:function(t,e){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(t,e,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(t,e)):i=null,i},sendToS3:function(t,e,i){var r=this.uploads3.createCORSRequest("PUT",e);r&&(r.onload=$.proxy(function(){var t;if(this.progress.hide(),200!==r.status)return t={error:!0},void this.upload.callback(t,this.upload.direct,r);var o=e.split("?");if(!o[0])return!1;if(this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),t={url:o[0],id:o[0],s3:!0},"file"===this.upload.type){var s=o[0].split("/");t.name=s[s.length-1]}this.upload.callback(t,this.upload.direct,i)},this),r.onerror=function(){},r.upload.onprogress=function(t){},r.setRequestHeader("Content-Type",t.type),r.setRequestHeader("x-amz-acl","public-read"),r.send(t))}}},utils:function(){return{isEmpty:function(t){return t="undefined"==typeof t?this.core.editor().html():t,t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/&nbsp;/gi,""),t=t.replace(/<\/?br\s?\/?>/g,""),t=t.replace(/\s/g,""),t=t.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,""),t=t.replace(/<iframe(.*?[^>])>$/i,"iframe"),t=t.replace(/<source(.*?[^>])>$/i,"source"),t=t.replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),t=t.replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),t=$.trim(t),""===t},isElement:function(t){try{return t instanceof HTMLElement}catch(e){return"object"==typeof t&&1===t.nodeType&&"object"==typeof t.style&&"object"==typeof t.ownerDocument}},strpos:function(t,e,i){var r=t.indexOf(e,i);return r>=0&&r},dataURItoBlob:function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var i=t.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(e.length),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);return new Blob([r],{type:i})},getOuterHtml:function(t){return $("<div>").append($(t).eq(0).clone()).html()},cloneAttributes:function(t,e){t=t[0]||t,e=$(e);for(var i=t.attributes,r=i.length;r--;){var o=i[r];e.attr(o.name,o.value)}return e},breakBlockTag:function(){var t=this.selection.block();if(!t)return!1;var e=this.utils.isEmpty(t.innerHTML),i=t.tagName.toLowerCase();if("pre"===i||"li"===i||"td"===i||"th"===i)return!1;if(!e&&this.utils.isStartOfElement(t))return{$block:$(t),$next:$(t).next(),type:"start"};if(!e&&this.utils.isEndOfElement(t))return{$block:$(t),$next:$(t).next(),type:"end"};var r=this.selection.extractEndOfNode(t),o=$("<"+i+" />").append(r);return o=this.utils.cloneAttributes(t,o),$(t).after(o),{$block:$(t),$next:o,type:"break"}},inBlocks:function(t){t=$.isArray(t)?t:[t];for(var e=this.selection.blocks(),i=e.length,r=!1,o=0;o<i;o++)if(e[o]!==!1){var s=e[o].tagName.toLowerCase();$.inArray(s,t)!==-1&&(r=!0)}return r},inInlines:function(t){t=$.isArray(t)?t:[t];for(var e=this.selection.inlines(),i=e.length,r=!1,o=0;o<i;o++){var s=e[o].tagName.toLowerCase();$.inArray(s,t)!==-1&&(r=!0)}return r},isTag:function(t,e){var i=$(t).closest(e,this.core.editor()[0]);return 1===i.length&&i[0]},isBlock:function(t){return null!==t&&(t=t[0]||t,t&&this.utils.isBlockTag(t.tagName))},isBlockTag:function(t){return"undefined"!=typeof t&&this.reIsBlock.test(t)},isInline:function(t){return t=t[0]||t,t&&this.utils.isInlineTag(t.tagName)},isInlineTag:function(t){return"undefined"!=typeof t&&this.reIsInline.test(t)},isRedactorParent:function(t){return!!t&&(0!==$(t).parents(".redactor-in").length&&!$(t).hasClass("redactor-in")&&t)},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(t){var e=this.selection.parent(),i=this.selection.current();if($.isArray(t)){var r=0;return $.each(t,$.proxy(function(t,o){this.utils.isCurrentOrParentOne(i,e,o)&&r++},this)),0!==r}return this.utils.isCurrentOrParentOne(i,e,t)},isCurrentOrParentOne:function(t,e,i){return i=i.toUpperCase(),e&&e.tagName===i?e:!(!t||t.tagName!==i)&&t},isEditorRelative:function(){var t=this.core.editor().css("position"),e=["absolute","fixed","relative"];return $.inArray(e,t)!==-1},setEditorRelative:function(){this.core.editor().addClass("redactor-relative")},getScrollTarget:function(){var t=$(this.opts.scrollTarget);return 0!==t.length?t:$(document)},freezeScroll:function(){this.freezeScrollTop=this.utils.getScrollTarget().scrollTop(),this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},unfreezeScroll:function(){"undefined"!=typeof this.freezeScrollTop&&this.utils.getScrollTarget().scrollTop(this.freezeScrollTop)},saveScroll:function(){this.tmpScrollTop=this.utils.getScrollTarget().scrollTop()},restoreScroll:function(){"undefined"!=typeof this.tmpScrollTop&&this.utils.getScrollTarget().scrollTop(this.tmpScrollTop)},isStartOfElement:function(t){return!("undefined"==typeof t&&!(t=this.selection.block()))&&0===this.offset.get(t)},isEndOfElement:function(t){if("undefined"==typeof t&&(t=this.selection.block(),!t))return!1;var e=$.trim($(t).text()).replace(/[\t\n\r\n]/g,"").replace(/\u200B/g,""),i=this.offset.get(t);return i===e.length},removeEmptyAttr:function(t,e){var i=$(t);return"undefined"==typeof i.attr(e)||""===i.attr(e)&&(i.removeAttr(e),!0)},replaceToTag:function(t,e){var i;return $(t).replaceWith(function(){i=$("<"+e+" />").append($(this).contents());for(var t=0;t<this.attributes.length;t++)i.attr(this.attributes[t].name,this.attributes[t].value);return i}),i},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},disableBodyScroll:function(){var t=$("html"),e=window.innerWidth;if(!e){var i=document.documentElement.getBoundingClientRect();e=i.right-Math.abs(i.left)}var r=document.body.clientWidth<e,o=this.utils.measureScrollbar();t.css("overflow","hidden"),r&&t.css("padding-right",o)},measureScrollbar:function(){var t=$("body"),e=document.createElement("div");e.className="redactor-scrollbar-measure",t.append(e);var i=e.offsetWidth-e.clientWidth;return t[0].removeChild(e),i},enableBodyScroll:function(){$("html").css({overflow:"","padding-right":""}),$("body").remove("redactor-scrollbar-measure")},appendFields:function(t,e){if(!t)return e;if("object"==typeof t)return $.each(t,function(t,i){null!==i&&0===i.toString().indexOf("#")&&(i=$(i).val()),e.append(t,i)}),e;var i=$(t);if(0===i.length)return e;var r="";return i.each(function(){e.append($(this).attr("name"),$(this).val())}),e},appendForms:function(t,e){if(!t)return e;var i=$(t);if(0===i.length)return e;var r=i.serializeArray();return $.each(r,function(t,i){e.append(i.name,i.value)}),e},isRgb:function(t){return 0===t.search(/^rgb/i)},rgb2hex:function(t){function e(t){return("0"+parseInt(t).toString(16)).slice(-2)}return t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+e(t[1])+e(t[2])+e(t[3])},isCollapsed:function(){return this.selection.isCollapsed()},isMobile:function(){return this.detect.isMobile()},isDesktop:function(){return this.detect.isDesktop()},isPad:function(){return this.detect.isIpad()}}},browser:function(){return{webkit:function(){return this.detect.isWebkit()},ff:function(){return this.detect.isFirefox()},ie:function(){return this.detect.isIe()}}}},$(window).on("load.tools.redactor",function(){$('[data-tools="redactor"]').redactor()}),t.prototype.init.prototype=t.prototype}(jQuery),function($){function t(t,e,i,r){var o={duration:.5,iterate:1,delay:0,prefix:"redactor-",timing:"linear"};this.animation=e,this.slide="slideDown"===this.animation||"slideUp"===this.animation,this.$element=$(t),this.prefixes=["","-moz-","-o-animation-","-webkit-"],this.queue=[],"function"==typeof i?(r=i,this.opts=o):this.opts=$.extend(o,i),this.slide&&this.$element.height(this.$element.height()),this.init(r)}$.fn.redactorAnimation=function(e,i,r){return this.each(function(){new t(this,e,i,r)})},t.prototype={init:function(t){this.queue.push(this.animation),this.clean(),"show"===this.animation?(this.opts.timing="linear",this.$element.removeClass("hide").show(),"function"==typeof t&&t(this)):"hide"===this.animation?(this.opts.timing="linear",this.$element.hide(),"function"==typeof t&&t(this)):this.animate(t)},animate:function(t){this.$element.addClass("animated").css("display","").removeClass("hide"),this.$element.addClass(this.opts.prefix+this.queue[0]),this.set(this.opts.duration+"s",this.opts.delay+"s",this.opts.iterate,this.opts.timing);var e=this.queue.length>1?null:t;this.complete("AnimationEnd",$.proxy(function(){this.$element.hasClass(this.opts.prefix+this.queue[0])&&(this.clean(),this.queue.shift(),this.queue.length&&this.animate(t))},this),e)},set:function(t,e,i,r){for(var o=this.prefixes.length;o--;)this.$element.css(this.prefixes[o]+"animation-duration",t),this.$element.css(this.prefixes[o]+"animation-delay",e),this.$element.css(this.prefixes[o]+"animation-iteration-count",i),this.$element.css(this.prefixes[o]+"animation-timing-function",r)},clean:function(){this.$element.removeClass("animated"),this.$element.removeClass(this.opts.prefix+this.queue[0]),this.set("","","","")},complete:function(t,e,i){this.$element.one(t.toLowerCase()+" webkit"+t+" o"+t+" MS"+t,$.proxy(function(){"function"==typeof e&&e(),"function"==typeof i&&i(this);var t=["fadeOut","slideUp","zoomOut","slideOutUp","slideOutRight","slideOutLeft"];$.inArray(this.animation,t)!==-1&&this.$element.css("display","none"),this.slide&&this.$element.css("height","")},this))}}}(jQuery),function($){$.Redactor.prototype.table=function(){return{langs:{en:{table:"Table","insert-table":"Insert table","insert-row-above":"Insert row above","insert-row-below":"Insert row below","insert-column-left":"Insert column left","insert-column-right":"Insert column right","add-head":"Add head","delete-head":"Delete head","delete-column":"Delete column","delete-row":"Delete row","delete-table":"Delete table"}},init:function(){var t={};t.insert_table={title:this.lang.get("insert-table"),func:this.table.insert,observe:{element:"table",in:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_row_above={title:this.lang.get("insert-row-above"),func:this.table.addRowAbove,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_row_below={title:this.lang.get("insert-row-below"),func:this.table.addRowBelow,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_column_left={title:this.lang.get("insert-column-left"),func:this.table.addColumnLeft,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.insert_column_right={title:this.lang.get("insert-column-right"),func:this.table.addColumnRight,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.add_head={title:this.lang.get("add-head"),func:this.table.addHead,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_head={title:this.lang.get("delete-head"),func:this.table.deleteHead,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_column={title:this.lang.get("delete-column"),func:this.table.deleteColumn,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_row={title:this.lang.get("delete-row"),func:this.table.deleteRow,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}},t.delete_table={title:this.lang.get("delete-table"),func:this.table.deleteTable,observe:{element:"table",out:{attr:{class:"redactor-dropdown-link-inactive","aria-disabled":!0}}}};var e=this.button.addBefore("link","table",this.lang.get("table"));this.button.addDropdown(e,t)},insert:function(){if(!this.table.getTable()){this.placeholder.hide();for(var t=2,e=3,i=$("<div>"),r=$("<table />"),o=0;o<t;o++){for(var s=$("<tr>"),n=0;n<e;n++){var a=$("<td>"+this.opts.invisibleSpace+"</td>");0===o&&0===n&&a.append(this.marker.get()),$(s).append(a)}r.append(s)}i.append(r);var l=i.html();this.buffer.set();var c=this.selection.current();0!==$(c).closest("li",this.core.editor()[0]).length?$(c).closest("ul, ol").first().after(l):(this.air.collapsed(),this.insert.html(l)),this.selection.restore(),this.core.callback("insertedTable",r)}},getTable:function(){var t=$(this.selection.current()).closest("table");return!!this.utils.isRedactorParent(t)&&(0!==t.size()&&t)},restoreAfterDelete:function(t){this.selection.restore(),t.find("span.redactor-selection-marker").remove()},deleteTable:function(){var t=this.table.getTable();if(t){this.buffer.set();var e=t.next();this.opts.linebreaks||0===e.length?this.caret.after(t):this.caret.start(e),t.remove()}},deleteRow:function(){var t=this.table.getTable();if(t){var e=$(this.selection.current());this.buffer.set();var i=e.closest("tr"),r=i.prev().length?i.prev():i.next();if(r.length){var o=r.children("td, th").first();o.length&&o.prepend(this.marker.get())}i.remove(),this.table.restoreAfterDelete(t)}},deleteColumn:function(){var t=this.table.getTable();if(t){this.buffer.set();var e=$(this.selection.current()),i=e.closest("td, th"),r=i[0].cellIndex;t.find("tr").each($.proxy(function(t,e){var i=$(e),o=r-1<0?r+1:r-1;0===t&&i.find("td, th").eq(o).prepend(this.marker.get()),i.find("td, th").eq(r).remove()},this)),this.table.restoreAfterDelete(t)}},addHead:function(){var t=this.table.getTable();if(t){if(this.buffer.set(),0!==t.find("thead").size())return void this.table.deleteHead();var e=t.find("tr").first().clone();e.find("td").replaceWith($.proxy(function(){return $("<th>").html(this.opts.invisibleSpace)},this)),$thead=$("<thead></thead>").append(e),t.prepend($thead)}},deleteHead:function(){var t=this.table.getTable();if(t){var e=t.find("thead");0!==e.size()&&(this.buffer.set(),e.remove())}},addRowAbove:function(){this.table.addRow("before")},addRowBelow:function(){this.table.addRow("after")},addColumnLeft:function(){this.table.addColumn("before")},addColumnRight:function(){this.table.addColumn("after")},addRow:function(t){var e=this.table.getTable();if(e){this.buffer.set();var i=$(this.selection.current()),r=i.closest("tr"),o=r.clone();o.find("th").replaceWith(function(){var t=$("<td>");return t[0].attributes=this.attributes,t.append($(this).contents())}),o.find("td").html(this.opts.invisibleSpace),"after"===t?r.after(o):r.before(o)}},addColumn:function(t){var e=this.table.getTable();if(e){var i=0,r=$(this.selection.current());this.buffer.set();var o=r.closest("tr"),s=r.closest("td, th");o.find("td, th").each($.proxy(function(t,e){$(e)[0]===s[0]&&(i=t)},this)),e.find("tr").each($.proxy(function(e,r){var o=$(r).find("td, th").eq(i),s=o.clone();
s.html(this.opts.invisibleSpace),"after"===t?o.after(s):o.before(s)},this))}}}}}(jQuery),function($){$.Redactor.prototype.video=function(){return{reUrlYoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,reUrlVimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,langs:{en:{video:"Video","video-html-code":"Video Embed Code or Youtube/Vimeo Link"}},getTemplate:function(){return String()+'<div class="modal-section" id="redactor-modal-video-insert"><section><label>'+this.lang.get("video-html-code")+'</label><textarea id="redactor-insert-video-area" style="height: 160px;"></textarea></section><section><button id="redactor-modal-button-action">Insert</button><button id="redactor-modal-button-cancel">Cancel</button></section></div>'},init:function(){var t=this.button.addAfter("image","video",this.lang.get("video"));this.button.addCallback(t,this.video.show)},show:function(){this.modal.addTemplate("video",this.video.getTemplate()),this.modal.load("video",this.lang.get("video"),700),this.modal.getActionButton().text(this.lang.get("insert")).on("click",this.video.insert),this.modal.show(),this.detect.isDesktop()&&setTimeout(function(){$("#redactor-insert-video-area").focus()},1)},insert:function(){var t=$("#redactor-insert-video-area").val();if(!t.match(/<iframe|<video/gi)){t=this.clean.stripTags(t),this.opts.videoContainerClass="undefined"==typeof this.opts.videoContainerClass?"video-container":this.opts.videoContainerClass;var e='<div class="'+this.opts.videoContainerClass+'"><iframe style="width: 500px; height: 281px;" src="',i='" frameborder="0" allowfullscreen></iframe></div>';t.match(this.video.reUrlYoutube)?t=t.replace(this.video.reUrlYoutube,e+"//www.youtube.com/embed/$1"+i):t.match(this.video.reUrlVimeo)&&(t=t.replace(this.video.reUrlVimeo,e+"//player.vimeo.com/video/$2"+i))}this.modal.close(),this.placeholder.hide(),this.buffer.set(),this.air.collapsed(),this.insert.html(t)}}}}(jQuery),function($){$.Redactor.prototype.imagemanager=function(){return{langs:{en:{upload:"Upload",choose:"Choose"}},init:function(){this.opts.imageManagerJson&&this.modal.addCallback("image",this.imagemanager.load)},load:function(){var t=$('<div style="overflow: auto; height: 300px; display: none;" class="redactor-modal-tab" data-title="Choose">');this.modal.getModal().append(t),$.ajax({dataType:"json",cache:!1,url:this.opts.imageManagerJson,success:$.proxy(function(e){$.each(e,$.proxy(function(e,i){var r="";"undefined"!=typeof i.title&&(r=i.title);var o=$('<img src="'+i.thumb+'"  data-params="'+encodeURI(JSON.stringify(i))+'" style="width: 100px; height: 75px; cursor: pointer;" />');t.append(o),$(o).click($.proxy(this.imagemanager.insert,this))},this))},this)})},insert:function(t){var e=$(t.target),i=$.parseJSON(decodeURI(e.attr("data-params")));this.image.insert(i,null)}}}}(jQuery),function($){$.Redactor.prototype.filemanager=function(){return{langs:{en:{upload:"Upload",choose:"Choose"}},init:function(){this.opts.fileManagerJson&&this.modal.addCallback("file",this.filemanager.load)},load:function(){var t=$('<div  style="overflow: auto; height: 300px; display: none;" class="redactor-modal-tab" data-title="Choose">').hide();this.modal.getModal().append(t),$.ajax({dataType:"json",cache:!1,url:this.opts.fileManagerJson,success:$.proxy(function(e){var i=$('<ul id="redactor-modal-list">');$.each(e,$.proxy(function(t,e){var r=$('<a href="#" data-params="'+encodeURI(JSON.stringify(e))+'" class="redactor-file-manager-link">'+e.title+' <span style="font-size: 11px; color: #888;">'+e.name+'</span> <span style="position: absolute; right: 10px; font-size: 11px; color: #888;">('+e.size+")</span></a>"),o=$("<li />");r.on("click",$.proxy(this.filemanager.insert,this)),o.append(r),i.append(o)},this)),t.append(i)},this)})},insert:function(t){t.preventDefault();var e=$(t.target).closest(".redactor-file-manager-link"),i=$.parseJSON(decodeURI(e.attr("data-params")));this.file.insert(i,null)}}}}(jQuery),function($){$.Redactor.prototype.codemirror=function(){return{init:function(){var t=this.button.addFirst("html","HTML");this.button.addCallback(t,this.codemirror.toggle),this.codemirror.$textarea=$("<textarea />"),this.codemirror.$textarea.hide(),"textarea"===this.opts.type?this.core.box().append(this.codemirror.$textarea):this.core.box().after(this.codemirror.$textarea),this.core.element().on("destroy.callback.redactor",$.proxy(function(){this.codemirror.$textarea.remove()},this));var e="undefined"!=typeof this.opts.codemirror?this.opts.codemirror:{lineNumbers:!0};this.codemirror.editor=CodeMirror.fromTextArea(this.codemirror.$textarea[0],e),this.codemirror.$textarea.next(".CodeMirror").hide()},toggle:function(){return this.codemirror.$textarea.hasClass("open")?this.codemirror.hide():this.codemirror.show()},setCaretOnShow:function(){this.codemirror.offset=this.offset.get();var t=$(window).scrollTop(),e=this.core.editor().innerWidth(),i=this.core.editor().innerHeight();this.codemirror.start=0,this.codemirror.end=0;var r=$("<div/>").append($.parseHTML(this.core.editor().html(),document,!0)),o=r.find(".redactor-selection-marker");if(o.length>0){var s=r.html().replace(/&amp;/g,"&");1===o.length?(this.codemirror.start=this.utils.strpos(s,r.find("#selection-marker-1").prop("outerHTML")),this.codemirror.end=this.codemirror.start):2===o.length&&(this.codemirror.start=this.utils.strpos(s,r.find("#selection-marker-1").prop("outerHTML")),this.codemirror.end=this.utils.strpos(s,r.find("#selection-marker-2").prop("outerHTML"))-r.find("#selection-marker-1").prop("outerHTML").toString().length)}},setCaretOnHide:function(){this.codemirror.start=0,this.codemirror.end=0;var t=this,e="";if(this.codemirror.$textarea.next(".CodeMirror").each(function(i,r){t.codemirror.selection=r.CodeMirror.listSelections(),t.codemirror.start=r.CodeMirror.indexFromPos(t.codemirror.selection[0].anchor),t.codemirror.end=r.CodeMirror.indexFromPos(t.codemirror.selection[0].head),e=r.CodeMirror.getValue()}),this.codemirror.start>this.codemirror.end&&this.codemirror.end>0){var i=this.codemirror.end,r=this.codemirror.start;this.codemirror.start=i,this.codemirror.end=r}if(this.codemirror.start=this.codemirror.enlargeOffset(e,this.codemirror.start),this.codemirror.end=this.codemirror.enlargeOffset(e,this.codemirror.end),e=e.substr(0,this.codemirror.start)+this.marker.html(1)+e.substr(this.codemirror.start),this.codemirror.end>this.codemirror.start){var o=this.marker.html(1).toString().length;e=e.substr(0,this.codemirror.end+o)+this.marker.html(2)+e.substr(this.codemirror.end+o)}return e},hide:function(){var t;this.codemirror.$textarea.removeClass("open").next(".CodeMirror").hide(),this.codemirror.$textarea.next(".CodeMirror").off(".redactor-codemirror"),t=this.codemirror.setCaretOnHide(t),t=this.paragraphize.load(t),this.code.start(t),this.button.enableAll(),this.core.editor().show().focus(),this.selection.restore(),this.core.callback("visual")},show:function(){this.selection.save(),this.codemirror.setCaretOnShow();var t=this.core.editor().innerHeight(),e=this.code.get();e=this.core.callback("source",e),this.core.editor().hide(),this.button.disableAll("html"),this.marker.remove(),this.codemirror.$textarea.val(e).height(t).addClass("open"),this.codemirror.$textarea.next(".CodeMirror").on("keyup.redactor-codemirror",$.proxy(function(){"textarea"===this.opts.type&&this.codemirror.$textarea.next(".CodeMirror").each($.proxy(function(t,e){this.core.textarea().val(e.CodeMirror.getValue())},this))},this));var i=this;this.codemirror.$textarea.next(".CodeMirror").each(function(r,o){$(o).show(),o.CodeMirror.setValue(e),o.CodeMirror.setSize("100%",t),o.CodeMirror.refresh(),i.codemirror.start===i.codemirror.end?o.CodeMirror.setCursor(o.CodeMirror.posFromIndex(i.codemirror.start).line,o.CodeMirror.posFromIndex(i.codemirror.end).ch):o.CodeMirror.setSelection({line:o.CodeMirror.posFromIndex(i.codemirror.start).line,ch:o.CodeMirror.posFromIndex(i.codemirror.start).ch},{line:o.CodeMirror.posFromIndex(i.codemirror.end).line,ch:o.CodeMirror.posFromIndex(i.codemirror.end).ch}),o.CodeMirror.focus()})},enlargeOffset:function(t,e){var i=t.length,r=0;if(">"===t[e])r++;else for(var o=e;o<=i&&(r++,">"!==t[o]);o++)if("<"===t[o]||o===i){r=0;break}return e+r}}}}(jQuery);