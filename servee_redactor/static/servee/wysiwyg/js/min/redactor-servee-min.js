function load_wysiwyg(e){e.find("textarea:not(.no_wysiwyg)").redactor({focus:!0,replaceDivs:!1,toolbarFixed:!0,buttonSource:!0,imageUpload:"/servee_image/upload/",imageManagerJson:"/servee_image/recent/",fileUpload:"/servee_document/upload/",fileManagerJson:"/servee_document/recent/",plugins:["imagemanager","filemanager","table","video"],codemirror:!0,buttons:["formatting","bold","italic",,"link","unorderedlist","orderedlist","outdent","indent","image","file","video","table","horizontalrule","html"],initCallback:function(){"function"==typeof $.fn.matchHeight&&$.fn.matchHeight._update()},changeCallback:function(){"function"==typeof $.fn.matchHeight&&$.fn.matchHeight._update()}});var t=CodeMirror.fromTextArea($("#redactor")[0],{lineNumbers:!0,mode:"text/html",matchBrackets:!0})}if(function($){"use strict";function e(t,i){return new e.prototype.init(t,i)}Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;return function(){return t.apply(e)}});var t=0;$.fn.redactor=function(t){var i=[],r=Array.prototype.slice.call(arguments,1);return this.each("string"==typeof t?function(){var e=$.data(this,"redactor"),n;if("-1"!=t.search(/\./)?(n=t.split("."),"undefined"!=typeof e[n[0]]&&(n=e[n[0]][n[1]])):n=e[t],"undefined"!=typeof e&&$.isFunction(n)){var o=n.apply(e,r);void 0!==o&&o!==e&&i.push(o)}else $.error('No such method "'+t+'" for Redactor')}:function(){$.data(this,"redactor",{}),$.data(this,"redactor",e(this,t))}),0===i.length?this:1===i.length?i[0]:i},$.Redactor=e,$.Redactor.VERSION="10.1.1",$.Redactor.modules=["alignment","autosave","block","buffer","build","button","caret","clean","code","core","dropdown","file","focus","image","indent","inline","insert","keydown","keyup","lang","line","link","list","modal","observe","paragraphize","paste","placeholder","progress","selection","shortcuts","tabifier","tidy","toolbar","upload","utils","linkify"],$.Redactor.opts={lang:"en",direction:"ltr",plugins:!1,focus:!1,focusEnd:!1,placeholder:!1,visual:!0,tabindex:!1,minHeight:!1,maxHeight:!1,linebreaks:!1,replaceDivs:!0,paragraphize:!0,cleanStyleOnEnter:!1,enterKey:!0,cleanOnPaste:!0,cleanSpaces:!0,pastePlainText:!1,autosave:!1,autosaveName:!1,autosaveInterval:60,autosaveOnChange:!1,autosaveFields:!1,linkTooltip:!0,linkProtocol:"http",linkNofollow:!1,linkSize:50,imageEditable:!0,imageLink:!0,imagePosition:!0,imageFloatMargin:"10px",imageResizable:!0,imageUpload:null,imageUploadParam:"file",uploadImageField:!1,dragImageUpload:!0,fileUpload:null,fileUploadParam:"file",dragFileUpload:!0,s3:!1,convertLinks:!0,convertUrlLinks:!0,convertImageLinks:!0,convertVideoLinks:!0,preSpaces:4,tabAsSpaces:!1,tabKey:!0,scrollTarget:!1,toolbar:!0,toolbarFixed:!0,toolbarFixedTarget:document,toolbarFixedTopOffset:0,toolbarExternal:!1,toolbarOverflow:!1,source:!0,buttons:["html","formatting","bold","italic","deleted","unorderedlist","orderedlist","outdent","indent","image","file","link","alignment","horizontalrule"],buttonsHide:[],buttonsHideOnMobile:[],formatting:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],formattingAdd:!1,tabifier:!0,deniedTags:["script","style"],allowedTags:!1,paragraphizeBlocks:["table","div","pre","form","ul","ol","h1","h2","h3","h4","h5","h6","dl","blockquote","figcaption","address","section","header","footer","aside","article","object","style","script","iframe","select","input","textarea","button","option","map","area","math","hr","fieldset","legend","hgroup","nav","figure","details","menu","summary","p"],removeComments:!1,replaceTags:[["strike","del"]],replaceStyles:[["font-weight:\\s?bold","strong"],["font-style:\\s?italic","em"],["text-decoration:\\s?underline","u"],["text-decoration:\\s?line-through","del"]],removeDataAttr:!1,removeAttr:!1,allowedAttr:!1,removeWithoutAttr:["span"],removeEmpty:["p"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist","alignleft","aligncenter","alignright","justify"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},shortcuts:{"ctrl+shift+m, meta+shift+m":{func:"inline.removeFormat"},"ctrl+b, meta+b":{func:"inline.format",params:["bold"]},"ctrl+i, meta+i":{func:"inline.format",params:["italic"]},"ctrl+h, meta+h":{func:"inline.format",params:["superscript"]},"ctrl+l, meta+l":{func:"inline.format",params:["subscript"]},"ctrl+k, meta+k":{func:"link.show"},"ctrl+shift+7":{func:"list.toggle",params:["orderedlist"]},"ctrl+shift+8":{func:"list.toggle",params:["unorderedlist"]}},shortcutsAdd:!1,buffer:[],rebuffer:[],emptyHtml:"<p>&#x200b;</p>",invisibleSpace:"&#x200b;",imageTypes:["image/png","image/jpeg","image/gif"],indentValue:20,verifiedTags:["a","img","b","strong","sub","sup","i","em","u","small","strike","del","cite","ul","ol","li"],inlineTags:["strong","b","u","em","i","code","del","ins","samp","kbd","sup","sub","mark","var","cite","small"],alignmentTags:["P","H1","H2","H3","H4","H5","H6","DL","DT","DD","DIV","TD","BLOCKQUOTE","OUTPUT","FIGCAPTION","ADDRESS","SECTION","HEADER","FOOTER","ASIDE","ARTICLE"],blockLevelElements:["PRE","UL","OL","LI"],langs:{en:{html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",link_edit:"Edit link",unlink:"Unlink",formatting:"Formatting",paragraph:"Normal text",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",header5:"Header 5",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",center:"Center",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code or Youtube/Vimeo Link",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment",filename:"Name (optional)",edit:"Edit",upload_label:"Drop file here or "}},linkify:{regexps:{youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,image:/((https?|www)[^\s]+\.)(jpe?g|png|gif)(\?[^\s-]+)?/gi,url:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi}},codemirror:!1},e.fn=$.Redactor.prototype={keyCode:{BACKSPACE:8,DELETE:46,DOWN:40,ENTER:13,SPACE:32,ESC:27,TAB:9,CTRL:17,META:91,SHIFT:16,ALT:18,RIGHT:39,LEFT:37,LEFT_WIN:91},init:function(e,i){if(this.$element=$(e),this.uuid=t++,this.rtePaste=!1,this.$pasteBox=!1,this.loadOptions(i),this.loadModules(),this.formatting={},$.merge(this.opts.blockLevelElements,this.opts.alignmentTags),this.reIsBlock=new RegExp("^("+this.opts.blockLevelElements.join("|")+")$","i"),this.tidy.setupAllowed(),this.opts.deniedTags!==!1)for(var r=["html","head","link","body","meta","applet"],n=0;n<r.length;n++)this.opts.deniedTags.push(r[n]);this.lang.load(),$.extend(this.opts.shortcuts,this.opts.shortcutsAdd),this.core.setCallback("start"),this.start=!0,this.build.run()},loadOptions:function(e){this.opts=$.extend({},$.extend(!0,{},$.Redactor.opts),this.$element.data(),e)},getModuleMethods:function(e){return Object.getOwnPropertyNames(e).filter(function(t){return"function"==typeof e[t]})},loadModules:function(){for(var e=$.Redactor.modules.length,t=0;e>t;t++)this.bindModuleMethods($.Redactor.modules[t])},bindModuleMethods:function(e){if("undefined"!=typeof this[e]){this[e]=this[e]();for(var t=this.getModuleMethods(this[e]),i=t.length,r=0;i>r;r++)this[e][t[r]]=this[e][t[r]].bind(this)}},alignment:function(){return{left:function(){this.alignment.set("")},right:function(){this.alignment.set("right")},center:function(){this.alignment.set("center")},justify:function(){this.alignment.set("justify")},set:function(e){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save(),this.alignment.blocks=this.selection.getBlocks(),this.alignment.type=e,this.alignment.isLinebreaksOrNoBlocks()?this.alignment.setText():this.alignment.setBlocks(),this.selection.restore(),this.code.sync()},setText:function(){var e=this.selection.wrap("div");$(e).attr("data-tagblock","redactor").css("text-align",this.alignment.type)},setBlocks:function(){$.each(this.alignment.blocks,$.proxy(function(e,t){var i=this.utils.getAlignmentElement(t);i&&(this.alignment.isNeedReplaceElement(i)?this.alignment.replaceElement(i):this.alignment.alignElement(i))},this))},isLinebreaksOrNoBlocks:function(){return this.opts.linebreaks&&this.alignment.blocks[0]===!1},isNeedReplaceElement:function(e){return""===this.alignment.type&&"undefined"!=typeof e.data("tagblock")},replaceElement:function(e){e.replaceWith(e.html())},alignElement:function(e){e.css("text-align",this.alignment.type),this.utils.removeEmptyAttr(e,"style")}}},autosave:function(){return{html:!1,enable:function(){this.opts.autosave&&(this.autosave.name=this.opts.autosaveName?this.opts.autosaveName:this.$textarea.attr("name"),this.opts.autosaveOnChange||(this.autosaveInterval=setInterval(this.autosave.load,1e3*this.opts.autosaveInterval)))},onChange:function(){this.opts.autosaveOnChange&&this.autosave.load()},load:function(){if(this.autosave.source=this.code.get(),this.autosave.html!==this.autosave.source){var e={};e.name=this.autosave.name,e[this.autosave.name]=this.autosave.source,e=this.autosave.getHiddenFields(e);var t=$.ajax({url:this.opts.autosave,type:"post",data:e});t.done(this.autosave.success)}},getHiddenFields:function(e){return this.opts.autosaveFields===!1||"object"!=typeof this.opts.autosaveFields?e:($.each(this.opts.autosaveFields,$.proxy(function(t,i){null!==i&&0===i.toString().indexOf("#")&&(i=$(i).val()),e[t]=i},this)),e)},success:function(e){var t;try{t=$.parseJSON(e)}catch(i){t=e}var r="undefined"==typeof t.error?"autosave":"autosaveError";this.core.setCallback(r,this.autosave.name,t),this.autosave.html=this.autosave.source},disable:function(){clearInterval(this.autosaveInterval)}}},block:function(){return{formatting:function(e){this.block.clearStyle=!1;var t,i;"undefined"!=typeof this.formatting[e].data?t="data":"undefined"!=typeof this.formatting[e].attr?t="attr":"undefined"!=typeof this.formatting[e]["class"]&&(t="class"),"undefined"!=typeof this.formatting[e].clear&&(this.block.clearStyle=!0),t&&(i=this.formatting[e][t]),this.block.format(this.formatting[e].tag,t,i)},format:function(e,t,i){"quote"==e&&(e="blockquote");var r=["p","pre","blockquote","h1","h2","h3","h4","h5","h6"];-1!=$.inArray(e,r)&&(this.block.isRemoveInline="pre"==e||-1!=e.search(/h[1-6]/i),this.utils.browser("msie")||this.$editor.focus(),this.block.blocks=this.selection.getBlocks(),this.block.blocksSize=this.block.blocks.length,this.block.type=t,this.block.value=i,this.buffer.set(),this.selection.save(),this.block.set(e),this.selection.restore(),this.code.sync())},set:function(e){this.selection.get(),this.block.containerTag=this.range.commonAncestorContainer.tagName,this.range.collapsed?this.block.setCollapsed(e):this.block.setMultiple(e)},setCollapsed:function(e){var t=this.block.blocks[0];if(t!==!1){if("LI"==t.tagName){if("blockquote"!=e)return;return void this.block.formatListToBlockquote()}var i="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(i&&!this.opts.linebreaks)document.execCommand("formatblock",!1,"<"+e+">"),t=this.selection.getBlock(),this.block.toggle($(t));else if(t.tagName.toLowerCase()!=e)if(this.opts.linebreaks&&"p"==e)$(t).prepend("<br>").append("<br>"),this.utils.replaceWithContents(t);else{var r=this.utils.replaceToTag(t,e);this.block.toggle(r),"p"!=e&&"blockquote"!=e&&r.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(r),("p"==e||this.block.headTag)&&r.find("p").contents().unwrap(),this.block.formatTableWrapping(r)}else if("blockquote"==e&&t.tagName.toLowerCase()==e)if(this.opts.linebreaks)$(t).prepend("<br>").append("<br>"),this.utils.replaceWithContents(t);else{var n=this.utils.replaceToTag(t,"p");this.block.toggle(n)}else t.tagName.toLowerCase()==e&&this.block.toggle($(t));"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&$(t).removeAttr("class").removeAttr("style")}},setMultiple:function(e){var t=this.block.blocks[0],i="TD"==this.block.containerTag||"TH"==this.block.containerTag;if(t!==!1&&1===this.block.blocksSize)if(t.tagName.toLowerCase()==e&&"blockquote"==e)if(this.opts.linebreaks)$(t).prepend("<br>").append("<br>"),this.utils.replaceWithContents(t);else{var r=this.utils.replaceToTag(t,"p");this.block.toggle(r)}else if("LI"==t.tagName){if("blockquote"!=e)return;this.block.formatListToBlockquote()}else if("BLOCKQUOTE"==this.block.containerTag)this.block.formatBlockquote(e);else if(this.opts.linebreaks&&(i||this.range.commonAncestorContainer!=t))this.block.formatWrap(e);else if(this.opts.linebreaks&&"p"==e)$(t).prepend("<br>").append("<br>"),this.utils.replaceWithContents(t);else if("TD"===t.tagName)this.block.formatWrap(e);else{var n=this.utils.replaceToTag(t,e);this.block.toggle(n),this.block.isRemoveInline&&this.utils.removeInlineTags(n),("p"==e||this.block.headTag)&&n.find("p").contents().unwrap()}else if(this.opts.linebreaks||"p"!=e){if("blockquote"==e){for(var o=0,s=0;s<this.block.blocksSize;s++)"BLOCKQUOTE"==this.block.blocks[s].tagName&&o++;if(o==this.block.blocksSize)return void $.each(this.block.blocks,$.proxy(function(e,t){var i=!1;this.opts.linebreaks?($(t).prepend("<br>").append("<br>"),i=this.utils.replaceWithContents(t)):i=this.utils.replaceToTag(t,"p"),i&&"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&i.removeAttr("class").removeAttr("style")},this))}this.block.formatWrap(e)}else{var a=0,l=!1;"class"==this.block.type&&(l="toggle",a=$(this.block.blocks).filter("."+this.block.value).length,this.block.blocksSize==a?l="toggle":this.block.blocksSize>a?l="set":0===a&&(l="set"));var c=["ul","ol","li","td","th","dl","dt","dd"];$.each(this.block.blocks,$.proxy(function(t,i){if(-1==$.inArray(i.tagName.toLowerCase(),c)){var r=this.utils.replaceToTag(i,e);l?"toggle"==l?this.block.toggle(r):"remove"==l?this.block.remove(r):"set"==l&&this.block.setForce(r):this.block.toggle(r),"p"!=e&&"blockquote"!=e&&r.find("img").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(r),("p"==e||this.block.headTag)&&r.find("p").contents().unwrap(),"undefined"==typeof this.block.type&&"undefined"==typeof this.block.value&&r.removeAttr("class").removeAttr("style")}},this))}},setForce:function(e){return this.block.clearStyle&&e.removeAttr("class").removeAttr("style"),"class"==this.block.type?void e.addClass(this.block.value):"attr"==this.block.type||"data"==this.block.type?void e.attr(this.block.value.name,this.block.value.value):void 0},toggle:function(e){return this.block.clearStyle&&e.removeAttr("class").removeAttr("style"),"class"==this.block.type?void e.toggleClass(this.block.value):"attr"==this.block.type||"data"==this.block.type?void(e.attr(this.block.value.name)==this.block.value.value?e.removeAttr(this.block.value.name):e.attr(this.block.value.name,this.block.value.value)):void e.removeAttr("style class")},remove:function(e){e.removeClass(this.block.value)},formatListToBlockquote:function(){var e=$(this.block.blocks[0]).closest("ul, ol",this.$editor[0]);$(e).find("ul, ol").contents().unwrap(),$(e).find("li").append($("<br>")).contents().unwrap();var t=this.utils.replaceToTag(e,"blockquote");this.block.toggle(t)},formatBlockquote:function(e){document.execCommand("outdent"),document.execCommand("formatblock",!1,e),this.clean.clearUnverified(),this.$editor.find("p:empty").remove();var t=this.selection.getBlock();"p"!=e&&$(t).find("img").remove(),this.opts.linebreaks||this.block.toggle($(t)),this.$editor.find("ul, ol, tr, blockquote, p").each($.proxy(this.utils.removeEmpty,this)),this.opts.linebreaks&&"p"==e&&this.utils.replaceWithContents(t)},formatWrap:function(e){if("UL"==this.block.containerTag||"OL"==this.block.containerTag){if("blockquote"!=e)return;this.block.formatListToBlockquote()}var t=this.selection.wrap(e);if(t!==!1){var i=$(t);this.block.formatTableWrapping(i);var r=i.find(this.opts.blockLevelElements.join(",")+", td, table, thead, tbody, tfoot, th, tr");(this.opts.linebreaks&&"p"==e||"pre"==e||"blockquote"==e)&&r.append("<br />"),r.contents().unwrap(),"p"!=e&&"blockquote"!=e&&i.find("img").remove(),$.each(this.block.blocks,$.proxy(this.utils.removeEmpty,this)),i.append(this.selection.getMarker(2)),this.opts.linebreaks||this.block.toggle(i),this.$editor.find("ul, ol, tr, blockquote, p").each($.proxy(this.utils.removeEmpty,this)),i.find("blockquote:empty").remove(),this.block.isRemoveInline&&this.utils.removeInlineTags(i),this.opts.linebreaks&&"p"==e&&this.utils.replaceWithContents(i)}},formatTableWrapping:function(e){0!==e.closest("table",this.$editor[0]).length&&(0===e.closest("tr",this.$editor[0]).length&&e.wrap("<tr>"),0===e.closest("td",this.$editor[0]).length&&0===e.closest("th").length&&e.wrap("<td>"))},removeData:function(e,t){var i=this.selection.getBlocks();$(i).removeAttr("data-"+e),this.code.sync()},setData:function(e,t){var i=this.selection.getBlocks();$(i).attr("data-"+e,t),this.code.sync()},toggleData:function(e,t){var i=this.selection.getBlocks();$.each(i,function(){$(this).attr("data-"+e)?$(this).removeAttr("data-"+e):$(this).attr("data-"+e,t)})},removeAttr:function(e,t){var i=this.selection.getBlocks();$(i).removeAttr(e),this.code.sync()},setAttr:function(e,t){var i=this.selection.getBlocks();$(i).attr(e,t),this.code.sync()},toggleAttr:function(e,t){var i=this.selection.getBlocks();$.each(i,function(){$(this).attr(name)?$(this).removeAttr(name):$(this).attr(name,t)})},removeClass:function(e){var t=this.selection.getBlocks();$(t).removeClass(e),this.utils.removeEmptyAttr(t,"class"),this.code.sync()},setClass:function(e){var t=this.selection.getBlocks();$(t).addClass(e),this.code.sync()},toggleClass:function(e){var t=this.selection.getBlocks();$(t).toggleClass(e),this.code.sync()}}},buffer:function(){return{set:function(e){"undefined"==typeof e||"undo"==e?this.buffer.setUndo():this.buffer.setRedo()},setUndo:function(){this.selection.save(),this.opts.buffer.push(this.$editor.html()),this.selection.restore()},setRedo:function(){this.selection.save(),this.opts.rebuffer.push(this.$editor.html()),this.selection.restore()},getUndo:function(){this.$editor.html(this.opts.buffer.pop())},getRedo:function(){this.$editor.html(this.opts.rebuffer.pop())},add:function(){this.opts.buffer.push(this.$editor.html())},undo:function(){0!==this.opts.buffer.length&&(this.buffer.set("redo"),this.buffer.getUndo(),this.selection.restore(),setTimeout($.proxy(this.observe.load,this),50))},redo:function(){0!==this.opts.rebuffer.length&&(this.buffer.set("undo"),this.buffer.getRedo(),this.selection.restore(),setTimeout($.proxy(this.observe.load,this),50))}}},build:function(){return{run:function(){this.build.createContainerBox(),this.build.loadContent(),this.build.loadEditor(),this.build.enableEditor(),this.build.setCodeAndCall()},isTextarea:function(){return"TEXTAREA"===this.$element[0].tagName},createContainerBox:function(){this.$box=$('<div class="redactor-box" />')},createTextarea:function(){this.$textarea=$("<textarea />").attr("name",this.build.getTextareaName())},getTextareaName:function(){return"undefined"==typeof name?"content-"+this.uuid:this.$element.attr("id")},loadContent:function(){var e=this.build.isTextarea()?"val":"html";this.content=$.trim(this.$element[e]())},enableEditor:function(){this.$editor.attr({contenteditable:!0,dir:this.opts.direction})},loadEditor:function(){var e=this.build.isTextarea()?"fromTextarea":"fromElement";this.build[e]()},fromTextarea:function(){this.$editor=$("<div />"),this.$textarea=this.$element,this.$box.insertAfter(this.$element).append(this.$editor).append(this.$element),this.$editor.addClass("redactor-editor"),this.$element.hide()},fromElement:function(){this.$editor=this.$element,this.build.createTextarea(),this.$box.insertAfter(this.$editor).append(this.$editor).append(this.$textarea),this.$editor.addClass("redactor-editor"),this.$textarea.hide()},setCodeAndCall:function(){this.code.set(this.content),this.build.setOptions(),this.build.callEditor(),this.opts.visual||setTimeout($.proxy(this.code.showCode,this),200)},callEditor:function(){this.build.disableMozillaEditing(),this.build.setEvents(),this.build.setHelpers(),this.opts.toolbar&&(this.opts.toolbar=this.toolbar.init(),this.toolbar.build()),this.modal.loadTemplates(),this.build.plugins(),setTimeout($.proxy(this.observe.load,this),4),this.core.setCallback("init")},setOptions:function(){$(this.$textarea).attr("dir",this.opts.direction),this.opts.linebreaks&&this.$editor.addClass("redactor-linebreaks"),this.opts.tabindex&&this.$editor.attr("tabindex",this.opts.tabindex),this.opts.minHeight&&this.$editor.css("minHeight",this.opts.minHeight),this.opts.maxHeight&&this.$editor.css("maxHeight",this.opts.maxHeight)},setEventDropUpload:function(e){if(e.preventDefault(),this.opts.dragImageUpload&&this.opts.dragFileUpload){var t=e.dataTransfer.files;this.upload.directUpload(t[0],e)}},setEventDrop:function(e){this.code.sync(),setTimeout(this.clean.clearUnverified,1),this.core.setCallback("drop",e)},setEvents:function(){this.$editor.on("drop.redactor",$.proxy(function(e){return e=e.originalEvent||e,void 0!==window.FormData&&e.dataTransfer?0===e.dataTransfer.files.length?this.build.setEventDrop(e):(this.build.setEventDropUpload(e),setTimeout(this.clean.clearUnverified,1),void this.core.setCallback("drop",e)):!0},this)),this.$editor.on("click.redactor",$.proxy(function(e){var t=this.core.getEvent(),i="click"==t||"arrow"==t?!1:"click";this.core.addEvent(i),this.utils.disableSelectAll(),this.core.setCallback("click",e)},this)),this.$editor.on("paste.redactor",$.proxy(this.paste.init,this)),this.$editor.on("cut.redactor",$.proxy(this.code.sync,this)),this.$editor.on("keydown.redactor",$.proxy(this.keydown.init,this)),this.$editor.on("keyup.redactor",$.proxy(this.keyup.init,this)),$.isFunction(this.opts.codeKeydownCallback)&&this.$textarea.on("keydown.redactor-textarea",$.proxy(this.opts.codeKeydownCallback,this)),$.isFunction(this.opts.codeKeyupCallback)&&this.$textarea.on("keyup.redactor-textarea",$.proxy(this.opts.codeKeyupCallback,this)),$.isFunction(this.opts.focusCallback)&&this.$editor.on("focus.redactor",$.proxy(this.opts.focusCallback,this));var e;$(document).on("mousedown",function(t){e=t.target}),this.$editor.on("blur.redactor",$.proxy(function(t){this.rtePaste||this.build.isBlured(e)&&(this.utils.disableSelectAll(),$.isFunction(this.opts.blurCallback)&&this.core.setCallback("blur",t))},this))},isBlured:function(e){var t=$(e);return!t.hasClass("redactor-toolbar, redactor-dropdown")&&!t.is("#redactor-modal")&&0===t.parents(".redactor-toolbar, .redactor-dropdown, #redactor-modal").length},setHelpers:function(){this.linkify.isEnabled()&&this.linkify.format(),this.placeholder.enable(),this.opts.focus&&setTimeout(this.focus.setStart,100),this.opts.focusEnd&&setTimeout(this.focus.setEnd,100)},plugins:function(){this.opts.plugins&&RedactorPlugins&&$.each(this.opts.plugins,$.proxy(function(e,t){if("undefined"!=typeof RedactorPlugins[t]){if(-1!==$.inArray(t,$.Redactor.modules))return void $.error('Plugin name "'+t+"\" matches the name of the Redactor's module.");if($.isFunction(RedactorPlugins[t])){this[t]=RedactorPlugins[t]();for(var i=this.getModuleMethods(this[t]),r=i.length,n=0;r>n;n++)this[t][i[n]]=this[t][i[n]].bind(this);$.isFunction(this[t].init)&&this[t].init()}}},this))},disableMozillaEditing:function(){if(this.utils.browser("mozilla"))try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("enableInlineTableEditing",!1,!1)}catch(e){}}}},button:function(){return{build:function(e,t){var i=$('<a href="#" class="re-icon re-'+e+'" rel="'+e+'" />').attr("tabindex","-1");if((t.func||t.command||t.dropdown)&&this.button.setEvent(i,e,t),t.dropdown){var r=$('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+e+'" style="display: none;">');i.data("dropdown",r),this.dropdown.build(e,r,t.dropdown)}return this.utils.isDesktop()&&this.button.createTooltip(i,e,t.title),i},setEvent:function(e,t,i){e.on("touchstart click",$.proxy(function(r){if(e.hasClass("redactor-button-disabled"))return!1;var n="func",o=i.func;i.command?(n="command",o=i.command):i.dropdown&&(n="dropdown",o=!1),this.button.onClick(r,t,n,o)},this))},createTooltip:function(e,t,i){var r=$("<span>").addClass("redactor-toolbar-tooltip redactor-toolbar-tooltip-"+t).hide().html(i);r.appendTo("body"),e.on("mouseover",function(){if(!$(this).hasClass("redactor-button-disabled")){var t=e.offset();r.show(),r.css({top:t.top+e.innerHeight()+"px",left:t.left+e.innerWidth()/2-r.innerWidth()/2+"px"})}}),e.on("mouseout",function(){r.hide()})},onClick:function(e,t,i,r){this.button.caretOffset=this.caret.getOffset(),e.preventDefault(),this.utils.browser("msie")&&(e.returnValue=!1),"command"==i?this.inline.format(r):"dropdown"==i?this.dropdown.show(e,t):this.button.onClickCallback(e,r,t)},onClickCallback:function(e,t,i){var r;if($.isFunction(t))t.call(this,i);else if("-1"!=t.search(/\./)){if(r=t.split("."),"undefined"==typeof this[r[0]])return;this[r[0]][r[1]](i)}else this[t](i);this.observe.buttons(e,i)},get:function(e){return this.$toolbar.find("a.re-"+e)},setActive:function(e){this.button.get(e).addClass("redactor-act")},setInactive:function(e){this.button.get(e).removeClass("redactor-act")},setInactiveAll:function(e){"undefined"==typeof e?this.$toolbar.find("a.re-icon").removeClass("redactor-act"):this.$toolbar.find("a.re-icon").not(".re-"+e).removeClass("redactor-act")},setActiveInVisual:function(){this.$toolbar.find("a.re-icon").not("a.re-html").removeClass("redactor-button-disabled")},setInactiveInCode:function(){this.$toolbar.find("a.re-icon").not("a.re-html").addClass("redactor-button-disabled")},changeIcon:function(e,t){this.button.get(e).addClass("re-"+t)},removeIcon:function(e,t){this.button.get(e).removeClass("re-"+t)},setAwesome:function(e,t){var i=this.button.get(e);i.removeClass("redactor-btn-image").addClass("fa-redactor-btn"),i.html('<i class="fa '+t+'"></i>')},addCallback:function(e,t){var i="dropdown"==t?"dropdown":"func",r=e.attr("rel");e.on("touchstart click",$.proxy(function(n){return e.hasClass("redactor-button-disabled")?!1:void this.button.onClick(n,r,i,t)},this))},addDropdown:function(e,t){var i=e.attr("rel");this.button.addCallback(e,"dropdown");var r=$('<div class="redactor-dropdown redactor-dropdown-'+this.uuid+" redactor-dropdown-box-"+i+'" style="display: none;">');return e.data("dropdown",r),t&&this.dropdown.build(i,r,t),r},add:function(e,t){if(this.opts.toolbar){var i=this.button.build(e,{title:t});return i.addClass("redactor-btn-image"),this.$toolbar.append($("<li>").append(i)),i}},addFirst:function(e,t){if(this.opts.toolbar){var i=this.button.build(e,{title:t});return i.addClass("redactor-btn-image"),this.$toolbar.prepend($("<li>").append(i)),i}},addAfter:function(e,t,i){if(this.opts.toolbar){var r=this.button.build(t,{title:i});r.addClass("redactor-btn-image");var n=this.button.get(e);return 0!==n.length?n.parent().after($("<li>").append(r)):this.$toolbar.append($("<li>").append(r)),r}},addBefore:function(e,t,i){if(this.opts.toolbar){var r=this.button.build(t,{title:i});r.addClass("redactor-btn-image");var n=this.button.get(e);return 0!==n.length?n.parent().before($("<li>").append(r)):this.$toolbar.append($("<li>").append(r)),r}},remove:function(e){this.button.get(e).remove()}}},caret:function(){return{setStart:function(e){if(this.utils.isBlock(e))this.caret.set(e,0,e,0);else{var t=this.utils.createSpaceElement();$(e).prepend(t),this.caret.setEnd(t)}},setEnd:function(e){this.caret.set(e,1,e,1)},set:function(e,t,i,r){if(e=e[0]||e,i=i[0]||i,this.utils.isBlockTag(e.tagName)&&""===e.innerHTML&&(e.innerHTML=this.opts.invisibleSpace),"BR"==e.tagName&&this.opts.linebreaks===!1){var n=$(this.opts.emptyHtml)[0];$(e).replaceWith(n),e=n,i=e}this.selection.get();try{this.range.setStart(e,t),this.range.setEnd(i,r)}catch(o){}this.selection.addRange()},setAfter:function(e){try{var t=$(e)[0].tagName;if("BR"==t||this.utils.isBlock(e))"BR"!=t&&this.utils.browser("msie")?this.caret.setStart($(e).next()):this.caret.setAfterOrBefore(e,"after");else{var i=this.utils.createSpaceElement();$(e).after(i),this.caret.setEnd(i)}}catch(r){var i=this.utils.createSpaceElement();$(e).after(i),this.caret.setEnd(i)}},setBefore:function(e){this.utils.isBlock(e)?this.caret.setEnd($(e).prev()):this.caret.setAfterOrBefore(e,"before")},setAfterOrBefore:function(e,t){if(this.utils.browser("msie")||this.$editor.focus(),e=e[0]||e,this.selection.get(),"after"==t)try{this.range.setStartAfter(e),this.range.setEndAfter(e)}catch(i){}else try{this.range.setStartBefore(e),this.range.setEndBefore(e)}catch(i){}this.range.collapse(!1),this.selection.addRange()},getOffsetOfElement:function(e){e=e[0]||e,this.selection.get();var t=this.range.cloneRange();return t.selectNodeContents(e),t.setEnd(this.range.endContainer,this.range.endOffset),$.trim(t.toString()).length},getOffset:function(){var e=0,t=window.getSelection();if(t.rangeCount>0){var i=window.getSelection().getRangeAt(0),r=i.cloneRange();r.selectNodeContents(this.$editor[0]),r.setEnd(i.endContainer,i.endOffset),e=r.toString().length}return e},setOffset:function(e,t){"undefined"==typeof t&&(t=e),this.focus.isFocused()||this.focus.setStart();for(var i=this.selection.get(),r,n=0,o=document.createTreeWalker(this.$editor[0],NodeFilter.SHOW_TEXT,null,null);r=o.nextNode();)if(n+=r.nodeValue.length,n>e&&(this.range.setStart(r,r.nodeValue.length+e-n),e=1/0),n>=t){this.range.setEnd(r,r.nodeValue.length+t-n);break}this.range.collapse(!1),this.selection.addRange()},setToPoint:function(e,t){this.caret.setOffset(e,t)},getCoords:function(){return this.caret.getOffset()}}},clean:function(){return{onSet:function(e){e=this.clean.savePreCode(e),e=e.replace(/<script(.*?[^>]?)>([\w\W]*?)<\/script>/gi,'<pre class="redactor-script-tag" style="display: none;" $1>$2</pre>'),e=e.replace(/\$/g,"&#36;"),e=e.replace(/<a href="(.*?[^>]?)®(.*?[^>]?)">/gi,'<a href="$1&reg$2">'),this.opts.replaceDivs&&(e=this.clean.replaceDivs(e)),this.opts.linebreaks&&(e=this.clean.replaceParagraphsToBr(e)),e=this.clean.saveFormTags(e);var t=$("<div>");t.html(e);var i=t.find("font[style]");return 0!==i.length&&(i.replaceWith(function(){var e=$(this),t=$("<span>").attr("style",e.attr("style"));return t.append(e.contents())}),e=t.html()),t.remove(),e=e.replace(/<font(.*?[^<])>/gi,""),e=e.replace(/<\/font>/gi,""),e=this.tidy.load(e),this.opts.paragraphize&&(e=this.paragraphize.load(e)),e=this.clean.setVerified(e),e=this.clean.convertInline(e)},onSync:function(e){if(e=e.replace(/[\u200B-\u200D\uFEFF]/g,""),e=e.replace(/&#x200b;/gi,""),this.opts.cleanSpaces&&(e=e.replace(/&nbsp;/gi," ")),-1!=e.search(/^<p>(||\s||<br\s?\/?>||&nbsp;)<\/p>$/i))return"";e=e.replace(/<pre class="redactor-script-tag" style="display: none;"(.*?[^>]?)>([\w\W]*?)<\/pre>/gi,"<script$1>$2</script>"),e=this.clean.restoreFormTags(e);var t={"™":"&trade;","©":"&copy;","…":"&hellip;","—":"&mdash;","‐":"&dash;"};return $.each(t,function(t,i){e=e.replace(new RegExp(t,"g"),i)}),e=e.replace(new RegExp("<br\\s?/?></li>","gi"),"</li>"),
e=e.replace(new RegExp("</li><br\\s?/?>","gi"),"</li>"),e=e.replace(/<div(.*?[^>]) data-tagblock="redactor"(.*?[^>])>/gi,"<div$1$2>"),e=e.replace(/<(.*?) data-verified="redactor"(.*?[^>])>/gi,"<$1$2>"),e=e.replace(/<span(.*?[^>])\srel="(.*?[^>])"(.*?[^>])>/gi,"<span$1$3>"),e=e.replace(/<img(.*?[^>])\srel="(.*?[^>])"(.*?[^>])>/gi,"<img$1$3>"),e=e.replace(/<img(.*?[^>])\sstyle="" (.*?[^>])>'/gi,"<img$1 $2>"),e=e.replace(/<img(.*?[^>])\sstyle (.*?[^>])>'/gi,"<img$1 $2>"),e=e.replace(/<span class="redactor-invisible-space">(.*?)<\/span>/gi,"$1"),e=e.replace(/ data-save-url="(.*?[^>])"/gi,""),e=e.replace(/<span(.*?)id="redactor-image-box"(.*?[^>])>([\w\W]*?)<img(.*?)><\/span>/gi,"$3<img$4>"),e=e.replace(/<span(.*?)id="redactor-image-resizer"(.*?[^>])>(.*?)<\/span>/gi,""),e=e.replace(/<span(.*?)id="redactor-image-editter"(.*?[^>])>(.*?)<\/span>/gi,""),e=e.replace(/<font(.*?[^<])>/gi,""),e=e.replace(/<\/font>/gi,""),e=this.tidy.load(e),this.opts.linkNofollow&&(e=e.replace(/<a(.*?)rel="nofollow"(.*?[^>])>/gi,"<a$1$2>"),e=e.replace(/<a(.*?[^>])>/gi,'<a$1 rel="nofollow">')),e=e.replace(/\sdata-redactor-(tag|class|style)="(.*?[^>])"/gi,""),e=e.replace(new RegExp('<(.*?) data-verified="redactor"(.*?[^>])>',"gi"),"<$1$2>"),e=e.replace(new RegExp('<(.*?) data-verified="redactor">',"gi"),"<$1>")},onPaste:function(e,t){if(e=$.trim(e),e=e.replace(/\$/g,"&#36;"),e=e.replace(/<span class="s1">/gi,"<span>"),e=e.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),e=e.replace(/<span class="Apple-tab-span"[^>]*>\t<\/span>/gi,"	"),e=e.replace(/<span[^>]*>(\s|&nbsp;)<\/span>/gi," "),this.opts.pastePlainText)return this.clean.getPlainText(e);if(!this.utils.isSelectAll()&&"undefined"==typeof t){if(this.utils.isCurrentOrParent(["FIGCAPTION","A"]))return this.clean.getPlainText(e,!1);if(this.utils.isCurrentOrParent("PRE"))return e=e.replace(/”/g,'"'),e=e.replace(/“/g,'"'),e=e.replace(/‘/g,"'"),e=e.replace(/’/g,"'"),this.clean.getPreCode(e);if(this.utils.isCurrentOrParent(["BLOCKQUOTE","H1","H2","H3","H4","H5","H6"])){if(e=this.clean.getOnlyImages(e),!this.utils.browser("msie")){var i=this.selection.getBlock();i&&"P"==i.tagName&&(e=e.replace(/<img(.*?)>/gi,"<p><img$1></p>"))}return e}if(this.utils.isCurrentOrParent(["TD"]))return e=this.clean.onPasteTidy(e,"td"),this.opts.linebreaks&&(e=this.clean.replaceParagraphsToBr(e)),e=this.clean.replaceDivsToBr(e);if(this.utils.isCurrentOrParent(["LI"]))return this.clean.onPasteTidy(e,"li")}return e=this.clean.isSingleLine(e,t),this.clean.singleLine||(this.opts.linebreaks&&(e=this.clean.replaceParagraphsToBr(e)),this.opts.replaceDivs&&(e=this.clean.replaceDivs(e)),e=this.clean.saveFormTags(e)),e=this.clean.onPasteWord(e),e=this.clean.onPasteExtra(e),e=this.clean.onPasteTidy(e,"all"),!this.clean.singleLine&&this.opts.paragraphize&&(e=this.paragraphize.load(e)),e=this.clean.removeDirtyStyles(e),e=this.clean.onPasteRemoveSpans(e),e=this.clean.onPasteRemoveEmpty(e),e=this.clean.convertInline(e)},onPasteWord:function(e){return e=e.replace(/<!--[\s\S]*?-->/gi,""),e=e.replace(/<style[^>]*>[\s\S]*?<\/style>/gi,""),/(class=\"?Mso|style=\"[^\"]*\bmso\-|w:WordDocument)/.test(e)&&(e=this.clean.onPasteIeFixLinks(e),e=e.replace(/<img(.*?)v:shapes=(.*?)>/gi,""),e=e.replace(/src="file\:\/\/(.*?)"/,'src=""'),e=e.replace(/<p(.*?)class="MsoListParagraphCxSpFirst"([\w\W]*?)<\/p>/gi,"<ul><li$2</li>"),e=e.replace(/<p(.*?)class="MsoListParagraphCxSpMiddle"([\w\W]*?)<\/p>/gi,"<li$2</li>"),e=e.replace(/<p(.*?)class="MsoListParagraphCxSpLast"([\w\W]*?)<\/p>/gi,"<li$2</li></ul>"),e=e.replace(/<p(.*?)class="MsoListParagraph"([\w\W]*?)<\/p>/gi,"<ul><li$2</li></ul>"),e=e.replace(/·/g,""),e=e.replace(/<p class="Mso(.*?)"/gi,"<p"),e=e.replace(/ class=\"(mso[^\"]*)\"/gi,""),e=e.replace(/ class=(mso\w+)/gi,""),e=e.replace(/<o:p(.*?)>([\w\W]*?)<\/o:p>/gi,"$2"),e=e.replace(/\n/g," "),e=e.replace(/<p>\n?<li>/gi,"<li>")),this.opts.cleanSpaces&&(e=e.replace(/(\s|&nbsp;)+/g," ")),e},onPasteExtra:function(e){return e=e.replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),e=e.replace(/<b(.*?)id="docs-internal-guid(.*?)">([\w\W]*?)<\/b>/gi,"$3"),e=e.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi,'<span style="font-weight: bold;"><span style="font-style: italic;">'),e=e.replace(/<span[^>]*font-style: italic[^>]*>/gi,'<span style="font-style: italic;">'),e=e.replace(/<span[^>]*font-weight: bold[^>]*>/gi,'<span style="font-weight: bold;">'),e=e.replace(/<span[^>]*text-decoration: underline[^>]*>/gi,'<span style="text-decoration: underline;">'),e=e.replace(/<img>/gi,""),e=e.replace(/\n{3,}/gi,"\n"),e=e.replace(/<font(.*?)>([\w\W]*?)<\/font>/gi,"$2"),e=e.replace(/<p><p>/gi,"<p>"),e=e.replace(/<\/p><\/p>/gi,"</p>"),e=e.replace(/<li>(\s*|\t*|\n*)<p>/gi,"<li>"),e=e.replace(/<\/p>(\s*|\t*|\n*)<\/li>/gi,"</li>"),e=e.replace(/<\/p>\s<p/gi,"</p><p"),e=e.replace(/<img src="webkit-fake-url\:\/\/(.*?)"(.*?)>/gi,""),e=e.replace(/<p>•([\w\W]*?)<\/p>/gi,"<li>$1</li>"),this.utils.browser("mozilla")&&(e=e.replace(/<br\s?\/?>$/gi,"")),e},onPasteTidy:function(e,t){var i=["span","a","pre","blockquote","small","em","strong","code","kbd","mark","address","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","p","br","video","audio","iframe","embed","param","object","img","table","td","th","tr","tbody","tfoot","thead","h1","h2","h3","h4","h5","h6"],r=!1,n=[["a","*"],["img",["src","alt"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]];"all"==t?(r=["p","span","h1","h2","h3","h4","h5","h6"],n=[["table","class"],["td",["colspan","rowspan"]],["a","*"],["img",["src","alt","data-redactor-inserted-image"]],["span",["class","rel","data-verified"]],["iframe","*"],["video","*"],["audio","*"],["embed","*"],["object","*"],["param","*"],["source","*"]]):"td"==t?i=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","ol","ul","li","dl","dt","dd","br","iframe","video","audio","embed","param","object","img","h1","h2","h3","h4","h5","h6"]:"li"==t&&(i=["ul","ol","li","span","a","small","em","strong","code","kbd","mark","cite","var","samp","dfn","sup","sub","b","i","u","del","br","iframe","video","audio","embed","param","object","img"]);var o={deniedTags:this.opts.deniedTags?this.opts.deniedTags:!1,allowedTags:this.opts.allowedTags?this.opts.allowedTags:i,removeComments:!0,removePhp:!0,removeAttr:this.opts.removeAttr?this.opts.removeAttr:!1,allowedAttr:this.opts.allowedAttr?this.opts.allowedAttr:n,removeEmpty:r};return this.tidy.load(e,o)},onPasteRemoveEmpty:function(e){return e=e.replace(/<(p|h[1-6])>(|\s|\n|\t|<br\s?\/?>)<\/(p|h[1-6])>/gi,""),this.opts.linebreaks||(e=e.replace(/<br>$/i,"")),e},onPasteRemoveSpans:function(e){return e=e.replace(/<span>(.*?)<\/span>/gi,"$1"),e=e.replace(/<span[^>]*>\s|&nbsp;<\/span>/gi," ")},onPasteIeFixLinks:function(e){if(!this.utils.browser("msie"))return e;var t=$.trim(e);return 0===t.search(/^<a(.*?)>(.*?)<\/a>$/i)&&(e=e.replace(/^<a(.*?)>(.*?)<\/a>$/i,"$2")),e},isSingleLine:function(e,t){if(this.clean.singleLine=!1,!this.utils.isSelectAll()&&"undefined"==typeof t){var i=this.opts.blockLevelElements.join("|").replace("P|","").replace("DIV|",""),r=e.match(new RegExp("</("+i+")>","gi")),n=e.match(/<\/(p|div)>/gi);if(!r&&(null===n||n&&n.length<=1)){var o=e.match(/<br\s?\/?>/gi),s=e.match(/<img(.*?[^>])>/gi);o||s||(this.clean.singleLine=!0,e=e.replace(/<\/?(p|div)(.*?)>/gi,""))}}return e},stripTags:function(e,t){t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var i=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;return e.replace(i,function(e,i){return t.indexOf("<"+i.toLowerCase()+">")>-1?e:""})},savePreCode:function(e){return e=this.clean.savePreFormatting(e),e=this.clean.saveCodeFormatting(e)},savePreFormatting:function(e){var t=e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==t&&$.each(t,$.proxy(function(t,i){var r=i.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);r[2]=r[2].replace(/<br\s?\/?>/g,"\n"),r[2]=r[2].replace(/&nbsp;/g," "),this.opts.preSpaces&&(r[2]=r[2].replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),r[2]=this.clean.encodeEntities(r[2]),r[2]=r[2].replace(/\$/g,"&#36;"),e=e.replace(i,"<pre"+r[1]+">"+r[2]+"</pre>")},this)),e},saveCodeFormatting:function(e){var t=e.match(/<code(.*?[^>])>(.*?)<\/code>/gi);return null!==t&&$.each(t,$.proxy(function(t,i){var r=i.match(/<code(.*?[^>])>(.*?)<\/code>/i);r[2]=r[2].replace(/&nbsp;/g," "),r[2]=this.clean.encodeEntities(r[2]),r[2]=r[2].replace(/\$/g,"&#36;"),e=e.replace(i,"<code"+r[1]+">"+r[2]+"</code>")},this)),e},getTextFromHtml:function(e){e=e.replace(/<br\s?\/?>|<\/H[1-6]>|<\/p>|<\/div>|<\/li>|<\/td>/gi,"\n");var t=document.createElement("div");return t.innerHTML=e,e=t.textContent||t.innerText,$.trim(e)},getPlainText:function(e,t){return e=this.clean.getTextFromHtml(e),e=e.replace(/\n/g,"<br />"),this.opts.paragraphize&&"undefined"==typeof t&&!this.utils.browser("mozilla")&&(e=this.paragraphize.load(e)),e},getPreCode:function(e){return e=e.replace(/<img(.*?) style="(.*?)"(.*?[^>])>/gi,"<img$1$3>"),e=e.replace(/<img(.*?)>/gi,"&lt;img$1&gt;"),e=this.clean.getTextFromHtml(e),this.opts.preSpaces&&(e=e.replace(/\t/g,Array(this.opts.preSpaces+1).join(" "))),e=this.clean.encodeEntities(e)},getOnlyImages:function(e){return e=e.replace(/<img(.*?)>/gi,"[img$1]"),e=e.replace(/<([Ss]*?)>/gi,""),e=e.replace(/\[img(.*?)\]/gi,"<img$1>")},getOnlyLinksAndImages:function(e){return e=e.replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]'),e=e.replace(/<img(.*?)>/gi,"[img$1]"),e=e.replace(/<(.*?)>/gi,""),e=e.replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>'),e=e.replace(/\[img(.*?)\]/gi,"<img$1>")},encodeEntities:function(e){return e=String(e).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},removeDirtyStyles:function(e){if(this.utils.browser("msie"))return e;var t=document.createElement("div");return t.innerHTML=e,this.clean.clearUnverifiedRemove($(t)),e=t.innerHTML,$(t).remove(),e},clearUnverified:function(){if(!this.utils.browser("msie")){this.clean.clearUnverifiedRemove(this.$editor);var e=this.$editor.find("h1, h2, h3, h4, h5, h6");e.find("span").removeAttr("style"),e.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),this.code.sync()}},clearUnverifiedRemove:function(e){e.find(this.opts.verifiedTags.join(", ")).removeAttr("style"),e.find("span").not('[data-verified="redactor"]').removeAttr("style"),e.find('span[data-verified="redactor"], img[data-verified="redactor"]').each(function(e,t){var i=$(t);i.attr("style",i.attr("rel"))})},cleanEmptyParagraph:function(){var e=this.$editor.find("p").first();this.utils.isEmpty(e.html())&&e.remove()},setVerified:function(e){if(this.utils.browser("msie"))return e;e=e.replace(new RegExp("<img(.*?[^>])>","gi"),'<img$1 data-verified="redactor">'),e=e.replace(new RegExp("<span(.*?[^>])>","gi"),'<span$1 data-verified="redactor">');var t=e.match(new RegExp('<(span|img)(.*?)style="(.*?)"(.*?[^>])>',"gi"));if(t)for(var i=t.length,r=0;i>r;r++)try{var n=t[r].replace(/style="(.*?)"/i,'style="$1" rel="$1"');e=e.replace(t[r],n)}catch(o){}return e},convertInline:function(e){var t=$("<div />").html(e),i=this.opts.inlineTags;return i.push("span"),t.find(i.join(",")).each(function(){var e=$(this),t=this.tagName.toLowerCase();e.attr("data-redactor-tag",t),"span"==t&&(e.attr("style")?e.attr("data-redactor-style",e.attr("style")):e.attr("class")&&e.attr("data-redactor-class",e.attr("class")))}),e=t.html(),t.remove(),e},normalizeLists:function(){this.$editor.find("li").each(function(e,t){var i=$(t).next();0===i.length||"UL"!=i[0].tagName&&"OL"!=i[0].tagName||$(t).append(i)})},removeSpaces:function(e){return e=e.replace(/\n/g,""),e=e.replace(/[\t]*/g,""),e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/g," "),e=e.replace(/[\s\n]*$/g," "),e=e.replace(/>\s{2,}</g,"> <"),e=e.replace(/\n\n/g,"\n"),e=e.replace(/[\u200B-\u200D\uFEFF]/g,"")},replaceDivs:function(e){return this.opts.linebreaks?(e=e.replace(/<div><br\s?\/?><\/div>/gi,"<br />"),e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"$2<br />")):e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p$1>$2</p>"),e=e.replace(/<div(.*?[^>])>/gi,""),e=e.replace(/<\/div>/gi,"")},replaceDivsToBr:function(e){return e=e.replace(/<div\s(.*?)>/gi,"<p>"),e=e.replace(/<div><br\s?\/?><\/div>/gi,"<br /><br />"),e=e.replace(/<div>([\w\W]*?)<\/div>/gi,"$1<br /><br />")},replaceParagraphsToBr:function(e){return e=e.replace(/<p\s(.*?)>/gi,"<p>"),e=e.replace(/<p><br\s?\/?><\/p>/gi,"<br />"),e=e.replace(/<p>([\w\W]*?)<\/p>/gi,"$1<br /><br />"),e=e.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>")},saveFormTags:function(e){return e.replace(/<form(.*?)>([\w\W]*?)<\/form>/gi,'<section$1 rel="redactor-form-tag">$2</section>')},restoreFormTags:function(e){return e.replace(/<section(.*?) rel="redactor-form-tag"(.*?)>([\w\W]*?)<\/section>/gi,"<form$1$2>$3</form>")}}},code:function(){return{set:function(e){e=$.trim(e.toString()),e=this.clean.onSet(e),this.$editor.html(e),this.code.sync(),""!==e&&this.placeholder.remove(),setTimeout($.proxy(this.buffer.add,this),15),this.start===!1&&this.observe.load()},get:function(){var e=this.$textarea.val();return e=this.tabifier.get(e)},sync:function(){setTimeout($.proxy(this.code.startSync,this),10)},startSync:function(){var e=this.$editor.html();this.code.syncCode&&this.code.syncCode==e||(this.code.syncCode=e,e=this.core.setCallback("syncBefore",e),e=this.clean.onSync(e),this.$textarea.val(e),this.core.setCallback("sync",e),this.start===!1&&this.core.setCallback("change",e),this.start=!1,0==this.autosave.html&&(this.autosave.html=this.code.get()),this.opts.codemirror&&this.$textarea.next(".CodeMirror").each(function(t,i){i.CodeMirror.setValue(e)}),this.autosave.onChange(),this.autosave.enable())},toggle:function(){this.opts.visual?this.code.showCode():this.code.showVisual()},showCode:function(){this.code.offset=this.caret.getOffset();var e=$(window).scrollTop(),t=this.$editor.innerWidth(),i=this.$editor.innerHeight();this.$editor.hide();var r=this.$textarea.val();this.modified=this.clean.removeSpaces(r),r=this.tabifier.get(r),this.$textarea.val(r),this.opts.codemirror?this.$textarea.next(".CodeMirror").each(function(e,n){$(n).show(),n.CodeMirror.setValue(r),n.CodeMirror.setSize(t,i),n.CodeMirror.refresh(),n.CodeMirror.focus()}):(this.$textarea.height(i).show().focus(),this.$textarea.on("keydown.redactor-textarea-indenting",this.code.textareaIndenting),$(window).scrollTop(e),this.$textarea[0].setSelectionRange&&this.$textarea[0].setSelectionRange(0,0),this.$textarea[0].scrollTop=0),this.opts.visual=!1,this.button.setInactiveInCode(),this.button.setActive("html"),this.core.setCallback("source",r)},showVisual:function(){var e;this.opts.visual||(this.opts.codemirror?this.$textarea.next(".CodeMirror").each(function(t,i){e=i.CodeMirror.getValue()}):e=this.$textarea.hide().val(),this.modified!==this.clean.removeSpaces(e)&&this.code.set(e),this.opts.codemirror&&this.$textarea.next(".CodeMirror").hide(),this.$editor.show(),this.utils.isEmpty(e)||this.placeholder.remove(),this.caret.setOffset(this.code.offset),this.$textarea.off("keydown.redactor-textarea-indenting"),this.button.setActiveInVisual(),this.button.setInactive("html"),this.observe.load(),this.opts.visual=!0,this.core.setCallback("visual",e))},textareaIndenting:function(e){if(9!==e.keyCode)return!0;var t=this.$textarea,i=t.get(0).selectionStart;return t.val(t.val().substring(0,i)+"	"+t.val().substring(t.get(0).selectionEnd)),t.get(0).selectionStart=t.get(0).selectionEnd=i+1,!1}}},core:function(){return{getObject:function(){return $.extend({},this)},getEditor:function(){return this.$editor},getBox:function(){return this.$box},getElement:function(){return this.$element},getTextarea:function(){return this.$textarea},getToolbar:function(){return this.$toolbar?this.$toolbar:!1},addEvent:function(e){this.core.event=e},getEvent:function(){return this.core.event},setCallback:function(e,t,i){var r=this.opts[e+"Callback"];return $.isFunction(r)?"undefined"==typeof i?r.call(this,t):r.call(this,t,i):"undefined"==typeof i?t:i},destroy:function(){this.core.setCallback("destroy"),this.$element.off(".redactor").removeData("redactor"),this.$editor.off(".redactor"),$(document).off("click.redactor-image-delete."+this.uuid),$(document).off("click.redactor-image-resize-hide."+this.uuid),$(document).off("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid),$("body").off("scroll.redactor."+this.uuid),$(this.opts.toolbarFixedTarget).off("scroll.redactor."+this.uuid),this.$editor.removeClass("redactor-editor redactor-linebreaks redactor-placeholder"),this.$editor.removeAttr("contenteditable");var e=this.code.get();this.$toolbar.find("a").each(function(){var e=$(this);e.data("dropdown")&&(e.data("dropdown").remove(),e.data("dropdown",{}))}),this.build.isTextarea()?(this.$box.after(this.$element),this.$box.remove(),this.$element.val(e).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$element.html(e).show()),this.$pasteBox&&this.$pasteBox.remove(),this.$modalBox&&this.$modalBox.remove(),this.$modalOverlay&&this.$modalOverlay.remove(),$(".redactor-toolbar-tooltip").remove(),clearInterval(this.autosaveInterval)}}},dropdown:function(){return{build:function(e,t,i){"formatting"==e&&this.opts.formattingAdd&&$.each(this.opts.formattingAdd,$.proxy(function(e,t){var r=t.tag,n;"undefined"!=typeof t["class"]&&(r=r+"-"+t["class"]),t.type=this.utils.isBlockTag(t.tag)?"block":"inline",n="undefined"!=typeof t.func?t.func:"inline"==t.type?"inline.formatting":"block.formatting",this.opts.linebreaks&&"block"==t.type&&"p"==t.tag||(this.formatting[r]={tag:t.tag,style:t.style,"class":t["class"],attr:t.attr,data:t.data,clear:t.clear},i[r]={func:n,title:t.title})},this)),$.each(i,$.proxy(function(i,r){var n=$('<a href="#" class="redactor-dropdown-'+i+'">'+r.title+"</a>");"formatting"==e&&n.addClass("redactor-formatting-"+i),n.on("click",$.proxy(function(e){e.preventDefault();var t="func",n=r.func;r.command?(t="command",n=r.command):r.dropdown&&(t="dropdown",n=r.dropdown),this.button.onClick(e,i,t,n),this.dropdown.hideAll()},this)),t.append(n)},this))},show:function(e,t){if(!this.opts.visual)return e.preventDefault(),!1;var i=this.button.get(t),r=i.data("dropdown").appendTo(document.body);if(this.utils.isMobile()&&!this.utils.browser("msie")&&document.activeElement.blur(),i.hasClass("dropact"))this.dropdown.hideAll();else{this.dropdown.hideAll(),this.core.setCallback("dropdownShow",{dropdown:r,key:t,button:i}),this.button.setActive(t),i.addClass("dropact");var n=i.offset(),o=r.width();n.left+o>$(document).width()&&(n.left=Math.max(0,n.left-o));var s=n.left+"px";if(this.$toolbar.hasClass("toolbar-fixed-box")){var a=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,l="fixed";this.opts.toolbarFixedTarget!==document&&(a=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,l="absolute"),r.css({position:l,left:s,top:a+"px"}).show()}else{var a=i.innerHeight()+n.top+"px";r.css({position:"absolute",left:s,top:a}).show()}this.core.setCallback("dropdownShown",{dropdown:r,key:t,button:i})}$(document).one("click",$.proxy(this.dropdown.hide,this)),this.$editor.one("click",$.proxy(this.dropdown.hide,this));var c=$(document.body),d=c.width();r.on("mouseover",function(){c.addClass("body-redactor-hidden"),c.css("margin-right",c.width()-d+"px")}),r.on("mouseout",function(){c.removeClass("body-redactor-hidden").css("margin-right",0)}),e.stopPropagation()},hideAll:function(){this.$toolbar.find("a.dropact").removeClass("redactor-act").removeClass("dropact"),$(document.body).removeClass("body-redactor-hidden").css("margin-right",0),$(".redactor-dropdown-"+this.uuid).hide(),this.core.setCallback("dropdownHide")},hide:function(e){var t=$(e.target);t.hasClass("dropact")||(t.removeClass("dropact"),this.dropdown.hideAll())}}},file:function(){return{show:function(){this.modal.load("file",this.lang.get("file"),700),this.upload.init("#redactor-modal-file-upload",this.opts.fileUpload,this.file.insert),this.selection.save(),this.selection.get();var e=this.sel.toString();$("#redactor-filename").val(e),this.modal.show()},insert:function(e,t,i){if("undefined"!=typeof e.error)return this.modal.close(),this.selection.restore(),void this.core.setCallback("fileUploadError",e);var r;if("string"==typeof e)r=e;else{var n=$("#redactor-filename").val();("undefined"==typeof n||""===n)&&(n=e.filename),r='<a href="'+e.filelink+'" id="filelink-marker">'+n+"</a>"}if(t){this.selection.removeMarkers();var o=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(i,o)}else this.modal.close();if(this.selection.restore(),this.buffer.set(),this.insert.htmlWithoutClean(r),"string"!=typeof e){var s=$(this.$editor.find("a#filelink-marker"));0!==s.length?s.removeAttr("id").removeAttr("style"):s=!1,this.core.setCallback("fileUpload",s,e)}}}},focus:function(){return{setStart:function(){this.$editor.focus();var e=this.$editor.children().first();if(0!==e.length&&0!==e[0].length&&"BR"!=e[0].tagName&&3!=e[0].nodeType){if("UL"==e[0].tagName||"OL"==e[0].tagName){var t=e.find("li").first();if(!this.utils.isBlock(t)&&""===t.text())return void this.caret.setStart(t)}return this.opts.linebreaks&&!this.utils.isBlockTag(e[0].tagName)?(this.selection.get(),this.range.setStart(this.$editor[0],0),this.range.setEnd(this.$editor[0],0),void this.selection.addRange()):void this.caret.setStart(e)}},setEnd:function(){if(this.utils.browser("mozilla")||this.utils.browser("msie")){var e=this.$editor.children().last();this.$editor.focus(),this.caret.setEnd(e)}else{this.selection.get();try{this.range.selectNodeContents(this.$editor[0]),this.range.collapse(!1),this.selection.addRange()}catch(t){}}},isFocused:function(){var e=document.getSelection().focusNode;return null===e?!1:this.opts.linebreaks&&$(e.parentNode).hasClass("redactor-linebreaks")?!0:this.utils.isRedactorParent(e.parentNode)?this.$editor.is(":focus"):!1}}},image:function(){return{show:function(){this.modal.load("image",this.lang.get("image"),700),this.upload.init("#redactor-modal-image-droparea",this.opts.imageUpload,this.image.insert),this.selection.save(),this.modal.show()},showEdit:function(e){var t=e.closest("a",this.$editor[0]);if(this.modal.load("imageEdit",this.lang.get("edit"),705),this.modal.createCancelButton(),this.image.buttonDelete=this.modal.createDeleteButton(this.lang.get("_delete")),this.image.buttonSave=this.modal.createActionButton(this.lang.get("save")),this.image.buttonDelete.on("click",$.proxy(function(){this.image.remove(e)},this)),this.image.buttonSave.on("click",$.proxy(function(){this.image.update(e)},this)),$("#redactor-image-title").val(e.attr("alt")),this.opts.imageLink){var i=$("#redactor-image-link");i.attr("href",e.attr("src")),0!==t.length&&(i.val(t.attr("href")),"_blank"==t.attr("target")&&$("#redactor-image-link-blank").prop("checked",!0))}else $(".redactor-image-link-option").hide();if(this.opts.imagePosition){var r="block"==e.css("display")&&"none"==e.css("float")?"center":e.css("float");$("#redactor-image-align").val(r)}else $(".redactor-image-position-option").hide();this.modal.show()},setFloating:function(e){var t=$("#redactor-image-align").val(),i="",r="",n="";switch(t){case"left":i="left",n="0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin+" 0";break;case"right":i="right",n="0 0 "+this.opts.imageFloatMargin+" "+this.opts.imageFloatMargin;break;case"center":r="block",n="auto"}e.css({"float":i,display:r,margin:n}),e.attr("rel",e.attr("style"))},update:function(e){this.image.hideResize(),this.buffer.set();var t=e.closest("a",this.$editor[0]);e.attr("alt",$("#redactor-image-title").val()),this.image.setFloating(e);var i=$.trim($("#redactor-image-link").val());if(""!==i){var r="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",n=new RegExp("^(http|ftp|https)://"+r,"i"),o=new RegExp("^"+r,"i");-1==i.search(n)&&0===i.search(o)&&this.opts.linkProtocol&&(i=this.opts.linkProtocol+"://"+i);var s=$("#redactor-image-link-blank").prop("checked")?!0:!1;if(0===t.length){var a=$('<a href="'+i+'">'+this.utils.getOuterHtml(e)+"</a>");s&&a.attr("target","_blank"),e.replaceWith(a)}else t.attr("href",i),s?t.attr("target","_blank"):t.removeAttr("target")}else 0!==t.length&&t.replaceWith(this.utils.getOuterHtml(e));this.modal.close(),this.observe.images(),this.code.sync()},setEditable:function(e){this.opts.imageEditable&&e.on("dragstart",$.proxy(this.image.onDrag,this)),e.on("mousedown",$.proxy(this.image.hideResize,this)),e.on("click.redactor touchstart",$.proxy(function(t){return this.observe.image=e,0!==this.$editor.find("#redactor-image-box").length?!1:(this.image.resizer=this.image.loadEditableControls(e),$(document).on("click.redactor-image-resize-hide."+this.uuid,$.proxy(this.image.hideResize,this)),this.$editor.on("click.redactor-image-resize-hide."+this.uuid,$.proxy(this.image.hideResize,this)),void(this.opts.imageResizable&&this.image.resizer.on("mousedown.redactor touchstart.redactor",$.proxy(function(t){this.image.setResizable(t,e)},this))))},this))},setResizable:function(e,t){e.preventDefault(),this.image.resizeHandle={x:e.pageX,y:e.pageY,el:t,ratio:t.width()/t.height(),h:t.height()},e=e.originalEvent||e,e.targetTouches&&(this.image.resizeHandle.x=e.targetTouches[0].pageX,this.image.resizeHandle.y=e.targetTouches[0].pageY),this.image.startResize()},startResize:function(){$(document).on("mousemove.redactor-image-resize touchmove.redactor-image-resize",$.proxy(this.image.moveResize,this)),$(document).on("mouseup.redactor-image-resize touchend.redactor-image-resize",$.proxy(this.image.stopResize,this))},moveResize:function(e){e.preventDefault(),e=e.originalEvent||e;var t=this.image.resizeHandle.h;t+=e.targetTouches?e.targetTouches[0].pageY-this.image.resizeHandle.y:e.pageY-this.image.resizeHandle.y;var i=Math.round(t*this.image.resizeHandle.ratio);if(!(50>t||100>i)){var t=Math.round(this.image.resizeHandle.el.width()/this.image.resizeHandle.ratio);this.image.resizeHandle.el.attr({width:i,height:t}),this.image.resizeHandle.el.width(i),this.image.resizeHandle.el.height(t),this.code.sync()}},stopResize:function(){this.handle=!1,$(document).off(".redactor-image-resize"),this.image.hideResize()},onDrag:function(e){return 0!==this.$editor.find("#redactor-image-box").length?(e.preventDefault(),!1):void this.$editor.on("drop.redactor-image-inside-drop",$.proxy(function(){setTimeout($.proxy(this.image.onDrop,this),1)},this))},onDrop:function(){this.image.fixImageSourceAfterDrop(),this.observe.images(),this.$editor.off("drop.redactor-image-inside-drop"),this.clean.clearUnverified(),this.code.sync()},fixImageSourceAfterDrop:function(){this.$editor.find("img[data-save-url]").each(function(){var e=$(this);e.attr("src",e.attr("data-save-url")),e.removeAttr("data-save-url")})},hideResize:function(e){if(!e||0===$(e.target).closest("#redactor-image-box",this.$editor[0]).length){if(e&&"IMG"==e.target.tagName){var t=$(e.target);t.attr("data-save-url",t.attr("src"))}var i=this.$editor.find("#redactor-image-box");0!==i.length&&(this.opts.imageEditable&&this.image.editter.remove(),$(this.image.resizer).remove(),i.find("img").css({marginTop:i[0].style.marginTop,marginBottom:i[0].style.marginBottom,marginLeft:i[0].style.marginLeft,marginRight:i[0].style.marginRight}),i.css("margin",""),i.find("img").css("opacity",""),i.replaceWith(function(){return $(this).contents()}),$(document).off("click.redactor-image-resize-hide."+this.uuid),this.$editor.off("click.redactor-image-resize-hide."+this.uuid),"undefined"!=typeof this.image.resizeHandle&&this.image.resizeHandle.el.attr("rel",this.image.resizeHandle.el.attr("style")),this.code.sync())}},loadResizableControls:function(e,t){if(this.opts.imageResizable&&!this.utils.isMobile()){var i=$('<span id="redactor-image-resizer" data-redactor="verified"></span>');return this.utils.isDesktop()||i.css({width:"15px",height:"15px"}),i.attr("contenteditable",!1),t.append(i),t.append(e),i}return t.append(e),!1},loadEditableControls:function(e){var t=$('<span id="redactor-image-box" data-redactor="verified">');if(t.css("float",e.css("float")).attr("contenteditable",!1),"auto"!=e[0].style.margin?(t.css({marginTop:e[0].style.marginTop,marginBottom:e[0].style.marginBottom,marginLeft:e[0].style.marginLeft,marginRight:e[0].style.marginRight}),e.css("margin","")):t.css({display:"block",margin:"auto"}),e.css("opacity",".5").after(t),this.opts.imageEditable){this.image.editter=$('<span id="redactor-image-editter" data-redactor="verified">'+this.lang.get("edit")+"</span>"),this.image.editter.attr("contenteditable",!1),this.image.editter.on("click",$.proxy(function(){this.image.showEdit(e)},this)),t.append(this.image.editter);var i=this.image.editter.innerWidth();this.image.editter.css("margin-left","-"+i/2+"px")}return this.image.loadResizableControls(e,t)},remove:function(e){var t=$(e),i=t.closest("a",this.$editor[0]),r=t.closest("figure",this.$editor[0]),n=t.parent();0!==$("#redactor-image-box").length&&(n=$("#redactor-image-box").parent());var o;0!==r.length?(o=r.next(),r.remove()):0!==i.length?(n=i.parent(),i.remove()):t.remove(),$("#redactor-image-box").remove(),this.caret.setStart(0!==r.length?o:n),this.core.setCallback("imageDelete",t[0].src,t),this.modal.close(),this.code.sync()},insert:function(e,t,i){if("undefined"!=typeof e.error)return this.modal.close(),this.selection.restore(),void this.core.setCallback("imageUploadError",e);var r;"string"==typeof e?r=$(e).attr("data-redactor-inserted-image","true"):(r=$("<img>"),r.attr("src",e.filelink).attr("data-redactor-inserted-image","true"));var n=r,o=this.utils.isCurrentOrParent("P");if(o&&(n=$("<blockquote />").append(r)),t){this.selection.removeMarkers();var s=this.selection.getMarker();this.insert.nodeToCaretPositionFromPoint(i,s)}else this.modal.close();this.selection.restore(),this.buffer.set(),this.insert.html(this.utils.getOuterHtml(n),!1);var a=this.$editor.find("img[data-redactor-inserted-image=true]").removeAttr("data-redactor-inserted-image");o?a.parent().contents().unwrap().wrap("<p />"):this.opts.linebreaks&&a.before("<br>").after("<br>"),"string"!=typeof e&&this.core.setCallback("imageUpload",a,e)}}},indent:function(){return{increase:function(){this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var e=this.selection.getBlock();e&&"LI"==e.tagName?this.indent.increaseLists():e===!1&&this.opts.linebreaks?this.indent.increaseText():this.indent.increaseBlocks(),this.selection.restore(),this.code.sync()},increaseLists:function(){document.execCommand("indent"),this.indent.fixEmptyIndent(),this.clean.normalizeLists(),this.clean.clearUnverified()},increaseBlocks:function(){$.each(this.selection.getBlocks(),$.proxy(function(e,t){if("TD"!==t.tagName&&"TH"!==t.tagName){var i=this.utils.getAlignmentElement(t),r=this.utils.normalize(i.css("margin-left"))+this.opts.indentValue;i.css("margin-left",r+"px")}},this))},increaseText:function(){var e=this.selection.wrap("div");$(e).attr("data-tagblock","redactor"),$(e).css("margin-left",this.opts.indentValue+"px")},decrease:function(){this.buffer.set(),this.selection.save();var e=this.selection.getBlock();e&&"LI"==e.tagName?this.indent.decreaseLists():this.indent.decreaseBlocks(),this.selection.restore(),this.code.sync()},decreaseLists:function(){document.execCommand("outdent");var e=this.selection.getCurrent(),t=$(e).closest("li",this.$editor[0]),i=t.parent();0!==t.length&&0!==i.length&&"LI"==i[0].tagName&&i.after(t),this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==t.length||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote, p").each($.proxy(this.utils.removeEmpty,this))),this.clean.clearUnverified()},decreaseBlocks:function(){$.each(this.selection.getBlocks(),$.proxy(function(e,t){
var i=this.utils.getAlignmentElement(t),r=this.utils.normalize(i.css("margin-left"))-this.opts.indentValue;0>=r?this.opts.linebreaks&&"undefined"!=typeof i.data("tagblock")?i.replaceWith(i.html()+"<br />"):(i.css("margin-left",""),this.utils.removeEmptyAttr(i,"style")):i.css("margin-left",r+"px")},this))},fixEmptyIndent:function(){var e=this.selection.getBlock();if(this.range.collapsed&&e&&"LI"==e.tagName&&this.utils.isEmpty($(e).text())){var t=$(e);t.find("span").not(".redactor-selection-marker").contents().unwrap(),t.append("<br>")}}}},inline:function(){return{formatting:function(e){var t,i;"undefined"!=typeof this.formatting[e].style?t="style":"undefined"!=typeof this.formatting[e]["class"]&&(t="class"),t&&(i=this.formatting[e][t]),this.inline.format(this.formatting[e].tag,t,i)},format:function(e,t,i){if(!this.utils.isCurrentOrParent("PRE")&&!this.utils.isCurrentOrParentHeader()){for(var r=["b","bold","i","italic","underline","strikethrough","deleted","superscript","subscript"],n=["strong","strong","em","em","u","del","del","sup","sub"],o=0;o<r.length;o++)e==r[o]&&(e=n[o]);if(this.opts.allowedTags){if(-1==$.inArray(e,this.opts.allowedTags))return}else if(-1!==$.inArray(e,this.opts.deniedTags))return;this.inline.type=t||!1,this.inline.value=i||!1,this.buffer.set(),this.utils.browser("msie")||this.$editor.focus(),this.selection.get(),this.range.collapsed?this.inline.formatCollapsed(e):this.inline.formatMultiple(e)}},formatCollapsed:function(e){var t=this.selection.getCurrent(),i=$(t).closest(e+"[data-redactor-tag="+e+"]",this.$editor[0]);if(0!==i.length&&"style"!=this.inline.type&&"SPAN"!=i[0].tagName)return void(this.utils.isEmpty(i.text())?(this.caret.setAfter(i[0]),i.remove(),this.code.sync()):this.utils.isEndOfElement(i)&&this.caret.setAfter(i[0]));var r=$("<"+e+">").attr("data-verified","redactor").attr("data-redactor-tag",e);r.html(this.opts.invisibleSpace),r=this.inline.setFormat(r);var r=this.insert.node(r);this.caret.setEnd(r),this.code.sync()},formatMultiple:function(e){if(this.inline.formatConvert(e),this.selection.save(),document.execCommand("strikethrough"),this.$editor.find("strike").each($.proxy(function(t,i){var r=$(i);this.inline.formatRemoveSameChildren(r,e);var n;if(this.inline.type?(n=$("<span>").attr("data-redactor-tag",e).attr("data-verified","redactor"),n=this.inline.setFormat(n)):n=$("<"+e+">").attr("data-redactor-tag",e).attr("data-verified","redactor"),r.replaceWith(n.html(r.contents())),"span"==e){var o=n.parent();if(o&&"SPAN"==o[0].tagName&&"style"==this.inline.type)for(var s=this.inline.value.split(";"),a=0;a<s.length;a++){if(""===s[a])return;var l=s[a].split(":");o.css(l[0],""),this.utils.removeEmptyAttr(o,"style")&&o.replaceWith(o.contents())}}},this)),"span"!=e&&this.$editor.find(this.opts.inlineTags.join(", ")).each($.proxy(function(e,t){var i=$(t),r=i.css("text-decoration");"line-through"==r&&(i.css("text-decoration",""),this.utils.removeEmptyAttr(i,"style"))},this)),"del"!=e){var t=this;this.$editor.find("inline").each(function(e,i){t.utils.replaceToTag(i,"del")})}this.selection.restore(),this.code.sync()},formatRemoveSameChildren:function(e,t){var i=this;e.children(t).each(function(){var e=$(this);if(!e.hasClass("redactor-selection-marker"))if("style"==i.inline.type)for(var t=i.inline.value.split(";"),r=0;r<t.length;r++){if(""===t[r])return;var n=t[r].split(":");e.css(n[0],""),i.utils.removeEmptyAttr(e,"style")&&e.replaceWith(e.contents())}else e.contents().unwrap()})},formatConvert:function(e){this.selection.save();var t="";"class"==this.inline.type?t="[data-redactor-class="+this.inline.value+"]":"style"==this.inline.type&&(t='[data-redactor-style="'+this.inline.value+'"]');var i=this;"del"!=e&&this.$editor.find("del").each(function(e,t){i.utils.replaceToTag(t,"inline")}),"span"!=e&&this.$editor.find(e).each(function(){var e=$(this);e.replaceWith($("<strike />").html(e.contents()))}),this.$editor.find('[data-redactor-tag="'+e+'"]'+t).each(function(){if(""!==t||"span"!=e||this.tagName.toLowerCase()!=e){var i=$(this);i.replaceWith($("<strike />").html(i.contents()))}}),this.selection.restore()},setFormat:function(e){switch(this.inline.type){case"class":e.hasClass(this.inline.value)?(e.removeClass(this.inline.value),e.removeAttr("data-redactor-class")):(e.addClass(this.inline.value),e.attr("data-redactor-class",this.inline.value));break;case"style":e[0].style.cssText=this.inline.value,e.attr("data-redactor-style",this.inline.value)}return e},removeStyle:function(){this.buffer.set();var e=this.selection.getCurrent(),t=this.selection.getInlines();if(this.selection.save(),e&&"SPAN"===e.tagName){var i=$(e);i.removeAttr("style"),0===i[0].attributes.length&&i.replaceWith(i.contents())}$.each(t,$.proxy(function(e,t){var i=$(t);-1==$.inArray(t.tagName.toLowerCase(),this.opts.inlineTags)||i.hasClass("redactor-selection-marker")||(i.removeAttr("style"),0===i[0].attributes.length&&i.replaceWith(i.contents()))},this)),this.selection.restore(),this.code.sync()},removeStyleRule:function(e){this.buffer.set();var t=this.selection.getParent(),i=this.selection.getInlines();if(this.selection.save(),t&&"SPAN"===t.tagName){var r=$(t);r.css(e,""),this.utils.removeEmptyAttr(r,"style"),0===r[0].attributes.length&&r.replaceWith(r.contents())}$.each(i,$.proxy(function(t,i){var r=$(i);-1==$.inArray(i.tagName.toLowerCase(),this.opts.inlineTags)||r.hasClass("redactor-selection-marker")||(r.css(e,""),this.utils.removeEmptyAttr(r,"style"),0===r[0].attributes.length&&r.replaceWith(r.contents()))},this)),this.selection.restore(),this.code.sync()},removeFormat:function(){this.buffer.set();var e=this.selection.getCurrent();this.selection.save(),document.execCommand("removeFormat"),e&&"SPAN"===e.tagName&&$(e).replaceWith($(e).contents()),$.each(this.selection.getNodes(),$.proxy(function(e,t){var i=$(t);-1==$.inArray(t.tagName.toLowerCase(),this.opts.inlineTags)||i.hasClass("redactor-selection-marker")||i.replaceWith(i.contents())},this)),this.selection.restore(),this.code.sync()},toggleClass:function(e){this.inline.format("span","class",e)},toggleStyle:function(e){this.inline.format("span","style",e)}}},insert:function(){return{set:function(e,t){this.placeholder.remove(),e=this.clean.setVerified(e),"undefined"==typeof t&&(e=this.clean.onPaste(e,!1)),this.$editor.html(e),this.selection.remove(),this.focus.setEnd(),this.clean.normalizeLists(),this.code.sync(),this.observe.load(),"undefined"==typeof t&&setTimeout($.proxy(this.clean.clearUnverified,this),10)},text:function(e){if(this.placeholder.remove(),e=e.toString(),e=$.trim(e),e=this.clean.getPlainText(e,!1),this.$editor.focus(),this.utils.browser("msie"))this.insert.htmlIe(e);else{this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;for(var i=document.createDocumentFragment(),r,n;r=t.firstChild;)n=i.appendChild(r);if(this.range.insertNode(i),n){var o=this.range.cloneRange();o.setStartAfter(n),o.collapse(!0),this.sel.removeAllRanges(),this.sel.addRange(o)}}this.code.sync(),this.clean.clearUnverified()},htmlWithoutClean:function(e){this.insert.html(e,!1)},html:function(e,t){this.placeholder.remove(),"undefined"==typeof t&&(t=!0),this.$editor.focus(),e=this.clean.setVerified(e),t&&(e=this.clean.onPaste(e)),this.utils.browser("msie")?this.insert.htmlIe(e):(this.clean.singleLine?this.insert.execHtml(e):document.execCommand("insertHTML",!1,e),this.insert.htmlFixMozilla()),this.clean.normalizeLists(),this.opts.linebreaks||this.$editor.find("p").each($.proxy(this.utils.removeEmpty,this)),this.code.sync(),this.observe.load(),t&&this.clean.clearUnverified()},htmlFixMozilla:function(){if(this.utils.browser("mozilla")){var e=$(this.selection.getBlock()).next();e.length>0&&"P"==e[0].tagName&&""===e.html()&&e.remove()}},htmlIe:function(e){if(this.utils.isIe11()){var t=this.utils.isCurrentOrParent("P"),i=$("<div>").append(e),r=i.contents().is("p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article");return void(t&&r?this.insert.ie11FixInserting(t,e):this.insert.ie11PasteFrag(e))}document.selection.createRange().pasteHTML(e)},execHtml:function(e){e=this.clean.setVerified(e),this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;for(var i=document.createDocumentFragment(),r,n;r=t.firstChild;)n=i.appendChild(r);this.range.insertNode(i),this.range.collapse(!0),this.caret.setAfter(n)},node:function(e,t){e=e[0]||e;var i=this.utils.getOuterHtml(e);return i=this.clean.setVerified(i),null!==i.match(/</g)&&(e=$(i)[0]),this.selection.get(),t!==!1&&this.range.deleteContents(),this.range.insertNode(e),this.range.collapse(!1),this.selection.addRange(),e},nodeToPoint:function(e,t,i){e=e[0]||e,this.selection.get();var r;if(document.caretPositionFromPoint){var n=document.caretPositionFromPoint(t,i);this.range.setStart(n.offsetNode,n.offset),this.range.collapse(!0),this.range.insertNode(e)}else if(document.caretRangeFromPoint)r=document.caretRangeFromPoint(t,i),r.insertNode(e);else if("undefined"!=typeof document.body.createTextRange){r=document.body.createTextRange(),r.moveToPoint(t,i);var o=r.duplicate();o.moveToPoint(t,i),r.setEndPoint("EndToEnd",o),r.select()}},nodeToCaretPositionFromPoint:function(e,t){t=t[0]||t;var i,r=e.clientX,n=e.clientY;if(document.caretPositionFromPoint){var o=document.caretPositionFromPoint(r,n),s=document.getSelection();i=s.getRangeAt(0),i.setStart(o.offsetNode,o.offset),i.collapse(!0),i.insertNode(t)}else if(document.caretRangeFromPoint)i=document.caretRangeFromPoint(r,n),i.insertNode(t);else if("undefined"!=typeof document.body.createTextRange){i=document.body.createTextRange(),i.moveToPoint(r,n);var a=i.duplicate();a.moveToPoint(r,n),i.setEndPoint("EndToEnd",a),i.select()}},ie11FixInserting:function(e,t){var i=document.createElement("span");i.className="redactor-ie-paste",this.insert.node(i);var r=$(e).html();r="<p>"+r.replace(/<span class="redactor-ie-paste"><\/span>/gi,"</p>"+t+"<p>")+"</p>",$(e).replaceWith(r)},ie11PasteFrag:function(e){this.selection.get(),this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;for(var i=document.createDocumentFragment(),r,n;r=t.firstChild;)n=i.appendChild(r);this.range.insertNode(i),this.range.collapse(!1),this.selection.addRange()}}},keydown:function(){return{init:function(e){if(!this.rtePaste){var t=e.which,i=t>=37&&40>=t;this.keydown.ctrl=e.ctrlKey||e.metaKey,this.keydown.current=this.selection.getCurrent(),this.keydown.parent=this.selection.getParent(),this.keydown.block=this.selection.getBlock(),this.keydown.pre=this.utils.isTag(this.keydown.current,"pre"),this.keydown.blockquote=this.utils.isTag(this.keydown.current,"blockquote"),this.keydown.figcaption=this.utils.isTag(this.keydown.current,"figcaption"),this.shortcuts.init(e,t),this.keydown.checkEvents(i,t),this.keydown.setupBuffer(e,t),this.keydown.addArrowsEvent(i),this.keydown.setupSelectAll(e,t);var r=this.core.setCallback("keydown",e);if(r===!1)return e.preventDefault(),!1;if(this.opts.enterKey&&(this.utils.browser("msie")||this.utils.browser("mozilla"))&&(t===this.keyCode.DOWN||t===this.keyCode.RIGHT)){var n=!1,o=!1;if(this.keydown.block&&"TD"===this.keydown.block.tagName&&(o=$(this.keydown.block).closest("table",this.$editor[0])),o&&o.find("td").last()[0]===this.keydown.block&&(n=!0),this.utils.isEndOfElement()&&n){var s=$(this.opts.emptyHtml);o.after(s),this.caret.setStart(s)}}if(this.opts.enterKey&&t===this.keyCode.DOWN&&this.keydown.onArrowDown(),!this.opts.enterKey&&t===this.keyCode.ENTER)return e.preventDefault(),void(this.range.collapsed||this.range.deleteContents());if(t==this.keyCode.ENTER&&!e.shiftKey&&!e.ctrlKey&&!e.metaKey){var a=this.core.setCallback("enter",e);if(a===!1)return e.preventDefault(),!1;if(this.keydown.blockquote&&this.keydown.exitFromBlockquote(e)===!0)return!1;var l,c;if(this.keydown.pre)return this.keydown.insertNewLine(e);if(this.keydown.blockquote||this.keydown.figcaption)return l=this.selection.getCurrent(),c=$(l).next(),0!==c.length&&"BR"==c[0].tagName?this.keydown.insertBreakLine(e):this.utils.isEndOfElement()&&l&&"SPAN"!=l?this.keydown.insertDblBreakLine(e):this.keydown.insertBreakLine(e);if(this.opts.linebreaks&&!this.keydown.block)return l=this.selection.getCurrent(),c=$(this.keydown.current).next(),0!==c.length&&"BR"==c[0].tagName?this.keydown.insertBreakLine(e):l!==!1&&$(l).hasClass("redactor-invisible-space")?(this.caret.setAfter(l),$(l).contents().unwrap(),this.keydown.insertDblBreakLine(e)):this.utils.isEndOfEditor()?this.keydown.insertDblBreakLine(e):this.keydown.insertBreakLine(0===c.length&&l===!1&&"undefined"!=typeof c.context?e:e);if(this.opts.linebreaks&&this.keydown.block)setTimeout($.proxy(this.keydown.replaceDivToBreakLine,this),1);else if(!this.opts.linebreaks&&this.keydown.block)if("LI"!==this.keydown.block.tagName)setTimeout($.proxy(this.keydown.replaceDivToParagraph,this),1);else{l=this.selection.getCurrent();var d=$(l).closest("li",this.$editor[0]),h=d.closest("ul,ol",this.$editor[0]);if(0!==d.length&&this.utils.isEmpty(d.html())&&0===h.next().length&&this.utils.isEmpty(h.find("li").last().html())){h.find("li").last().remove();var s=$(this.opts.emptyHtml);return h.after(s),this.caret.setStart(s),!1}}else if(!this.opts.linebreaks&&!this.keydown.block)return this.keydown.insertParagraph(e)}if(t===this.keyCode.ENTER&&(e.ctrlKey||e.shiftKey))return this.keydown.onShiftEnter(e);if(t===this.keyCode.TAB||e.metaKey&&221===t||e.metaKey&&219===t)return this.keydown.onTab(e,t);if(t===this.keyCode.BACKSPACE||t===this.keyCode.DELETE){if(this.utils.browser("mozilla")&&this.keydown.current&&"TD"===this.keydown.current.tagName)return e.preventDefault(),!1;var u=this.selection.getNodes();if(u)for(var f=u.length,p,g=0;f>g;g++){var m=$(u[g]).children("img");if(0!==m.length){var v=this;$.each(m,function(e,t){var i=$(t);"none"==i.css("float")&&(v.core.setCallback("imageDelete",t.src,i),p=t)})}else"IMG"==u[g].tagName&&p!=u[g]&&(this.core.setCallback("imageDelete",u[g].src,$(u[g])),p=u[g])}}t===this.keyCode.BACKSPACE&&(this.keydown.removeInvisibleSpace(),this.keydown.removeEmptyListInTable(e)),this.code.sync()}},checkEvents:function(e,t){e||"click"!=this.core.getEvent()&&"arrow"!=this.core.getEvent()||(this.core.addEvent(!1),this.keydown.checkKeyEvents(t)&&this.buffer.set())},checkKeyEvents:function(e){var t=this.keyCode,i=[t.BACKSPACE,t.DELETE,t.ENTER,t.SPACE,t.ESC,t.TAB,t.CTRL,t.META,t.ALT,t.SHIFT];return-1==$.inArray(e,i)?!0:!1},addArrowsEvent:function(e){return e?"click"==this.core.getEvent()||"arrow"==this.core.getEvent()?void this.core.addEvent(!1):void this.core.addEvent("arrow"):void 0},setupBuffer:function(e,t){return this.keydown.ctrl&&90===t&&!e.shiftKey&&!e.altKey&&this.opts.buffer.length?(e.preventDefault(),void this.buffer.undo()):this.keydown.ctrl&&90===t&&e.shiftKey&&!e.altKey&&0!==this.opts.rebuffer.length?(e.preventDefault(),void this.buffer.redo()):void(this.keydown.ctrl||(t==this.keyCode.BACKSPACE||t==this.keyCode.DELETE||t==this.keyCode.ENTER&&!e.ctrlKey&&!e.shiftKey||t==this.keyCode.SPACE)&&this.buffer.set())},setupSelectAll:function(e,t){this.keydown.ctrl&&65===t?this.utils.enableSelectAll():t==this.keyCode.LEFT_WIN||this.keydown.ctrl||this.utils.disableSelectAll()},onArrowDown:function(){for(var e=[this.keydown.blockquote,this.keydown.pre,this.keydown.figcaption],t=0;t<e.length;t++)if(e[t])return this.keydown.insertAfterLastElement(e[t]),!1},onShiftEnter:function(e){return this.buffer.set(),this.utils.isEndOfElement()?this.keydown.insertDblBreakLine(e):this.keydown.insertBreakLine(e)},onTab:function(e,t){if(!this.opts.tabKey)return!0;if(this.utils.isEmpty(this.code.get())&&this.opts.tabAsSpaces===!1)return!0;e.preventDefault();var i;return this.keydown.pre&&!e.shiftKey?(i=document.createTextNode(this.opts.preSpaces?Array(this.opts.preSpaces+1).join(" "):"	"),this.insert.node(i),this.code.sync()):this.opts.tabAsSpaces!==!1?(i=document.createTextNode(Array(this.opts.tabAsSpaces+1).join(" ")),this.insert.node(i),this.code.sync()):e.metaKey&&219===t?this.indent.decrease():e.metaKey&&221===t?this.indent.increase():e.shiftKey?this.indent.decrease():this.indent.increase(),!1},replaceDivToBreakLine:function(){var e=this.selection.getBlock(),t=e.innerHTML.replace(/<br\s?\/?>/gi,"");if(("DIV"===e.tagName||"P"===e.tagName)&&""===t&&!$(e).hasClass("redactor-editor")){var i=document.createElement("br");return $(e).replaceWith(i),this.caret.setBefore(i),this.code.sync(),!1}},replaceDivToParagraph:function(){var e=this.selection.getBlock(),t=e.innerHTML.replace(/<br\s?\/?>/gi,"");if("DIV"===e.tagName&&""===t&&!$(e).hasClass("redactor-editor")){var i=document.createElement("p");return i.innerHTML=this.opts.invisibleSpace,$(e).replaceWith(i),this.caret.setStart(i),this.code.sync(),!1}this.opts.cleanStyleOnEnter&&"P"==e.tagName&&$(e).removeAttr("class").removeAttr("style")},insertParagraph:function(e){e.preventDefault(),this.selection.get();var t=document.createElement("p");return t.innerHTML=this.opts.invisibleSpace,this.range.deleteContents(),this.range.insertNode(t),this.caret.setStart(t),this.code.sync(),!1},exitFromBlockquote:function(e){if(this.utils.isEndOfElement()){var t=$.trim($(this.keydown.block).html());if(-1!=t.search(/(<br\s?\/?>){2}$/i)){if(e.preventDefault(),this.opts.linebreaks){var i=document.createElement("br");$(this.keydown.blockquote).after(i),this.caret.setBefore(i),$(this.keydown.block).html(t.replace(/<br\s?\/?>$/i,""))}else{var r=$(this.opts.emptyHtml);$(this.keydown.blockquote).after(r),this.caret.setStart(r)}return!0}}},insertAfterLastElement:function(e){if(this.utils.isEndOfElement())if(this.buffer.set(),this.opts.linebreaks){var t=$("<div>").append($.trim(this.$editor.html())).contents(),i=t.last()[0];if("SPAN"==i.tagName&&""===i.innerHTML&&(i=t.prev()[0]),this.utils.getOuterHtml(i)!=this.utils.getOuterHtml(e))return;var r=document.createElement("br");$(e).after(r),this.caret.setAfter(r)}else{if(this.$editor.contents().last()[0]!==e)return;var n=$(this.opts.emptyHtml);$(e).after(n),this.caret.setStart(n)}},insertNewLine:function(e){e.preventDefault();var t=document.createTextNode("\n");return this.selection.get(),this.range.deleteContents(),this.range.insertNode(t),this.caret.setAfter(t),this.code.sync(),!1},insertBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e)},insertDblBreakLine:function(e){return this.keydown.insertBreakLineProcessing(e,!0)},insertBreakLineProcessing:function(e,t){e.stopPropagation(),this.selection.get();var i=document.createElement("br");this.utils.browser("msie")?(this.range.collapse(!1),this.range.setEnd(this.range.endContainer,this.range.endOffset)):this.range.deleteContents(),this.range.insertNode(i);var r=$(i).parent("a");if(r.length>0&&(r.find(i).remove(),r.after(i)),t===!0){var n=$(i).next();if(0!==n.length&&"BR"===n[0].tagName&&this.utils.isEndOfEditor())return this.caret.setAfter(i),this.code.sync(),!1;var o=document.createElement("br");this.range.insertNode(o),this.caret.setAfter(o)}else this.keydown.insertBreakLineProcessingAfter(i);return this.code.sync(),!1},insertBreakLineProcessingAfter:function(e){var t=this.utils.createSpaceElement();$(e).after(t),this.selection.selectElement(t),$(t).replaceWith(function(){return $(this).contents()})},removeInvisibleSpace:function(){var e=$(this.keydown.current);0===e.text().search(/^\u200B$/g)&&e.remove()},removeEmptyListInTable:function(e){var t=$(this.keydown.current),i=$(this.keydown.parent),r=t.closest("td",this.$editor[0]);if(0!==r.length&&t.closest("li",this.$editor[0])&&1===i.children("li").length){if(!this.utils.isEmpty(t.text()))return;e.preventDefault(),t.remove(),i.remove(),this.caret.setStart(r)}}}},keyup:function(){return{init:function(e){if(!this.rtePaste){var t=e.which;this.keyup.current=this.selection.getCurrent(),this.keyup.parent=this.selection.getParent();var i=this.utils.isRedactorParent($(this.keyup.parent).parent()),r=this.core.setCallback("keyup",e);return r===!1?(e.preventDefault(),!1):(!this.opts.linebreaks&&3==this.keyup.current.nodeType&&this.keyup.current.length<=1&&(this.keyup.parent===!1||"BODY"==this.keyup.parent.tagName)&&this.keyup.replaceToParagraph(),!this.opts.linebreaks&&this.utils.isRedactorParent(this.keyup.current)&&"DIV"===this.keyup.current.tagName&&this.keyup.replaceToParagraph(!1),this.opts.linebreaks||!$(this.keyup.parent).hasClass("redactor-invisible-space")||i!==!1&&"BODY"!=i[0].tagName||($(this.keyup.parent).contents().unwrap(),this.keyup.replaceToParagraph()),this.linkify.isEnabled()&&this.linkify.isKey(t)&&this.linkify.format(),t===this.keyCode.DELETE||t===this.keyCode.BACKSPACE?(this.clean.clearUnverified(),this.observe.image?(e.preventDefault(),this.image.hideResize(),this.buffer.set(),this.image.remove(this.observe.image),this.observe.image=!1,!1):(this.$editor.find("p").each($.proxy(function(e,t){this.utils.removeEmpty(e,$(t).html())},this)),this.opts.linebreaks&&this.keyup.current&&"DIV"==this.keyup.current.tagName&&this.utils.isEmpty(this.keyup.current.innerHTML)&&($(this.keyup.current).after(this.selection.getMarkerAsHtml()),this.selection.restore(),$(this.keyup.current).remove()),this.keyup.formatEmpty(e))):void 0)}},replaceToParagraph:function(e){var t=$(this.keyup.current),i;i=$("<p>").append(e===!1?t.html():t.clone()),t.replaceWith(i);var r=$(i).next();"undefined"!=typeof r[0]&&"BR"==r[0].tagName&&r.remove(),this.caret.setEnd(i)},formatEmpty:function(e){var t=$.trim(this.$editor.html());if(this.utils.isEmpty(t))return e.preventDefault(),this.opts.linebreaks?(this.$editor.html(this.selection.getMarkerAsHtml()),this.selection.restore()):(t="<p><br /></p>",this.$editor.html(t),this.focus.setStart()),this.code.sync(),!1}}},lang:function(){return{load:function(){this.opts.curLang=this.opts.langs[this.opts.lang]},get:function(e){return"undefined"!=typeof this.opts.curLang[e]?this.opts.curLang[e]:""}}},line:function(){return{insert:function(){this.buffer.set();var e=this.selection.getBlocks();return e[0]!==!1&&this.line.isExceptLastOrFirst(e)?void(this.utils.browser("msie")||this.$editor.focus()):void(this.utils.browser("msie")?this.line.insertInIe():this.line.insertInOthersBrowsers())},isExceptLastOrFirst:function(e){var t=["li","td","th","blockquote","figcaption","pre","dl","dt","dd"],i=e[0].tagName.toLowerCase(),r=this.selection.getLastBlock();r="undefined"==typeof r?i:r.tagName.toLowerCase();var n=-1!=$.inArray(i,t),o=-1!=$.inArray(r,t);return n&&o||n?!0:void 0},insertInIe:function(){this.utils.saveScroll(),this.buffer.set(),this.insert.node(document.createElement("hr")),this.utils.restoreScroll(),this.code.sync()},insertInOthersBrowsers:function(){this.buffer.set();var e='<p id="redactor-insert-line"><br /></p>';this.opts.linebreaks&&(e='<br id="redactor-insert-line">'),document.execCommand("insertHTML",!1,"<hr>"+e),this.line.setFocus(),this.code.sync()},setFocus:function(){var e=this.$editor.find("#redactor-insert-line"),t=$(e).next()[0];t?(this.caret.setAfter(e),e.remove()):e.removeAttr("id")}}},link:function(){return{show:function(e){"undefined"!=typeof e&&e.preventDefault&&e.preventDefault(),this.modal.load("link",this.lang.get("link_insert"),600),this.modal.createCancelButton(),this.link.buttonInsert=this.modal.createActionButton(this.lang.get("insert")),this.selection.get(),this.link.getData(),this.link.cleanUrl(),"_blank"==this.link.target&&$("#redactor-link-blank").prop("checked",!0),this.link.$inputUrl=$("#redactor-link-url"),this.link.$inputText=$("#redactor-link-url-text"),this.link.$inputText.val(this.link.text),this.link.$inputUrl.val(this.link.url),this.link.buttonInsert.on("click",$.proxy(this.link.insert,this)),$(".redactor-link-tooltip").remove(),this.selection.save(),this.modal.show(),this.link.$inputUrl.focus()},cleanUrl:function(){var e=self.location.href.replace(/\/$/i,"");if("undefined"!=typeof this.link.url&&(this.link.url=this.link.url.replace(e,""),this.link.url=this.link.url.replace(/^\/#/,"#"),this.link.url=this.link.url.replace("mailto:",""),!this.opts.linkProtocol)){var t=new RegExp("^(http|ftp|https)://"+self.location.host,"i");this.link.url=this.link.url.replace(t,"")}},getData:function(){this.link.$node=!1;var e=$(this.selection.getCurrent()).closest("a",this.$editor[0]);0!==e.length&&"A"===e[0].tagName?(this.link.$node=e,this.link.url=e.attr("href"),this.link.text=e.text(),this.link.target=e.attr("target")):(this.link.text=this.sel.toString(),this.link.url="",this.link.target="")},insert:function(){this.placeholder.remove();var e="",t=this.link.$inputUrl.val(),i=this.link.$inputText.val();if(""===$.trim(t))return void this.link.$inputUrl.addClass("redactor-input-error").on("keyup",function(){$(this).removeClass("redactor-input-error"),$(this).off("keyup")});if(-1!=t.search("@")&&/(http|ftp|https):\/\//i.test(t)===!1)t="mailto:"+t;else if(0!==t.search("#")){$("#redactor-link-blank").prop("checked")&&(e="_blank");var r="((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\.)+[a-z]{2,}",n=new RegExp("^(http|ftp|https)://"+r,"i"),o=new RegExp("^"+r,"i"),s=new RegExp(".(html|php)$","i");-1==t.search(n)&&-1==t.search(s)&&0===t.search(o)&&this.opts.linkProtocol&&(t=this.opts.linkProtocol+"://"+t)}this.link.set(i,t,e),this.modal.close()},set:function(e,t,i){if(e=$.trim(e.replace(/<|>/g,"")),this.selection.restore(),""!==e||""!==t){if(""===e&&""!==t&&(e=t),this.link.$node){this.buffer.set();var r=this.link.$node,n=r.children();if(n.length>0){for(;n.length;)n=n.children();n=n.end()}else n=r;r.attr("href",t),n.text(e),""!==i?r.attr("target",i):r.removeAttr("target"),this.selection.selectElement(r),this.code.sync()}else{if(this.utils.browser("mozilla")&&""===this.link.text){var o=$("<a />").attr("href",t).text(e);""!==i&&o.attr("target",i),this.insert.node(o),this.selection.selectElement(o)}else{var o;this.utils.browser("msie")?(o=$('<a href="'+t+'">').text(e),""!==i&&o.attr("target",i),o=$(this.insert.node(o)),this.selection.getText().match(/\s$/)&&o.after(" "),this.selection.selectElement(o)):(document.execCommand("createLink",!1,t),o=$(this.selection.getCurrent()).closest("a",this.$editor[0]),this.utils.browser("mozilla")&&(o=$('a[_moz_dirty=""]')),""!==i&&o.attr("target",i),o.removeAttr("style").removeAttr("_moz_dirty"),this.selection.getText().match(/\s$/)&&o.after(" "),(""!==this.link.text||this.link.text!=e)&&(o.text(e),this.selection.selectElement(o)))}this.code.sync(),this.core.setCallback("insertedLink",o)}setTimeout($.proxy(function(){this.observe.links()},this),5)}},unlink:function(e){"undefined"!=typeof e&&e.preventDefault&&e.preventDefault();var t=this.selection.getNodes();if(t){this.buffer.set();for(var i=t.length,r=0;i>r;r++){var n=$(t[r]).closest("a",this.$editor[0]);n.replaceWith(n.contents())}$(".redactor-link-tooltip").remove(),this.code.sync()}},toggleClass:function(e){this.link.setClass(e,"toggleClass")},addClass:function(e){this.link.setClass(e,"addClass")},removeClass:function(e){this.link.setClass(e,"removeClass")},setClass:function(e,t){var i=this.selection.getInlinesTags(["a"]);i!==!1&&$.each(i,function(){$(this)[t](e)})}}},list:function(){return{toggle:function(e){this.placeholder.remove(),this.utils.browser("msie")||this.$editor.focus(),this.buffer.set(),this.selection.save();var t=this.selection.getParent(),i=$(t).closest("ol, ul",this.$editor[0]);this.utils.isRedactorParent(i)||0===i.length||(i=!1);var r,n,o=!1;if(i&&i.length){o=!0;var s=i[0].tagName;r="orderedlist"===e&&"UL"===s,n="unorderedlist"===e&&"OL"===s}r?this.utils.replaceToTag(i,"ol"):n?this.utils.replaceToTag(i,"ul"):o?this.list.remove(e):this.list.insert(e),this.selection.restore(),this.code.sync()},insert:function(e){var t=this.selection.getParent(),i=this.selection.getCurrent(),r=$(i).closest("td, th",this.$editor[0]);this.utils.browser("msie")&&this.opts.linebreaks?this.list.insertInIe(e):document.execCommand("insert"+e);var n=$(this.selection.getParent()).closest("ol, ul",this.$editor[0]);if(0!==r.length){var o=r.prev(),s=r.html();r.html(""),!o||1!==o.length||"TD"!==o[0].tagName&&"TH"!==o[0].tagName?$(t).prepend(r):$(o).after(r),r.html(s)}if(this.utils.isEmpty(n.find("li").text())){var a=n.children("li");a.find("br").remove(),a.append(this.selection.getMarkerAsHtml())}if(n.length){var l=n.parent();this.utils.isRedactorParent(l)&&"LI"!=l[0].tagName&&this.utils.isBlock(l[0])&&l.replaceWith(l.contents())}this.utils.browser("msie")||this.$editor.focus(),this.clean.clearUnverified()},insertInIe:function(e){var t=this.selection.wrap("div"),i=$(t).html(),r=$("orderedlist"==e?"<ol>":"<ul>"),n=$("<li>");if(""===$.trim(i))n.append(this.selection.getMarkerAsHtml()),r.append(n),this.$editor.find("#selection-marker-1").replaceWith(r);else{var o=i.split(/<br\s?\/?>/gi);if(o)for(var s=0;s<o.length;s++)""!==$.trim(o[s])&&r.append($("<li>").html(o[s]));else n.append(i),r.append(n);$(t).replaceWith(r)}},remove:function(e){document.execCommand("insert"+e);var t=$(this.selection.getCurrent());this.indent.fixEmptyIndent(),this.opts.linebreaks||0!==t.closest("li, th, td",this.$editor[0]).length||(document.execCommand("formatblock",!1,"p"),this.$editor.find("ul, ol, blockquote").each($.proxy(this.utils.removeEmpty,this)));var i=$(this.selection.getCurrent()).closest("table",this.$editor[0]),r=i.prev();this.opts.linebreaks||0===i.length||0===r.length||"BR"!=r[0].tagName||r.remove(),this.clean.clearUnverified()}}},modal:function(){return{callbacks:{},loadTemplates:function(){this.opts.modal={imageEdit:String()+'<section id="redactor-modal-image-edit"><label>'+this.lang.get("title")+'</label><input type="text" id="redactor-image-title" /><label class="redactor-image-link-option">'+this.lang.get("link")+'</label><input type="text" id="redactor-image-link" class="redactor-image-link-option" /><label class="redactor-image-link-option"><input type="checkbox" id="redactor-image-link-blank"> '+this.lang.get("link_new_tab")+'</label><label class="redactor-image-position-option">'+this.lang.get("image_position")+'</label><select class="redactor-image-position-option" id="redactor-image-align"><option value="none">'+this.lang.get("none")+'</option><option value="left">'+this.lang.get("left")+'</option><option value="center">'+this.lang.get("center")+'</option><option value="right">'+this.lang.get("right")+"</option></select></section>",image:String()+'<section id="redactor-modal-image-insert"><div id="redactor-modal-image-droparea"></div></section>',file:String()+'<section id="redactor-modal-file-insert"><div id="redactor-modal-file-upload-box"><label>'+this.lang.get("filename")+'</label><input type="text" id="redactor-filename" /><br><br><div id="redactor-modal-file-upload"></div></div></section>',link:String()+'<section id="redactor-modal-link-insert"><label>URL</label><input type="url" id="redactor-link-url" /><label>'+this.lang.get("text")+'</label><input type="text" id="redactor-link-url-text" /><label><input type="checkbox" id="redactor-link-blank"> '+this.lang.get("link_new_tab")+"</label></section>"},$.extend(this.opts,this.opts.modal)},addCallback:function(e,t){this.modal.callbacks[e]=t},createTabber:function(e){this.modal.$tabber=$("<div>").attr("id","redactor-modal-tabber"),e.prepend(this.modal.$tabber)},addTab:function(e,t,i){var r=$('<a href="#" rel="tab'+e+'">').text(t);i&&r.addClass("active");var n=this;r.on("click",function(e){e.preventDefault(),$(".redactor-tab").hide(),$(".redactor-"+$(this).attr("rel")).show(),n.modal.$tabber.find("a").removeClass("active"),$(this).addClass("active")}),this.modal.$tabber.append(r)},addTemplate:function(e,t){this.opts.modal[e]=t},getTemplate:function(e){return this.opts.modal[e]},getModal:function(){return this.$modalBody.find("section")},load:function(e,t,i){this.modal.templateName=e,this.modal.width=i,this.modal.build(),this.modal.enableEvents(),this.modal.setTitle(t),this.modal.setDraggable(),this.modal.setContent(),"undefined"!=typeof this.modal.callbacks[e]&&this.modal.callbacks[e].call(this)},show:function(){this.utils.isMobile()&&!this.utils.browser("msie")&&document.activeElement.blur(),$(document.body).removeClass("body-redactor-hidden"),
this.modal.bodyOveflow=$(document.body).css("overflow"),$(document.body).css("overflow","hidden"),this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop(),this.$modalOverlay.show(),this.$modalBox.show(),this.modal.setButtonsWidth(),this.utils.saveScroll(),this.utils.isMobile()||(setTimeout($.proxy(this.modal.showOnDesktop,this),0),$(window).on("resize.redactor-modal",$.proxy(this.modal.resize,this))),this.core.setCallback("modalOpened",this.modal.templateName,this.$modal),$(document).off("focusin.modal"),this.$modal.find("input[type=text],input[type=url],input[type=email]").on("keydown.redactor-modal",$.proxy(this.modal.setEnter,this))},showOnDesktop:function(){var e=this.$modal.outerHeight(),t=$(window).height(),i=$(window).width();return this.modal.width>i?void this.$modal.css({width:"96%",marginTop:t/2-e/2+"px"}):void this.$modal.css(e>t?{width:this.modal.width+"px",marginTop:"20px"}:{width:this.modal.width+"px",marginTop:t/2-e/2+"px"})},showOnMobile:function(){this.$modal.css({width:"96%",marginTop:"2%"})},resize:function(){this.utils.isMobile()?this.modal.showOnMobile():this.modal.showOnDesktop()},setTitle:function(e){this.$modalHeader.html(e)},setContent:function(){this.$modalBody.html(this.modal.getTemplate(this.modal.templateName))},setDraggable:function(){"undefined"!=typeof $.fn.draggable&&(this.$modal.draggable({handle:this.$modalHeader}),this.$modalHeader.css("cursor","move"))},setEnter:function(e){13==e.which&&(e.preventDefault(),this.$modal.find("button.redactor-modal-action-btn").click())},createCancelButton:function(){var e=$("<button>").addClass("redactor-modal-btn redactor-modal-close-btn").html(this.lang.get("cancel"));e.on("click",$.proxy(this.modal.close,this)),this.$modalFooter.append(e)},createDeleteButton:function(e){return this.modal.createButton(e,"delete")},createActionButton:function(e){return this.modal.createButton(e,"action")},createButton:function(e,t){var i=$("<button>").addClass("redactor-modal-btn").addClass("redactor-modal-"+t+"-btn").html(e);return this.$modalFooter.append(i),i},setButtonsWidth:function(){var e=this.$modalFooter.find("button"),t=e.length;0!==t&&e.css("width",100/t+"%")},build:function(){this.modal.buildOverlay(),this.$modalBox=$('<div id="redactor-modal-box" />').hide(),this.$modal=$('<div id="redactor-modal" />'),this.$modalHeader=$("<header />"),this.$modalClose=$('<span id="redactor-modal-close" />').html("&times;"),this.$modalBody=$('<div id="redactor-modal-body" />'),this.$modalFooter=$("<footer />"),this.$modal.append(this.$modalHeader),this.$modal.append(this.$modalClose),this.$modal.append(this.$modalBody),this.$modal.append(this.$modalFooter),this.$modalBox.append(this.$modal),this.$modalBox.appendTo(document.body)},buildOverlay:function(){this.$modalOverlay=$('<div id="redactor-modal-overlay">').hide(),$("body").prepend(this.$modalOverlay)},enableEvents:function(){this.$modalClose.on("click.redactor-modal",$.proxy(this.modal.close,this)),$(document).on("keyup.redactor-modal",$.proxy(this.modal.closeHandler,this)),this.$editor.on("keyup.redactor-modal",$.proxy(this.modal.closeHandler,this)),this.$modalBox.on("click.redactor-modal",$.proxy(this.modal.close,this))},disableEvents:function(){this.$modalClose.off("click.redactor-modal"),$(document).off("keyup.redactor-modal"),this.$editor.off("keyup.redactor-modal"),this.$modalBox.off("click.redactor-modal"),$(window).off("resize.redactor-modal")},closeHandler:function(e){e.which==this.keyCode.ESC&&this.modal.close(!1)},close:function(e){if(e){if(!$(e.target).hasClass("redactor-modal-close-btn")&&e.target!=this.$modalClose[0]&&e.target!=this.$modalBox[0])return;e.preventDefault()}this.$modalBox&&(this.modal.disableEvents(),this.$modalOverlay.remove(),this.$modalBox.fadeOut("fast",$.proxy(function(){this.$modalBox.remove(),setTimeout($.proxy(this.utils.restoreScroll,this),0),void 0!==e&&this.selection.restore(),$(document.body).css("overflow",this.modal.bodyOveflow),this.core.setCallback("modalClosed",this.modal.templateName)},this)))}}},observe:function(){return{load:function(){this.observe.images(),this.observe.links()},buttons:function(e,t){var i=this.selection.getCurrent(),r=this.selection.getParent();if(e!==!1?this.button.setInactiveAll():this.button.setInactiveAll(t),e===!1&&"html"!==t)return void(-1!=$.inArray(t,this.opts.activeButtons)&&this.button.toggleActive(t));$.each(this.opts.activeButtonsStates,$.proxy(function(e,t){var n=$(r).closest(e,this.$editor[0]),o=$(i).closest(e,this.$editor[0]);(0===n.length||this.utils.isRedactorParent(n))&&this.utils.isRedactorParent(o)&&(0!==n.length||0!==o.closest(e,this.$editor[0]).length)&&this.button.setActive(t)},this));var n=$(r).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0]);if(this.utils.isRedactorParent(r)&&n.length){var o=""===n.css("text-align")?"left":n.css("text-align");this.button.setActive("align"+o)}},addButton:function(e,t){this.opts.activeButtons.push(t),this.opts.activeButtonsStates[e]=t},images:function(){this.$editor.find("img").each($.proxy(function(e,t){var i=$(t);i.closest("a",this.$editor[0]).on("click",function(e){e.preventDefault()}),this.utils.browser("msie")&&i.attr("unselectable","on"),this.image.setEditable(i)},this)),$(document).on("click.redactor-image-delete."+this.uuid,$.proxy(function(e){this.observe.image=!1,"IMG"==e.target.tagName&&this.utils.isRedactorParent(e.target)&&(this.observe.image=this.observe.image&&this.observe.image==e.target?!1:e.target)},this))},links:function(){this.opts.linkTooltip&&(this.$editor.find("a").on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,$.proxy(this.observe.showTooltip,this)),this.$editor.on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,$.proxy(this.observe.closeTooltip,this)),$(document).on("touchstart.redactor."+this.uuid+" click.redactor."+this.uuid,$.proxy(this.observe.closeTooltip,this)))},getTooltipPosition:function(e){return e.offset()},showTooltip:function(e){var t=$(e.target);if("IMG"!=t[0].tagName&&("A"!==t[0].tagName&&(t=t.closest("a",this.$editor[0])),"A"===t[0].tagName)){var i=t,r=this.observe.getTooltipPosition(i),n=$('<span class="redactor-link-tooltip"></span>'),o=i.attr("href");void 0===o&&(o=""),o.length>24&&(o=o.substring(0,24)+"...");var s=$('<a href="'+i.attr("href")+'" target="_blank" />').html(o).addClass("redactor-link-tooltip-action"),a=$('<a href="#" />').html(this.lang.get("edit")).on("click",$.proxy(this.link.show,this)).addClass("redactor-link-tooltip-action"),l=$('<a href="#" />').html(this.lang.get("unlink")).on("click",$.proxy(this.link.unlink,this)).addClass("redactor-link-tooltip-action");n.append(s).append(" | ").append(a).append(" | ").append(l),n.css({top:r.top+parseInt(i.css("line-height"),10)+"px",left:r.left+"px"}),$(".redactor-link-tooltip").remove(),$("body").append(n)}},closeTooltip:function(e){e=e.originalEvent||e;var t=e.target,i=$(t).closest("a",this.$editor[0]);(0===i.length||"A"!==i[0].tagName||"A"===t.tagName)&&("A"===t.tagName&&this.utils.isRedactorParent(t)||$(t).hasClass("redactor-link-tooltip-action")||$(".redactor-link-tooltip").remove())}}},paragraphize:function(){return{load:function(e){return this.opts.linebreaks?e:""===e||"<p></p>"===e?this.opts.emptyHtml:(e+="\n",this.paragraphize.safes=[],this.paragraphize.z=0,e=e.replace(/(<br\s?\/?>){1,}\n?<\/blockquote>/gi,"</blockquote>"),e=this.paragraphize.getSafes(e),e=this.paragraphize.getSafesComments(e),e=this.paragraphize.replaceBreaksToNewLines(e),e=this.paragraphize.replaceBreaksToParagraphs(e),e=this.paragraphize.clear(e),e=this.paragraphize.restoreSafes(e),e=e.replace(new RegExp("<br\\s?/?>\n?<("+this.opts.paragraphizeBlocks.join("|")+")(.*?[^>])>","gi"),"<p><br /></p>\n<$1$2>"),$.trim(e))},getSafes:function(e){var t=$("<div />").append(e);return t.find("blockquote p").replaceWith(function(){return $(this).append("<br />").contents()}),e=t.html(),t.find(this.opts.paragraphizeBlocks.join(", ")).each($.proxy(function(t,i){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i.outerHTML,e=e.replace(i.outerHTML,"\n{replace"+this.paragraphize.z+"}")},this)),e},getSafesComments:function(e){var t=e.match(/<!--([\w\W]*?)-->/gi);return t?($.each(t,$.proxy(function(t,i){this.paragraphize.z++,this.paragraphize.safes[this.paragraphize.z]=i,e=e.replace(i,"\n{replace"+this.paragraphize.z+"}")},this)),e):e},restoreSafes:function(e){return $.each(this.paragraphize.safes,function(t,i){i="undefined"!=typeof i?i.replace(/\$/g,"&#36;"):i,e=e.replace("{replace"+t+"}",i)}),e},replaceBreaksToParagraphs:function(e){var t=e.split(new RegExp("\n","g"),-1);if(e="",t)for(var i=t.length,r=0;i>r;r++){if(!t.hasOwnProperty(r))return;-1==t[r].search("{replace")?(t[r]=t[r].replace(/<p>\n\t?<\/p>/gi,""),t[r]=t[r].replace(/<p><\/p>/gi,""),""!==t[r]&&(e+="<p>"+t[r].replace(/^\n+|\n+$/g,"")+"</p>")):e+=t[r]}return e},replaceBreaksToNewLines:function(e){return e=e.replace(/<br \/>\s*<br \/>/gi,"\n\n"),e=e.replace(/<br\s?\/?>\n?<br\s?\/?>/gi,"\n<br /><br />"),e=e.replace(new RegExp("\r\n","g"),"\n"),e=e.replace(new RegExp("\r","g"),"\n"),e=e.replace(new RegExp("/\n\n+/"),"g","\n\n")},clear:function(e){return e=e.replace(new RegExp("</blockquote></p>","gi"),"</blockquote>"),e=e.replace(new RegExp("<p></blockquote>","gi"),"</blockquote>"),e=e.replace(new RegExp("<p><blockquote>","gi"),"<blockquote>"),e=e.replace(new RegExp("<blockquote></p>","gi"),"<blockquote>"),e=e.replace(new RegExp("<p><p ","gi"),"<p "),e=e.replace(new RegExp("<p><p>","gi"),"<p>"),e=e.replace(new RegExp("</p></p>","gi"),"</p>"),e=e.replace(new RegExp("<p>\\s?</p>","gi"),""),e=e.replace(new RegExp("\n</p>","gi"),"</p>"),e=e.replace(new RegExp("<p>	?	?\n?<p>","gi"),"<p>"),e=e.replace(new RegExp("<p>	*</p>","gi"),"")}}},paste:function(){return{init:function(e){return this.opts.cleanOnPaste?(this.rtePaste=!0,this.buffer.set(),this.selection.save(),this.utils.saveScroll(),this.paste.createPasteBox(),$(window).on("scroll.redactor-freeze",$.proxy(function(){$(window).scrollTop(this.saveBodyScroll)},this)),void setTimeout($.proxy(function(){var e=this.$pasteBox.html();this.$pasteBox.remove(),this.selection.restore(),this.utils.restoreScroll(),this.paste.insert(e),$(window).off("scroll.redactor-freeze"),this.linkify.isEnabled()&&this.linkify.format()},this),1)):void setTimeout($.proxy(this.code.sync,this),1)},createPasteBox:function(){this.$pasteBox=$("<div>").html("").attr("contenteditable","true").css({position:"fixed",width:0,top:0,left:"-9999px"}),this.utils.browser("msie")?this.$box.append(this.$pasteBox):$("body").append(this.$pasteBox),this.$pasteBox.focus()},insert:function(e){e=this.core.setCallback("pasteBefore",e),e=this.utils.isSelectAll()?this.clean.onPaste(e,!1):this.clean.onPaste(e),e=this.core.setCallback("paste",e),this.utils.isSelectAll()?this.insert.set(e,!1):this.insert.html(e,!1),this.utils.disableSelectAll(),this.rtePaste=!1,setTimeout($.proxy(this.clean.clearUnverified,this),10),setTimeout($.proxy(function(){var e=this.$editor.find("span");$.each(e,function(e,t){var i=t.innerHTML.replace(/[\u200B-\u200D\uFEFF]/,"");""===i&&0===t.attributes.length&&$(t).remove()})},this),10)}}},placeholder:function(){return{enable:function(){this.placeholder.is()&&(this.$editor.attr("placeholder",this.$element.attr("placeholder")),this.placeholder.toggle(),this.$editor.on("keyup.redactor-placeholder",$.proxy(this.placeholder.toggle,this)))},toggle:function(){var e="removeClass";this.utils.isEmpty(this.$editor.html(),!1)&&(e="addClass"),this.$editor[e]("redactor-placeholder")},remove:function(){this.$editor.removeClass("redactor-placeholder")},is:function(){return this.opts.placeholder?this.$element.attr("placeholder",this.opts.placeholder):!("undefined"==typeof this.$element.attr("placeholder")||""===this.$element.attr("placeholder"))}}},progress:function(){return{show:function(){$(document.body).append($('<div id="redactor-progress"><span></span></div>')),$("#redactor-progress").fadeIn()},hide:function(){$("#redactor-progress").fadeOut(1500,function(){$(this).remove()})}}},selection:function(){return{get:function(){this.sel=document.getSelection(),document.getSelection&&this.sel.getRangeAt&&this.sel.rangeCount?this.range=this.sel.getRangeAt(0):this.range=document.createRange()},addRange:function(){try{this.sel.removeAllRanges()}catch(e){}this.sel.addRange(this.range)},getCurrent:function(){var e=!1;return this.selection.get(),this.sel&&this.sel.rangeCount>0&&(e=this.sel.getRangeAt(0).startContainer),this.utils.isRedactorParent(e)},getParent:function(e){return e=e||this.selection.getCurrent(),e?this.utils.isRedactorParent($(e).parent()[0]):!1},getBlock:function(e){for(e=e||this.selection.getCurrent();e;){if(this.utils.isBlockTag(e.tagName))return $(e).hasClass("redactor-editor")?!1:e;e=e.parentNode}return!1},getInlines:function(e,t){if(this.selection.get(),this.range&&this.range.collapsed)return!1;var i=[];e="undefined"==typeof e||e===!1?this.selection.getNodes():e;var r=this.opts.inlineTags;if(r.push("span"),"undefined"!=typeof t)for(var n=0;n<t.length;n++)r.push(t[n]);return $.each(e,$.proxy(function(e,t){-1!=$.inArray(t.tagName.toLowerCase(),r)&&i.push(t)},this)),0===i.length?!1:i},getInlinesTags:function(e){if(this.selection.get(),this.range&&this.range.collapsed)return!1;var t=[],i=this.selection.getNodes();return $.each(i,$.proxy(function(i,r){-1!=$.inArray(r.tagName.toLowerCase(),e)&&t.push(r)},this)),0===t.length?!1:t},getBlocks:function(e){if(this.selection.get(),this.range&&this.range.collapsed)return[this.selection.getBlock()];var t=[];return e="undefined"==typeof e?this.selection.getNodes():e,$.each(e,$.proxy(function(e,i){this.utils.isBlock(i)&&(this.selection.lastBlock=i,t.push(i))},this)),0===t.length?[this.selection.getBlock()]:t},getLastBlock:function(){return this.selection.lastBlock},getNodes:function(){this.selection.get();var e=this.selection.getNodesMarker(1),t=this.selection.getNodesMarker(2),i=this.range.cloneRange();if(this.range.collapsed===!1){var r=i.startContainer,n=i.startOffset;this.selection.setNodesMarker(i,t,!1),i.setStart(r,n),this.selection.setNodesMarker(i,e,!0)}else this.selection.setNodesMarker(i,e,!0),t=e;var o=[],s=0,a=this;this.$editor.find("*").each(function(){if(this==e){var i=$(this).parent();0!==i.length&&"BODY"!=i[0].tagName&&a.utils.isRedactorParent(i[0])&&o.push(i[0]),o.push(this),s=1}else s>0&&(o.push(this),s+=1);return this==t?!1:void 0});for(var l=[],c=o.length,d=0;c>d;d++)"nodes-marker-1"!=o[d].id&&"nodes-marker-2"!=o[d].id&&l.push(o[d]);return this.selection.removeNodesMarkers(),l},getNodesMarker:function(e){return $('<span id="nodes-marker-'+e+'" class="redactor-nodes-marker" data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},setNodesMarker:function(e,t,i){try{e.collapse(i),e.insertNode(t)}catch(r){}},removeNodesMarkers:function(){$(document).find("span.redactor-nodes-marker").remove(),this.$editor.find("span.redactor-nodes-marker").remove()},fromPoint:function(e,t){this.caret.setOffset(e,t)},wrap:function(e){if(this.selection.get(),this.range.collapsed)return!1;var t=document.createElement(e);return t.appendChild(this.range.extractContents()),this.range.insertNode(t),t},selectElement:function(e){this.caret.set(e,0,e,1)},selectAll:function(){this.selection.get(),this.range.selectNodeContents(this.$editor[0]),this.selection.addRange()},remove:function(){this.selection.get(),this.sel.removeAllRanges()},save:function(){this.selection.createMarkers()},createMarkers:function(){this.selection.get();var e=this.selection.getMarker(1);if(this.selection.setMarker(this.range,e,!0),this.range.collapsed===!1){var t=this.selection.getMarker(2);this.selection.setMarker(this.range,t,!1)}this.savedSel=this.$editor.html()},getMarker:function(e){return"undefined"==typeof e&&(e=1),$('<span id="selection-marker-'+e+'" class="redactor-selection-marker"  data-verified="redactor">'+this.opts.invisibleSpace+"</span>")[0]},getMarkerAsHtml:function(e){return this.utils.getOuterHtml(this.selection.getMarker(e))},setMarker:function(e,t,i){e=e.cloneRange();try{e.collapse(i),e.insertNode(t)}catch(r){this.focus.setStart()}},restore:function(){var e=this.$editor.find("span#selection-marker-1"),t=this.$editor.find("span#selection-marker-2");0!==e.length&&0!==t.length?this.caret.set(e,0,t,0):0!==e.length?this.caret.set(e,0,e,0):this.$editor.focus(),this.selection.removeMarkers(),this.savedSel=!1},removeMarkers:function(){this.$editor.find("span.redactor-selection-marker").each(function(e,t){var i=$(t).text().replace(/[\u200B-\u200D\uFEFF]/g,"");""===i?$(t).remove():$(t).replaceWith(function(){return $(this).contents()})})},getText:function(){return this.selection.get(),this.sel.toString()},getHtml:function(){var e="";if(this.selection.get(),this.sel.rangeCount){for(var t=document.createElement("div"),i=this.sel.rangeCount,r=0;i>r;++r)t.appendChild(this.sel.getRangeAt(r).cloneContents());e=t.innerHTML}return this.clean.onSync(e)},replaceWithHtml:function(e){if(e=this.selection.getMarkerAsHtml(1)+e+this.selection.getMarkerAsHtml(2),this.selection.get(),window.getSelection&&window.getSelection().getRangeAt){this.range.deleteContents();var t=document.createElement("div");t.innerHTML=e;for(var i=document.createDocumentFragment(),r;r=t.firstChild;)i.appendChild(r);this.range.insertNode(i)}else document.selection&&document.selection.createRange&&this.range.pasteHTML(e);this.selection.restore(),this.code.sync()}}},shortcuts:function(){return{init:function(e,t){return this.opts.shortcuts?void $.each(this.opts.shortcuts,$.proxy(function(t,i){for(var r=t.split(","),n=r.length,o=0;n>o;o++)"string"==typeof r[o]&&this.shortcuts.handler(e,$.trim(r[o]),$.proxy(function(){var e;"-1"!=i.func.search(/\./)?(e=i.func.split("."),"undefined"!=typeof this[e[0]]&&this[e[0]][e[1]].apply(this,i.params)):this[i.func].apply(this,i.params)},this))},this)):(!e.ctrlKey&&!e.metaKey||66!==t&&73!==t||e.preventDefault(),!1)},handler:function(e,t,i){var r={8:"backspace",9:"tab",10:"return",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",59:";",61:"=",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},n={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|"};t=t.toLowerCase().split(" ");var o=r[e.keyCode],s=String.fromCharCode(e.which).toLowerCase(),a="",l={};$.each(["alt","ctrl","meta","shift"],function(t,i){e[i+"Key"]&&o!==i&&(a+=i+"+")}),o&&(l[a+o]=!0),s&&(l[a+s]=!0,l[a+n[s]]=!0,"shift+"===a&&(l[n[s]]=!0));for(var c=0,d=t.length;d>c;c++)if(l[t[c]])return e.preventDefault(),i.apply(this,arguments)}}},tabifier:function(){return{get:function(e){if(!this.opts.tabifier)return e;var t=["area","body","head","hr","i?frame","link","meta","noscript","style","script","table","tbody","thead","tfoot"],i=["li","dt","dt","h[1-6]","option","script"],r=["p","blockquote","div","dl","fieldset","form","frameset","map","ol","pre","select","td","th","tr","ul"];this.tabifier.lineBefore=new RegExp("^<(/?"+t.join("|/?")+"|"+i.join("|")+")[ >]"),this.tabifier.lineAfter=new RegExp("^<(br|/?"+t.join("|/?")+"|/"+i.join("|/")+")[ >]"),this.tabifier.newLevel=new RegExp("^</?("+r.join("|")+")[ >]");var n=0,o=e.length,s=0,a=null,l=null,c="",d="",h="";for(this.tabifier.cleanlevel=0;o>n;n++){if(s=n,-1==e.substr(n).indexOf("<"))return d+=e.substr(n),this.tabifier.finish(d);for(;o>s&&"<"!=e.charAt(s);)s++;for(n!=s&&(h=e.substr(n,s-n),h.match(/^\s{2,}$/g)||("\n"==d.charAt(d.length-1)?d+=this.tabifier.getTabs():"\n"==h.charAt(0)&&(d+="\n"+this.tabifier.getTabs(),h=h.replace(/^\s+/,"")),d+=h),h.match(/\n/)&&(d+="\n"+this.tabifier.getTabs())),a=s;o>s&&">"!=e.charAt(s);)s++;c=e.substr(a,s-a),n=s;var u;if("!--"==c.substr(1,3)){if(!c.match(/--$/)){for(;"-->"!=e.substr(s,3);)s++;s+=2,c=e.substr(a,s-a),n=s}"\n"!=d.charAt(d.length-1)&&(d+="\n"),d+=this.tabifier.getTabs(),d+=c+">\n"}else"!"==c[1]?d=this.tabifier.placeTag(c+">",d):"?"==c[1]?d+=c+">\n":(u=c.match(/^<(script|style|pre)/i))?(u[1]=u[1].toLowerCase(),c=this.tabifier.cleanTag(c),d=this.tabifier.placeTag(c,d),l=String(e.substr(n+1)).toLowerCase().indexOf("</"+u[1]),l&&(h=e.substr(n+1,l),n+=l,d+=h)):(c=this.tabifier.cleanTag(c),d=this.tabifier.placeTag(c,d))}return this.tabifier.finish(d)},getTabs:function(){for(var e="",t=0;t<this.tabifier.cleanlevel;t++)e+="	";return e},finish:function(e){return e=e.replace(/\n\s*\n/g,"\n"),e=e.replace(/^[\s\n]*/,""),e=e.replace(/[\s\n]*$/,""),e=e.replace(/<script(.*?)>\n<\/script>/gi,"<script$1></script>"),this.tabifier.cleanlevel=0,e},cleanTag:function(e){var t="";e=e.replace(/\n/g," "),e=e.replace(/\s{2,}/g," "),e=e.replace(/^\s+|\s+$/g," ");var i="";e.match(/\/$/)&&(i="/",e=e.replace(/\/+$/,""));for(var r;r=/\s*([^= ]+)(?:=((['"']).*?\3|[^ ]+))?/.exec(e);)r[2]?t+=r[1].toLowerCase()+"="+r[2]:r[1]&&(t+=r[1].toLowerCase()),t+=" ",e=e.substr(r[0].length);return t.replace(/\s*$/,"")+i+">"},placeTag:function(e,t){var i=e.match(this.tabifier.newLevel);return(e.match(this.tabifier.lineBefore)||i)&&(t=t.replace(/\s*$/,""),t+="\n"),i&&"/"==e.charAt(1)&&this.tabifier.cleanlevel--,"\n"==t.charAt(t.length-1)&&(t+=this.tabifier.getTabs()),i&&"/"!=e.charAt(1)&&this.tabifier.cleanlevel++,t+=e,(e.match(this.tabifier.lineAfter)||e.match(this.tabifier.newLevel))&&(t=t.replace(/ *$/,"")),t}}},tidy:function(){return{setupAllowed:function(){if(this.opts.allowedTags&&(this.opts.deniedTags=!1),this.opts.allowedAttr&&(this.opts.removeAttr=!1),!this.opts.linebreaks){var e=["p","section"];this.opts.allowedTags&&this.tidy.addToAllowed(e),this.opts.deniedTags&&this.tidy.removeFromDenied(e)}},addToAllowed:function(e){for(var t=e.length,i=0;t>i;i++)-1==$.inArray(e[i],this.opts.allowedTags)&&this.opts.allowedTags.push(e[i])},removeFromDenied:function(e){for(var t=e.length,i=0;t>i;i++){var r=$.inArray(e[i],this.opts.deniedTags);-1!=r&&this.opts.deniedTags.splice(r,1)}},load:function(e,t){return this.tidy.settings={deniedTags:this.opts.deniedTags,allowedTags:this.opts.allowedTags,removeComments:this.opts.removeComments,replaceTags:this.opts.replaceTags,replaceStyles:this.opts.replaceStyles,removeDataAttr:this.opts.removeDataAttr,removeAttr:this.opts.removeAttr,allowedAttr:this.opts.allowedAttr,removeWithoutAttr:this.opts.removeWithoutAttr,removeEmpty:this.opts.removeEmpty},$.extend(this.tidy.settings,t),e=this.tidy.removeComments(e),this.tidy.$div=$("<div />").append(e),this.tidy.replaceTags(),this.tidy.replaceStyles(),this.tidy.removeTags(),this.tidy.removeAttr(),this.tidy.removeEmpty(),this.tidy.removeParagraphsInLists(),this.tidy.removeDataAttr(),this.tidy.removeWithoutAttr(),e=this.tidy.$div.html(),this.tidy.$div.remove(),e},removeComments:function(e){return this.tidy.settings.removeComments?e.replace(/<!--[\s\S]*?-->/gi,""):e},replaceTags:function(e){if(!this.tidy.settings.replaceTags)return e;for(var t=this.tidy.settings.replaceTags.length,i=[],r=[],n=0;t>n;n++)r.push(this.tidy.settings.replaceTags[n][1]),i.push(this.tidy.settings.replaceTags[n][0]);$.each(i,$.proxy(function(e,t){this.tidy.$div.find(t).replaceWith(function(){return $("<"+r[e]+" />",{html:$(this).html()})})},this))},replaceStyles:function(){if(this.tidy.settings.replaceStyles){var e=this.tidy.settings.replaceStyles.length;this.tidy.$div.find("span").each($.proxy(function(t,i){for(var r=$(i),n=r.attr("style"),o=0;e>o;o++)if(n&&n.match(new RegExp("^"+this.tidy.settings.replaceStyles[o][0],"i"))){var s=this.tidy.settings.replaceStyles[o][1];r.replaceWith(function(){var e=document.createElement(s);return $(e).append($(this).contents())})}},this))}},removeTags:function(){!this.tidy.settings.deniedTags&&this.tidy.settings.allowedTags&&this.tidy.$div.find("*").not(this.tidy.settings.allowedTags.join(",")).each(function(e,t){""===t.innerHTML?$(t).remove():$(t).contents().unwrap()}),this.tidy.settings.deniedTags&&this.tidy.$div.find(this.tidy.settings.deniedTags.join(",")).each(function(e,t){""===t.innerHTML?$(t).remove():$(t).contents().unwrap()})},removeAttr:function(){var e;if(!this.tidy.settings.removeAttr&&this.tidy.settings.allowedAttr){var t=[],i=[];e=this.tidy.settings.allowedAttr.length;for(var r=0;e>r;r++)t.push(this.tidy.settings.allowedAttr[r][0]),i.push(this.tidy.settings.allowedAttr[r][1]);this.tidy.$div.find("*").each($.proxy(function(e,r){var n=$(r),o=$.inArray(n[0].tagName.toLowerCase(),t),s=this.tidy.removeAttrGetRemoves(o,i,n);s&&$.each(s,function(e,t){n.removeAttr(t)})},this))}if(this.tidy.settings.removeAttr){e=this.tidy.settings.removeAttr.length;for(var r=0;e>r;r++){var n=this.tidy.settings.removeAttr[r][1];$.isArray(n)&&(n=n.join(" ")),this.tidy.$div.find(this.tidy.settings.removeAttr[r][0]).removeAttr(n)}}},removeAttrGetRemoves:function(e,t,i){var r=[];return-1==e?$.each(i[0].attributes,function(e,t){r.push(t.name)}):"*"==t[e]?r=[]:$.each(i[0].attributes,function(i,n){$.isArray(t[e])?-1==$.inArray(n.name,t[e])&&r.push(n.name):t[e]!=n.name&&r.push(n.name)}),r},removeAttrs:function(e,t){return t=new RegExp(t,"g"),e.each(function(){for(var e=$(this),i=this.attributes.length-1,r=i;r>=0;r--){var n=this.attributes[r];n&&n.specified&&n.name.search(t)>=0&&e.removeAttr(n.name)}})},removeEmpty:function(){this.tidy.settings.removeEmpty&&this.tidy.$div.find(this.tidy.settings.removeEmpty.join(",")).each(function(){var e=$(this),t=e.text();t=t.replace(/[\u200B-\u200D\uFEFF]/g,""),t=t.replace(/&nbsp;/gi,""),t=t.replace(/\s/g,""),""===t&&0===e.children().length&&e.remove()})},removeParagraphsInLists:function(){this.tidy.$div.find("li p").contents().unwrap()},removeDataAttr:function(){if(this.tidy.settings.removeDataAttr){var e=this.tidy.settings.removeDataAttr;$.isArray(this.tidy.settings.removeDataAttr)&&(e=this.tidy.settings.removeDataAttr.join(",")),this.tidy.removeAttrs(this.tidy.$div.find(e),"^(data-)")}},removeWithoutAttr:function(){this.tidy.settings.removeWithoutAttr&&this.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(",")).each(function(){0===this.attributes.length&&$(this).contents().unwrap()})}}},toolbar:function(){return{init:function(){return{html:{title:this.lang.get("html"),func:"code.toggle"},formatting:{title:this.lang.get("formatting"),dropdown:{p:{title:this.lang.get("paragraph"),func:"block.format"},blockquote:{title:this.lang.get("quote"),func:"block.format"},pre:{title:this.lang.get("code"),func:"block.format"},h1:{title:this.lang.get("header1"),func:"block.format"},h2:{title:this.lang.get("header2"),func:"block.format"},h3:{title:this.lang.get("header3"),func:"block.format"},h4:{title:this.lang.get("header4"),func:"block.format"},h5:{title:this.lang.get("header5"),func:"block.format"}}},bold:{title:this.lang.get("bold"),func:"inline.format"},italic:{title:this.lang.get("italic"),func:"inline.format"},deleted:{title:this.lang.get("deleted"),func:"inline.format"},underline:{title:this.lang.get("underline"),func:"inline.format"},unorderedlist:{title:"&bull; "+this.lang.get("unorderedlist"),func:"list.toggle"},orderedlist:{title:"1. "+this.lang.get("orderedlist"),func:"list.toggle"},outdent:{title:"< "+this.lang.get("outdent"),func:"indent.decrease"},indent:{title:"> "+this.lang.get("indent"),func:"indent.increase"},image:{title:this.lang.get("image"),func:"image.show"},file:{title:this.lang.get("file"),func:"file.show"},link:{title:this.lang.get("link"),dropdown:{link:{title:this.lang.get("link_insert"),func:"link.show"},unlink:{title:this.lang.get("unlink"),func:"link.unlink"}}},alignment:{title:this.lang.get("alignment"),dropdown:{left:{title:this.lang.get("align_left"),func:"alignment.left"},center:{title:this.lang.get("align_center"),func:"alignment.center"},right:{title:this.lang.get("align_right"),func:"alignment.right"},justify:{title:this.lang.get("align_justify"),func:"alignment.justify"}}},horizontalrule:{title:this.lang.get("horizontalrule"),func:"line.insert"}}},build:function(){this.toolbar.hideButtons(),this.toolbar.hideButtonsOnMobile(),this.toolbar.isButtonSourceNeeded(),0!==this.opts.buttons.length&&(this.$toolbar=this.toolbar.createContainer(),this.toolbar.setOverflow(),this.toolbar.append(),this.toolbar.setFormattingTags(),this.toolbar.loadButtons(),this.toolbar.setFixed(),this.opts.activeButtons&&this.$editor.on("mouseup.redactor keyup.redactor focus.redactor",$.proxy(this.observe.buttons,this)))},createContainer:function(){return $("<ul>").addClass("redactor-toolbar").attr("id","redactor-toolbar-"+this.uuid)},setFormattingTags:function(){$.each(this.opts.toolbar.formatting.dropdown,$.proxy(function(e,t){-1==$.inArray(e,this.opts.formatting)&&delete this.opts.toolbar.formatting.dropdown[e]},this))},loadButtons:function(){$.each(this.opts.buttons,$.proxy(function(e,t){if(this.opts.toolbar[t]){if("file"===t){if(this.opts.fileUpload===!1)return;if(!this.opts.fileUpload&&this.opts.s3===!1)return}if("image"===t){if(this.opts.imageUpload===!1)return;if(!this.opts.imageUpload&&this.opts.s3===!1)return}var i=this.opts.toolbar[t];this.$toolbar.append($("<li>").append(this.button.build(t,i)))}},this))},append:function(){this.opts.toolbarExternal?(this.$toolbar.addClass("redactor-toolbar-external"),$(this.opts.toolbarExternal).html(this.$toolbar)):this.$box.prepend(this.$toolbar)},setFixed:function(){this.utils.isDesktop()&&(this.opts.toolbarExternal||this.opts.toolbarFixed&&(this.toolbar.observeScroll(),$(this.opts.toolbarFixedTarget).on("scroll.redactor."+this.uuid,$.proxy(this.toolbar.observeScroll,this))))},setOverflow:function(){this.utils.isMobile()&&this.opts.toolbarOverflow&&this.$toolbar.addClass("redactor-toolbar-overflow")},isButtonSourceNeeded:function(){if(!this.opts.source){var e=this.opts.buttons.indexOf("html");-1!==e&&this.opts.buttons.splice(e,1)}},hideButtons:function(){0!==this.opts.buttonsHide.length&&$.each(this.opts.buttonsHide,$.proxy(function(e,t){var i=this.opts.buttons.indexOf(t);this.opts.buttons.splice(i,1)},this))},hideButtonsOnMobile:function(){this.utils.isMobile()&&0!==this.opts.buttonsHideOnMobile.length&&$.each(this.opts.buttonsHideOnMobile,$.proxy(function(e,t){var i=this.opts.buttons.indexOf(t);this.opts.buttons.splice(i,1)},this))},observeScroll:function(){var e=$(this.opts.toolbarFixedTarget).scrollTop(),t=1;this.opts.toolbarFixedTarget===document&&(t=this.$box.offset().top),e>t?this.toolbar.observeScrollEnable(e,t):this.toolbar.observeScrollDisable()},observeScrollEnable:function(e,t){var i=this.opts.toolbarFixedTopOffset+e-t,r=0,n=t+this.$box.height()-32,o=this.$box.innerWidth();this.$toolbar.addClass("toolbar-fixed-box"),this.$toolbar.css({position:"absolute",width:o,top:i+"px",left:r}),e>n&&$(".redactor-dropdown-"+this.uuid+":visible").hide(),this.toolbar.setDropdownsFixed(),this.$toolbar.css("visibility",n>e?"visible":"hidden")},observeScrollDisable:function(){this.$toolbar.css({position:"relative",width:"auto",top:0,left:0,visibility:"visible"}),this.toolbar.unsetDropdownsFixed(),this.$toolbar.removeClass("toolbar-fixed-box")},setDropdownsFixed:function(){var e=this.$toolbar.innerHeight()+this.opts.toolbarFixedTopOffset,t="fixed";this.opts.toolbarFixedTarget!==document&&(e=this.$toolbar.innerHeight()+this.$toolbar.offset().top+this.opts.toolbarFixedTopOffset,t="absolute"),$(".redactor-dropdown-"+this.uuid).each(function(){$(this).css({position:t,top:e+"px"})})},unsetDropdownsFixed:function(){var e=this.$toolbar.innerHeight()+this.$toolbar.offset().top;$(".redactor-dropdown-"+this.uuid).each(function(){$(this).css({position:"absolute",top:e+"px"})})}}},upload:function(){return{init:function(e,t,i){this.upload.direct=!1,this.upload.callback=i,this.upload.url=t,this.upload.$el=$(e),this.upload.$droparea=$('<div id="redactor-droparea" />'),this.upload.$placeholdler=$('<div id="redactor-droparea-placeholder" />').text(this.lang.get("upload_label")),
this.upload.$input=$('<input type="file" name="file" />'),this.upload.$placeholdler.append(this.upload.$input),this.upload.$droparea.append(this.upload.$placeholdler),this.upload.$el.append(this.upload.$droparea),this.upload.$droparea.off("redactor.upload"),this.upload.$input.off("redactor.upload"),this.upload.$droparea.on("dragover.redactor.upload",$.proxy(this.upload.onDrag,this)),this.upload.$droparea.on("dragleave.redactor.upload",$.proxy(this.upload.onDragLeave,this)),this.upload.$input.on("change.redactor.upload",$.proxy(function(e){e=e.originalEvent||e,this.upload.traverseFile(this.upload.$input[0].files[0],e)},this)),this.upload.$droparea.on("drop.redactor.upload",$.proxy(function(e){e.preventDefault(),this.upload.$droparea.removeClass("drag-hover").addClass("drag-drop"),this.upload.onDrop(e)},this))},directUpload:function(e,t){this.upload.direct=!0,this.upload.traverseFile(e,t)},onDrop:function(e){e=e.originalEvent||e;var t=e.dataTransfer.files;this.upload.traverseFile(t[0],e)},traverseFile:function(e,t){if(this.opts.s3)return this.upload.setConfig(e),void this.upload.s3uploadFile(e);var i=window.FormData?new FormData:null;if(window.FormData){this.upload.setConfig(e);var r="image"==this.upload.type?this.opts.imageUploadParam:this.opts.fileUploadParam;i.append(r,e)}this.progress.show(),this.core.setCallback("uploadStart",t,i),this.upload.sendData(i,t)},setConfig:function(e){this.upload.getType(e),this.upload.direct&&(this.upload.url="image"==this.upload.type?this.opts.imageUpload:this.opts.fileUpload,this.upload.callback="image"==this.upload.type?this.image.insert:this.file.insert)},getType:function(e){this.upload.type="image",-1==this.opts.imageTypes.indexOf(e.type)&&(this.upload.type="file")},getHiddenFields:function(e,t){return e===!1||"object"!=typeof e?t:($.each(e,$.proxy(function(e,i){null!==i&&0===i.toString().indexOf("#")&&(i=$(i).val()),t.append(e,i)},this)),t)},sendData:function(e,t){"image"==this.upload.type?(e=this.upload.getHiddenFields(this.opts.uploadImageFields,e),e=this.upload.getHiddenFields(this.upload.imageFields,e)):(e=this.upload.getHiddenFields(this.opts.uploadFileFields,e),e=this.upload.getHiddenFields(this.upload.fileFields,e));var i=new XMLHttpRequest;i.open("POST",this.upload.url),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),i.onreadystatechange=$.proxy(function(){if(4==i.readyState){var e=i.responseText;e=e.replace(/^\[/,""),e=e.replace(/\]$/,"");var r;try{r="string"==typeof e?$.parseJSON(e):e}catch(n){r={error:!0}}this.progress.hide(),this.upload.direct||this.upload.$droparea.removeClass("drag-drop"),this.upload.callback(r,this.upload.direct,t)}},this),i.send(e)},onDrag:function(e){e.preventDefault(),this.upload.$droparea.addClass("drag-hover")},onDragLeave:function(e){e.preventDefault(),this.upload.$droparea.removeClass("drag-hover")},clearImageFields:function(){this.upload.imageFields={}},addImageFields:function(e,t){this.upload.imageFields[e]=t},removeImageFields:function(e){delete this.upload.imageFields[e]},clearFileFields:function(){this.upload.fileFields={}},addFileFields:function(e,t){this.upload.fileFields[e]=t},removeFileFields:function(e){delete this.upload.fileFields[e]},s3uploadFile:function(e){this.upload.s3executeOnSignedUrl(e,$.proxy(function(t){this.upload.s3uploadToS3(e,t)},this))},s3executeOnSignedUrl:function(e,t){var i=new XMLHttpRequest,r="?";"-1"!=this.opts.s3.search(/\?/)&&(r="&"),i.open("GET",this.opts.s3+r+"name="+e.name+"&type="+e.type,!0),i.overrideMimeType&&i.overrideMimeType("text/plain; charset=x-user-defined");var n=this;i.onreadystatechange=function(e){4==this.readyState&&200==this.status?(n.progress.show(),t(decodeURIComponent(this.responseText))):4==this.readyState&&200!=this.status},i.send()},s3createCORSRequest:function(e,t){var i=new XMLHttpRequest;return"withCredentials"in i?i.open(e,t,!0):"undefined"!=typeof XDomainRequest?(i=new XDomainRequest,i.open(e,t)):i=null,i},s3uploadToS3:function(e,t){var i=this.upload.s3createCORSRequest("PUT",t);i&&(i.onload=$.proxy(function(){if(200==i.status){this.progress.hide();var e=t.split("?");if(!e[0])return!1;this.upload.direct||this.upload.$droparea.removeClass("drag-drop");var r={filelink:e[0]};if("file"==this.upload.type){var n=e[0].split("/");r.filename=n[n.length-1]}this.upload.callback(r,this.upload.direct,!1)}},this),i.onerror=function(){},i.upload.onprogress=function(e){},i.setRequestHeader("Content-Type",e.type),i.setRequestHeader("x-amz-acl","public-read"),i.send(e))}}},utils:function(){return{isMobile:function(){return/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)},isDesktop:function(){return!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent)},isString:function(e){return"[object String]"==Object.prototype.toString.call(e)},isEmpty:function(e,t){return e=e.replace(/[\u200B-\u200D\uFEFF]/g,""),e=e.replace(/&nbsp;/gi,""),e=e.replace(/<\/?br\s?\/?>/g,""),e=e.replace(/\s/g,""),e=e.replace(/^<p>[^\W\w\D\d]*?<\/p>$/i,""),e=e.replace(/<iframe(.*?[^>])>$/i,"iframe"),e=e.replace(/<source(.*?[^>])>$/i,"source"),t!==!1&&(e=e.replace(/<[^\/>][^>]*><\/[^>]+>/gi,""),e=e.replace(/<[^\/>][^>]*><\/[^>]+>/gi,"")),e=$.trim(e),""===e},normalize:function(e){return"undefined"==typeof e?0:parseInt(e.replace("px",""),10)},hexToRgb:function(e){if("undefined"!=typeof e){if(-1==e.search(/^#/))return e;var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(t,function(e,t,i,r){return t+t+i+i+r+r});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return"rgb("+parseInt(i[1],16)+", "+parseInt(i[2],16)+", "+parseInt(i[3],16)+")"}},getOuterHtml:function(e){return $("<div>").append($(e).eq(0).clone()).html()},getAlignmentElement:function(e){return-1!==$.inArray(e.tagName,this.opts.alignmentTags)?$(e):$(e).closest(this.opts.alignmentTags.toString().toLowerCase(),this.$editor[0])},removeEmptyAttr:function(e,t){var i=$(e);return"undefined"==typeof i.attr(t)?!0:""===i.attr(t)?(i.removeAttr(t),!0):!1},removeEmpty:function(e,t){var i=$($.parseHTML(t));if(i.find(".redactor-invisible-space").removeAttr("style").removeAttr("class"),0===i.find("hr, br, img, iframe, source").length){var r=$.trim(i.text());this.utils.isEmpty(r,!1)&&i.remove()}},saveScroll:function(){this.saveEditorScroll=this.$editor.scrollTop(),this.saveBodyScroll=$(window).scrollTop(),this.opts.scrollTarget&&(this.saveTargetScroll=$(this.opts.scrollTarget).scrollTop())},restoreScroll:function(){("undefined"!=typeof this.saveScroll||"undefined"!=typeof this.saveBodyScroll)&&($(window).scrollTop(this.saveBodyScroll),this.$editor.scrollTop(this.saveEditorScroll),this.opts.scrollTarget&&$(this.opts.scrollTarget).scrollTop(this.saveTargetScroll))},createSpaceElement:function(){var e=document.createElement("span");return e.className="redactor-invisible-space",e.innerHTML=this.opts.invisibleSpace,e},removeInlineTags:function(e){var t=this.opts.inlineTags;t.push("span"),"PRE"==e.tagName&&t.push("a"),$(e).find(t.join(",")).not("span.redactor-selection-marker").contents().unwrap()},replaceWithContents:function(e,t){var i=this;return $(e).replaceWith(function(){return t===!0&&i.utils.removeInlineTags(this),$(this).contents()}),$(e)},replaceToTag:function(e,t,i){var r,n=this;return $(e).replaceWith(function(){r=$("<"+t+" />").append($(this).contents());for(var e=0;e<this.attributes.length;e++)r.attr(this.attributes[e].name,this.attributes[e].value);return i===!0&&n.utils.removeInlineTags(r),r}),r},isStartOfElement:function(){var e=this.selection.getBlock();if(!e)return!1;var t=this.caret.getOffsetOfElement(e);return 0===t?!0:!1},isEndOfElement:function(e){if("undefined"==typeof e){var e=this.selection.getBlock();if(!e)return!1}var t=this.caret.getOffsetOfElement(e),i=$.trim($(e).text()).replace(/\n\r\n/g,"");return t==i.length?!0:!1},isEndOfEditor:function(){var e=this.$editor[0],t=this.caret.getOffsetOfElement(e),i=$.trim($(e).html().replace(/(<([^>]+)>)/gi,""));return t==i.length?!0:!1},isBlock:function(e){return e=e[0]||e,e&&this.utils.isBlockTag(e.tagName)},isBlockTag:function(e){return"undefined"==typeof e?!1:this.reIsBlock.test(e)},isTag:function(e,t){var i=$(e).closest(t,this.$editor[0]);return 1==i.length?i[0]:!1},isSelectAll:function(){return this.selectAll},enableSelectAll:function(){this.selectAll=!0},disableSelectAll:function(){this.selectAll=!1},isRedactorParent:function(e){return e?0===$(e).parents(".redactor-editor").length||$(e).hasClass("redactor-editor")?!1:e:!1},isCurrentOrParentHeader:function(){return this.utils.isCurrentOrParent(["H1","H2","H3","H4","H5","H6"])},isCurrentOrParent:function(e){var t=this.selection.getParent(),i=this.selection.getCurrent();if($.isArray(e)){var r=0;return $.each(e,$.proxy(function(e,n){this.utils.isCurrentOrParentOne(i,t,n)&&r++},this)),0===r?!1:!0}return this.utils.isCurrentOrParentOne(i,t,e)},isCurrentOrParentOne:function(e,t,i){return i=i.toUpperCase(),t&&t.tagName===i?t:e&&e.tagName===i?e:!1},isOldIe:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<9?!0:!1},isLessIe10:function(){return this.utils.browser("msie")&&parseInt(this.utils.browser("version"),10)<10?!0:!1},isIe11:function(){return!!navigator.userAgent.match(/Trident\/7\./)},browser:function(e){var t=navigator.userAgent.toLowerCase(),i=/(opr)[\/]([\w.]+)/.exec(t)||/(chrome)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(t)||/(webkit)[ \/]([\w.]+)/.exec(t)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(t)||/(msie) ([\w.]+)/.exec(t)||t.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(t)||t.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(t)||[];return"safari"==e?"undefined"!=typeof i[3]?"safari"==i[3]:!1:"version"==e?i[2]:"webkit"==e?"chrome"==i[1]||"opr"==i[1]||"webkit"==i[1]:"rv"==i[1]?"msie"==e:"opr"==i[1]?"webkit"==e:e==i[1]}}},linkify:function(){return{isKey:function(e){return e==this.keyCode.ENTER||e==this.keyCode.SPACE},isEnabled:function(){return this.opts.convertLinks&&(this.opts.convertUrlLinks||this.opts.convertImageLinks||this.opts.convertVideoLinks)&&!this.utils.isCurrentOrParent("PRE")},format:function(){var e=this.linkify,t=this.opts;this.$editor.find(":not(iframe,img,a,pre)").addBack().contents().filter(function(){return 3===this.nodeType&&""!=$.trim(this.nodeValue)&&!$(this).parent().is("pre")&&(this.nodeValue.match(t.linkify.regexps.youtube)||this.nodeValue.match(t.linkify.regexps.vimeo)||this.nodeValue.match(t.linkify.regexps.image)||this.nodeValue.match(t.linkify.regexps.url))}).each(function(){var i=$(this).text(),r=i;t.convertVideoLinks&&(r.match(t.linkify.regexps.youtube)||r.match(t.linkify.regexps.vimeo))?r=e.convertVideoLinks(r):t.convertImageLinks&&r.match(t.linkify.regexps.image)?r=e.convertImages(r):t.convertUrlLinks&&(r=e.convertLinks(r)),$(this).before(i.replace(i,r)).remove()}),this.linkify.after()},convertVideoLinks:function(e){var t='<iframe width="500" height="281" src="',i='" frameborder="0" allowfullscreen></iframe>';return e.match(this.opts.linkify.regexps.youtube)&&(e=e.replace(this.opts.linkify.regexps.youtube,t+"//www.youtube.com/embed/$1"+i)),e.match(this.opts.linkify.regexps.vimeo)&&(e=e.replace(this.opts.linkify.regexps.vimeo,t+"//player.vimeo.com/video/$2"+i)),e},convertImages:function(e){var t=e.match(this.opts.linkify.regexps.image);return t&&(e=e.replace(e,'<img src="'+t+'" />')),e},convertLinks:function(e){var t=e.match(this.opts.linkify.regexps.url);if(t){t=$.grep(t,function(e,i){return $.inArray(e,t)===i});for(var i=t.length,r=0;i>r;r++){var n=t[r],o=n,s=this.opts.linkProtocol+"://";null!==n.match(/(https?|ftp):\/\//i)&&(s=""),o.length>this.opts.linkSize&&(o=o.substring(0,this.opts.linkSize)+"..."),o=decodeURIComponent(o);var a="\\b";-1!=$.inArray(n.slice(-1),["/","&","="])&&(a="");var l=new RegExp("("+n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+a+")","g");e=e.replace(l,'<a href="'+s+$.trim(n)+'">'+$.trim(o)+"</a>")}}return e},after:function(){this.observe.load(),this.code.sync()}}}},$(window).on("load.tools.redactor",function(){$('[data-tools="redactor"]').redactor()}),e.prototype.init.prototype=e.prototype}(jQuery),!RedactorPlugins)var RedactorPlugins={};if(function($){RedactorPlugins.table=function(){return{getTemplate:function(){return String()+'<section id="redactor-modal-table-insert"><label>'+this.lang.get("rows")+'</label><input type="text" size="5" value="2" id="redactor-table-rows" /><label>'+this.lang.get("columns")+'</label><input type="text" size="5" value="3" id="redactor-table-columns" /></section>'},init:function(){var e={};e.insert_table={title:this.lang.get("insert_table"),func:this.table.show},e.insert_row_above={title:this.lang.get("insert_row_above"),func:this.table.addRowAbove},e.insert_row_below={title:this.lang.get("insert_row_below"),func:this.table.addRowBelow},e.insert_column_left={title:this.lang.get("insert_column_left"),func:this.table.addColumnLeft},e.insert_column_right={title:this.lang.get("insert_column_right"),func:this.table.addColumnRight},e.add_head={title:this.lang.get("add_head"),func:this.table.addHead},e.delete_head={title:this.lang.get("delete_head"),func:this.table.deleteHead},e.delete_column={title:this.lang.get("delete_column"),func:this.table.deleteColumn},e.delete_row={title:this.lang.get("delete_row"),func:this.table.deleteRow},e.delete_table={title:this.lang.get("delete_table"),func:this.table.deleteTable},this.observe.addButton("td","table"),this.observe.addButton("th","table");var t=this.button.addBefore("link","table",this.lang.get("table"));this.button.addDropdown(t,e)},show:function(){this.modal.addTemplate("table",this.table.getTemplate()),this.modal.load("table",this.lang.get("insert_table"),300),this.modal.createCancelButton();var e=this.modal.createActionButton(this.lang.get("insert"));e.on("click",this.table.insert),this.selection.save(),this.modal.show(),$("#redactor-table-rows").focus()},insert:function(){var e=$("#redactor-table-rows").val(),t=$("#redactor-table-columns").val(),i=$("<div>"),r=Math.floor(99999*Math.random()),n=$('<table id="table'+r+'"><tbody></tbody></table>'),o,s,a,l;for(o=0;e>o;o++){for(s=$("<tr>"),a=0;t>a;a++)l=$("<td>"+this.opts.invisibleSpace+"</td>"),0===o&&0===a&&l.append(this.selection.getMarker()),$(s).append(l);n.append(s)}i.append(n);var c=i.html();if(this.modal.close(),this.selection.restore(),!this.table.getTable()){this.buffer.set();var d=this.selection.getBlock()||this.selection.getCurrent();d&&"BODY"!=d.tagName?("LI"==d.tagName&&(d=$(d).closest("ul, ol")),$(d).after(c)):this.insert.html(c),this.selection.restore();var h=this.$editor.find("#table"+r);if(!this.opts.linebreaks&&(this.utils.browser("mozilla")||this.utils.browser("msie"))){var u=h.next();0===u.length&&h.after(this.opts.emptyHtml)}this.observe.buttons(),h.find("span.redactor-selection-marker").remove(),h.removeAttr("id"),this.code.sync(),this.core.setCallback("insertedTable",h)}},getTable:function(){var e=$(this.selection.getParent()).closest("table");return this.utils.isRedactorParent(e)?0===e.size()?!1:e:!1},restoreAfterDelete:function(e){this.selection.restore(),e.find("span.redactor-selection-marker").remove(),this.code.sync()},deleteTable:function(){var e=this.table.getTable();if(e){this.buffer.set();var t=e.next();this.opts.linebreaks||0===t.length?this.caret.setAfter(e):this.caret.setStart(t),e.remove(),this.code.sync()}},deleteRow:function(){var e=this.table.getTable();if(e){var t=$(this.selection.getCurrent());this.buffer.set();var i=t.closest("tr"),r=i.prev().length?i.prev():i.next();if(r.length){var n=r.children("td, th").first();n.length&&n.prepend(this.selection.getMarker())}i.remove(),this.table.restoreAfterDelete(e)}},deleteColumn:function(){var e=this.table.getTable();if(e){this.buffer.set();var t=$(this.selection.getCurrent()),i=t.closest("td, th"),r=i[0].cellIndex;e.find("tr").each($.proxy(function(e,t){var i=$(t),n=0>r-1?r+1:r-1;0===e&&i.find("td, th").eq(n).prepend(this.selection.getMarker()),i.find("td, th").eq(r).remove()},this)),this.table.restoreAfterDelete(e)}},addHead:function(){var e=this.table.getTable();if(e){if(this.buffer.set(),0!==e.find("thead").size())return void this.table.deleteHead();var t=e.find("tr").first().clone();t.find("td").replaceWith($.proxy(function(){return $("<th>").html(this.opts.invisibleSpace)},this)),$thead=$("<thead></thead>").append(t),e.prepend($thead),this.code.sync()}},deleteHead:function(){var e=this.table.getTable();if(e){var t=e.find("thead");0!==t.size()&&(this.buffer.set(),t.remove(),this.code.sync())}},addRowAbove:function(){this.table.addRow("before")},addRowBelow:function(){this.table.addRow("after")},addColumnLeft:function(){this.table.addColumn("before")},addColumnRight:function(){this.table.addColumn("after")},addRow:function(e){var t=this.table.getTable();if(t){this.buffer.set();var i=$(this.selection.getCurrent()),r=i.closest("tr"),n=r.clone();n.find("th").replaceWith(function(){var e=$("<td>");return e[0].attributes=this.attributes,e.append($(this).contents())}),n.find("td").html(this.opts.invisibleSpace),"after"==e?r.after(n):r.before(n),this.code.sync()}},addColumn:function(e){var t=this.table.getTable();if(t){var i=0,r=$(this.selection.getCurrent());this.buffer.set();var n=r.closest("tr"),o=r.closest("td, th");n.find("td, th").each($.proxy(function(e,t){$(t)[0]===o[0]&&(i=e)},this)),t.find("tr").each($.proxy(function(t,r){var n=$(r).find("td, th").eq(i),o=n.clone();o.html(this.opts.invisibleSpace),"after"==e?n.after(o):n.before(o)},this)),this.code.sync()}}}}}(jQuery),!RedactorPlugins)var RedactorPlugins={};if(function($){RedactorPlugins.video=function(){return{reUrlYoutube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,reUrlVimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,getTemplate:function(){return String()+'<section id="redactor-modal-video-insert"><label>'+this.lang.get("video_html_code")+'</label><textarea id="redactor-insert-video-area" style="height: 160px;"></textarea></section>'},init:function(){var e=this.button.addAfter("image","video",this.lang.get("video"));this.button.addCallback(e,this.video.show)},show:function(){this.modal.addTemplate("video",this.video.getTemplate()),this.modal.load("video",this.lang.get("video"),700),this.modal.createCancelButton();var e=this.modal.createActionButton(this.lang.get("insert"));e.on("click",this.video.insert),this.selection.save(),this.modal.show(),$("#redactor-insert-video-area").focus()},insert:function(){var e=$("#redactor-insert-video-area").val();if(!e.match(/<iframe|<video/gi)){e=this.clean.stripTags(e);var t='<iframe style="width: 500px; height: 281px;" src="',i='" frameborder="0" allowfullscreen></iframe>';e.match(this.video.reUrlYoutube)?e=e.replace(this.video.reUrlYoutube,t+"//www.youtube.com/embed/$1"+i):e.match(this.video.reUrlVimeo)&&(e=e.replace(this.video.reUrlVimeo,t+"//player.vimeo.com/video/$2"+i))}this.selection.restore(),this.modal.close();var r=this.selection.getBlock()||this.selection.getCurrent();r?$(r).after(e):this.insert.html(e),this.code.sync()}}}}(jQuery),!RedactorPlugins)var RedactorPlugins={};if(function($){RedactorPlugins.imagemanager=function(){return{init:function(){this.opts.imageManagerJson&&this.modal.addCallback("image",this.imagemanager.load)},load:function(){var e=this.modal.getModal();this.modal.createTabber(e),this.modal.addTab(1,"Upload","active"),this.modal.addTab(2,"Choose"),$("#redactor-modal-image-droparea").addClass("redactor-tab redactor-tab1");var t=$('<div id="redactor-image-manager-box" style="overflow: auto; height: 300px;" class="redactor-tab redactor-tab2">').hide();e.append(t),$.ajax({dataType:"json",cache:!1,url:this.opts.imageManagerJson,success:$.proxy(function(e){$.each(e,$.proxy(function(e,t){var i="";"undefined"!=typeof t.title&&(i=t.title);var r=$('<img src="'+t.thumb+'" rel="'+t.image+'" title="'+i+'" style="width: 100px; height: 75px; cursor: pointer;" />');$("#redactor-image-manager-box").append(r),$(r).click($.proxy(this.imagemanager.insert,this))},this))},this)})},insert:function(e){this.image.insert('<img src="'+$(e.target).attr("rel")+'" alt="'+$(e.target).attr("title")+'">')}}}}(jQuery),!RedactorPlugins)var RedactorPlugins={};!function($){RedactorPlugins.filemanager=function(){return{init:function(){this.opts.fileManagerJson&&this.modal.addCallback("file",this.filemanager.load)},load:function(){var e=this.modal.getModal();this.modal.createTabber(e),this.modal.addTab(1,"Upload","active"),this.modal.addTab(2,"Choose"),$("#redactor-modal-file-upload-box").addClass("redactor-tab redactor-tab1");var t=$('<div id="redactor-file-manager-box" style="overflow: auto; height: 300px;" class="redactor-tab redactor-tab2">').hide();e.append(t),$.ajax({dataType:"json",cache:!1,url:this.opts.fileManagerJson,success:$.proxy(function(e){var t=$('<ul id="redactor-modal-list">');$.each(e,$.proxy(function(e,i){var r=$('<a href="#" title="'+i.title+'" rel="'+i.link+'" class="redactor-file-manager-link">'+i.title+' <span style="font-size: 11px; color: #888;">'+i.name+'</span> <span style="position: absolute; right: 10px; font-size: 11px; color: #888;">('+i.size+")</span></a>"),n=$("<li />");r.on("click",$.proxy(this.filemanager.insert,this)),n.append(r),t.append(n)},this)),$("#redactor-file-manager-box").append(t)},this)})},insert:function(e){e.preventDefault();var t=$(e.target).closest(".redactor-file-manager-link");this.file.insert('<a href="'+t.attr("rel")+'">'+t.attr("title")+"</a>")}}}}(jQuery),function(e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else{if("function"==typeof define&&define.amd)return define([],e);this.CodeMirror=e()}}(function(){function e(i,r){if(!(this instanceof e))return new e(i,r);this.options=r=r||{},on(wo,r,!1),p(r);var n=r.value;"string"==typeof n&&(n=new qo(n,r.mode)),this.doc=n;var o=this.display=new t(i,n);o.wrapper.CodeMirror=this,d(this),l(this),r.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),r.autofocus&&!Zn&&pt(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new Qr},Bn&&setTimeout(sn(ft,this,!0),20),vt(this),kn();var s=this;Qe(this,function(){s.curOp.forceUpdate=!0,br(s,n),r.autofocus&&!Zn||pn()==o.input?setTimeout(sn(Ft,s),20):Wt(s);for(var e in xo)xo.hasOwnProperty(e)&&xo[e](s,r[e],Co);for(var t=0;t<Ao.length;++t)Ao[t](s)})}function t(e,t){var i=this,r=i.input=dn("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none");Un?r.style.width="1000px":r.setAttribute("wrap","off"),Jn&&(r.style.border="1px solid black"),r.setAttribute("autocorrect","off"),r.setAttribute("autocapitalize","off"),r.setAttribute("spellcheck","false"),i.inputDiv=dn("div",[r],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),i.scrollbarH=dn("div",[dn("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar"),i.scrollbarV=dn("div",[dn("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),i.scrollbarFiller=dn("div",null,"CodeMirror-scrollbar-filler"),i.gutterFiller=dn("div",null,"CodeMirror-gutter-filler"),i.lineDiv=dn("div",null,"CodeMirror-code"),i.selectionDiv=dn("div",null,null,"position: relative; z-index: 1"),i.cursorDiv=dn("div",null,"CodeMirror-cursors"),i.measure=dn("div",null,"CodeMirror-measure"),i.lineMeasure=dn("div",null,"CodeMirror-measure"),i.lineSpace=dn("div",[i.measure,i.lineMeasure,i.selectionDiv,i.cursorDiv,i.lineDiv],null,"position: relative; outline: none"),i.mover=dn("div",[dn("div",[i.lineSpace],"CodeMirror-lines")],null,"position: relative"),i.sizer=dn("div",[i.mover],"CodeMirror-sizer"),i.heightForcer=dn("div",null,null,"position: absolute; height: "+is+"px; width: 1px;"),i.gutters=dn("div",null,"CodeMirror-gutters"),i.lineGutter=null,i.scroller=dn("div",[i.sizer,i.heightForcer,i.gutters],"CodeMirror-scroll"),i.scroller.setAttribute("tabIndex","-1"),i.wrapper=dn("div",[i.inputDiv,i.scrollbarH,i.scrollbarV,i.scrollbarFiller,i.gutterFiller,i.scroller],"CodeMirror"),In&&(i.gutters.style.zIndex=-1,i.scroller.style.paddingRight=0),Jn&&(r.style.width="0px"),Un||(i.scroller.draggable=!0),Xn&&(i.inputDiv.style.height="1px",i.inputDiv.style.position="absolute"),In&&(i.scrollbarH.style.minHeight=i.scrollbarV.style.minWidth="18px"),e.appendChild?e.appendChild(i.wrapper):e(i.wrapper),i.viewFrom=i.viewTo=t.first,i.view=[],i.externalMeasured=null,i.viewOffset=0,i.lastSizeC=0,i.updateLineNumbers=null,i.lineNumWidth=i.lineNumInnerWidth=i.lineNumChars=null,i.prevInput="",i.alignWidgets=!1,i.pollingFast=!1,i.poll=new Qr,i.cachedCharWidth=i.cachedTextHeight=i.cachedPaddingH=null,i.inaccurateSelection=!1,i.maxLine=null,i.maxLineLength=0,i.maxLineChanged=!1,i.wheelDX=i.wheelDY=i.wheelStartX=i.wheelStartY=null,i.shift=!1,i.selForContextMenu=null}function i(t){t.doc.mode=e.getMode(t.options,t.doc.modeOption),r(t)}function r(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.frontier=e.doc.first,ye(e,100),e.state.modeGen++,e.curOp&&rt(e)}function n(e){e.options.lineWrapping?(vn(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth=""):(mn(e.display.wrapper,"CodeMirror-wrap"),f(e)),s(e),rt(e),Re(e),setTimeout(function(){m(e)},100)}function o(e){var t=Ke(e.display),i=e.options.lineWrapping,r=i&&Math.max(5,e.display.scroller.clientWidth/Ge(e.display)-3);return function(n){if(qi(e.doc,n))return 0;var o=0;if(n.widgets)for(var s=0;s<n.widgets.length;s++)n.widgets[s].height&&(o+=n.widgets[s].height);return i?o+(Math.ceil(n.text.length/r)||1)*t:o+t}}function s(e){var t=e.doc,i=o(e);t.iter(function(e){var t=i(e);t!=e.height&&xr(e,t)})}function a(e){var t=Oo[e.options.keyMap],i=t.style;e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(i?" cm-keymap-"+i:"")}function l(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Re(e)}function c(e){d(e),rt(e),setTimeout(function(){b(e)},20)}function d(e){var t=e.display.gutters,i=e.options.gutters;hn(t);for(var r=0;r<i.length;++r){var n=i[r],o=t.appendChild(dn("div",null,"CodeMirror-gutter "+n));"CodeMirror-linenumbers"==n&&(e.display.lineGutter=o,o.style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=r?"":"none",h(e)}function h(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px",e.display.scrollbarH.style.left=e.options.fixedGutter?t+"px":0}function u(e){if(0==e.height)return 0;for(var t=e.text.length,i,r=e;i=Bi(r);){var n=i.find(0,!0);r=n.from.line,t+=n.from.ch-n.to.ch}for(r=e;i=Ii(r);){var n=i.find(0,!0);t-=r.text.length-n.from.ch,r=n.to.line,t+=r.text.length-n.to.ch}return t}function f(e){var t=e.display,i=e.doc;t.maxLine=yr(i,i.first),t.maxLineLength=u(t.maxLine),t.maxLineChanged=!0,i.iter(function(e){var i=u(e);i>t.maxLineLength&&(t.maxLineLength=i,t.maxLine=e)})}function p(e){var t=tn(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function g(e){var t=e.display.scroller;return{clientHeight:t.clientHeight,barHeight:e.display.scrollbarV.clientHeight,scrollWidth:t.scrollWidth,clientWidth:t.clientWidth,barWidth:e.display.scrollbarH.clientWidth,docHeight:Math.round(e.doc.height+Te(e.display))}}function m(e,t){t||(t=g(e));var i=e.display,r=t.docHeight+is,n=t.scrollWidth>t.clientWidth,o=r>t.clientHeight;if(o?(i.scrollbarV.style.display="block",i.scrollbarV.style.bottom=n?xn(i.measure)+"px":"0",i.scrollbarV.firstChild.style.height=Math.max(0,r-t.clientHeight+(t.barHeight||i.scrollbarV.clientHeight))+"px"):(i.scrollbarV.style.display="",i.scrollbarV.firstChild.style.height="0"),n?(i.scrollbarH.style.display="block",i.scrollbarH.style.right=o?xn(i.measure)+"px":"0",i.scrollbarH.firstChild.style.width=t.scrollWidth-t.clientWidth+(t.barWidth||i.scrollbarH.clientWidth)+"px"):(i.scrollbarH.style.display="",i.scrollbarH.firstChild.style.width="0"),n&&o?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=i.scrollbarFiller.style.width=xn(i.measure)+"px"):i.scrollbarFiller.style.display="",n&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=xn(i.measure)+"px",i.gutterFiller.style.width=i.gutters.offsetWidth+"px"):i.gutterFiller.style.display="",!e.state.checkedOverlayScrollbar&&t.clientHeight>0){if(0===xn(i.measure)){var s=eo&&!Yn?"12px":"18px";i.scrollbarV.style.minWidth=i.scrollbarH.style.minHeight=s;var a=function(t){_r(t)!=i.scrollbarV&&_r(t)!=i.scrollbarH&&Je(e,wt)(t)};Qo(i.scrollbarV,"mousedown",a),Qo(i.scrollbarH,"mousedown",a)}e.state.checkedOverlayScrollbar=!0}}function v(e,t,i){var r=i&&null!=i.top?Math.max(0,i.top):e.scroller.scrollTop;r=Math.floor(r-Ce(e));var n=i&&null!=i.bottom?i.bottom:r+e.wrapper.clientHeight,o=Tr(t,r),s=Tr(t,n);if(i&&i.ensure){var a=i.ensure.from.line,l=i.ensure.to.line;if(o>a)return{from:a,to:Tr(t,Sr(yr(t,a))+e.wrapper.clientHeight)};if(Math.min(l,t.lastLine())>=s)return{from:Tr(t,Sr(yr(t,l))-e.wrapper.clientHeight),to:l}}return{from:o,to:Math.max(s,o+1)}}function b(e){var t=e.display,i=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var r=w(t)-t.scroller.scrollLeft+e.doc.scrollLeft,n=t.gutters.offsetWidth,o=r+"px",s=0;s<i.length;s++)if(!i[s].hidden){e.options.fixedGutter&&i[s].gutter&&(i[s].gutter.style.left=o);var a=i[s].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=r+n+"px")}}function y(e){if(!e.options.lineNumbers)return!1;var t=e.doc,i=k(e.options,t.first+t.size-1),r=e.display;if(i.length!=r.lineNumChars){var n=r.measure.appendChild(dn("div",[dn("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=n.firstChild.offsetWidth,s=n.offsetWidth-o;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(o,r.lineGutter.offsetWidth-s),r.lineNumWidth=r.lineNumInnerWidth+s,r.lineNumChars=r.lineNumInnerWidth?i.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",h(e),!0}return!1}function k(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function w(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function x(e,t,i){for(var r=e.display.viewFrom,n=e.display.viewTo,o,s=v(e.display,e.doc,t),a=!0;;a=!1){var l=e.display.scroller.clientWidth;if(!C(e,s,i))break;o=!0,e.display.maxLineChanged&&!e.options.lineWrapping&&T(e);var c=g(e);if(ge(e),S(e,c),m(e,c),Un&&e.options.lineWrapping&&L(e,c),a&&e.options.lineWrapping&&l!=e.display.scroller.clientWidth)i=!0;else if(i=!1,t&&null!=t.top&&(t={top:Math.min(c.docHeight-is-c.clientHeight,t.top)}),s=v(e.display,e.doc,t),s.from>=e.display.viewFrom&&s.to<=e.display.viewTo)break}return e.display.updateLineNumbers=null,o&&(qr(e,"update",e),(e.display.viewFrom!=r||e.display.viewTo!=n)&&qr(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo)),o}function C(e,t,i){var r=e.display,n=e.doc;if(!r.wrapper.offsetWidth)return void ot(e);if(!(!i&&t.from>=r.viewFrom&&t.to<=r.viewTo&&0==ct(e))){y(e)&&ot(e);var o=E(e),s=n.first+n.size,a=Math.max(t.from-e.options.viewportMargin,n.first),l=Math.min(s,t.to+e.options.viewportMargin);r.viewFrom<a&&a-r.viewFrom<20&&(a=Math.max(n.first,r.viewFrom)),r.viewTo>l&&r.viewTo-l<20&&(l=Math.min(s,r.viewTo)),so&&(a=_i(e.doc,a),l=Ui(e.doc,l));var c=a!=r.viewFrom||l!=r.viewTo||r.lastSizeC!=r.wrapper.clientHeight;lt(e,a,l),r.viewOffset=Sr(yr(e.doc,r.viewFrom)),e.display.mover.style.top=r.viewOffset+"px";var d=ct(e);if(c||0!=d||i){var h=pn();return d>4&&(r.lineDiv.style.display="none"),N(e,r.updateLineNumbers,o),d>4&&(r.lineDiv.style.display=""),h&&pn()!=h&&h.offsetHeight&&h.focus(),hn(r.cursorDiv),hn(r.selectionDiv),c&&(r.lastSizeC=r.wrapper.clientHeight,ye(e,400)),A(e),!0}}}function T(e){var t=e.display,i=Ee(e,t.maxLine,t.maxLine.text.length).left;t.maxLineChanged=!1;var r=Math.max(0,i+3),n=Math.max(0,t.sizer.offsetLeft+r+is-t.scroller.clientWidth);

t.sizer.style.minWidth=r+"px",n<e.doc.scrollLeft&&$t(e,Math.min(t.scroller.scrollLeft,n),!0)}function S(e,t){e.display.sizer.style.minHeight=e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=Math.max(t.docHeight,t.clientHeight-is)+"px"}function L(e,t){e.display.sizer.offsetWidth+e.display.gutters.offsetWidth<e.display.scroller.clientWidth-1&&(e.display.sizer.style.minHeight=e.display.heightForcer.style.top="0px",e.display.gutters.style.height=t.docHeight+"px")}function A(e){for(var t=e.display,i=t.lineDiv.offsetTop,r=0;r<t.view.length;r++){var n=t.view[r],o;if(!n.hidden){if(In){var s=n.node.offsetTop+n.node.offsetHeight;o=s-i,i=s}else{var a=n.node.getBoundingClientRect();o=a.bottom-a.top}var l=n.line.height-o;if(2>o&&(o=Ke(t)),(l>.001||-.001>l)&&(xr(n.line,o),M(n.line),n.rest))for(var c=0;c<n.rest.length;c++)M(n.rest[c])}}}function M(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.offsetHeight}function E(e){for(var t=e.display,i={},r={},n=t.gutters.firstChild,o=0;n;n=n.nextSibling,++o)i[e.options.gutters[o]]=n.offsetLeft,r[e.options.gutters[o]]=n.offsetWidth;return{fixedPos:w(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:i,gutterWidth:r,wrapperWidth:t.wrapper.clientWidth}}function N(e,t,i){function r(t){var i=t.nextSibling;return Un&&eo&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),i}for(var n=e.display,o=e.options.lineNumbers,s=n.lineDiv,a=s.firstChild,l=n.view,c=n.viewFrom,d=0;d<l.length;d++){var h=l[d];if(h.hidden);else if(h.node){for(;a!=h.node;)a=r(a);var u=o&&null!=t&&c>=t&&h.lineNumber;h.changes&&(tn(h.changes,"gutter")>-1&&(u=!1),O(e,h,c,i)),u&&(hn(h.lineNumber),h.lineNumber.appendChild(document.createTextNode(k(e.options,c)))),a=h.node.nextSibling}else{var f=F(e,h,c,i);s.insertBefore(f,a)}c+=h.size}for(;a;)a=r(a)}function O(e,t,i,r){for(var n=0;n<t.changes.length;n++){var o=t.changes[n];"text"==o?R(e,t):"gutter"==o?B(e,t,i,r):"class"==o?D(t):"widget"==o&&I(t,r)}t.changes=null}function P(e){return e.node==e.text&&(e.node=dn("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),In&&(e.node.style.zIndex=2)),e.node}function H(e){var t=e.bgClass?e.bgClass+" "+(e.line.bgClass||""):e.line.bgClass;if(t&&(t+=" CodeMirror-linebackground"),e.background)t?e.background.className=t:(e.background.parentNode.removeChild(e.background),e.background=null);else if(t){var i=P(e);e.background=i.insertBefore(dn("div",null,t),i.firstChild)}}function z(e,t){var i=e.display.externalMeasured;return i&&i.line==t.line?(e.display.externalMeasured=null,t.measure=i.measure,i.built):sr(e,t)}function R(e,t){var i=t.text.className,r=z(e,t);t.text==t.node&&(t.node=r.pre),t.text.parentNode.replaceChild(r.pre,t.text),t.text=r.pre,r.bgClass!=t.bgClass||r.textClass!=t.textClass?(t.bgClass=r.bgClass,t.textClass=r.textClass,D(t)):i&&(t.text.className=i)}function D(e){H(e),e.line.wrapClass?P(e).className=e.line.wrapClass:e.node!=e.text&&(e.node.className="");var t=e.textClass?e.textClass+" "+(e.line.textClass||""):e.line.textClass;e.text.className=t||""}function B(e,t,i,r){t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null);var n=t.line.gutterMarkers;if(e.options.lineNumbers||n){var o=P(t),s=t.gutter=o.insertBefore(dn("div",null,"CodeMirror-gutter-wrapper","position: absolute; left: "+(e.options.fixedGutter?r.fixedPos:-r.gutterTotalWidth)+"px"),t.text);if(!e.options.lineNumbers||n&&n["CodeMirror-linenumbers"]||(t.lineNumber=s.appendChild(dn("div",k(e.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+r.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),n)for(var a=0;a<e.options.gutters.length;++a){var l=e.options.gutters[a],c=n.hasOwnProperty(l)&&n[l];c&&s.appendChild(dn("div",[c],"CodeMirror-gutter-elt","left: "+r.gutterLeft[l]+"px; width: "+r.gutterWidth[l]+"px"))}}}function I(e,t){e.alignable&&(e.alignable=null);for(var i=e.node.firstChild,r;i;i=r){var r=i.nextSibling;"CodeMirror-linewidget"==i.className&&e.node.removeChild(i)}W(e,t)}function F(e,t,i,r){var n=z(e,t);return t.text=t.node=n.pre,n.bgClass&&(t.bgClass=n.bgClass),n.textClass&&(t.textClass=n.textClass),D(t),B(e,t,i,r),W(t,r),t.node}function W(e,t){if(j(e.line,e,t,!0),e.rest)for(var i=0;i<e.rest.length;i++)j(e.rest[i],e,t,!1)}function j(e,t,i,r){if(e.widgets)for(var n=P(t),o=0,s=e.widgets;o<s.length;++o){var a=s[o],l=dn("div",[a.node],"CodeMirror-linewidget");a.handleMouseEvents||(l.ignoreEvents=!0),_(a,l,t,i),r&&a.above?n.insertBefore(l,t.gutter||t.text):n.appendChild(l),qr(a,"redraw")}}function _(e,t,i,r){if(e.noHScroll){(i.alignable||(i.alignable=[])).push(t);var n=r.wrapperWidth;t.style.left=r.fixedPos+"px",e.coverGutter||(n-=r.gutterTotalWidth,t.style.paddingLeft=r.gutterTotalWidth+"px"),t.style.width=n+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-r.gutterTotalWidth+"px"))}function U(e){return ao(e.line,e.ch)}function q(e,t){return lo(e,t)<0?t:e}function V(e,t){return lo(e,t)<0?e:t}function K(e,t){this.ranges=e,this.primIndex=t}function G(e,t){this.anchor=e,this.head=t}function X(e,t){var i=e[t];e.sort(function(e,t){return lo(e.from(),t.from())}),t=tn(e,i);for(var r=1;r<e.length;r++){var n=e[r],o=e[r-1];if(lo(o.to(),n.from())>=0){var s=V(o.from(),n.from()),a=q(o.to(),n.to()),l=o.empty()?n.from()==n.head:o.from()==o.head;t>=r&&--t,e.splice(--r,2,new G(l?a:s,l?s:a))}}return new K(e,t)}function Y(e,t){return new K([new G(e,t||e)],0)}function Q(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function J(e,t){if(t.line<e.first)return ao(e.first,0);var i=e.first+e.size-1;return t.line>i?ao(i,yr(e,i).text.length):Z(t,yr(e,t.line).text.length)}function Z(e,t){var i=e.ch;return null==i||i>t?ao(e.line,t):0>i?ao(e.line,0):e}function ee(e,t){return t>=e.first&&t<e.first+e.size}function te(e,t){for(var i=[],r=0;r<t.length;r++)i[r]=J(e,t[r]);return i}function ie(e,t,i,r){if(e.cm&&e.cm.display.shift||e.extend){var n=t.anchor;if(r){var o=lo(i,n)<0;o!=lo(r,n)<0?(n=i,i=r):o!=lo(i,r)<0&&(i=r)}return new G(n,i)}return new G(r||i,i)}function re(e,t,i,r){ce(e,new K([ie(e,e.sel.primary(),t,i)],0),r)}function ne(e,t,i){for(var r=[],n=0;n<e.sel.ranges.length;n++)r[n]=ie(e,e.sel.ranges[n],t[n],null);var o=X(r,e.sel.primIndex);ce(e,o,i)}function oe(e,t,i,r){var n=e.sel.ranges.slice(0);n[t]=i,ce(e,X(n,e.sel.primIndex),r)}function se(e,t,i,r){ce(e,Y(t,i),r)}function ae(e,t){var i={ranges:t.ranges,update:function(t){this.ranges=[];for(var i=0;i<t.length;i++)this.ranges[i]=new G(J(e,t[i].anchor),J(e,t[i].head))}};return Zo(e,"beforeSelectionChange",e,i),e.cm&&Zo(e.cm,"beforeSelectionChange",e.cm,i),i.ranges!=t.ranges?X(i.ranges,i.ranges.length-1):t}function le(e,t,i){var r=e.history.done,n=en(r);n&&n.ranges?(r[r.length-1]=t,de(e,t,i)):ce(e,t,i)}function ce(e,t,i){de(e,t,i),Pr(e,e.sel,e.cm?e.cm.curOp.id:0/0,i)}function de(e,t,i){(Xr(e,"beforeSelectionChange")||e.cm&&Xr(e.cm,"beforeSelectionChange"))&&(t=ae(e,t));var r=i&&i.bias||(lo(t.primary().head,e.sel.primary().head)<0?-1:1);he(e,fe(e,t,r,!0)),i&&i.scroll===!1||!e.cm||ai(e.cm)}function he(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0,Gr(e.cm)),qr(e,"cursorActivity",e))}function ue(e){he(e,fe(e,e.sel,null,!1),ns)}function fe(e,t,i,r){for(var n,o=0;o<t.ranges.length;o++){var s=t.ranges[o],a=pe(e,s.anchor,i,r),l=pe(e,s.head,i,r);(n||a!=s.anchor||l!=s.head)&&(n||(n=t.ranges.slice(0,o)),n[o]=new G(a,l))}return n?X(n,t.primIndex):t}function pe(e,t,i,r){var n=!1,o=t,s=i||1;e.cantEdit=!1;e:for(;;){var a=yr(e,o.line);if(a.markedSpans)for(var l=0;l<a.markedSpans.length;++l){var c=a.markedSpans[l],d=c.marker;if((null==c.from||(d.inclusiveLeft?c.from<=o.ch:c.from<o.ch))&&(null==c.to||(d.inclusiveRight?c.to>=o.ch:c.to>o.ch))){if(r&&(Zo(d,"beforeCursorEnter"),d.explicitlyCleared)){if(a.markedSpans){--l;continue}break}if(!d.atomic)continue;var h=d.find(0>s?-1:1);if(0==lo(h,o)&&(h.ch+=s,h.ch<0?h=h.line>e.first?J(e,ao(h.line-1)):null:h.ch>a.text.length&&(h=h.line<e.first+e.size-1?ao(h.line+1,0):null),!h)){if(n)return r?(e.cantEdit=!0,ao(e.first,0)):pe(e,t,i,!0);n=!0,h=t,s=-s}o=h;continue e}}return o}}function ge(e){for(var t=e.display,i=e.doc,r=document.createDocumentFragment(),n=document.createDocumentFragment(),o=0;o<i.sel.ranges.length;o++){var s=i.sel.ranges[o],a=s.empty();(a||e.options.showCursorWhenSelecting)&&me(e,s,r),a||ve(e,s,n)}if(e.options.moveInputWithCursor){var l=je(e,i.sel.primary().head,"div"),c=t.wrapper.getBoundingClientRect(),d=t.lineDiv.getBoundingClientRect(),h=Math.max(0,Math.min(t.wrapper.clientHeight-10,l.top+d.top-c.top)),u=Math.max(0,Math.min(t.wrapper.clientWidth-10,l.left+d.left-c.left));t.inputDiv.style.top=h+"px",t.inputDiv.style.left=u+"px"}un(t.cursorDiv,r),un(t.selectionDiv,n)}function me(e,t,i){var r=je(e,t.head,"div"),n=i.appendChild(dn("div"," ","CodeMirror-cursor"));if(n.style.left=r.left+"px",n.style.top=r.top+"px",n.style.height=Math.max(0,r.bottom-r.top)*e.options.cursorHeight+"px",r.other){var o=i.appendChild(dn("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));o.style.display="",o.style.left=r.other.left+"px",o.style.top=r.other.top+"px",o.style.height=.85*(r.other.bottom-r.other.top)+"px"}}function ve(e,t,i){function r(e,t,i,r){0>t&&(t=0),t=Math.round(t),r=Math.round(r),a.appendChild(dn("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; width: "+(null==i?d-e:i)+"px; height: "+(r-t)+"px"))}function n(t,i,n){function o(i,r){return We(e,ao(t,i),"div",a,r)}var a=yr(s,t),l=a.text.length,h,u;return Sn(Lr(a),i||0,null==n?l:n,function(e,t,s){var a=o(e,"left"),f,p,g;if(e==t)f=a,p=g=a.left;else{if(f=o(t-1,"right"),"rtl"==s){var m=a;a=f,f=m}p=a.left,g=f.right}null==i&&0==e&&(p=c),f.top-a.top>3&&(r(p,a.top,null,a.bottom),p=c,a.bottom<f.top&&r(p,a.bottom,null,f.top)),null==n&&t==l&&(g=d),(!h||a.top<h.top||a.top==h.top&&a.left<h.left)&&(h=a),(!u||f.bottom>u.bottom||f.bottom==u.bottom&&f.right>u.right)&&(u=f),c+1>p&&(p=c),r(p,f.top,g-p,f.bottom)}),{start:h,end:u}}var o=e.display,s=e.doc,a=document.createDocumentFragment(),l=Se(e.display),c=l.left,d=o.lineSpace.offsetWidth-l.right,h=t.from(),u=t.to();if(h.line==u.line)n(h.line,h.ch,u.ch);else{var f=yr(s,h.line),p=yr(s,u.line),g=Wi(f)==Wi(p),m=n(h.line,h.ch,g?f.text.length+1:null).end,v=n(u.line,g?0:null,u.ch).start;g&&(m.top<v.top-2?(r(m.right,m.top,null,m.bottom),r(c,v.top,v.left,v.bottom)):r(m.right,m.top,v.left-m.right,m.bottom)),m.bottom<v.top&&r(c,m.bottom,null,v.top)}i.appendChild(a)}function be(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var i=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0&&(t.blinker=setInterval(function(){t.cursorDiv.style.visibility=(i=!i)?"":"hidden"},e.options.cursorBlinkRate))}}function ye(e,t){e.doc.mode.startState&&e.doc.frontier<e.display.viewTo&&e.state.highlight.set(t,sn(ke,e))}function ke(e){var t=e.doc;if(t.frontier<t.first&&(t.frontier=t.first),!(t.frontier>=e.display.viewTo)){var i=+new Date+e.options.workTime,r=Eo(t.mode,xe(e,t.frontier));Qe(e,function(){t.iter(t.frontier,Math.min(t.first+t.size,e.display.viewTo+500),function(n){if(t.frontier>=e.display.viewFrom){var o=n.styles,s=ir(e,n,r,!0);n.styles=s.styles,s.classes?n.styleClasses=s.classes:n.styleClasses&&(n.styleClasses=null);for(var a=!o||o.length!=n.styles.length,l=0;!a&&l<o.length;++l)a=o[l]!=n.styles[l];a&&nt(e,t.frontier,"text"),n.stateAfter=Eo(t.mode,r)}else nr(e,n.text,r),n.stateAfter=t.frontier%5==0?Eo(t.mode,r):null;return++t.frontier,+new Date>i?(ye(e,e.options.workDelay),!0):void 0})})}}function we(e,t,i){for(var r,n,o=e.doc,s=i?-1:t-(e.doc.mode.innerMode?1e3:100),a=t;a>s;--a){if(a<=o.first)return o.first;var l=yr(o,a-1);if(l.stateAfter&&(!i||a<=o.frontier))return a;var c=as(l.text,null,e.options.tabSize);(null==n||r>c)&&(n=a-1,r=c)}return n}function xe(e,t,i){var r=e.doc,n=e.display;if(!r.mode.startState)return!0;var o=we(e,t,i),s=o>r.first&&yr(r,o-1).stateAfter;return s=s?Eo(r.mode,s):$o(r.mode),r.iter(o,t,function(i){nr(e,i.text,s);var a=o==t-1||o%5==0||o>=n.viewFrom&&o<n.viewTo;i.stateAfter=a?Eo(r.mode,s):null,++o}),i&&(r.frontier=o),s}function Ce(e){return e.lineSpace.offsetTop}function Te(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function Se(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=un(e.measure,dn("pre","x")),i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,r={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(r.left)||isNaN(r.right)||(e.cachedPaddingH=r),r}function Le(e,t,i){var r=e.options.lineWrapping,n=r&&e.display.scroller.clientWidth;if(!t.measure.heights||r&&t.measure.width!=n){var o=t.measure.heights=[];if(r){t.measure.width=n;for(var s=t.text.firstChild.getClientRects(),a=0;a<s.length-1;a++){var l=s[a],c=s[a+1];Math.abs(l.bottom-c.bottom)>2&&o.push((l.bottom+c.top)/2-i.top)}}o.push(i.bottom-i.top)}}function Ae(e,t,i){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var r=0;r<e.rest.length;r++)if(e.rest[r]==t)return{map:e.measure.maps[r],cache:e.measure.caches[r]};for(var r=0;r<e.rest.length;r++)if(Cr(e.rest[r])>i)return{map:e.measure.maps[r],cache:e.measure.caches[r],before:!0}}function Me(e,t){t=Wi(t);var i=Cr(t),r=e.display.externalMeasured=new tt(e.doc,t,i);r.lineN=i;var n=r.built=sr(e,r);return r.text=n.pre,un(e.display.lineMeasure,n.pre),r}function Ee(e,t,i,r){return Oe(e,Ne(e,t),i,r)}function $e(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[st(e,t)];var i=e.display.externalMeasured;return i&&t>=i.lineN&&t<i.lineN+i.size?i:void 0}function Ne(e,t){var i=Cr(t),r=$e(e,i);r&&!r.text?r=null:r&&r.changes&&O(e,r,i,E(e)),r||(r=Me(e,t));var n=Ae(r,t,i);return{line:t,view:r,rect:null,map:n.map,cache:n.cache,before:n.before,hasHeights:!1}}function Oe(e,t,i,r){t.before&&(i=-1);var n=i+(r||""),o;return t.cache.hasOwnProperty(n)?o=t.cache[n]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(Le(e,t.view,t.rect),t.hasHeights=!0),o=Pe(e,t,i,r),o.bogus||(t.cache[n]=o)),{left:o.left,right:o.right,top:o.top,bottom:o.bottom}}function Pe(e,t,i,r){for(var n=t.map,o,s,a,l,c=0;c<n.length;c+=3){var d=n[c],h=n[c+1];if(d>i?(s=0,a=1,l="left"):h>i?(s=i-d,a=s+1):(c==n.length-3||i==h&&n[c+3]>i)&&(a=h-d,s=a-1,i>=h&&(l="right")),null!=s){if(o=n[c+2],d==h&&r==(o.insertLeft?"left":"right")&&(l=r),"left"==r&&0==s)for(;c&&n[c-2]==n[c-3]&&n[c-1].insertLeft;)o=n[(c-=3)+2],l="left";if("right"==r&&s==h-d)for(;c<n.length-3&&n[c+3]==n[c+4]&&!n[c+5].insertLeft;)o=n[(c+=3)+2],l="right";break}}var u;if(3==o.nodeType){for(;s&&cn(t.line.text.charAt(d+s));)--s;for(;h>d+a&&cn(t.line.text.charAt(d+a));)++a;if(Fn&&0==s&&a==h-d)u=o.parentNode.getBoundingClientRect();else if(_n&&e.options.lineWrapping){var f=fs(o,s,a).getClientRects();u=f.length?f["right"==r?f.length-1:0]:co}else u=fs(o,s,a).getBoundingClientRect()||co}else{s>0&&(l=r="right");var f;u=e.options.lineWrapping&&(f=o.getClientRects()).length>1?f["right"==r?f.length-1:0]:o.getBoundingClientRect()}if(Fn&&!s&&(!u||!u.left&&!u.right)){var p=o.parentNode.getClientRects()[0];u=p?{left:p.left,right:p.left+Ge(e.display),top:p.top,bottom:p.bottom}:co}for(var g,m=(u.bottom+u.top)/2-t.rect.top,v=t.view.measure.heights,c=0;c<v.length-1&&!(m<v[c]);c++);g=c?v[c-1]:0,m=v[c];var b={left:("right"==l?u.right:u.left)-t.rect.left,right:("left"==l?u.left:u.right)-t.rect.left,top:g,bottom:m};return u.left||u.right||(b.bogus=!0),b}function He(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function ze(e){e.display.externalMeasure=null,hn(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)He(e.display.view[t])}function Re(e){ze(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function De(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Be(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function Ie(e,t,i,r){if(t.widgets)for(var n=0;n<t.widgets.length;++n)if(t.widgets[n].above){var o=Gi(t.widgets[n]);i.top+=o,i.bottom+=o}if("line"==r)return i;r||(r="local");var s=Sr(t);if("local"==r?s+=Ce(e.display):s-=e.display.viewOffset,"page"==r||"window"==r){var a=e.display.lineSpace.getBoundingClientRect();s+=a.top+("window"==r?0:Be());var l=a.left+("window"==r?0:De());i.left+=l,i.right+=l}return i.top+=s,i.bottom+=s,i}function Fe(e,t,i){if("div"==i)return t;var r=t.left,n=t.top;if("page"==i)r-=De(),n-=Be();else if("local"==i||!i){var o=e.display.sizer.getBoundingClientRect();r+=o.left,n+=o.top}var s=e.display.lineSpace.getBoundingClientRect();return{left:r-s.left,top:n-s.top}}function We(e,t,i,r,n){return r||(r=yr(e.doc,t.line)),Ie(e,r,Ee(e,r,t.ch,n),i)}function je(e,t,i,r,n){function o(t,o){var s=Oe(e,n,t,o?"right":"left");return o?s.left=s.right:s.right=s.left,Ie(e,r,s,i)}function s(e,t){var i=a[t],r=i.level%2;return e==Ln(i)&&t&&i.level<a[t-1].level?(i=a[--t],e=An(i)-(i.level%2?0:1),r=!0):e==An(i)&&t<a.length-1&&i.level<a[t+1].level&&(i=a[++t],e=Ln(i)-i.level%2,r=!1),r&&e==i.to&&e>i.from?o(e-1):o(e,r)}r=r||yr(e.doc,t.line),n||(n=Ne(e,r));var a=Lr(r),l=t.ch;if(!a)return o(l);var c=Pn(a,l),d=s(l,c);return null!=Cs&&(d.other=s(l,Cs)),d}function _e(e,t){var i=0,t=J(e.doc,t);e.options.lineWrapping||(i=Ge(e.display)*t.ch);var r=yr(e.doc,t.line),n=Sr(r)+Ce(e.display);return{left:i,right:i,top:n,bottom:n+r.height}}function Ue(e,t,i,r){var n=ao(e,t);return n.xRel=r,i&&(n.outside=!0),n}function qe(e,t,i){var r=e.doc;if(i+=e.display.viewOffset,0>i)return Ue(r.first,0,!0,-1);var n=Tr(r,i),o=r.first+r.size-1;if(n>o)return Ue(r.first+r.size-1,yr(r,o).text.length,!0,1);0>t&&(t=0);for(var s=yr(r,n);;){var a=Ve(e,s,n,t,i),l=Ii(s),c=l&&l.find(0,!0);if(!l||!(a.ch>c.from.ch||a.ch==c.from.ch&&a.xRel>0))return a;n=Cr(s=c.to.line)}}function Ve(e,t,i,r,n){function o(r){var n=je(e,ao(i,r),"line",t,c);return a=!0,s>n.bottom?n.left-l:s<n.top?n.left+l:(a=!1,n.left)}var s=n-Sr(t),a=!1,l=2*e.display.wrapper.clientWidth,c=Ne(e,t),d=Lr(t),h=t.text.length,u=Mn(t),f=En(t),p=o(u),g=a,m=o(f),v=a;if(r>m)return Ue(i,f,v,1);for(;;){if(d?f==u||f==zn(t,u,1):1>=f-u){for(var b=p>r||m-r>=r-p?u:f,y=r-(b==u?p:m);cn(t.text.charAt(b));)++b;var k=Ue(i,b,b==u?g:v,-1>y?-1:y>1?1:0);return k}var w=Math.ceil(h/2),x=u+w;if(d){x=u;for(var C=0;w>C;++C)x=zn(t,x,1)}var T=o(x);T>r?(f=x,m=T,(v=a)&&(m+=1e3),h=w):(u=x,p=T,g=a,h-=w)}}function Ke(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==ho){ho=dn("pre");for(var t=0;49>t;++t)ho.appendChild(document.createTextNode("x")),ho.appendChild(dn("br"));ho.appendChild(document.createTextNode("x"))}un(e.measure,ho);var i=ho.offsetHeight/50;return i>3&&(e.cachedTextHeight=i),hn(e.measure),i||1}function Ge(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=dn("span","xxxxxxxxxx"),i=dn("pre",[t]);un(e.measure,i);var r=t.getBoundingClientRect(),n=(r.right-r.left)/10;return n>2&&(e.cachedCharWidth=n),n||10}function Xe(e){e.curOp={viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,id:++uo},ts++||(es=[])}function Ye(e){var t=e.curOp,i=e.doc,r=e.display;if(e.curOp=null,t.updateMaxLine&&f(e),t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<r.viewFrom||t.scrollToPos.to.line>=r.viewTo)||r.maxLineChanged&&e.options.lineWrapping){var n=x(e,{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate);e.display.scroller.offsetHeight&&(e.doc.scrollTop=e.display.scroller.scrollTop)}if(!n&&t.selectionChanged&&ge(e),n||t.startHeight==e.doc.height||m(e),null==r.wheelStartX||null==t.scrollTop&&null==t.scrollLeft&&!t.scrollToPos||(r.wheelStartX=r.wheelStartY=null),null!=t.scrollTop&&r.scroller.scrollTop!=t.scrollTop){var o=Math.max(0,Math.min(r.scroller.scrollHeight-r.scroller.clientHeight,t.scrollTop));r.scroller.scrollTop=r.scrollbarV.scrollTop=i.scrollTop=o}if(null!=t.scrollLeft&&r.scroller.scrollLeft!=t.scrollLeft){var s=Math.max(0,Math.min(r.scroller.scrollWidth-r.scroller.clientWidth,t.scrollLeft));r.scroller.scrollLeft=r.scrollbarH.scrollLeft=i.scrollLeft=s,b(e)}if(t.scrollToPos){var a=ri(e,J(e.doc,t.scrollToPos.from),J(e.doc,t.scrollToPos.to),t.scrollToPos.margin);t.scrollToPos.isCursor&&e.state.focused&&ii(e,a)}t.selectionChanged&&be(e),e.state.focused&&t.updateInput&&ft(e,t.typing);var l=t.maybeHiddenMarkers,c=t.maybeUnhiddenMarkers;if(l)for(var d=0;d<l.length;++d)l[d].lines.length||Zo(l[d],"hide");if(c)for(var d=0;d<c.length;++d)c[d].lines.length&&Zo(c[d],"unhide");var h;if(--ts||(h=es,es=null),t.changeObjs&&Zo(e,"changes",e,t.changeObjs),h)for(var d=0;d<h.length;++d)h[d]();if(t.cursorActivityHandlers)for(var d=0;d<t.cursorActivityHandlers.length;d++)t.cursorActivityHandlers[d](e)}function Qe(e,t){if(e.curOp)return t();Xe(e);try{return t()}finally{Ye(e)}}function Je(e,t){return function(){if(e.curOp)return t.apply(e,arguments);Xe(e);try{return t.apply(e,arguments)}finally{Ye(e)}}}function Ze(e){return function(){if(this.curOp)return e.apply(this,arguments);Xe(this);try{return e.apply(this,arguments)}finally{Ye(this)}}}function et(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);Xe(t);try{return e.apply(this,arguments)}finally{Ye(t)}}}function tt(e,t,i){this.line=t,this.rest=ji(t),this.size=this.rest?Cr(en(this.rest))-i+1:1,this.node=this.text=null,this.hidden=qi(e,t)}function it(e,t,i){for(var r=[],n,o=t;i>o;o=n){var s=new tt(e.doc,yr(e.doc,o),o);n=o+s.size,r.push(s)}return r}function rt(e,t,i,r){null==t&&(t=e.doc.first),null==i&&(i=e.doc.first+e.doc.size),r||(r=0);var n=e.display;if(r&&i<n.viewTo&&(null==n.updateLineNumbers||n.updateLineNumbers>t)&&(n.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=n.viewTo)so&&_i(e.doc,t)<n.viewTo&&ot(e);else if(i<=n.viewFrom)so&&Ui(e.doc,i+r)>n.viewFrom?ot(e):(n.viewFrom+=r,n.viewTo+=r);else if(t<=n.viewFrom&&i>=n.viewTo)ot(e);else if(t<=n.viewFrom){var o=at(e,i,i+r,1);o?(n.view=n.view.slice(o.index),n.viewFrom=o.lineN,n.viewTo+=r):ot(e)}else if(i>=n.viewTo){var o=at(e,t,t,-1);o?(n.view=n.view.slice(0,o.index),n.viewTo=o.lineN):ot(e)}else{var s=at(e,t,t,-1),a=at(e,i,i+r,1);s&&a?(n.view=n.view.slice(0,s.index).concat(it(e,s.lineN,a.lineN)).concat(n.view.slice(a.index)),n.viewTo+=r):ot(e)}var l=n.externalMeasured;l&&(i<l.lineN?l.lineN+=r:t<l.lineN+l.size&&(n.externalMeasured=null))}function nt(e,t,i){e.curOp.viewChanged=!0;var r=e.display,n=e.display.externalMeasured;if(n&&t>=n.lineN&&t<n.lineN+n.size&&(r.externalMeasured=null),!(t<r.viewFrom||t>=r.viewTo)){var o=r.view[st(e,t)];if(null!=o.node){var s=o.changes||(o.changes=[]);-1==tn(s,i)&&s.push(i)}}}function ot(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function st(e,t){if(t>=e.display.viewTo)return null;if(t-=e.display.viewFrom,0>t)return null;for(var i=e.display.view,r=0;r<i.length;r++)if(t-=i[r].size,0>t)return r}function at(e,t,i,r){var n=st(e,t),o,s=e.display.view;if(!so||i==e.doc.first+e.doc.size)return{index:n,lineN:i};for(var a=0,l=e.display.viewFrom;n>a;a++)l+=s[a].size;if(l!=t){if(r>0){if(n==s.length-1)return null;o=l+s[n].size-t,n++}else o=l-t;t+=o,i+=o}for(;_i(e.doc,i)!=i;){if(n==(0>r?0:s.length-1))return null;i+=r*s[n-(0>r?1:0)].size,n+=r}return{index:n,lineN:i}}function lt(e,t,i){var r=e.display,n=r.view;0==n.length||t>=r.viewTo||i<=r.viewFrom?(r.view=it(e,t,i),r.viewFrom=t):(r.viewFrom>t?r.view=it(e,t,r.viewFrom).concat(r.view):r.viewFrom<t&&(r.view=r.view.slice(st(e,t))),r.viewFrom=t,r.viewTo<i?r.view=r.view.concat(it(e,r.viewTo,i)):r.viewTo>i&&(r.view=r.view.slice(0,st(e,i)))),r.viewTo=i}function ct(e){for(var t=e.display.view,i=0,r=0;r<t.length;r++){var n=t[r];n.hidden||n.node&&!n.changes||++i}return i}function dt(e){e.display.pollingFast||e.display.poll.set(e.options.pollInterval,function(){ut(e),e.state.focused&&dt(e)})}function ht(e){function t(){var r=ut(e);r||i?(e.display.pollingFast=!1,dt(e)):(i=!0,e.display.poll.set(60,t))}var i=!1;e.display.pollingFast=!0,e.display.poll.set(20,t)}function ut(e){var t=e.display.input,i=e.display.prevInput,r=e.doc;if(!e.state.focused||ks(t)&&!i||mt(e)||e.options.disableInput)return!1;e.state.pasteIncoming&&e.state.fakedLastChar&&(t.value=t.value.substring(0,t.value.length-1),e.state.fakedLastChar=!1);var n=t.value;if(n==i&&!e.somethingSelected())return!1;if(_n&&!Fn&&e.display.inputHasSelection===n)return ft(e),!1;var o=!e.curOp;o&&Xe(e),e.display.shift=!1,8203!=n.charCodeAt(0)||r.sel!=e.display.selForContextMenu||i||(i="​");for(var s=0,a=Math.min(i.length,n.length);a>s&&i.charCodeAt(s)==n.charCodeAt(s);)++s;for(var l=n.slice(s),c=ys(l),d=e.state.pasteIncoming&&c.length>1&&r.sel.ranges.length==c.length,h=r.sel.ranges.length-1;h>=0;h--){var u=r.sel.ranges[h],f=u.from(),p=u.to();s<i.length?f=ao(f.line,f.ch-(i.length-s)):e.state.overwrite&&u.empty()&&!e.state.pasteIncoming&&(p=ao(p.line,Math.min(yr(r,p.line).text.length,p.ch+en(c).length)));var g=e.curOp.updateInput,m={from:f,to:p,text:d?[c[h]]:c,origin:e.state.pasteIncoming?"paste":e.state.cutIncoming?"cut":"+input"};if(Xt(e.doc,m),qr(e,"inputRead",e,m),l&&!e.state.pasteIncoming&&e.options.electricChars&&e.options.smartIndent&&u.head.ch<100&&(!h||r.sel.ranges[h-1].head.line!=u.head.line)){var v=e.getModeAt(u.head);if(v.electricChars){for(var b=0;b<v.electricChars.length;b++)if(l.indexOf(v.electricChars.charAt(b))>-1){ci(e,u.head.line,"smart");break}}else if(v.electricInput){var y=ko(m);v.electricInput.test(yr(r,y.line).text.slice(0,y.ch))&&ci(e,u.head.line,"smart")}}}return ai(e),e.curOp.updateInput=g,e.curOp.typing=!0,n.length>1e3||n.indexOf("\n")>-1?t.value=e.display.prevInput="":e.display.prevInput=n,o&&Ye(e),e.state.pasteIncoming=e.state.cutIncoming=!1,!0}function ft(e,t){var i,r,n=e.doc;if(e.somethingSelected()){e.display.prevInput="";var o=n.sel.primary();i=ws&&(o.to().line-o.from().line>100||(r=e.getSelection()).length>1e3);var s=i?"-":r||e.getSelection();e.display.input.value=s,e.state.focused&&cs(e.display.input),_n&&!Fn&&(e.display.inputHasSelection=s)}else t||(e.display.prevInput=e.display.input.value="",_n&&!Fn&&(e.display.inputHasSelection=null));e.display.inaccurateSelection=i}function pt(e){"nocursor"==e.options.readOnly||Zn&&pn()==e.display.input||e.display.input.focus()}function gt(e){e.state.focused||(pt(e),Ft(e))}function mt(e){return e.options.readOnly||e.doc.cantEdit}function vt(e){function t(){e.state.focused&&setTimeout(sn(pt,e),0)}function i(t){Kr(e,t)||Yo(t)}function r(t){if(e.somethingSelected())n.inaccurateSelection&&(n.prevInput="",n.inaccurateSelection=!1,n.input.value=e.getSelection(),cs(n.input));else{for(var i="",r=[],o=0;o<e.doc.sel.ranges.length;o++){var s=e.doc.sel.ranges[o].head.line,a={anchor:ao(s,0),head:ao(s+1,0)};r.push(a),i+=e.getRange(a.anchor,a.head)}"cut"==t.type?e.setSelections(r,null,ns):(n.prevInput="",n.input.value=i,cs(n.input))}"cut"==t.type&&(e.state.cutIncoming=!0)}var n=e.display;Qo(n.scroller,"mousedown",Je(e,wt)),Bn?Qo(n.scroller,"dblclick",Je(e,function(t){if(!Kr(e,t)){var i=kt(e,t);if(i&&!Lt(e,t)&&!yt(e.display,t)){Go(t);var r=pi(e,i);re(e.doc,r.anchor,r.head)}}})):Qo(n.scroller,"dblclick",function(t){Kr(e,t)||Go(t)}),Qo(n.lineSpace,"selectstart",function(e){yt(n,e)||Go(e)}),no||Qo(n.scroller,"contextmenu",function(t){jt(e,t)}),Qo(n.scroller,"scroll",function(){n.scroller.clientHeight&&(Et(e,n.scroller.scrollTop),$t(e,n.scroller.scrollLeft,!0),Zo(e,"scroll",e))}),Qo(n.scrollbarV,"scroll",function(){n.scroller.clientHeight&&Et(e,n.scrollbarV.scrollTop)}),Qo(n.scrollbarH,"scroll",function(){n.scroller.clientHeight&&$t(e,n.scrollbarH.scrollLeft)}),Qo(n.scroller,"mousewheel",function(t){Nt(e,t)}),Qo(n.scroller,"DOMMouseScroll",function(t){Nt(e,t)}),Qo(n.scrollbarH,"mousedown",t),Qo(n.scrollbarV,"mousedown",t),Qo(n.wrapper,"scroll",function(){n.wrapper.scrollTop=n.wrapper.scrollLeft=0}),Qo(n.input,"keyup",Je(e,Bt)),Qo(n.input,"input",function(){_n&&!Fn&&e.display.inputHasSelection&&(e.display.inputHasSelection=null),ht(e)}),Qo(n.input,"keydown",Je(e,Rt)),Qo(n.input,"keypress",Je(e,It)),Qo(n.input,"focus",sn(Ft,e)),Qo(n.input,"blur",sn(Wt,e)),e.options.dragDrop&&(Qo(n.scroller,"dragstart",function(t){Mt(e,t)}),Qo(n.scroller,"dragenter",i),Qo(n.scroller,"dragover",i),Qo(n.scroller,"drop",Je(e,At))),Qo(n.scroller,"paste",function(t){yt(n,t)||(e.state.pasteIncoming=!0,pt(e),ht(e))}),Qo(n.input,"paste",function(){if(Un&&!e.state.fakedLastChar&&!(new Date-e.state.lastMiddleDown<200)){var t=n.input.selectionStart,i=n.input.selectionEnd;n.input.value+="$",n.input.selectionStart=t,n.input.selectionEnd=i,e.state.fakedLastChar=!0}e.state.pasteIncoming=!0,ht(e)}),Qo(n.input,"cut",r),Qo(n.input,"copy",r),Xn&&Qo(n.sizer,"mouseup",function(){pn()==n.input&&n.input.blur(),pt(e)})}function bt(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,e.setSize()}function yt(e,t){for(var i=_r(t);i!=e.wrapper;i=i.parentNode)if(!i||i.ignoreEvents||i.parentNode==e.sizer&&i!=e.mover)return!0}function kt(e,t,i,r){var n=e.display;if(!i){var o=_r(t);if(o==n.scrollbarH||o==n.scrollbarV||o==n.scrollbarFiller||o==n.gutterFiller)return null}var s,a,l=n.lineSpace.getBoundingClientRect();try{s=t.clientX-l.left,a=t.clientY-l.top}catch(t){return null}var c=qe(e,s,a),d;if(r&&1==c.xRel&&(d=yr(e.doc,c.line).text).length==c.ch){var h=as(d,d.length,e.options.tabSize)-d.length;c=ao(c.line,Math.max(0,Math.round((s-Se(e.display).left)/Ge(e.display))-h))}return c}function wt(e){if(!Kr(this,e)){var t=this,i=t.display;if(i.shift=e.shiftKey,yt(i,e))return void(Un||(i.scroller.draggable=!1,setTimeout(function(){i.scroller.draggable=!0},100)));if(!Lt(t,e)){var r=kt(t,e);switch(window.focus(),Ur(e)){case 1:r?xt(t,e,r):_r(e)==i.scroller&&Go(e);break;case 2:Un&&(t.state.lastMiddleDown=+new Date),r&&re(t.doc,r),setTimeout(sn(pt,t),20),Go(e);break;case 3:no&&jt(t,e)}}}}function xt(e,t,i){setTimeout(sn(gt,e),0);var r=+new Date,n;po&&po.time>r-400&&0==lo(po.pos,i)?n="triple":fo&&fo.time>r-400&&0==lo(fo.pos,i)?(n="double",po={time:r,pos:i}):(n="single",fo={time:r,pos:i});var o=e.doc.sel,s=eo?t.metaKey:t.ctrlKey;e.options.dragDrop&&gs&&!mt(e)&&"single"==n&&o.contains(i)>-1&&o.somethingSelected()?Ct(e,t,i,s):Tt(e,t,i,n,s)}function Ct(e,t,i,r){var n=e.display,o=Je(e,function(s){Un&&(n.scroller.draggable=!1),e.state.draggingText=!1,Jo(document,"mouseup",o),Jo(n.scroller,"drop",o),Math.abs(t.clientX-s.clientX)+Math.abs(t.clientY-s.clientY)<10&&(Go(s),r||re(e.doc,i),pt(e),Bn&&!Fn&&setTimeout(function(){document.body.focus(),pt(e)},20))});Un&&(n.scroller.draggable=!0),e.state.draggingText=o,n.scroller.dragDrop&&n.scroller.dragDrop(),Qo(document,"mouseup",o),Qo(n.scroller,"drop",o)}function Tt(e,t,i,r,n){function o(t){if(0!=lo(g,t))if(g=t,"rect"==r){for(var n=[],o=e.options.tabSize,s=as(yr(c,i.line).text,i.ch,o),a=as(yr(c,t.line).text,t.ch,o),l=Math.min(s,a),f=Math.max(s,a),p=Math.min(i.line,t.line),m=Math.min(e.lastLine(),Math.max(i.line,t.line));m>=p;p++){var v=yr(c,p).text,b=Jr(v,l,o);l==f?n.push(new G(ao(p,b),ao(p,b))):v.length>b&&n.push(new G(ao(p,b),ao(p,Jr(v,f,o))))}n.length||n.push(new G(i,i)),ce(c,X(u.ranges.slice(0,h).concat(n),h),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var y=d,k=y.anchor,w=t;if("single"!=r){if("double"==r)var x=pi(e,t);else var x=new G(ao(t.line,0),J(c,ao(t.line+1,0)));lo(x.anchor,k)>0?(w=x.head,k=V(y.from(),x.anchor)):(w=x.anchor,k=q(y.to(),x.head))}var n=u.ranges.slice(0);n[h]=new G(J(c,k),w),ce(c,X(n,h),os)}}function s(t){var i=++b,n=kt(e,t,!0,"rect"==r);if(n)if(0!=lo(n,g)){gt(e),o(n);var a=v(l,c);(n.line>=a.to||n.line<a.from)&&setTimeout(Je(e,function(){b==i&&s(t)}),150)}else{var d=t.clientY<m.top?-20:t.clientY>m.bottom?20:0;d&&setTimeout(Je(e,function(){b==i&&(l.scroller.scrollTop+=d,s(t))}),50)}}function a(t){b=1/0,Go(t),
pt(e),Jo(document,"mousemove",y),Jo(document,"mouseup",k),c.history.lastSelOrigin=null}var l=e.display,c=e.doc;Go(t);var d,h,u=c.sel;if(n&&!t.shiftKey?(h=c.sel.contains(i),d=h>-1?c.sel.ranges[h]:new G(i,i)):d=c.sel.primary(),t.altKey)r="rect",n||(d=new G(i,i)),i=kt(e,t,!0,!0),h=-1;else if("double"==r){var f=pi(e,i);d=e.display.shift||c.extend?ie(c,d,f.anchor,f.head):f}else if("triple"==r){var p=new G(ao(i.line,0),J(c,ao(i.line+1,0)));d=e.display.shift||c.extend?ie(c,d,p.anchor,p.head):p}else d=ie(c,d,i);n?h>-1?oe(c,h,d,os):(h=c.sel.ranges.length,ce(c,X(c.sel.ranges.concat([d]),h),{scroll:!1,origin:"*mouse"})):(h=0,ce(c,new K([d],0),os),u=c.sel);var g=i,m=l.wrapper.getBoundingClientRect(),b=0,y=Je(e,function(e){(_n&&!Wn?e.buttons:Ur(e))?s(e):a(e)}),k=Je(e,a);Qo(document,"mousemove",y),Qo(document,"mouseup",k)}function St(e,t,i,r,n){try{var o=t.clientX,s=t.clientY}catch(t){return!1}if(o>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;r&&Go(t);var a=e.display,l=a.lineDiv.getBoundingClientRect();if(s>l.bottom||!Xr(e,i))return jr(t);s-=l.top-a.viewOffset;for(var c=0;c<e.options.gutters.length;++c){var d=a.gutters.childNodes[c];if(d&&d.getBoundingClientRect().right>=o){var h=Tr(e.doc,s),u=e.options.gutters[c];return n(e,i,e,h,u,t),jr(t)}}}function Lt(e,t){return St(e,t,"gutterClick",!0,qr)}function At(e){var t=this;if(!Kr(t,e)&&!yt(t.display,e)){Go(e),_n&&(go=+new Date);var i=kt(t,e,!0),r=e.dataTransfer.files;if(i&&!mt(t))if(r&&r.length&&window.FileReader&&window.File)for(var n=r.length,o=Array(n),s=0,a=function(e,r){var a=new FileReader;a.onload=Je(t,function(){if(o[r]=a.result,++s==n){i=J(t.doc,i);var e={from:i,to:i,text:ys(o.join("\n")),origin:"paste"};Xt(t.doc,e),le(t.doc,Y(i,ko(e)))}}),a.readAsText(e)},l=0;n>l;++l)a(r[l],l);else{if(t.state.draggingText&&t.doc.sel.contains(i)>-1)return t.state.draggingText(e),void setTimeout(sn(pt,t),20);try{var o=e.dataTransfer.getData("Text");if(o){if(t.state.draggingText&&!(eo?e.metaKey:e.ctrlKey))var c=t.listSelections();if(de(t.doc,Y(i,i)),c)for(var l=0;l<c.length;++l)ti(t.doc,"",c[l].anchor,c[l].head,"drag");t.replaceSelection(o,"around","paste"),pt(t)}}catch(e){}}}}function Mt(e,t){if(_n&&(!e.state.draggingText||+new Date-go<100))return void Yo(t);if(!Kr(e,t)&&!yt(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.setDragImage&&!Gn)){var i=dn("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",Kn&&(i.width=i.height=1,e.display.wrapper.appendChild(i),i._top=i.offsetTop),t.dataTransfer.setDragImage(i,0,0),Kn&&i.parentNode.removeChild(i)}}function Et(e,t){Math.abs(e.doc.scrollTop-t)<2||(e.doc.scrollTop=t,Dn||x(e,{top:t}),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t),e.display.scrollbarV.scrollTop!=t&&(e.display.scrollbarV.scrollTop=t),Dn&&x(e),ye(e,100))}function $t(e,t,i){(i?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)||(t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),e.doc.scrollLeft=t,b(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbarH.scrollLeft!=t&&(e.display.scrollbarH.scrollLeft=t))}function Nt(e,t){var i=t.wheelDeltaX,r=t.wheelDeltaY;null==i&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(i=t.detail),null==r&&t.detail&&t.axis==t.VERTICAL_AXIS?r=t.detail:null==r&&(r=t.wheelDelta);var n=e.display,o=n.scroller;if(i&&o.scrollWidth>o.clientWidth||r&&o.scrollHeight>o.clientHeight){if(r&&eo&&Un)e:for(var s=t.target,a=n.view;s!=o;s=s.parentNode)for(var l=0;l<a.length;l++)if(a[l].node==s){e.display.currentWheelTarget=s;break e}if(i&&!Dn&&!Kn&&null!=vo)return r&&Et(e,Math.max(0,Math.min(o.scrollTop+r*vo,o.scrollHeight-o.clientHeight))),$t(e,Math.max(0,Math.min(o.scrollLeft+i*vo,o.scrollWidth-o.clientWidth))),Go(t),void(n.wheelStartX=null);if(r&&null!=vo){var c=r*vo,d=e.doc.scrollTop,h=d+n.wrapper.clientHeight;0>c?d=Math.max(0,d+c-50):h=Math.min(e.doc.height,h+c+50),x(e,{top:d,bottom:h})}20>mo&&(null==n.wheelStartX?(n.wheelStartX=o.scrollLeft,n.wheelStartY=o.scrollTop,n.wheelDX=i,n.wheelDY=r,setTimeout(function(){if(null!=n.wheelStartX){var e=o.scrollLeft-n.wheelStartX,t=o.scrollTop-n.wheelStartY,i=t&&n.wheelDY&&t/n.wheelDY||e&&n.wheelDX&&e/n.wheelDX;n.wheelStartX=n.wheelStartY=null,i&&(vo=(vo*mo+i)/(mo+1),++mo)}},200)):(n.wheelDX+=i,n.wheelDY+=r))}}function Ot(e,t,i){if("string"==typeof t&&(t=No[t],!t))return!1;e.display.pollingFast&&ut(e)&&(e.display.pollingFast=!1);var r=e.display.shift,n=!1;try{mt(e)&&(e.state.suppressEdits=!0),i&&(e.display.shift=!1),n=t(e)!=rs}finally{e.display.shift=r,e.state.suppressEdits=!1}return n}function Pt(e){var t=e.state.keyMaps.slice(0);return e.options.extraKeys&&t.push(e.options.extraKeys),t.push(e.options.keyMap),t}function Ht(e,t){var i=mi(e.options.keyMap),r=i.auto;clearTimeout(bo),r&&!Ho(t)&&(bo=setTimeout(function(){mi(e.options.keyMap)==i&&(e.options.keyMap=r.call?r.call(null,e):r,a(e))},50));var n=zo(t,!0),o=!1;if(!n)return!1;var s=Pt(e);return o=t.shiftKey?Po("Shift-"+n,s,function(t){return Ot(e,t,!0)})||Po(n,s,function(t){return("string"==typeof t?/^go[A-Z]/.test(t):t.motion)?Ot(e,t):void 0}):Po(n,s,function(t){return Ot(e,t)}),o&&(Go(t),be(e),qr(e,"keyHandled",e,n,t)),o}function zt(e,t,i){var r=Po("'"+i+"'",Pt(e),function(t){return Ot(e,t,!0)});return r&&(Go(t),be(e),qr(e,"keyHandled",e,"'"+i+"'",t)),r}function Rt(e){var t=this;if(gt(t),!Kr(t,e)){Bn&&27==e.keyCode&&(e.returnValue=!1);var i=e.keyCode;t.display.shift=16==i||e.shiftKey;var r=Ht(t,e);Kn&&(yo=r?i:null,!r&&88==i&&!ws&&(eo?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),18!=i||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||Dt(t)}}function Dt(e){function t(e){18!=e.keyCode&&e.altKey||(mn(i,"CodeMirror-crosshair"),Jo(document,"keyup",t),Jo(document,"mouseover",t))}var i=e.display.lineDiv;vn(i,"CodeMirror-crosshair"),Qo(document,"keyup",t),Qo(document,"mouseover",t)}function Bt(e){Kr(this,e)||16==e.keyCode&&(this.doc.sel.shift=!1)}function It(e){var t=this;if(!Kr(t,e)){var i=e.keyCode,r=e.charCode;if(Kn&&i==yo)return yo=null,void Go(e);if(!(Kn&&(!e.which||e.which<10)||Xn)||!Ht(t,e)){var n=String.fromCharCode(null==r?i:r);zt(t,e,n)||(_n&&!Fn&&(t.display.inputHasSelection=null),ht(t))}}}function Ft(e){"nocursor"!=e.options.readOnly&&(e.state.focused||(Zo(e,"focus",e),e.state.focused=!0,vn(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(ft(e),Un&&setTimeout(sn(ft,e,!0),0))),dt(e),be(e))}function Wt(e){e.state.focused&&(Zo(e,"blur",e),e.state.focused=!1,mn(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150)}function jt(e,t){function i(){if(null!=n.input.selectionStart){var t=e.somethingSelected(),i=n.input.value="​"+(t?n.input.value:"");n.prevInput=t?"":"​",n.input.selectionStart=1,n.input.selectionEnd=i.length,n.selForContextMenu=e.doc.sel}}function r(){if(n.inputDiv.style.position="relative",n.input.style.cssText=l,Fn&&(n.scrollbarV.scrollTop=n.scroller.scrollTop=s),dt(e),null!=n.input.selectionStart){(!_n||Fn)&&i();var t=0,r=function(){n.selForContextMenu==e.doc.sel&&0==n.input.selectionStart?Je(e,No.selectAll)(e):t++<10?n.detectingSelectAll=setTimeout(r,500):ft(e)};n.detectingSelectAll=setTimeout(r,200)}}if(!Kr(e,t,"contextmenu")){var n=e.display;if(!yt(n,t)&&!_t(e,t)){var o=kt(e,t),s=n.scroller.scrollTop;if(o&&!Kn){var a=e.options.resetSelectionOnContextMenu;a&&-1==e.doc.sel.contains(o)&&Je(e,ce)(e.doc,Y(o),ns);var l=n.input.style.cssText;if(n.inputDiv.style.position="absolute",n.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(t.clientY-5)+"px; left: "+(t.clientX-5)+"px; z-index: 1000; background: "+(_n?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",pt(e),ft(e),e.somethingSelected()||(n.input.value=n.prevInput=" "),n.selForContextMenu=e.doc.sel,clearTimeout(n.detectingSelectAll),_n&&!Fn&&i(),no){Yo(t);var c=function(){Jo(window,"mouseup",c),setTimeout(r,20)};Qo(window,"mouseup",c)}else setTimeout(r,50)}}}}function _t(e,t){return Xr(e,"gutterContextMenu")?St(e,t,"gutterContextMenu",!1,Zo):!1}function Ut(e,t){if(lo(e,t.from)<0)return e;if(lo(e,t.to)<=0)return ko(t);var i=e.line+t.text.length-(t.to.line-t.from.line)-1,r=e.ch;return e.line==t.to.line&&(r+=ko(t).ch-t.to.ch),ao(i,r)}function qt(e,t){for(var i=[],r=0;r<e.sel.ranges.length;r++){var n=e.sel.ranges[r];i.push(new G(Ut(n.anchor,t),Ut(n.head,t)))}return X(i,e.sel.primIndex)}function Vt(e,t,i){return e.line==t.line?ao(i.line,e.ch-t.ch+i.ch):ao(i.line+(e.line-t.line),e.ch)}function Kt(e,t,i){for(var r=[],n=ao(e.first,0),o=n,s=0;s<t.length;s++){var a=t[s],l=Vt(a.from,n,o),c=Vt(ko(a),n,o);if(n=a.to,o=c,"around"==i){var d=e.sel.ranges[s],h=lo(d.head,d.anchor)<0;r[s]=new G(h?c:l,h?l:c)}else r[s]=new G(l,l)}return new K(r,e.sel.primIndex)}function Gt(e,t,i){var r={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){this.canceled=!0}};return i&&(r.update=function(t,i,r,n){t&&(this.from=J(e,t)),i&&(this.to=J(e,i)),r&&(this.text=r),void 0!==n&&(this.origin=n)}),Zo(e,"beforeChange",e,r),e.cm&&Zo(e.cm,"beforeChange",e.cm,r),r.canceled?null:{from:r.from,to:r.to,text:r.text,origin:r.origin}}function Xt(e,t,i){if(e.cm){if(!e.cm.curOp)return Je(e.cm,Xt)(e,t,i);if(e.cm.state.suppressEdits)return}if(!(Xr(e,"beforeChange")||e.cm&&Xr(e.cm,"beforeChange"))||(t=Gt(e,t,!0))){var r=oo&&!i&&Ni(e,t.from,t.to);if(r)for(var n=r.length-1;n>=0;--n)Yt(e,{from:r[n].from,to:r[n].to,text:n?[""]:t.text});else Yt(e,t)}}function Yt(e,t){if(1!=t.text.length||""!=t.text[0]||0!=lo(t.from,t.to)){var i=qt(e,t);Nr(e,t,i,e.cm?e.cm.curOp.id:0/0),Zt(e,t,i,Mi(e,t));var r=[];vr(e,function(e,i){i||-1!=tn(r,e.history)||(Wr(e.history,t),r.push(e.history)),Zt(e,t,null,Mi(e,t))})}}function Qt(e,t,i){if(!e.cm||!e.cm.state.suppressEdits){for(var r=e.history,n,o=e.sel,s="undo"==t?r.done:r.undone,a="undo"==t?r.undone:r.done,l=0;l<s.length&&(n=s[l],i?!n.ranges||n.equals(e.sel):n.ranges);l++);if(l!=s.length){for(r.lastOrigin=r.lastSelOrigin=null;n=s.pop(),n.ranges;){if(Hr(n,a),i&&!n.equals(e.sel))return void ce(e,n,{clearRedo:!1});o=n}var c=[];Hr(o,a),a.push({changes:c,generation:r.generation}),r.generation=n.generation||++r.maxGeneration;for(var d=Xr(e,"beforeChange")||e.cm&&Xr(e.cm,"beforeChange"),l=n.changes.length-1;l>=0;--l){var h=n.changes[l];if(h.origin=t,d&&!Gt(e,h,!1))return void(s.length=0);c.push(Mr(e,h));var u=l?qt(e,h,null):en(s);Zt(e,h,u,$i(e,h)),!l&&e.cm&&e.cm.scrollIntoView(h);var f=[];vr(e,function(e,t){t||-1!=tn(f,e.history)||(Wr(e.history,h),f.push(e.history)),Zt(e,h,null,$i(e,h))})}}}}function Jt(e,t){if(0!=t&&(e.first+=t,e.sel=new K(rn(e.sel.ranges,function(e){return new G(ao(e.anchor.line+t,e.anchor.ch),ao(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){rt(e.cm,e.first,e.first-t,t);for(var i=e.cm.display,r=i.viewFrom;r<i.viewTo;r++)nt(e.cm,r,"gutter")}}function Zt(e,t,i,r){if(e.cm&&!e.cm.curOp)return Je(e.cm,Zt)(e,t,i,r);if(t.to.line<e.first)return void Jt(e,t.text.length-1-(t.to.line-t.from.line));if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var n=t.text.length-1-(e.first-t.from.line);Jt(e,n),t={from:ao(e.first,0),to:ao(t.to.line+n,t.to.ch),text:[en(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:ao(o,yr(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=kr(e,t.from,t.to),i||(i=qt(e,t,null)),e.cm?ei(e.cm,t,r):pr(e,t,r),de(e,i,ns)}}function ei(e,t,i){var r=e.doc,n=e.display,s=t.from,a=t.to,l=!1,c=s.line;e.options.lineWrapping||(c=Cr(Wi(yr(r,s.line))),r.iter(c,a.line+1,function(e){return e==n.maxLine?(l=!0,!0):void 0})),r.sel.contains(t.from,t.to)>-1&&Gr(e),pr(r,t,i,o(e)),e.options.lineWrapping||(r.iter(c,s.line+t.text.length,function(e){var t=u(e);t>n.maxLineLength&&(n.maxLine=e,n.maxLineLength=t,n.maxLineChanged=!0,l=!1)}),l&&(e.curOp.updateMaxLine=!0)),r.frontier=Math.min(r.frontier,s.line),ye(e,400);var d=t.text.length-(a.line-s.line)-1;s.line!=a.line||1!=t.text.length||fr(e.doc,t)?rt(e,s.line,a.line+1,d):nt(e,s.line,"text");var h=Xr(e,"changes"),f=Xr(e,"change");if(f||h){var p={from:s,to:a,text:t.text,removed:t.removed,origin:t.origin};f&&qr(e,"change",e,p),h&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(p)}e.display.selForContextMenu=null}function ti(e,t,i,r,n){if(r||(r=i),lo(r,i)<0){var o=r;r=i,i=o}"string"==typeof t&&(t=ys(t)),Xt(e,{from:i,to:r,text:t,origin:n})}function ii(e,t){var i=e.display,r=i.sizer.getBoundingClientRect(),n=null;if(t.top+r.top<0?n=!0:t.bottom+r.top>(window.innerHeight||document.documentElement.clientHeight)&&(n=!1),null!=n&&!Qn){var o=dn("div","​",null,"position: absolute; top: "+(t.top-i.viewOffset-Ce(e.display))+"px; height: "+(t.bottom-t.top+is)+"px; left: "+t.left+"px; width: 2px;");e.display.lineSpace.appendChild(o),o.scrollIntoView(n),e.display.lineSpace.removeChild(o)}}function ri(e,t,i,r){for(null==r&&(r=0);;){var n=!1,o=je(e,t),s=i&&i!=t?je(e,i):o,a=oi(e,Math.min(o.left,s.left),Math.min(o.top,s.top)-r,Math.max(o.left,s.left),Math.max(o.bottom,s.bottom)+r),l=e.doc.scrollTop,c=e.doc.scrollLeft;if(null!=a.scrollTop&&(Et(e,a.scrollTop),Math.abs(e.doc.scrollTop-l)>1&&(n=!0)),null!=a.scrollLeft&&($t(e,a.scrollLeft),Math.abs(e.doc.scrollLeft-c)>1&&(n=!0)),!n)return o}}function ni(e,t,i,r,n){var o=oi(e,t,i,r,n);null!=o.scrollTop&&Et(e,o.scrollTop),null!=o.scrollLeft&&$t(e,o.scrollLeft)}function oi(e,t,i,r,n){var o=e.display,s=Ke(e.display);0>i&&(i=0);var a=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:o.scroller.scrollTop,l=o.scroller.clientHeight-is,c={},d=e.doc.height+Te(o),h=s>i,u=n>d-s;if(a>i)c.scrollTop=h?0:i;else if(n>a+l){var f=Math.min(i,(u?d:n)-l);f!=a&&(c.scrollTop=f)}var p=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:o.scroller.scrollLeft,g=o.scroller.clientWidth-is;t+=o.gutters.offsetWidth,r+=o.gutters.offsetWidth;var m=o.gutters.offsetWidth,v=m+10>t;return p+m>t||v?(v&&(t=0),c.scrollLeft=Math.max(0,t-10-m)):r>g+p-3&&(c.scrollLeft=r+10-g),c}function si(e,t,i){(null!=t||null!=i)&&li(e),null!=t&&(e.curOp.scrollLeft=(null==e.curOp.scrollLeft?e.doc.scrollLeft:e.curOp.scrollLeft)+t),null!=i&&(e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+i)}function ai(e){li(e);var t=e.getCursor(),i=t,r=t;e.options.lineWrapping||(i=t.ch?ao(t.line,t.ch-1):t,r=ao(t.line,t.ch+1)),e.curOp.scrollToPos={from:i,to:r,margin:e.options.cursorScrollMargin,isCursor:!0}}function li(e){var t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null;var i=_e(e,t.from),r=_e(e,t.to),n=oi(e,Math.min(i.left,r.left),Math.min(i.top,r.top)-t.margin,Math.max(i.right,r.right),Math.max(i.bottom,r.bottom)+t.margin);e.scrollTo(n.scrollLeft,n.scrollTop)}}function ci(e,t,i,r){var n=e.doc,o;null==i&&(i="add"),"smart"==i&&(e.doc.mode.indent?o=xe(e,t):i="prev");var s=e.options.tabSize,a=yr(n,t),l=as(a.text,null,s);a.stateAfter&&(a.stateAfter=null);var c=a.text.match(/^\s*/)[0],d;if(r||/\S/.test(a.text)){if("smart"==i&&(d=e.doc.mode.indent(o,a.text.slice(c.length),a.text),d==rs)){if(!r)return;i="prev"}}else d=0,i="not";"prev"==i?d=t>n.first?as(yr(n,t-1).text,null,s):0:"add"==i?d=l+e.options.indentUnit:"subtract"==i?d=l-e.options.indentUnit:"number"==typeof i&&(d=l+i),d=Math.max(0,d);var h="",u=0;if(e.options.indentWithTabs)for(var f=Math.floor(d/s);f;--f)u+=s,h+="	";if(d>u&&(h+=Zr(d-u)),h!=c)ti(e.doc,h,ao(t,0),ao(t,c.length),"+input");else for(var f=0;f<n.sel.ranges.length;f++){var p=n.sel.ranges[f];if(p.head.line==t&&p.head.ch<c.length){var u=ao(t,c.length);oe(n,f,new G(u,u));break}}a.stateAfter=null}function di(e,t,i,r){var n=t,o=t,s=e.doc;return"number"==typeof t?o=yr(s,Q(s,t)):n=Cr(t),null==n?null:(r(o,n)&&nt(e,n,i),o)}function hi(e,t){for(var i=e.doc.sel.ranges,r=[],n=0;n<i.length;n++){for(var o=t(i[n]);r.length&&lo(o.from,en(r).to)<=0;){var s=r.pop();if(lo(s.from,o.from)<0){o.from=s.from;break}}r.push(o)}Qe(e,function(){for(var t=r.length-1;t>=0;t--)ti(e.doc,"",r[t].from,r[t].to,"+delete");ai(e)})}function ui(e,t,i,r,n){function o(){var t=a+i;return t<e.first||t>=e.first+e.size?h=!1:(a=t,d=yr(e,t))}function s(e){var t=(n?zn:Rn)(d,l,i,!0);if(null==t){if(e||!o())return h=!1;l=n?(0>i?En:Mn)(d):0>i?d.text.length:0}else l=t;return!0}var a=t.line,l=t.ch,c=i,d=yr(e,a),h=!0;if("char"==r)s();else if("column"==r)s(!0);else if("word"==r||"group"==r)for(var u=null,f="group"==r,p=e.cm&&e.cm.getHelper(t,"wordChars"),g=!0;!(0>i)||s(!g);g=!1){var m=d.text.charAt(l)||"\n",v=an(m,p)?"w":f&&"\n"==m?"n":!f||/\s/.test(m)?null:"p";if(!f||g||v||(v="s"),u&&u!=v){0>i&&(i=1,s());break}if(v&&(u=v),i>0&&!s(!g))break}var b=pe(e,ao(a,l),c,!0);return h||(b.hitSide=!0),b}function fi(e,t,i,r){var n=e.doc,o=t.left,s;if("page"==r){var a=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);s=t.top+i*(a-(0>i?1.5:.5)*Ke(e.display))}else"line"==r&&(s=i>0?t.bottom+3:t.top-3);for(;;){var l=qe(e,o,s);if(!l.outside)break;if(0>i?0>=s:s>=n.height){l.hitSide=!0;break}s+=5*i}return l}function pi(e,t){var i=e.doc,r=yr(i,t.line).text,n=t.ch,o=t.ch;if(r){var s=e.getHelper(t,"wordChars");(t.xRel<0||o==r.length)&&n?--n:++o;for(var a=r.charAt(n),l=an(a,s)?function(e){return an(e,s)}:/\s/.test(a)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!an(e)};n>0&&l(r.charAt(n-1));)--n;for(;o<r.length&&l(r.charAt(o));)++o}return new G(ao(t.line,n),ao(t.line,o))}function gi(t,i,r,n){e.defaults[t]=i,r&&(xo[t]=n?function(e,t,i){i!=Co&&r(e,t,i)}:r)}function mi(e){return"string"==typeof e?Oo[e]:e}function vi(e,t,i,r,n){if(r&&r.shared)return bi(e,t,i,r,n);if(e.cm&&!e.cm.curOp)return Je(e.cm,vi)(e,t,i,r,n);var o=new Do(e,n),s=lo(t,i);if(r&&on(r,o,!1),s>0||0==s&&o.clearWhenEmpty!==!1)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=dn("span",[o.replacedWith],"CodeMirror-widget"),r.handleMouseEvents||(o.widgetNode.ignoreEvents=!0),r.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(Fi(e,t.line,t,i,o)||t.line!=i.line&&Fi(e,i.line,t,i,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");so=!0}o.addToHistory&&Nr(e,{from:t,to:i,origin:"markText"},e.sel,0/0);var a=t.line,l=e.cm,c;if(e.iter(a,i.line+1,function(e){l&&o.collapsed&&!l.options.lineWrapping&&Wi(e)==l.display.maxLine&&(c=!0),o.collapsed&&a!=t.line&&xr(e,0),Si(e,new xi(o,a==t.line?t.ch:null,a==i.line?i.ch:null)),++a}),o.collapsed&&e.iter(t.line,i.line+1,function(t){qi(e,t)&&xr(t,0)}),o.clearOnEnter&&Qo(o,"beforeCursorEnter",function(){o.clear()}),o.readOnly&&(oo=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed&&(o.id=++Bo,o.atomic=!0),l){if(c&&(l.curOp.updateMaxLine=!0),o.collapsed)rt(l,t.line,i.line+1);else if(o.className||o.title||o.startStyle||o.endStyle)for(var d=t.line;d<=i.line;d++)nt(l,d,"text");o.atomic&&ue(l.doc),qr(l,"markerAdded",l,o)}return o}function bi(e,t,i,r,n){r=on(r),r.shared=!1;var o=[vi(e,t,i,r,n)],s=o[0],a=r.widgetNode;return vr(e,function(e){a&&(r.widgetNode=a.cloneNode(!0)),o.push(vi(e,J(e,t),J(e,i),r,n));for(var l=0;l<e.linked.length;++l)if(e.linked[l].isParent)return;s=en(o)}),new Io(o,s)}function yi(e){return e.findMarks(ao(e.first,0),e.clipPos(ao(e.lastLine())),function(e){return e.parent})}function ki(e,t){for(var i=0;i<t.length;i++){var r=t[i],n=r.find(),o=e.clipPos(n.from),s=e.clipPos(n.to);if(lo(o,s)){var a=vi(e,o,s,r.primary,r.primary.type);r.markers.push(a),a.parent=r}}}function wi(e){for(var t=0;t<e.length;t++){var i=e[t],r=[i.primary.doc];vr(i.primary.doc,function(e){r.push(e)});for(var n=0;n<i.markers.length;n++){var o=i.markers[n];-1==tn(r,o.doc)&&(o.parent=null,i.markers.splice(n--,1))}}}function xi(e,t,i){this.marker=e,this.from=t,this.to=i}function Ci(e,t){if(e)for(var i=0;i<e.length;++i){var r=e[i];if(r.marker==t)return r}}function Ti(e,t){for(var i,r=0;r<e.length;++r)e[r]!=t&&(i||(i=[])).push(e[r]);return i}function Si(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function Li(e,t,i){if(e)for(var r=0,n;r<e.length;++r){var o=e[r],s=o.marker,a=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);if(a||o.from==t&&"bookmark"==s.type&&(!i||!o.marker.insertLeft)){var l=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new xi(s,o.from,l?null:o.to))}}return n}function Ai(e,t,i){if(e)for(var r=0,n;r<e.length;++r){var o=e[r],s=o.marker,a=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);if(a||o.from==t&&"bookmark"==s.type&&(!i||o.marker.insertLeft)){var l=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);(n||(n=[])).push(new xi(s,l?null:o.from-t,null==o.to?null:o.to-t))}}return n}function Mi(e,t){var i=ee(e,t.from.line)&&yr(e,t.from.line).markedSpans,r=ee(e,t.to.line)&&yr(e,t.to.line).markedSpans;if(!i&&!r)return null;var n=t.from.ch,o=t.to.ch,s=0==lo(t.from,t.to),a=Li(i,n,s),l=Ai(r,o,s),c=1==t.text.length,d=en(t.text).length+(c?n:0);if(a)for(var h=0;h<a.length;++h){var u=a[h];if(null==u.to){var f=Ci(l,u.marker);f?c&&(u.to=null==f.to?null:f.to+d):u.to=n}}if(l)for(var h=0;h<l.length;++h){var u=l[h];if(null!=u.to&&(u.to+=d),null==u.from){var f=Ci(a,u.marker);f||(u.from=d,c&&(a||(a=[])).push(u))}else u.from+=d,c&&(a||(a=[])).push(u)}a&&(a=Ei(a)),l&&l!=a&&(l=Ei(l));var p=[a];if(!c){var g=t.text.length-2,m;if(g>0&&a)for(var h=0;h<a.length;++h)null==a[h].to&&(m||(m=[])).push(new xi(a[h].marker,null,null));for(var h=0;g>h;++h)p.push(m);p.push(l)}return p}function Ei(e){for(var t=0;t<e.length;++t){var i=e[t];null!=i.from&&i.from==i.to&&i.marker.clearWhenEmpty!==!1&&e.splice(t--,1)}return e.length?e:null}function $i(e,t){var i=Dr(e,t),r=Mi(e,t);if(!i)return r;if(!r)return i;for(var n=0;n<i.length;++n){var o=i[n],s=r[n];if(o&&s)e:for(var a=0;a<s.length;++a){for(var l=s[a],c=0;c<o.length;++c)if(o[c].marker==l.marker)continue e;o.push(l)}else s&&(i[n]=s)}return i}function Ni(e,t,i){var r=null;if(e.iter(t.line,i.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var i=e.markedSpans[t].marker;!i.readOnly||r&&-1!=tn(r,i)||(r||(r=[])).push(i)}}),!r)return null;for(var n=[{from:t,to:i}],o=0;o<r.length;++o)for(var s=r[o],a=s.find(0),l=0;l<n.length;++l){var c=n[l];if(!(lo(c.to,a.from)<0||lo(c.from,a.to)>0)){var d=[l,1],h=lo(c.from,a.from),u=lo(c.to,a.to);(0>h||!s.inclusiveLeft&&!h)&&d.push({from:c.from,to:a.from}),(u>0||!s.inclusiveRight&&!u)&&d.push({from:a.to,to:c.to}),n.splice.apply(n,d),l+=d.length-1}}return n}function Oi(e){var t=e.markedSpans;if(t){for(var i=0;i<t.length;++i)t[i].marker.detachLine(e);e.markedSpans=null}}function Pi(e,t){if(t){for(var i=0;i<t.length;++i)t[i].marker.attachLine(e);e.markedSpans=t}}function Hi(e){return e.inclusiveLeft?-1:0}function zi(e){return e.inclusiveRight?1:0}function Ri(e,t){var i=e.lines.length-t.lines.length;if(0!=i)return i;var r=e.find(),n=t.find(),o=lo(r.from,n.from)||Hi(e)-Hi(t);if(o)return-o;var s=lo(r.to,n.to)||zi(e)-zi(t);return s?s:t.id-e.id}function Di(e,t){var i=so&&e.markedSpans,r;if(i)for(var n,o=0;o<i.length;++o)n=i[o],n.marker.collapsed&&null==(t?n.from:n.to)&&(!r||Ri(r,n.marker)<0)&&(r=n.marker);return r}function Bi(e){return Di(e,!0)}function Ii(e){return Di(e,!1)}function Fi(e,t,i,r,n){var o=yr(e,t),s=so&&o.markedSpans;if(s)for(var a=0;a<s.length;++a){var l=s[a];if(l.marker.collapsed){var c=l.marker.find(0),d=lo(c.from,i)||Hi(l.marker)-Hi(n),h=lo(c.to,r)||zi(l.marker)-zi(n);if(!(d>=0&&0>=h||0>=d&&h>=0)&&(0>=d&&(lo(c.to,i)||zi(l.marker)-Hi(n))>0||d>=0&&(lo(c.from,r)||Hi(l.marker)-zi(n))<0))return!0}}}function Wi(e){for(var t;t=Bi(e);)e=t.find(-1,!0).line;return e}function ji(e){for(var t,i;t=Ii(e);)e=t.find(1,!0).line,(i||(i=[])).push(e);return i}function _i(e,t){var i=yr(e,t),r=Wi(i);return i==r?t:Cr(r)}function Ui(e,t){if(t>e.lastLine())return t;var i=yr(e,t),r;if(!qi(e,i))return t;for(;r=Ii(i);)i=r.find(1,!0).line;return Cr(i)+1}function qi(e,t){var i=so&&t.markedSpans;if(i)for(var r,n=0;n<i.length;++n)if(r=i[n],r.marker.collapsed){if(null==r.from)return!0;if(!r.marker.widgetNode&&0==r.from&&r.marker.inclusiveLeft&&Vi(e,t,r))return!0}}function Vi(e,t,i){if(null==i.to){var r=i.marker.find(1,!0);return Vi(e,r.line,Ci(r.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==t.text.length)return!0;for(var n,o=0;o<t.markedSpans.length;++o)if(n=t.markedSpans[o],n.marker.collapsed&&!n.marker.widgetNode&&n.from==i.to&&(null==n.to||n.to!=i.from)&&(n.marker.inclusiveLeft||i.marker.inclusiveRight)&&Vi(e,t,n))return!0}function Ki(e,t,i){Sr(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&si(e,null,i)}function Gi(e){return null!=e.height?e.height:(fn(document.body,e.node)||un(e.cm.display.measure,dn("div",[e.node],null,"position: relative")),e.height=e.node.offsetHeight)}function Xi(e,t,i,r){var n=new Fo(e,i,r);return n.noHScroll&&(e.display.alignWidgets=!0),di(e,t,"widget",function(t){var i=t.widgets||(t.widgets=[]);if(null==n.insertAt?i.push(n):i.splice(Math.min(i.length-1,Math.max(0,n.insertAt)),0,n),n.line=t,!qi(e.doc,t)){var r=Sr(t)<e.doc.scrollTop;xr(t,t.height+Gi(n)),r&&si(e,null,n.height),e.curOp.forceUpdate=!0}return!0}),n}function Yi(e,t,i,r){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),Oi(e),Pi(e,i);var n=r?r(e):1;n!=e.height&&xr(e,n)}function Qi(e){e.parent=null,Oi(e)}function Ji(e,t){if(e)for(;;){var i=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;e=e.slice(0,i.index)+e.slice(i.index+i[0].length);var r=i[1]?"bgClass":"textClass";null==t[r]?t[r]=i[2]:new RegExp("(?:^|s)"+i[2]+"(?:$|s)").test(t[r])||(t[r]+=" "+i[2])}return e}function Zi(t,i){if(t.blankLine)return t.blankLine(i);if(t.innerMode){var r=e.innerMode(t,i);return r.mode.blankLine?r.mode.blankLine(r.state):void 0}}function er(e,t,i){for(var r=0;10>r;r++){var n=e.token(t,i);if(t.pos>t.start)return n}throw new Error("Mode "+e.name+" failed to advance stream.")}function tr(t,i,r,n,o,s,a){var l=r.flattenSpans;null==l&&(l=t.options.flattenSpans);var c=0,d=null,h=new Ro(i,t.options.tabSize),u;for(""==i&&Ji(Zi(r,n),s);!h.eol();){if(h.pos>t.options.maxHighlightLength?(l=!1,a&&nr(t,i,n,h.pos),h.pos=i.length,u=null):u=Ji(er(r,h,n),s),t.options.addModeClass){var f=e.innerMode(r,n).mode.name;f&&(u="m-"+(u?f+" "+u:f))}l&&d==u||(c<h.start&&o(h.start,d),c=h.start,d=u),h.start=h.pos}for(;c<h.pos;){var p=Math.min(h.pos,c+5e4);o(p,d),c=p}}function ir(e,t,i,r){var n=[e.state.modeGen],o={};tr(e,t.text,e.doc.mode,i,function(e,t){n.push(e,t)},o,r);for(var s=0;s<e.state.overlays.length;++s){var a=e.state.overlays[s],l=1,c=0;tr(e,t.text,a.mode,!0,function(e,t){for(var i=l;e>c;){var r=n[l];r>e&&n.splice(l,1,e,n[l+1],r),l+=2,c=Math.min(e,r)}if(t)if(a.opaque)n.splice(i,l-i,e,"cm-overlay "+t),l=i+2;else for(;l>i;i+=2){var o=n[i+1];n[i+1]=(o?o+" ":"")+"cm-overlay "+t}},o)}return{styles:n,classes:o.bgClass||o.textClass?o:null}}function rr(e,t){if(!t.styles||t.styles[0]!=e.state.modeGen){var i=ir(e,t,t.stateAfter=xe(e,Cr(t)));t.styles=i.styles,i.classes?t.styleClasses=i.classes:t.styleClasses&&(t.styleClasses=null)}return t.styles}function nr(e,t,i,r){var n=e.doc.mode,o=new Ro(t,e.options.tabSize);for(o.start=o.pos=r||0,""==t&&Zi(n,i);!o.eol()&&o.pos<=e.options.maxHighlightLength;)er(n,o,i),o.start=o.pos}function or(e,t){if(!e||/^\s*$/.test(e))return null;var i=t.addModeClass?_o:jo;return i[e]||(i[e]=e.replace(/\S+/g,"cm-$&"))}function sr(e,t){var i=dn("span",null,null,Un?"padding-right: .1px":null),r={pre:dn("pre",[i]),content:i,col:0,pos:0,cm:e};t.measure={};for(var n=0;n<=(t.rest?t.rest.length:0);n++){var o=n?t.rest[n-1]:t.line,s;r.pos=0,r.addToken=lr,(_n||Un)&&e.getOption("lineWrapping")&&(r.addToken=cr(r.addToken)),Tn(e.display.measure)&&(s=Lr(o))&&(r.addToken=dr(r.addToken,s)),r.map=[],ur(o,r,rr(e,o)),o.styleClasses&&(o.styleClasses.bgClass&&(r.bgClass=bn(o.styleClasses.bgClass,r.bgClass||"")),o.styleClasses.textClass&&(r.textClass=bn(o.styleClasses.textClass,r.textClass||""))),0==r.map.length&&r.map.push(0,0,r.content.appendChild(Cn(e.display.measure))),0==n?(t.measure.map=r.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(r.map),(t.measure.caches||(t.measure.caches=[])).push({}))}return Zo(e,"renderLine",e,t.line,r.pre),r.pre.className&&(r.textClass=bn(r.pre.className,r.textClass||"")),r}function ar(e){var t=dn("span","•","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t}function lr(e,t,i,r,n,o){if(t){var s=e.cm.options.specialChars,a=!1;if(s.test(t))for(var l=document.createDocumentFragment(),c=0;;){s.lastIndex=c;var d=s.exec(t),h=d?d.index-c:t.length-c;if(h){var u=document.createTextNode(t.slice(c,c+h));l.appendChild(Fn?dn("span",[u]):u),e.map.push(e.pos,e.pos+h,u),e.col+=h,e.pos+=h}if(!d)break;if(c+=h+1,"	"==d[0]){var f=e.cm.options.tabSize,p=f-e.col%f,u=l.appendChild(dn("span",Zr(p),"cm-tab"));e.col+=p}else{var u=e.cm.options.specialCharPlaceholder(d[0]);l.appendChild(Fn?dn("span",[u]):u),e.col+=1}e.map.push(e.pos,e.pos+1,u),e.pos++}else{e.col+=t.length;var l=document.createTextNode(t);e.map.push(e.pos,e.pos+t.length,l),Fn&&(a=!0),e.pos+=t.length}if(i||r||n||a){var g=i||"";r&&(g+=r),n&&(g+=n);var m=dn("span",[l],g);return o&&(m.title=o),e.content.appendChild(m)}e.content.appendChild(l)}}function cr(e){function t(e){for(var t=" ",i=0;i<e.length-2;++i)t+=i%2?" ":" ";return t+=" "}return function(i,r,n,o,s,a){e(i,r.replace(/ {3,}/g,t),n,o,s,a)}}function dr(e,t){return function(i,r,n,o,s,a){n=n?n+" cm-force-border":"cm-force-border";for(var l=i.pos,c=l+r.length;;){for(var d=0;d<t.length;d++){var h=t[d];if(h.to>l&&h.from<=l)break}if(h.to>=c)return e(i,r,n,o,s,a);e(i,r.slice(0,h.to-l),n,o,null,a),o=null,r=r.slice(h.to-l),l=h.to}}}function hr(e,t,i,r){var n=!r&&i.widgetNode;n&&(e.map.push(e.pos,e.pos+t,n),e.content.appendChild(n)),e.pos+=t}function ur(e,t,i){var r=e.markedSpans,n=e.text,o=0;if(r)for(var s=n.length,a=0,l=1,c="",d,h=0,u,f,p,g,m;;){if(h==a){u=f=p=g="",m=null,h=1/0;for(var v=[],b=0;b<r.length;++b){var y=r[b],k=y.marker;y.from<=a&&(null==y.to||y.to>a)?(null!=y.to&&h>y.to&&(h=y.to,f=""),k.className&&(u+=" "+k.className),k.startStyle&&y.from==a&&(p+=" "+k.startStyle),k.endStyle&&y.to==h&&(f+=" "+k.endStyle),k.title&&!g&&(g=k.title),k.collapsed&&(!m||Ri(m.marker,k)<0)&&(m=y)):y.from>a&&h>y.from&&(h=y.from),"bookmark"==k.type&&y.from==a&&k.widgetNode&&v.push(k)}if(m&&(m.from||0)==a&&(hr(t,(null==m.to?s+1:m.to)-a,m.marker,null==m.from),null==m.to))return;if(!m&&v.length)for(var b=0;b<v.length;++b)hr(t,0,v[b])}if(a>=s)break;for(var w=Math.min(s,h);;){if(c){var x=a+c.length;if(!m){var C=x>w?c.slice(0,w-a):c;t.addToken(t,C,d?d+u:u,p,a+C.length==h?f:"",g)}if(x>=w){c=c.slice(w-a),a=w;break}a=x,p=""}c=n.slice(o,o=i[l++]),d=or(i[l++],t.cm.options)}}else for(var l=1;l<i.length;l+=2)t.addToken(t,n.slice(o,o=i[l]),or(i[l+1],t.cm.options))}function fr(e,t){return 0==t.from.ch&&0==t.to.ch&&""==en(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function pr(e,t,i,r){function n(e){return i?i[e]:null}function o(e,i,n){Yi(e,i,n,r),qr(e,"change",e,t)}var s=t.from,a=t.to,l=t.text,c=yr(e,s.line),d=yr(e,a.line),h=en(l),u=n(l.length-1),f=a.line-s.line;if(fr(e,t)){for(var p=0,g=[];p<l.length-1;++p)g.push(new Wo(l[p],n(p),r));o(d,d.text,u),f&&e.remove(s.line,f),g.length&&e.insert(s.line,g)}else if(c==d)if(1==l.length)o(c,c.text.slice(0,s.ch)+h+c.text.slice(a.ch),u);else{for(var g=[],p=1;p<l.length-1;++p)g.push(new Wo(l[p],n(p),r));g.push(new Wo(h+c.text.slice(a.ch),u,r)),o(c,c.text.slice(0,s.ch)+l[0],n(0)),e.insert(s.line+1,g)}else if(1==l.length)o(c,c.text.slice(0,s.ch)+l[0]+d.text.slice(a.ch),n(0)),e.remove(s.line+1,f);else{o(c,c.text.slice(0,s.ch)+l[0],n(0)),o(d,h+d.text.slice(a.ch),u);for(var p=1,g=[];p<l.length-1;++p)g.push(new Wo(l[p],n(p),r));f>1&&e.remove(s.line+1,f-1),e.insert(s.line+1,g)}qr(e,"change",e,t)}function gr(e){this.lines=e,this.parent=null;for(var t=0,i=0;t<e.length;++t)e[t].parent=this,i+=e[t].height;this.height=i}function mr(e){this.children=e;for(var t=0,i=0,r=0;r<e.length;++r){var n=e[r];t+=n.chunkSize(),i+=n.height,n.parent=this}this.size=t,this.height=i,this.parent=null}function vr(e,t,i){
function r(e,n,o){if(e.linked)for(var s=0;s<e.linked.length;++s){var a=e.linked[s];if(a.doc!=n){var l=o&&a.sharedHist;(!i||l)&&(t(a.doc,l),r(a.doc,e,l))}}}r(e,null,!0)}function br(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,s(e),i(e),e.options.lineWrapping||f(e),e.options.mode=t.modeOption,rt(e)}function yr(e,t){if(t-=e.first,0>t||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var i=e;!i.lines;)for(var r=0;;++r){var n=i.children[r],o=n.chunkSize();if(o>t){i=n;break}t-=o}return i.lines[t]}function kr(e,t,i){var r=[],n=t.line;return e.iter(t.line,i.line+1,function(e){var o=e.text;n==i.line&&(o=o.slice(0,i.ch)),n==t.line&&(o=o.slice(t.ch)),r.push(o),++n}),r}function wr(e,t,i){var r=[];return e.iter(t,i,function(e){r.push(e.text)}),r}function xr(e,t){var i=t-e.height;if(i)for(var r=e;r;r=r.parent)r.height+=i}function Cr(e){if(null==e.parent)return null;for(var t=e.parent,i=tn(t.lines,e),r=t.parent;r;t=r,r=r.parent)for(var n=0;r.children[n]!=t;++n)i+=r.children[n].chunkSize();return i+t.first}function Tr(e,t){var i=e.first;e:do{for(var r=0;r<e.children.length;++r){var n=e.children[r],o=n.height;if(o>t){e=n;continue e}t-=o,i+=n.chunkSize()}return i}while(!e.lines);for(var r=0;r<e.lines.length;++r){var s=e.lines[r],a=s.height;if(a>t)break;t-=a}return i+r}function Sr(e){e=Wi(e);for(var t=0,i=e.parent,r=0;r<i.lines.length;++r){var n=i.lines[r];if(n==e)break;t+=n.height}for(var o=i.parent;o;i=o,o=i.parent)for(var r=0;r<o.children.length;++r){var s=o.children[r];if(s==i)break;t+=s.height}return t}function Lr(e){var t=e.order;return null==t&&(t=e.order=Ts(e.text)),t}function Ar(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function Mr(e,t){var i={from:U(t.from),to:ko(t),text:kr(e,t.from,t.to)};return zr(e,i,t.from.line,t.to.line+1),vr(e,function(e){zr(e,i,t.from.line,t.to.line+1)},!0),i}function Er(e){for(;e.length;){var t=en(e);if(!t.ranges)break;e.pop()}}function $r(e,t){return t?(Er(e.done),en(e.done)):e.done.length&&!en(e.done).ranges?en(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),en(e.done)):void 0}function Nr(e,t,i,r){var n=e.history;n.undone.length=0;var o=+new Date,s;if((n.lastOp==r||n.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&n.lastModTime>o-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(s=$r(n,n.lastOp==r))){var a=en(s.changes);0==lo(t.from,t.to)&&0==lo(t.from,a.to)?a.to=ko(t):s.changes.push(Mr(e,t))}else{var l=en(n.done);for(l&&l.ranges||Hr(e.sel,n.done),s={changes:[Mr(e,t)],generation:n.generation},n.done.push(s);n.done.length>n.undoDepth;)n.done.shift(),n.done[0].ranges||n.done.shift()}n.done.push(i),n.generation=++n.maxGeneration,n.lastModTime=n.lastSelTime=o,n.lastOp=r,n.lastOrigin=n.lastSelOrigin=t.origin,a||Zo(e,"historyAdded")}function Or(e,t,i,r){var n=t.charAt(0);return"*"==n||"+"==n&&i.ranges.length==r.ranges.length&&i.somethingSelected()==r.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function Pr(e,t,i,r){var n=e.history,o=r&&r.origin;i==n.lastOp||o&&n.lastSelOrigin==o&&(n.lastModTime==n.lastSelTime&&n.lastOrigin==o||Or(e,o,en(n.done),t))?n.done[n.done.length-1]=t:Hr(t,n.done),n.lastSelTime=+new Date,n.lastSelOrigin=o,n.lastOp=i,r&&r.clearRedo!==!1&&Er(n.undone)}function Hr(e,t){var i=en(t);i&&i.ranges&&i.equals(e)||t.push(e)}function zr(e,t,i,r){var n=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,i),Math.min(e.first+e.size,r),function(i){i.markedSpans&&((n||(n=t["spans_"+e.id]={}))[o]=i.markedSpans),++o})}function Rr(e){if(!e)return null;for(var t=0,i;t<e.length;++t)e[t].marker.explicitlyCleared?i||(i=e.slice(0,t)):i&&i.push(e[t]);return i?i.length?i:null:e}function Dr(e,t){var i=t["spans_"+e.id];if(!i)return null;for(var r=0,n=[];r<t.text.length;++r)n.push(Rr(i[r]));return n}function Br(e,t,i){for(var r=0,n=[];r<e.length;++r){var o=e[r];if(o.ranges)n.push(i?K.prototype.deepCopy.call(o):o);else{var s=o.changes,a=[];n.push({changes:a});for(var l=0;l<s.length;++l){var c=s[l],d;if(a.push({from:c.from,to:c.to,text:c.text}),t)for(var h in c)(d=h.match(/^spans_(\d+)$/))&&tn(t,Number(d[1]))>-1&&(en(a)[h]=c[h],delete c[h])}}}return n}function Ir(e,t,i,r){i<e.line?e.line+=r:t<e.line&&(e.line=t,e.ch=0)}function Fr(e,t,i,r){for(var n=0;n<e.length;++n){var o=e[n],s=!0;if(o.ranges){o.copied||(o=e[n]=o.deepCopy(),o.copied=!0);for(var a=0;a<o.ranges.length;a++)Ir(o.ranges[a].anchor,t,i,r),Ir(o.ranges[a].head,t,i,r)}else{for(var a=0;a<o.changes.length;++a){var l=o.changes[a];if(i<l.from.line)l.from=ao(l.from.line+r,l.from.ch),l.to=ao(l.to.line+r,l.to.ch);else if(t<=l.to.line){s=!1;break}}s||(e.splice(0,n+1),n=0)}}}function Wr(e,t){var i=t.from.line,r=t.to.line,n=t.text.length-(r-i)-1;Fr(e.done,i,r,n),Fr(e.undone,i,r,n)}function jr(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function _r(e){return e.target||e.srcElement}function Ur(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),eo&&e.ctrlKey&&1==t&&(t=3),t}function qr(e,t){function i(e){return function(){e.apply(null,n)}}var r=e._handlers&&e._handlers[t];if(r){var n=Array.prototype.slice.call(arguments,2);es||(++ts,es=[],setTimeout(Vr,0));for(var o=0;o<r.length;++o)es.push(i(r[o]))}}function Vr(){--ts;var e=es;es=null;for(var t=0;t<e.length;++t)e[t]()}function Kr(e,t,i){return Zo(e,i||t.type,e,t),jr(t)||t.codemirrorIgnore}function Gr(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var i=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),r=0;r<t.length;++r)-1==tn(i,t[r])&&i.push(t[r])}function Xr(e,t){var i=e._handlers&&e._handlers[t];return i&&i.length>0}function Yr(e){e.prototype.on=function(e,t){Qo(this,e,t)},e.prototype.off=function(e,t){Jo(this,e,t)}}function Qr(){this.id=null}function Jr(e,t,i){for(var r=0,n=0;;){var o=e.indexOf("	",r);-1==o&&(o=e.length);var s=o-r;if(o==e.length||n+s>=t)return r+Math.min(s,t-n);if(n+=o-r,n+=i-n%i,r=o+1,n>=t)return r}}function Zr(e){for(;ls.length<=e;)ls.push(en(ls)+" ");return ls[e]}function en(e){return e[e.length-1]}function tn(e,t){for(var i=0;i<e.length;++i)if(e[i]==t)return i;return-1}function rn(e,t){for(var i=[],r=0;r<e.length;r++)i[r]=t(e[r],r);return i}function nn(e,t){var i;if(Object.create)i=Object.create(e);else{var r=function(){};r.prototype=e,i=new r}return t&&on(t,i),i}function on(e,t,i){t||(t={});for(var r in e)!e.hasOwnProperty(r)||i===!1&&t.hasOwnProperty(r)||(t[r]=e[r]);return t}function sn(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function an(e,t){return t?t.source.indexOf("\\w")>-1&&hs(e)?!0:t.test(e):hs(e)}function ln(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function cn(e){return e.charCodeAt(0)>=768&&us.test(e)}function dn(e,t,i,r){var n=document.createElement(e);if(i&&(n.className=i),r&&(n.style.cssText=r),"string"==typeof t)n.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)n.appendChild(t[o]);return n}function hn(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function un(e,t){return hn(e).appendChild(t)}function fn(e,t){if(e.contains)return e.contains(t);for(;t=t.parentNode;)if(t==e)return!0}function pn(){return document.activeElement}function gn(e){return new RegExp("\\b"+e+"\\b\\s*")}function mn(e,t){var i=gn(t);i.test(e.className)&&(e.className=e.className.replace(i,""))}function vn(e,t){gn(t).test(e.className)||(e.className+=" "+t)}function bn(e,t){for(var i=e.split(" "),r=0;r<i.length;r++)i[r]&&!gn(i[r]).test(t)&&(t+=" "+i[r]);return t}function yn(e){if(document.body.getElementsByClassName)for(var t=document.body.getElementsByClassName("CodeMirror"),i=0;i<t.length;i++){var r=t[i].CodeMirror;r&&e(r)}}function kn(){ps||(wn(),ps=!0)}function wn(){var e;Qo(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,ms=null,yn(bt)},100))}),Qo(window,"blur",function(){yn(Wt)})}function xn(e){if(null!=ms)return ms;var t=dn("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return un(e,t),t.offsetWidth&&(ms=t.offsetHeight-t.clientHeight),ms||0}function Cn(e){if(null==vs){var t=dn("span","​");un(e,dn("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(vs=t.offsetWidth<=1&&t.offsetHeight>2&&!In)}return vs?dn("span","​"):dn("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px")}function Tn(e){if(null!=bs)return bs;var t=un(e,document.createTextNode("AخA")),i=fs(t,0,1).getBoundingClientRect();if(i.left==i.right)return!1;var r=fs(t,1,2).getBoundingClientRect();return bs=r.right-i.right<3}function Sn(e,t,i,r){if(!e)return r(t,i,"ltr");for(var n=!1,o=0;o<e.length;++o){var s=e[o];(s.from<i&&s.to>t||t==i&&s.to==t)&&(r(Math.max(s.from,t),Math.min(s.to,i),1==s.level?"rtl":"ltr"),n=!0)}n||r(t,i,"ltr")}function Ln(e){return e.level%2?e.to:e.from}function An(e){return e.level%2?e.from:e.to}function Mn(e){var t=Lr(e);return t?Ln(t[0]):0}function En(e){var t=Lr(e);return t?An(en(t)):e.text.length}function $n(e,t){var i=yr(e.doc,t),r=Wi(i);r!=i&&(t=Cr(r));var n=Lr(r),o=n?n[0].level%2?En(r):Mn(r):0;return ao(t,o)}function Nn(e,t){for(var i,r=yr(e.doc,t);i=Ii(r);)r=i.find(1,!0).line,t=null;var n=Lr(r),o=n?n[0].level%2?Mn(r):En(r):r.text.length;return ao(null==t?Cr(r):t,o)}function On(e,t,i){var r=e[0].level;return t==r?!0:i==r?!1:i>t}function Pn(e,t){Cs=null;for(var i=0,r;i<e.length;++i){var n=e[i];if(n.from<t&&n.to>t)return i;if(n.from==t||n.to==t){if(null!=r)return On(e,n.level,e[r].level)?(n.from!=n.to&&(Cs=r),i):(n.from!=n.to&&(Cs=i),r);r=i}}return r}function Hn(e,t,i,r){if(!r)return t+i;do t+=i;while(t>0&&cn(e.text.charAt(t)));return t}function zn(e,t,i,r){var n=Lr(e);if(!n)return Rn(e,t,i,r);for(var o=Pn(n,t),s=n[o],a=Hn(e,t,s.level%2?-i:i,r);;){if(a>s.from&&a<s.to)return a;if(a==s.from||a==s.to)return Pn(n,a)==o?a:(s=n[o+=i],i>0==s.level%2?s.to:s.from);if(s=n[o+=i],!s)return null;a=i>0==s.level%2?Hn(e,s.to,-1,r):Hn(e,s.from,1,r)}}function Rn(e,t,i,r){var n=t+i;if(r)for(;n>0&&cn(e.text.charAt(n));)n+=i;return 0>n||n>e.text.length?null:n}var Dn=/gecko\/\d/i.test(navigator.userAgent),Bn=/MSIE \d/.test(navigator.userAgent),In=Bn&&(null==document.documentMode||document.documentMode<8),Fn=Bn&&(null==document.documentMode||document.documentMode<9),Wn=Bn&&(null==document.documentMode||document.documentMode<10),jn=/Trident\/([7-9]|\d{2,})\./.test(navigator.userAgent),_n=Bn||jn,Un=/WebKit\//.test(navigator.userAgent),qn=Un&&/Qt\/\d+\.\d+/.test(navigator.userAgent),Vn=/Chrome\//.test(navigator.userAgent),Kn=/Opera\//.test(navigator.userAgent),Gn=/Apple Computer/.test(navigator.vendor),Xn=/KHTML\//.test(navigator.userAgent),Yn=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Qn=/PhantomJS/.test(navigator.userAgent),Jn=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Zn=Jn||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),eo=Jn||/Mac/.test(navigator.platform),to=/win/i.test(navigator.platform),io=Kn&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);io&&(io=Number(io[1])),io&&io>=15&&(Kn=!1,Un=!0);var ro=eo&&(qn||Kn&&(null==io||12.11>io)),no=Dn||_n&&!Fn,oo=!1,so=!1,ao=e.Pos=function(e,t){return this instanceof ao?(this.line=e,void(this.ch=t)):new ao(e,t)},lo=e.cmpPos=function(e,t){return e.line-t.line||e.ch-t.ch};K.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var i=this.ranges[t],r=e.ranges[t];if(0!=lo(i.anchor,r.anchor)||0!=lo(i.head,r.head))return!1}return!0},deepCopy:function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new G(U(this.ranges[t].anchor),U(this.ranges[t].head));return new K(e,this.primIndex)},somethingSelected:function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},contains:function(e,t){t||(t=e);for(var i=0;i<this.ranges.length;i++){var r=this.ranges[i];if(lo(t,r.from())>=0&&lo(e,r.to())<=0)return i}return-1}},G.prototype={from:function(){return V(this.anchor,this.head)},to:function(){return q(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var co={left:0,right:0,top:0,bottom:0},ho,uo=0,fo,po,go=0,mo=0,vo=null;_n?vo=-.53:Dn?vo=15:Vn?vo=-.7:Gn&&(vo=-1/3);var bo,yo=null,ko=e.changeEnd=function(e){return e.text?ao(e.from.line+e.text.length-1,en(e.text).length+(1==e.text.length?e.from.ch:0)):e.to};e.prototype={constructor:e,focus:function(){window.focus(),pt(this),ht(this)},setOption:function(e,t){var i=this.options,r=i[e];(i[e]!=t||"mode"==e)&&(i[e]=t,xo.hasOwnProperty(e)&&Je(this,xo[e])(this,t,r))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](e)},removeKeyMap:function(e){for(var t=this.state.keyMaps,i=0;i<t.length;++i)if(t[i]==e||"string"!=typeof t[i]&&t[i].name==e)return t.splice(i,1),!0},addOverlay:Ze(function(t,i){var r=t.token?t:e.getMode(this.options,t);if(r.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:r,modeSpec:t,opaque:i&&i.opaque}),this.state.modeGen++,rt(this)}),removeOverlay:Ze(function(e){for(var t=this.state.overlays,i=0;i<t.length;++i){var r=t[i].modeSpec;if(r==e||"string"==typeof e&&r.name==e)return t.splice(i,1),this.state.modeGen++,void rt(this)}}),indentLine:Ze(function(e,t,i){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),ee(this.doc,e)&&ci(this,e,t,i)}),indentSelection:Ze(function(e){for(var t=this.doc.sel.ranges,i=-1,r=0;r<t.length;r++){var n=t[r];if(n.empty())n.head.line>i&&(ci(this,n.head.line,e,!0),i=n.head.line,r==this.doc.sel.primIndex&&ai(this));else{var o=Math.max(i,n.from().line),s=n.to();i=Math.min(this.lastLine(),s.line-(s.ch?0:1))+1;for(var a=o;i>a;++a)ci(this,a,e)}}}),getTokenAt:function(e,t){var i=this.doc;e=J(i,e);for(var r=xe(this,e.line,t),n=this.doc.mode,o=yr(i,e.line),s=new Ro(o.text,this.options.tabSize);s.pos<e.ch&&!s.eol();){s.start=s.pos;var a=er(n,s,r)}return{start:s.start,end:s.pos,string:s.current(),type:a||null,state:r}},getTokenTypeAt:function(e){e=J(this.doc,e);var t=rr(this,yr(this.doc,e.line)),i=0,r=(t.length-1)/2,n=e.ch,o;if(0==n)o=t[2];else for(;;){var s=i+r>>1;if((s?t[2*s-1]:0)>=n)r=s;else{if(!(t[2*s+1]<n)){o=t[2*s+2];break}i=s+1}}var a=o?o.indexOf("cm-overlay "):-1;return 0>a?o:0==a?null:o.slice(0,a-1)},getModeAt:function(t){var i=this.doc.mode;return i.innerMode?e.innerMode(i,this.getTokenAt(t).state).mode:i},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var i=[];if(!Mo.hasOwnProperty(t))return Mo;var r=Mo[t],n=this.getModeAt(e);if("string"==typeof n[t])r[n[t]]&&i.push(r[n[t]]);else if(n[t])for(var o=0;o<n[t].length;o++){var s=r[n[t][o]];s&&i.push(s)}else n.helperType&&r[n.helperType]?i.push(r[n.helperType]):r[n.name]&&i.push(r[n.name]);for(var o=0;o<r._global.length;o++){var a=r._global[o];a.pred(n,this)&&-1==tn(i,a.val)&&i.push(a.val)}return i},getStateAfter:function(e,t){var i=this.doc;return e=Q(i,null==e?i.first+i.size-1:e),xe(this,e+1,t)},cursorCoords:function(e,t){var i,r=this.doc.sel.primary();return i=null==e?r.head:"object"==typeof e?J(this.doc,e):e?r.from():r.to(),je(this,i,t||"page")},charCoords:function(e,t){return We(this,J(this.doc,e),t||"page")},coordsChar:function(e,t){return e=Fe(this,e,t||"page"),qe(this,e.left,e.top)},lineAtHeight:function(e,t){return e=Fe(this,{top:e,left:0},t||"page").top,Tr(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t){var i=!1,r=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>r&&(e=r,i=!0);var n=yr(this.doc,e);return Ie(this,n,{top:0,left:0},t||"page").top+(i?this.doc.height-Sr(n):0)},defaultTextHeight:function(){return Ke(this.display)},defaultCharWidth:function(){return Ge(this.display)},setGutterMarker:Ze(function(e,t,i){return di(this,e,"gutter",function(e){var r=e.gutterMarkers||(e.gutterMarkers={});return r[t]=i,!i&&ln(r)&&(e.gutterMarkers=null),!0})}),clearGutter:Ze(function(e){var t=this,i=t.doc,r=i.first;i.iter(function(i){i.gutterMarkers&&i.gutterMarkers[e]&&(i.gutterMarkers[e]=null,nt(t,r,"gutter"),ln(i.gutterMarkers)&&(i.gutterMarkers=null)),++r})}),addLineClass:Ze(function(e,t,i){return di(this,e,"class",function(e){var r="text"==t?"textClass":"background"==t?"bgClass":"wrapClass";if(e[r]){if(new RegExp("(?:^|\\s)"+i+"(?:$|\\s)").test(e[r]))return!1;e[r]+=" "+i}else e[r]=i;return!0})}),removeLineClass:Ze(function(e,t,i){return di(this,e,"class",function(e){var r="text"==t?"textClass":"background"==t?"bgClass":"wrapClass",n=e[r];if(!n)return!1;if(null==i)e[r]=null;else{var o=n.match(new RegExp("(?:^|\\s+)"+i+"(?:$|\\s+)"));if(!o)return!1;var s=o.index+o[0].length;e[r]=n.slice(0,o.index)+(o.index&&s!=n.length?" ":"")+n.slice(s)||null}return!0})}),addLineWidget:Ze(function(e,t,i){return Xi(this,e,t,i)}),removeLineWidget:function(e){e.clear()},lineInfo:function(e){if("number"==typeof e){if(!ee(this.doc,e))return null;var t=e;if(e=yr(this.doc,e),!e)return null}else{var t=Cr(e);if(null==t)return null}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,i,r,n){var o=this.display;e=je(this,J(this.doc,e));var s=e.bottom,a=e.left;if(t.style.position="absolute",o.sizer.appendChild(t),"over"==r)s=e.top;else if("above"==r||"near"==r){var l=Math.max(o.wrapper.clientHeight,this.doc.height),c=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==r||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight?s=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=l&&(s=e.bottom),a+t.offsetWidth>c&&(a=c-t.offsetWidth)}t.style.top=s+"px",t.style.left=t.style.right="","right"==n?(a=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==n?a=0:"middle"==n&&(a=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=a+"px"),i&&ni(this,a,s,a+t.offsetWidth,s+t.offsetHeight)},triggerOnKeyDown:Ze(Rt),triggerOnKeyPress:Ze(It),triggerOnKeyUp:Ze(Bt),execCommand:function(e){return No.hasOwnProperty(e)?No[e](this):void 0},findPosH:function(e,t,i,r){var n=1;0>t&&(n=-1,t=-t);for(var o=0,s=J(this.doc,e);t>o&&(s=ui(this.doc,s,n,i,r),!s.hitSide);++o);return s},moveH:Ze(function(e,t){var i=this;i.extendSelectionsBy(function(r){return i.display.shift||i.doc.extend||r.empty()?ui(i.doc,r.head,e,t,i.options.rtlMoveVisually):0>e?r.from():r.to()},ss)}),deleteH:Ze(function(e,t){var i=this.doc.sel,r=this.doc;i.somethingSelected()?r.replaceSelection("",null,"+delete"):hi(this,function(i){var n=ui(r,i.head,e,t,!1);return 0>e?{from:n,to:i.head}:{from:i.head,to:n}})}),findPosV:function(e,t,i,r){var n=1,o=r;0>t&&(n=-1,t=-t);for(var s=0,a=J(this.doc,e);t>s;++s){var l=je(this,a,"div");if(null==o?o=l.left:l.left=o,a=fi(this,l,n,i),a.hitSide)break}return a},moveV:Ze(function(e,t){var i=this,r=this.doc,n=[],o=!i.display.shift&&!r.extend&&r.sel.somethingSelected();if(r.extendSelectionsBy(function(s){if(o)return 0>e?s.from():s.to();var a=je(i,s.head,"div");null!=s.goalColumn&&(a.left=s.goalColumn),n.push(a.left);var l=fi(i,a,e,t);return"page"==t&&s==r.sel.primary()&&si(i,null,We(i,l,"div").top-a.top),l},ss),n.length)for(var s=0;s<r.sel.ranges.length;s++)r.sel.ranges[s].goalColumn=n[s]}),toggleOverwrite:function(e){(null==e||e!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?vn(this.display.cursorDiv,"CodeMirror-overwrite"):mn(this.display.cursorDiv,"CodeMirror-overwrite"),Zo(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return pn()==this.display.input},scrollTo:Ze(function(e,t){(null!=e||null!=t)&&li(this),null!=e&&(this.curOp.scrollLeft=e),null!=t&&(this.curOp.scrollTop=t)}),getScrollInfo:function(){var e=this.display.scroller,t=is;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-t,width:e.scrollWidth-t,clientHeight:e.clientHeight-t,clientWidth:e.clientWidth-t}},scrollIntoView:Ze(function(e,t){if(null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:ao(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line)li(this),this.curOp.scrollToPos=e;else{var i=oi(this,Math.min(e.from.left,e.to.left),Math.min(e.from.top,e.to.top)-e.margin,Math.max(e.from.right,e.to.right),Math.max(e.from.bottom,e.to.bottom)+e.margin);this.scrollTo(i.scrollLeft,i.scrollTop)}}),setSize:Ze(function(e,t){function i(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e}null!=e&&(this.display.wrapper.style.width=i(e)),null!=t&&(this.display.wrapper.style.height=i(t)),this.options.lineWrapping&&ze(this),this.curOp.forceUpdate=!0,Zo(this,"refresh",this)}),operation:function(e){return Qe(this,e)},refresh:Ze(function(){var e=this.display.cachedTextHeight;rt(this),this.curOp.forceUpdate=!0,Re(this),this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop),h(this),(null==e||Math.abs(e-Ke(this.display))>.5)&&s(this),Zo(this,"refresh",this)}),swapDoc:Ze(function(e){var t=this.doc;return t.cm=null,br(this,e),Re(this),ft(this),this.scrollTo(e.scrollLeft,e.scrollTop),qr(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Yr(e);var wo=e.defaults={},xo=e.optionHandlers={},Co=e.Init={toString:function(){return"CodeMirror.Init"}};gi("value","",function(e,t){e.setValue(t)},!0),gi("mode",null,function(e,t){e.doc.modeOption=t,i(e)},!0),gi("indentUnit",2,i,!0),gi("indentWithTabs",!1),gi("smartIndent",!0),gi("tabSize",4,function(e){r(e),Re(e),rt(e)},!0),gi("specialChars",/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\ufeff]/g,function(e,t){e.options.specialChars=new RegExp(t.source+(t.test("	")?"":"|	"),"g"),e.refresh()},!0),gi("specialCharPlaceholder",ar,function(e){e.refresh()},!0),gi("electricChars",!0),gi("rtlMoveVisually",!to),gi("wholeLineUpdateBefore",!0),gi("theme","default",function(e){l(e),c(e)},!0),gi("keyMap","default",a),gi("extraKeys",null),gi("lineWrapping",!1,n,!0),gi("gutters",[],function(e){p(e.options),c(e)},!0),gi("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?w(e.display)+"px":"0",e.refresh()},!0),gi("coverGutterNextToScrollbar",!1,m,!0),gi("lineNumbers",!1,function(e){p(e.options),c(e)},!0),gi("firstLineNumber",1,c,!0),gi("lineNumberFormatter",function(e){return e},c,!0),gi("showCursorWhenSelecting",!1,ge,!0),gi("resetSelectionOnContextMenu",!0),gi("readOnly",!1,function(e,t){"nocursor"==t?(Wt(e),e.display.input.blur(),e.display.disabled=!0):(e.display.disabled=!1,t||ft(e))}),gi("disableInput",!1,function(e,t){t||ft(e)},!0),gi("dragDrop",!0),gi("cursorBlinkRate",530),gi("cursorScrollMargin",0),gi("cursorHeight",1),gi("workTime",100),gi("workDelay",100),gi("flattenSpans",!0,r,!0),gi("addModeClass",!1,r,!0),gi("pollInterval",100),gi("undoDepth",200,function(e,t){e.doc.history.undoDepth=t}),gi("historyEventDelay",1250),gi("viewportMargin",10,function(e){e.refresh()},!0),gi("maxHighlightLength",1e4,r,!0),gi("moveInputWithCursor",!0,function(e,t){t||(e.display.inputDiv.style.top=e.display.inputDiv.style.left=0)}),gi("tabindex",null,function(e,t){e.display.input.tabIndex=t||""}),gi("autofocus",null);var To=e.modes={},So=e.mimeModes={};e.defineMode=function(t,i){if(e.defaults.mode||"null"==t||(e.defaults.mode=t),arguments.length>2){i.dependencies=[];for(var r=2;r<arguments.length;++r)i.dependencies.push(arguments[r])}To[t]=i},e.defineMIME=function(e,t){So[e]=t},e.resolveMode=function(t){if("string"==typeof t&&So.hasOwnProperty(t))t=So[t];else if(t&&"string"==typeof t.name&&So.hasOwnProperty(t.name)){var i=So[t.name];"string"==typeof i&&(i={name:i}),t=nn(i,t),t.name=i.name}else if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return e.resolveMode("application/xml");return"string"==typeof t?{name:t}:t||{name:"null"}},e.getMode=function(t,i){var i=e.resolveMode(i),r=To[i.name];if(!r)return e.getMode(t,"text/plain");var n=r(t,i);if(Lo.hasOwnProperty(i.name)){var o=Lo[i.name];for(var s in o)o.hasOwnProperty(s)&&(n.hasOwnProperty(s)&&(n["_"+s]=n[s]),n[s]=o[s])}if(n.name=i.name,i.helperType&&(n.helperType=i.helperType),i.modeProps)for(var s in i.modeProps)n[s]=i.modeProps[s];return n},e.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),e.defineMIME("text/plain","null");var Lo=e.modeExtensions={};e.extendMode=function(e,t){var i=Lo.hasOwnProperty(e)?Lo[e]:Lo[e]={};on(t,i)},e.defineExtension=function(t,i){e.prototype[t]=i},e.defineDocExtension=function(e,t){qo.prototype[e]=t},e.defineOption=gi;var Ao=[];e.defineInitHook=function(e){Ao.push(e)};var Mo=e.helpers={};e.registerHelper=function(t,i,r){Mo.hasOwnProperty(t)||(Mo[t]=e[t]={_global:[]}),Mo[t][i]=r},e.registerGlobalHelper=function(t,i,r,n){e.registerHelper(t,i,n),Mo[t]._global.push({pred:r,val:n})};var Eo=e.copyState=function(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var i={};for(var r in t){var n=t[r];n instanceof Array&&(n=n.concat([])),i[r]=n}return i},$o=e.startState=function(e,t,i){return e.startState?e.startState(t,i):!0};e.innerMode=function(e,t){for(;e.innerMode;){var i=e.innerMode(t);if(!i||i.mode==e)break;t=i.state,e=i.mode}return i||{mode:e,state:t}};var No=e.commands={selectAll:function(e){e.setSelection(ao(e.firstLine(),0),ao(e.lastLine()),ns)},singleSelection:function(e){e.setSelection(e.getCursor("anchor"),e.getCursor("head"),ns)},killLine:function(e){hi(e,function(t){if(t.empty()){var i=yr(e.doc,t.head.line).text.length;return t.head.ch==i&&t.head.line<e.lastLine()?{from:t.head,to:ao(t.head.line+1,0)}:{from:t.head,to:ao(t.head.line,i)}}return{from:t.from(),to:t.to()}})},deleteLine:function(e){hi(e,function(t){return{from:ao(t.from().line,0),to:J(e.doc,ao(t.to().line+1,0))}})},delLineLeft:function(e){hi(e,function(e){return{from:ao(e.from().line,0),to:e.from()}})},undo:function(e){e.undo()},redo:function(e){e.redo()},undoSelection:function(e){e.undoSelection()},redoSelection:function(e){e.redoSelection()},goDocStart:function(e){e.extendSelection(ao(e.firstLine(),0))},goDocEnd:function(e){e.extendSelection(ao(e.lastLine()))},goLineStart:function(e){e.extendSelectionsBy(function(t){return $n(e,t.head.line)},ss)},goLineStartSmart:function(e){e.extendSelectionsBy(function(t){var i=$n(e,t.head.line),r=e.getLineHandle(i.line),n=Lr(r);if(!n||0==n[0].level){var o=Math.max(0,r.text.search(/\S/)),s=t.head.line==i.line&&t.head.ch<=o&&t.head.ch;return ao(i.line,s?0:o)}return i},ss)},goLineEnd:function(e){e.extendSelectionsBy(function(t){return Nn(e,t.head.line)},ss)},goLineRight:function(e){e.extendSelectionsBy(function(t){var i=e.charCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div")},ss)},goLineLeft:function(e){e.extendSelectionsBy(function(t){var i=e.charCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:i},"div")},ss)},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goGroupRight:function(e){e.moveH(1,"group")},goGroupLeft:function(e){e.moveH(-1,"group")},goWordRight:function(e){e.moveH(1,"word")},delCharBefore:function(e){e.deleteH(-1,"char")},delCharAfter:function(e){e.deleteH(1,"char")},delWordBefore:function(e){e.deleteH(-1,"word")},delWordAfter:function(e){e.deleteH(1,"word")},delGroupBefore:function(e){e.deleteH(-1,"group")},delGroupAfter:function(e){e.deleteH(1,"group")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("	")},insertSoftTab:function(e){for(var t=[],i=e.listSelections(),r=e.options.tabSize,n=0;n<i.length;n++){var o=i[n].from(),s=as(e.getLine(o.line),o.ch,r);t.push(new Array(r-s%r+1).join(" "))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){Qe(e,function(){for(var t=e.listSelections(),i=[],r=0;r<t.length;r++){var n=t[r].head,o=yr(e.doc,n.line).text;if(o)if(n.ch==o.length&&(n=new ao(n.line,n.ch-1)),n.ch>0)n=new ao(n.line,n.ch+1),e.replaceRange(o.charAt(n.ch-1)+o.charAt(n.ch-2),ao(n.line,n.ch-2),n,"+transpose");else if(n.line>e.doc.first){var s=yr(e.doc,n.line-1).text;s&&e.replaceRange(o.charAt(0)+"\n"+s.charAt(s.length-1),ao(n.line-1,s.length-1),ao(n.line,1),"+transpose")}i.push(new G(n,n))}e.setSelections(i)})},newlineAndIndent:function(e){Qe(e,function(){for(var t=e.listSelections().length,i=0;t>i;i++){var r=e.listSelections()[i];e.replaceRange("\n",r.anchor,r.head,"+input"),e.indentLine(r.from().line+1,null,!0),ai(e)}})},toggleOverwrite:function(e){e.toggleOverwrite()}},Oo=e.keyMap={};Oo.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},Oo.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},Oo.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection",fallthrough:["basic","emacsy"]},Oo.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},Oo["default"]=eo?Oo.macDefault:Oo.pcDefault;var Po=e.lookupKey=function(e,t,i){function r(t){t=mi(t);var n=t[e];if(n===!1)return"stop";if(null!=n&&i(n))return!0;if(t.nofallthrough)return"stop";var o=t.fallthrough;if(null==o)return!1;if("[object Array]"!=Object.prototype.toString.call(o))return r(o);for(var s=0;s<o.length;++s){var a=r(o[s]);if(a)return a}return!1}for(var n=0;n<t.length;++n){var o=r(t[n]);if(o)return"stop"!=o}},Ho=e.isModifierKey=function(e){var t=xs[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t},zo=e.keyName=function(e,t){
if(Kn&&34==e.keyCode&&e["char"])return!1;var i=xs[e.keyCode];return null==i||e.altGraphKey?!1:(e.altKey&&(i="Alt-"+i),(ro?e.metaKey:e.ctrlKey)&&(i="Ctrl-"+i),(ro?e.ctrlKey:e.metaKey)&&(i="Cmd-"+i),!t&&e.shiftKey&&(i="Shift-"+i),i)};e.fromTextArea=function(t,i){function r(){t.value=c.getValue()}if(i||(i={}),i.value=t.value,!i.tabindex&&t.tabindex&&(i.tabindex=t.tabindex),!i.placeholder&&t.placeholder&&(i.placeholder=t.placeholder),null==i.autofocus){var n=pn();i.autofocus=n==t||null!=t.getAttribute("autofocus")&&n==document.body}if(t.form&&(Qo(t.form,"submit",r),!i.leaveSubmitMethodAlone)){var o=t.form,s=o.submit;try{var a=o.submit=function(){r(),o.submit=s,o.submit(),o.submit=a}}catch(l){}}t.style.display="none";var c=e(function(e){t.parentNode.insertBefore(e,t.nextSibling)},i);return c.save=r,c.getTextArea=function(){return t},c.toTextArea=function(){r(),t.parentNode.removeChild(c.getWrapperElement()),t.style.display="",t.form&&(Jo(t.form,"submit",r),"function"==typeof t.form.submit&&(t.form.submit=s))},c};var Ro=e.StringStream=function(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};Ro.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(e){var t=this.string.charAt(this.pos);if("string"==typeof e)var i=t==e;else var i=t&&(e.test?e.test(t):e(t));return i?(++this.pos,t):void 0},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);return t>-1?(this.pos=t,!0):void 0},backUp:function(e){this.pos-=e},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=as(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?as(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return as(this.string,null,this.tabSize)-(this.lineStart?as(this.string,this.lineStart,this.tabSize):0)},match:function(e,t,i){if("string"!=typeof e){var r=this.string.slice(this.pos).match(e);return r&&r.index>0?null:(r&&t!==!1&&(this.pos+=r[0].length),r)}var n=function(e){return i?e.toLowerCase():e},o=this.string.substr(this.pos,e.length);return n(o)==n(e)?(t!==!1&&(this.pos+=e.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}};var Do=e.TextMarker=function(e,t){this.lines=[],this.type=t,this.doc=e};Yr(Do),Do.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&Xe(e),Xr(this,"clear")){var i=this.find();i&&qr(this,"clear",i.from,i.to)}for(var r=null,n=null,o=0;o<this.lines.length;++o){var s=this.lines[o],a=Ci(s.markedSpans,this);e&&!this.collapsed?nt(e,Cr(s),"text"):e&&(null!=a.to&&(n=Cr(s)),null!=a.from&&(r=Cr(s))),s.markedSpans=Ti(s.markedSpans,a),null==a.from&&this.collapsed&&!qi(this.doc,s)&&e&&xr(s,Ke(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var o=0;o<this.lines.length;++o){var l=Wi(this.lines[o]),c=u(l);c>e.display.maxLineLength&&(e.display.maxLine=l,e.display.maxLineLength=c,e.display.maxLineChanged=!0)}null!=r&&e&&this.collapsed&&rt(e,r,n+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&ue(e.doc)),e&&qr(e,"markerCleared",e,this),t&&Ye(e),this.parent&&this.parent.clear()}},Do.prototype.find=function(e,t){null==e&&"bookmark"==this.type&&(e=1);for(var i,r,n=0;n<this.lines.length;++n){var o=this.lines[n],s=Ci(o.markedSpans,this);if(null!=s.from&&(i=ao(t?o:Cr(o),s.from),-1==e))return i;if(null!=s.to&&(r=ao(t?o:Cr(o),s.to),1==e))return r}return i&&{from:i,to:r}},Do.prototype.changed=function(){var e=this.find(-1,!0),t=this,i=this.doc.cm;e&&i&&Qe(i,function(){var r=e.line,n=Cr(e.line),o=$e(i,n);if(o&&(He(o),i.curOp.selectionChanged=i.curOp.forceUpdate=!0),i.curOp.updateMaxLine=!0,!qi(t.doc,r)&&null!=t.height){var s=t.height;t.height=null;var a=Gi(t)-s;a&&xr(r,r.height+a)}})},Do.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=tn(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},Do.prototype.detachLine=function(e){if(this.lines.splice(tn(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}};var Bo=0,Io=e.SharedTextMarker=function(e,t){this.markers=e,this.primary=t;for(var i=0;i<e.length;++i)e[i].parent=this};Yr(Io),Io.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();qr(this,"clear")}},Io.prototype.find=function(e,t){return this.primary.find(e,t)};var Fo=e.LineWidget=function(e,t,i){if(i)for(var r in i)i.hasOwnProperty(r)&&(this[r]=i[r]);this.cm=e,this.node=t};Yr(Fo),Fo.prototype.clear=function(){var e=this.cm,t=this.line.widgets,i=this.line,r=Cr(i);if(null!=r&&t){for(var n=0;n<t.length;++n)t[n]==this&&t.splice(n--,1);t.length||(i.widgets=null);var o=Gi(this);Qe(e,function(){Ki(e,i,-o),nt(e,r,"widget"),xr(i,Math.max(0,i.height-o))})}},Fo.prototype.changed=function(){var e=this.height,t=this.cm,i=this.line;this.height=null;var r=Gi(this)-e;r&&Qe(t,function(){t.curOp.forceUpdate=!0,Ki(t,i,r),xr(i,i.height+r)})};var Wo=e.Line=function(e,t,i){this.text=e,Pi(this,t),this.height=i?i(this):1};Yr(Wo),Wo.prototype.lineNo=function(){return Cr(this)};var jo={},_o={};gr.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var i=e,r=e+t;r>i;++i){var n=this.lines[i];this.height-=n.height,Qi(n),qr(n,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,i){this.height+=i,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0;r<t.length;++r)t[r].parent=this},iterN:function(e,t,i){for(var r=e+t;r>e;++e)if(i(this.lines[e]))return!0}},mr.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var i=0;i<this.children.length;++i){var r=this.children[i],n=r.chunkSize();if(n>e){var o=Math.min(t,n-e),s=r.height;if(r.removeInner(e,o),this.height-=s-r.height,n==o&&(this.children.splice(i--,1),r.parent=null),0==(t-=o))break;e=0}else e-=n}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof gr))){var a=[];this.collapse(a),this.children=[new gr(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,i){this.size+=t.length,this.height+=i;for(var r=0;r<this.children.length;++r){var n=this.children[r],o=n.chunkSize();if(o>=e){if(n.insertInner(e,t,i),n.lines&&n.lines.length>50){for(;n.lines.length>50;){var s=n.lines.splice(n.lines.length-25,25),a=new gr(s);n.height-=a.height,this.children.splice(r+1,0,a),a.parent=this}this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=e.children.splice(e.children.length-5,5),i=new mr(t);if(e.parent){e.size-=i.size,e.height-=i.height;var r=tn(e.parent.children,e);e.parent.children.splice(r+1,0,i)}else{var n=new mr(e.children);n.parent=e,e.children=[n,i],e=n}i.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,i){for(var r=0;r<this.children.length;++r){var n=this.children[r],o=n.chunkSize();if(o>e){var s=Math.min(t,o-e);if(n.iterN(e,s,i))return!0;if(0==(t-=s))break;e=0}else e-=o}}};var Uo=0,qo=e.Doc=function(e,t,i){if(!(this instanceof qo))return new qo(e,t,i);null==i&&(i=0),mr.call(this,[new gr([new Wo("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.frontier=i;var r=ao(i,0);this.sel=Y(r),this.history=new Ar(null),this.id=++Uo,this.modeOption=t,"string"==typeof e&&(e=ys(e)),pr(this,{from:r,to:r,text:e}),ce(this,Y(r),ns)};qo.prototype=nn(mr.prototype,{constructor:qo,iter:function(e,t,i){i?this.iterN(e-this.first,t-e,i):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var i=0,r=0;r<t.length;++r)i+=t[r].height;this.insertInner(e-this.first,t,i)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=wr(this,this.first,this.first+this.size);return e===!1?t:t.join(e||"\n")},setValue:et(function(e){var t=ao(this.first,0),i=this.first+this.size-1;Xt(this,{from:t,to:ao(i,yr(this,i).text.length),text:ys(e),origin:"setValue"},!0),ce(this,Y(t))}),replaceRange:function(e,t,i,r){t=J(this,t),i=i?J(this,i):t,ti(this,e,t,i,r)},getRange:function(e,t,i){var r=kr(this,J(this,e),J(this,t));return i===!1?r:r.join(i||"\n")},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){return ee(this,e)?yr(this,e):void 0},getLineNumber:function(e){return Cr(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=yr(this,e)),Wi(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return J(this,e)},getCursor:function(e){var t=this.sel.primary(),i;return i=null==e||"head"==e?t.head:"anchor"==e?t.anchor:"end"==e||"to"==e||e===!1?t.to():t.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:et(function(e,t,i){se(this,J(this,"number"==typeof e?ao(e,t||0):e),null,i)}),setSelection:et(function(e,t,i){se(this,J(this,e),J(this,t||e),i)}),extendSelection:et(function(e,t,i){re(this,J(this,e),t&&J(this,t),i)}),extendSelections:et(function(e,t){ne(this,te(this,e,t))}),extendSelectionsBy:et(function(e,t){ne(this,rn(this.sel.ranges,e),t)}),setSelections:et(function(e,t,i){if(e.length){for(var r=0,n=[];r<e.length;r++)n[r]=new G(J(this,e[r].anchor),J(this,e[r].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),ce(this,X(n,t),i)}}),addSelection:et(function(e,t,i){var r=this.sel.ranges.slice(0);r.push(new G(J(this,e),J(this,t||e))),ce(this,X(r,r.length-1),i)}),getSelection:function(e){for(var t=this.sel.ranges,i,r=0;r<t.length;r++){var n=kr(this,t[r].from(),t[r].to());i=i?i.concat(n):n}return e===!1?i:i.join(e||"\n")},getSelections:function(e){for(var t=[],i=this.sel.ranges,r=0;r<i.length;r++){var n=kr(this,i[r].from(),i[r].to());e!==!1&&(n=n.join(e||"\n")),t[r]=n}return t},replaceSelection:function(e,t,i){for(var r=[],n=0;n<this.sel.ranges.length;n++)r[n]=e;this.replaceSelections(r,t,i||"+input")},replaceSelections:et(function(e,t,i){for(var r=[],n=this.sel,o=0;o<n.ranges.length;o++){var s=n.ranges[o];r[o]={from:s.from(),to:s.to(),text:ys(e[o]),origin:i}}for(var a=t&&"end"!=t&&Kt(this,r,t),o=r.length-1;o>=0;o--)Xt(this,r[o]);a?le(this,a):this.cm&&ai(this.cm)}),undo:et(function(){Qt(this,"undo")}),redo:et(function(){Qt(this,"redo")}),undoSelection:et(function(){Qt(this,"undo",!0)}),redoSelection:et(function(){Qt(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,i=0,r=0;r<e.done.length;r++)e.done[r].ranges||++t;for(var r=0;r<e.undone.length;r++)e.undone[r].ranges||++i;return{undo:t,redo:i}},clearHistory:function(){this.history=new Ar(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Br(this.history.done),undone:Br(this.history.undone)}},setHistory:function(e){var t=this.history=new Ar(this.history.maxGeneration);t.done=Br(e.done.slice(0),null,!0),t.undone=Br(e.undone.slice(0),null,!0)},markText:function(e,t,i){return vi(this,J(this,e),J(this,t),i,"range")},setBookmark:function(e,t){var i={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared};return e=J(this,e),vi(this,e,e,i,"bookmark")},findMarksAt:function(e){e=J(this,e);var t=[],i=yr(this,e.line).markedSpans;if(i)for(var r=0;r<i.length;++r){var n=i[r];(null==n.from||n.from<=e.ch)&&(null==n.to||n.to>=e.ch)&&t.push(n.marker.parent||n.marker)}return t},findMarks:function(e,t,i){e=J(this,e),t=J(this,t);var r=[],n=e.line;return this.iter(e.line,t.line+1,function(o){var s=o.markedSpans;if(s)for(var a=0;a<s.length;a++){var l=s[a];n==e.line&&e.ch>l.to||null==l.from&&n!=e.line||n==t.line&&l.from>t.ch||i&&!i(l.marker)||r.push(l.marker.parent||l.marker)}++n}),r},getAllMarks:function(){var e=[];return this.iter(function(t){var i=t.markedSpans;if(i)for(var r=0;r<i.length;++r)null!=i[r].from&&e.push(i[r].marker)}),e},posFromIndex:function(e){var t,i=this.first;return this.iter(function(r){var n=r.text.length+1;return n>e?(t=e,!0):(e-=n,void++i)}),J(this,ao(i,t))},indexFromPos:function(e){e=J(this,e);var t=e.ch;return e.line<this.first||e.ch<0?0:(this.iter(this.first,e.line,function(e){t+=e.text.length+1}),t)},copy:function(e){var t=new qo(wr(this,this.first,this.first+this.size),this.modeOption,this.first);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,i=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<i&&(i=e.to);var r=new qo(wr(this,t,i),e.mode||this.modeOption,t);return e.sharedHist&&(r.history=this.history),(this.linked||(this.linked=[])).push({doc:r,sharedHist:e.sharedHist}),r.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],ki(r,yi(this)),r},unlinkDoc:function(t){if(t instanceof e&&(t=t.doc),this.linked)for(var i=0;i<this.linked.length;++i){var r=this.linked[i];if(r.doc==t){this.linked.splice(i,1),t.unlinkDoc(this),wi(yi(this));break}}if(t.history==this.history){var n=[t.id];vr(t,function(e){n.push(e.id)},!0),t.history=new Ar(null),t.history.done=Br(this.history.done,n),t.history.undone=Br(this.history.undone,n)}},iterLinkedDocs:function(e){vr(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),qo.prototype.eachLine=qo.prototype.iter;var Vo="iter insert remove copy getEditor".split(" ");for(var Ko in qo.prototype)qo.prototype.hasOwnProperty(Ko)&&tn(Vo,Ko)<0&&(e.prototype[Ko]=function(e){return function(){return e.apply(this.doc,arguments)}}(qo.prototype[Ko]));Yr(qo);var Go=e.e_preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},Xo=e.e_stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},Yo=e.e_stop=function(e){Go(e),Xo(e)},Qo=e.on=function(e,t,i){if(e.addEventListener)e.addEventListener(t,i,!1);else if(e.attachEvent)e.attachEvent("on"+t,i);else{var r=e._handlers||(e._handlers={}),n=r[t]||(r[t]=[]);n.push(i)}},Jo=e.off=function(e,t,i){if(e.removeEventListener)e.removeEventListener(t,i,!1);else if(e.detachEvent)e.detachEvent("on"+t,i);else{var r=e._handlers&&e._handlers[t];if(!r)return;for(var n=0;n<r.length;++n)if(r[n]==i){r.splice(n,1);break}}},Zo=e.signal=function(e,t){var i=e._handlers&&e._handlers[t];if(i)for(var r=Array.prototype.slice.call(arguments,2),n=0;n<i.length;++n)i[n].apply(null,r)},es,ts=0,is=30,rs=e.Pass={toString:function(){return"CodeMirror.Pass"}},ns={scroll:!1},os={origin:"*mouse"},ss={origin:"+move"};Qr.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var as=e.countColumn=function(e,t,i,r,n){null==t&&(t=e.search(/[^\s\u00a0]/),-1==t&&(t=e.length));for(var o=r||0,s=n||0;;){var a=e.indexOf("	",o);if(0>a||a>=t)return s+(t-o);s+=a-o,s+=i-s%i,o=a+1}},ls=[""],cs=function(e){e.select()};Jn?cs=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:_n&&(cs=function(e){try{e.select()}catch(t){}}),[].indexOf&&(tn=function(e,t){return e.indexOf(t)}),[].map&&(rn=function(e,t){return e.map(t)});var ds=/[\u00df\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,hs=e.isWordChar=function(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||ds.test(e))},us=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,fs;fs=document.createRange?function(e,t,i){var r=document.createRange();return r.setEnd(e,i),r.setStart(e,t),r}:function(e,t,i){var r=document.body.createTextRange();return r.moveToElementText(e.parentNode),r.collapse(!0),r.moveEnd("character",i),r.moveStart("character",t),r},Bn&&(pn=function(){try{return document.activeElement}catch(e){return document.body}});var ps=!1,gs=function(){if(Fn)return!1;var e=dn("div");return"draggable"in e||"dragDrop"in e}(),ms,vs,bs,ys=e.splitLines=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,i=[],r=e.length;r>=t;){var n=e.indexOf("\n",t);-1==n&&(n=e.length);var o=e.slice(t,"\r"==e.charAt(n-1)?n-1:n),s=o.indexOf("\r");-1!=s?(i.push(o.slice(0,s)),t+=s+1):(i.push(o),t=n+1)}return i}:function(e){return e.split(/\r\n?|\n/)},ks=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(i){}return t&&t.parentElement()==e?0!=t.compareEndPoints("StartToEnd",t):!1},ws=function(){var e=dn("div");return"oncopy"in e?!0:(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),xs={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};e.keyNames=xs,function(){for(var e=0;10>e;e++)xs[e+48]=xs[e+96]=String(e);for(var e=65;90>=e;e++)xs[e]=String.fromCharCode(e);for(var e=1;12>=e;e++)xs[e+111]=xs[e+63235]="F"+e}();var Cs,Ts=function(){function e(e){return 247>=e?i.charAt(e):e>=1424&&1524>=e?"R":e>=1536&&1773>=e?r.charAt(e-1536):e>=1774&&2220>=e?"r":e>=8192&&8203>=e?"w":8204==e?"b":"L"}function t(e,t,i){this.level=e,this.from=t,this.to=i}var i="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",r="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",n=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,s=/[LRr]/,a=/[Lb1n]/,l=/[1n]/,c="L";return function(i){if(!n.test(i))return!1;for(var r=i.length,d=[],h=0,u;r>h;++h)d.push(u=e(i.charCodeAt(h)));for(var h=0,f=c;r>h;++h){var u=d[h];"m"==u?d[h]=f:f=u}for(var h=0,p=c;r>h;++h){var u=d[h];"1"==u&&"r"==p?d[h]="n":s.test(u)&&(p=u,"r"==u&&(d[h]="R"))}for(var h=1,f=d[0];r-1>h;++h){var u=d[h];"+"==u&&"1"==f&&"1"==d[h+1]?d[h]="1":","!=u||f!=d[h+1]||"1"!=f&&"n"!=f||(d[h]=f),f=u}for(var h=0;r>h;++h){var u=d[h];if(","==u)d[h]="N";else if("%"==u){for(var g=h+1;r>g&&"%"==d[g];++g);for(var m=h&&"!"==d[h-1]||r>g&&"1"==d[g]?"1":"N",v=h;g>v;++v)d[v]=m;h=g-1}}for(var h=0,p=c;r>h;++h){var u=d[h];"L"==p&&"1"==u?d[h]="L":s.test(u)&&(p=u)}for(var h=0;r>h;++h)if(o.test(d[h])){for(var g=h+1;r>g&&o.test(d[g]);++g);for(var b="L"==(h?d[h-1]:c),y="L"==(r>g?d[g]:c),m=b||y?"L":"R",v=h;g>v;++v)d[v]=m;h=g-1}for(var k=[],w,h=0;r>h;)if(a.test(d[h])){var x=h;for(++h;r>h&&a.test(d[h]);++h);k.push(new t(0,x,h))}else{var C=h,T=k.length;for(++h;r>h&&"L"!=d[h];++h);for(var v=C;h>v;)if(l.test(d[v])){v>C&&k.splice(T,0,new t(1,C,v));var S=v;for(++v;h>v&&l.test(d[v]);++v);k.splice(T,0,new t(2,S,v)),C=v}else++v;h>C&&k.splice(T,0,new t(1,C,h))}return 1==k[0].level&&(w=i.match(/^\s+/))&&(k[0].from=w[0].length,k.unshift(new t(0,0,w[0].length))),1==en(k).level&&(w=i.match(/\s+$/))&&(en(k).to-=w[0].length,k.push(new t(0,r-w[0].length,r))),k[0].level!=en(k).level&&k.push(new t(k[0].level,r,r)),k}}();return e.version="4.2.0",e}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function t(e,t){var i=e.getRange(a(t.line,t.ch-1),a(t.line,t.ch+1));return 2==i.length?i:null}function i(i){for(var r={name:"autoCloseBrackets",Backspace:function(r){if(r.getOption("disableInput"))return e.Pass;for(var n=r.listSelections(),o=0;o<n.length;o++){if(!n[o].empty())return e.Pass;var s=t(r,n[o].head);if(!s||i.indexOf(s)%2!=0)return e.Pass}for(var o=n.length-1;o>=0;o--){var l=n[o].head;r.replaceRange("",a(l.line,l.ch-1),a(l.line,l.ch+1))}}},n="",o=0;o<i.length;o+=2)!function(t,i){t!=i&&(n+=i),r["'"+t+"'"]=function(r){if(r.getOption("disableInput"))return e.Pass;for(var o=r.listSelections(),l,c,d=0;d<o.length;d++){var h=o[d],u=h.head,f;if("'"==t&&"comment"==r.getTokenTypeAt(u))return e.Pass;var c=r.getRange(u,a(u.line,u.ch+1));if(h.empty())if(t==i&&c==i)f=r.getRange(u,a(u.line,u.ch+3))==t+t+t?"skipThree":"skip";else if(t==i&&u.ch>1&&r.getRange(a(u.line,u.ch-2),u)==t+t&&(u.ch<=2||r.getRange(a(u.line,u.ch-3),a(u.line,u.ch-2))!=t))f="addFour";else{if(t==i&&e.isWordChar(c))return e.Pass;if(!(r.getLine(u.line).length==u.ch||n.indexOf(c)>=0||s.test(c)))return e.Pass;f="both"}else f="surround";if(l){if(l!=f)return e.Pass}else l=f}r.operation(function(){if("skip"==l)r.execCommand("goCharRight");else if("skipThree"==l)for(var e=0;3>e;e++)r.execCommand("goCharRight");else if("surround"==l){for(var n=r.getSelections(),e=0;e<n.length;e++)n[e]=t+n[e]+i;r.replaceSelections(n,"around")}else"both"==l?(r.replaceSelection(t+i,null),r.execCommand("goCharLeft")):"addFour"==l&&(r.replaceSelection(t+t+t+t,"before"),r.execCommand("goCharRight"))})},t!=i&&(r["'"+i+"'"]=function(t){for(var r=t.listSelections(),n=0;n<r.length;n++){var o=r[n];if(!o.empty()||t.getRange(o.head,a(o.head.line,o.head.ch+1))!=i)return e.Pass}t.execCommand("goCharRight")})}(i.charAt(o),i.charAt(o+1));return r}function r(i){return function(r){if(r.getOption("disableInput"))return e.Pass;for(var n=r.listSelections(),o=0;o<n.length;o++){if(!n[o].empty())return e.Pass;var s=t(r,n[o].head);if(!s||i.indexOf(s)%2!=0)return e.Pass}r.operation(function(){r.replaceSelection("\n\n",null),r.execCommand("goCharLeft"),n=r.listSelections();for(var e=0;e<n.length;e++){var t=n[e].head.line;r.indentLine(t,null,!0),r.indentLine(t+1,null,!0)}})}}var n="()[]{}''\"\"",o="[]{}",s=/\s/,a=e.Pos;e.defineOption("autoCloseBrackets",!1,function(t,s,a){if(a!=e.Init&&a&&t.removeKeyMap("autoCloseBrackets"),s){var l=n,c=o;"string"==typeof s?l=s:"object"==typeof s&&(null!=s.pairs&&(l=s.pairs),null!=s.explode&&(c=s.explode));var d=i(l);c&&(d.Enter=r(c)),t.addKeyMap(d)}})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],e):e(CodeMirror)}(function(e){function t(t){if(t.getOption("disableInput"))return e.Pass;for(var i=t.listSelections(),a=[],l=0;l<i.length;l++){if(!i[l].empty())return e.Pass;var c=i[l].head,d=t.getTokenAt(c),h=e.innerMode(t.getMode(),d.state),u=h.state;if("xml"!=h.mode.name||!u.tagName)return e.Pass;var f=t.getOption("autoCloseTags"),p="html"==h.mode.configuration,g="object"==typeof f&&f.dontCloseTags||p&&o,m="object"==typeof f&&f.indentTags||p&&s,v=u.tagName;d.end>c.ch&&(v=v.slice(0,v.length-d.end+c.ch));var b=v.toLowerCase();if(!v||"string"==d.type&&(d.end!=c.ch||!/[\"\']/.test(d.string.charAt(d.string.length-1))||1==d.string.length)||"tag"==d.type&&"closeTag"==u.type||d.string.indexOf("/")==d.string.length-1||g&&r(g,b)>-1||n(t,v,c,u,!0))return e.Pass;var y=m&&r(m,b)>-1;a[l]={indent:y,text:">"+(y?"\n\n":"")+"</"+v+">",newPos:y?e.Pos(c.line+1,0):e.Pos(c.line,c.ch+1)}}for(var l=i.length-1;l>=0;l--){var k=a[l];t.replaceRange(k.text,i[l].head,i[l].anchor,"+insert");var w=t.listSelections().slice(0);w[l]={head:k.newPos,anchor:k.newPos},t.setSelections(w),k.indent&&(t.indentLine(k.newPos.line,null,!0),t.indentLine(k.newPos.line+1,null,!0))}}function i(t){if(t.getOption("disableInput"))return e.Pass;for(var i=t.listSelections(),r=[],o=0;o<i.length;o++){if(!i[o].empty())return e.Pass;var s=i[o].head,a=t.getTokenAt(s),l=e.innerMode(t.getMode(),a.state),c=l.state;if("string"==a.type||"<"!=a.string.charAt(0)||a.start!=s.ch-1||"xml"!=l.mode.name||!c.context||!c.context.tagName||n(t,c.context.tagName,s,c))return e.Pass;r[o]="/"+c.context.tagName+">"}t.replaceSelections(r)}function r(e,t){if(e.indexOf)return e.indexOf(t);for(var i=0,r=e.length;r>i;++i)if(e[i]==t)return i;return-1}function n(t,i,r,n,o){if(!e.scanForClosingTag)return!1;var s=Math.min(t.lastLine()+1,r.line+500),a=e.scanForClosingTag(t,r,null,s);if(!a||a.tag!=i)return!1;for(var l=n.context,c=o?1:0;l&&l.tagName==i;l=l.prev)++c;r=a.to;for(var d=1;c>d;d++){var h=e.scanForClosingTag(t,r,null,s);if(!h||h.tag!=i)return!1;r=h.to}return!0}e.defineOption("autoCloseTags",!1,function(r,n,o){if(o!=e.Init&&o&&r.removeKeyMap("autoCloseTags"),n){var s={name:"autoCloseTags"};("object"!=typeof n||n.whenClosing)&&(s["'/'"]=function(e){return i(e)}),("object"!=typeof n||n.whenOpening)&&(s["'>'"]=function(e){return t(e)}),r.addKeyMap(s)}});var o=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],s=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"]}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){e.defineMode("javascript",function(t,i){function r(e){for(var t=!1,i,r=!1;null!=(i=e.next());){if(!t){if("/"==i&&!r)return;"["==i?r=!0:r&&"]"==i&&(r=!1)}t=!t&&"\\"==i}}function n(e,t,i){return xe=e,Ce=i,t}function o(e,t){var i=e.next();if('"'==i||"'"==i)return t.tokenize=s(i),t.tokenize(e,t);if("."==i&&e.match(/^\d+(?:[eE][+\-]?\d+)?/))return n("number","number");if("."==i&&e.match(".."))return n("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(i))return n(i);if("="==i&&e.eat(">"))return n("=>","operator");if("0"==i&&e.eat(/x/i))return e.eatWhile(/[\da-f]/i),n("number","number");if(/\d/.test(i))return e.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),n("number","number");if("/"==i)return e.eat("*")?(t.tokenize=a,a(e,t)):e.eat("/")?(e.skipToEnd(),n("comment","comment")):"operator"==t.lastType||"keyword c"==t.lastType||"sof"==t.lastType||/^[\[{}\(,;:]$/.test(t.lastType)?(r(e),e.eatWhile(/[gimy]/),n("regexp","string-2")):(e.eatWhile(ke),n("operator","operator",e.current()));if("`"==i)return t.tokenize=l,l(e,t);if("#"==i)return e.skipToEnd(),n("error","error");if(ke.test(i))return e.eatWhile(ke),n("operator","operator",e.current());e.eatWhile(/[\w\$_]/);var o=e.current(),c=ye.propertyIsEnumerable(o)&&ye[o];return c&&"."!=t.lastType?n(c.type,c.style,o):n("variable","variable",o)}function s(e){return function(t,i){var r=!1,s;if(me&&"@"==t.peek()&&t.match(we))return i.tokenize=o,n("jsonld-keyword","meta");for(;null!=(s=t.next())&&(s!=e||r);)r=!r&&"\\"==s;return r||(i.tokenize=o),n("string","string")}}function a(e,t){for(var i=!1,r;r=e.next();){if("/"==r&&i){t.tokenize=o;break}i="*"==r}return n("comment","comment")}function l(e,t){for(var i=!1,r;null!=(r=e.next());){if(!i&&("`"==r||"$"==r&&e.eat("{"))){t.tokenize=o;break}i=!i&&"\\"==r}return n("quasi","string-2",e.current())}function c(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var i=e.string.indexOf("=>",e.start);if(!(0>i)){for(var r=0,n=!1,o=i-1;o>=0;--o){var s=e.string.charAt(o),a=Te.indexOf(s);if(a>=0&&3>a){if(!r){++o;break}if(0==--r)break}else if(a>=3&&6>a)++r;else if(/[$\w]/.test(s))n=!0;else if(n&&!r){++o;break}}n&&!r&&(t.fatArrowAt=o)}}function d(e,t,i,r,n,o){this.indented=e,this.column=t,this.type=i,this.prev=n,this.info=o,null!=r&&(this.align=r)}function h(e,t){for(var i=e.localVars;i;i=i.next)if(i.name==t)return!0;for(var r=e.context;r;r=r.prev)for(var i=r.vars;i;i=i.next)if(i.name==t)return!0}function u(e,t,i,r,n){var o=e.cc;for(Le.state=e,Le.stream=n,Le.marked=null,Le.cc=o,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);;){var s=o.length?o.pop():ve?x:w;if(s(i,r)){for(;o.length&&o[o.length-1].lex;)o.pop()();return Le.marked?Le.marked:"variable"==i&&h(e,r)?"variable-2":t}}}function f(){for(var e=arguments.length-1;e>=0;e--)Le.cc.push(arguments[e])}function p(){return f.apply(null,arguments),!0}function g(e){function t(t){for(var i=t;i;i=i.next)if(i.name==e)return!0;return!1}var r=Le.state;if(r.context){if(Le.marked="def",t(r.localVars))return;r.localVars={name:e,next:r.localVars}}else{if(t(r.globalVars))return;i.globalVars&&(r.globalVars={name:e,next:r.globalVars})}}function m(){Le.state.context={prev:Le.state.context,vars:Le.state.localVars},Le.state.localVars=Ae}function v(){Le.state.localVars=Le.state.context.vars,Le.state.context=Le.state.context.prev}function b(e,t){var i=function(){var i=Le.state,r=i.indented;"stat"==i.lexical.type&&(r=i.lexical.indented),i.lexical=new d(r,Le.stream.column(),e,null,i.lexical,t)};return i.lex=!0,i}function y(){var e=Le.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function k(e){function t(i){return i==e?p():";"==e?f():p(t)}return t}function w(e,t){return"var"==e?p(b("vardef",t.length),U,k(";"),y):"keyword a"==e?p(b("form"),x,w,y):"keyword b"==e?p(b("form"),w,y):"{"==e?p(b("}"),W,y):";"==e?p():"if"==e?("else"==Le.state.lexical.info&&Le.state.cc[Le.state.cc.length-1]==y&&Le.state.cc.pop()(),
p(b("form"),x,w,y,X)):"function"==e?p(te):"for"==e?p(b("form"),Y,w,y):"variable"==e?p(b("stat"),H):"switch"==e?p(b("form"),x,b("}","switch"),k("{"),W,y,y):"case"==e?p(x,k(":")):"default"==e?p(k(":")):"catch"==e?p(b("form"),m,k("("),ie,k(")"),w,y,v):"module"==e?p(b("form"),m,se,v,y):"class"==e?p(b("form"),re,oe,y):"export"==e?p(b("form"),ae,y):"import"==e?p(b("form"),le,y):f(b("stat"),x,k(";"),y)}function x(e){return T(e,!1)}function C(e){return T(e,!0)}function T(e,t){if(Le.state.fatArrowAt==Le.stream.start){var i=t?P:O;if("("==e)return p(m,b(")"),I(q,")"),y,k("=>"),i,v);if("variable"==e)return f(m,q,k("=>"),i,v)}var r=t?M:A;return Se.hasOwnProperty(e)?p(r):"function"==e?p(te,r):"keyword c"==e?p(t?L:S):"("==e?p(b(")"),S,fe,k(")"),y,r):"operator"==e||"spread"==e?p(t?C:x):"["==e?p(b("]"),he,y,r):"{"==e?F(R,"}",null,r):"quasi"==e?f(E,r):p()}function S(e){return e.match(/[;\}\)\],]/)?f():f(x)}function L(e){return e.match(/[;\}\)\],]/)?f():f(C)}function A(e,t){return","==e?p(x):M(e,t,!1)}function M(e,t,i){var r=0==i?A:M,n=0==i?x:C;return"=>"==t?p(m,i?P:O,v):"operator"==e?/\+\+|--/.test(t)?p(r):"?"==t?p(x,k(":"),n):p(n):"quasi"==e?f(E,r):";"!=e?"("==e?F(C,")","call",r):"."==e?p(z,r):"["==e?p(b("]"),S,k("]"),y,r):void 0:void 0}function E(e,t){return"quasi"!=e?f():"${"!=t.slice(t.length-2)?p(E):p(x,N)}function N(e){return"}"==e?(Le.marked="string-2",Le.state.tokenize=l,p(E)):void 0}function O(e){return c(Le.stream,Le.state),f("{"==e?w:x)}function P(e){return c(Le.stream,Le.state),f("{"==e?w:C)}function H(e){return":"==e?p(y,w):f(A,k(";"),y)}function z(e){return"variable"==e?(Le.marked="property",p()):void 0}function R(e,t){if("variable"==e){if(Le.marked="property","get"==t||"set"==t)return p(D)}else if("number"==e||"string"==e)Le.marked=me?"property":e+" property";else if("["==e)return p(x,k("]"),B);return Se.hasOwnProperty(e)?p(B):void 0}function D(e){return"variable"!=e?f(B):(Le.marked="property",p(te))}function B(e){return":"==e?p(C):"("==e?f(te):void 0}function I(e,t){function i(r){if(","==r){var n=Le.state.lexical;return"call"==n.info&&(n.pos=(n.pos||0)+1),p(e,i)}return r==t?p():p(k(t))}return function(r){return r==t?p():f(e,i)}}function F(e,t,i){for(var r=3;r<arguments.length;r++)Le.cc.push(arguments[r]);return p(b(t,i),I(e,t),y)}function W(e){return"}"==e?p():f(w,W)}function j(e){return be&&":"==e?p(_):void 0}function _(e){return"variable"==e?(Le.marked="variable-3",p()):void 0}function U(){return f(q,j,K,G)}function q(e,t){return"variable"==e?(g(t),p()):"["==e?F(q,"]"):"{"==e?F(V,"}"):void 0}function V(e,t){return"variable"!=e||Le.stream.match(/^\s*:/,!1)?("variable"==e&&(Le.marked="property"),p(k(":"),q,K)):(g(t),p(K))}function K(e,t){return"="==t?p(C):void 0}function G(e){return","==e?p(U):void 0}function X(e,t){return"keyword b"==e&&"else"==t?p(b("form","else"),w,y):void 0}function Y(e){return"("==e?p(b(")"),Q,k(")"),y):void 0}function Q(e){return"var"==e?p(U,k(";"),Z):";"==e?p(Z):"variable"==e?p(J):f(x,k(";"),Z)}function J(e,t){return"in"==t||"of"==t?(Le.marked="keyword",p(x)):p(A,Z)}function Z(e,t){return";"==e?p(ee):"in"==t||"of"==t?(Le.marked="keyword",p(x)):f(x,k(";"),ee)}function ee(e){")"!=e&&p(x)}function te(e,t){return"*"==t?(Le.marked="keyword",p(te)):"variable"==e?(g(t),p(te)):"("==e?p(m,b(")"),I(ie,")"),y,w,v):void 0}function ie(e){return"spread"==e?p(ie):f(q,j)}function re(e,t){return"variable"==e?(g(t),p(ne)):void 0}function ne(e,t){return"extends"==t?p(x):void 0}function oe(e){return"{"==e?F(R,"}"):void 0}function se(e,t){return"string"==e?p(w):"variable"==e?(g(t),p(de)):void 0}function ae(e,t){return"*"==t?(Le.marked="keyword",p(de,k(";"))):"default"==t?(Le.marked="keyword",p(x,k(";"))):f(w)}function le(e){return"string"==e?p():f(ce,de)}function ce(e,t){return"{"==e?F(ce,"}"):("variable"==e&&g(t),p())}function de(e,t){return"from"==t?(Le.marked="keyword",p(x)):void 0}function he(e){return"]"==e?p():f(C,ue)}function ue(e){return"for"==e?f(fe,k("]")):","==e?p(I(C,"]")):f(I(C,"]"))}function fe(e){return"for"==e?p(Y,fe):"if"==e?p(x,fe):void 0}var pe=t.indentUnit,ge=i.statementIndent,me=i.jsonld,ve=i.json||me,be=i.typescript,ye=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),i=e("keyword b"),r=e("keyword c"),n=e("operator"),o={type:"atom",style:"atom"},s={"if":e("if"),"while":t,"with":t,"else":i,"do":i,"try":i,"finally":i,"return":r,"break":r,"continue":r,"new":r,"delete":r,"throw":r,"debugger":r,"var":e("var"),"const":e("var"),let:e("var"),"function":e("function"),"catch":e("catch"),"for":e("for"),"switch":e("switch"),"case":e("case"),"default":e("default"),"in":n,"typeof":n,"instanceof":n,"true":o,"false":o,"null":o,undefined:o,NaN:o,Infinity:o,"this":e("this"),module:e("module"),"class":e("class"),"super":e("atom"),"yield":r,"export":e("export"),"import":e("import"),"extends":r};if(be){var a={type:"variable",style:"variable-3"},l={"interface":e("interface"),"extends":e("extends"),constructor:e("constructor"),"public":e("public"),"private":e("private"),"protected":e("protected"),"static":e("static"),string:a,number:a,bool:a,any:a};for(var c in l)s[c]=l[c]}return s}(),ke=/[+\-*&%=<>!?|~^]/,we=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/,xe,Ce,Te="([{}])",Se={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,"this":!0,"jsonld-keyword":!0},Le={state:null,column:null,marked:null,cc:null},Ae={name:"this",next:{name:"arguments"}};return y.lex=!0,{startState:function(e){var t={tokenize:o,lastType:"sof",cc:[],lexical:new d((e||0)-pe,0,"block",!1),localVars:i.localVars,context:i.localVars&&{vars:i.localVars},indented:0};return i.globalVars&&"object"==typeof i.globalVars&&(t.globalVars=i.globalVars),t},token:function(e,t){if(e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),c(e,t)),t.tokenize!=a&&e.eatSpace())return null;var i=t.tokenize(e,t);return"comment"==xe?i:(t.lastType="operator"!=xe||"++"!=Ce&&"--"!=Ce?xe:"incdec",u(t,i,xe,Ce,e))},indent:function(t,r){if(t.tokenize==a)return e.Pass;if(t.tokenize!=o)return 0;var n=r&&r.charAt(0),s=t.lexical;if(!/^\s*else\b/.test(r))for(var l=t.cc.length-1;l>=0;--l){var c=t.cc[l];if(c==y)s=s.prev;else if(c!=X)break}"stat"==s.type&&"}"==n&&(s=s.prev),ge&&")"==s.type&&"stat"==s.prev.type&&(s=s.prev);var d=s.type,h=n==d;return"vardef"==d?s.indented+("operator"==t.lastType||","==t.lastType?s.info+1:0):"form"==d&&"{"==n?s.indented:"form"==d?s.indented+pe:"stat"==d?s.indented+("operator"==t.lastType||","==t.lastType?ge||pe:0):"switch"!=s.info||h||0==i.doubleIndentSwitch?s.align?s.column+(h?0:1):s.indented+(h?0:pe):s.indented+(/^(?:case|default)\b/.test(r)?pe:2*pe)},electricChars:":{}",blockCommentStart:ve?null:"/*",blockCommentEnd:ve?null:"*/",lineComment:ve?null:"//",fold:"brace",helperType:ve?"json":"javascript",jsonldMode:me,jsonMode:ve}}),e.registerHelper("wordChars","javascript",/[\\w$]/),e.defineMIME("text/javascript","javascript"),e.defineMIME("text/ecmascript","javascript"),e.defineMIME("application/javascript","javascript"),e.defineMIME("application/ecmascript","javascript"),e.defineMIME("application/json",{name:"javascript",json:!0}),e.defineMIME("application/x-json",{name:"javascript",json:!0}),e.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),e.defineMIME("text/typescript",{name:"javascript",typescript:!0}),e.defineMIME("application/typescript",{name:"javascript",typescript:!0})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function t(e){for(var t={},i=0;i<e.length;++i)t[e[i]]=!0;return t}function i(e,t){for(var i=!1,r;null!=(r=e.next());){if(i&&"/"==r){t.tokenize=null;break}i="*"==r}return["comment","comment"]}function r(e,t){return e.skipTo("-->")?(e.match("-->"),t.tokenize=null):e.skipToEnd(),["comment","comment"]}e.defineMode("css",function(t,i){function r(e,t){return C=t,e}function n(e,t){var i=e.next();if(p[i]){var n=p[i](e,t);if(n!==!1)return n}return"@"==i?(e.eatWhile(/[\w\\\-]/),r("def",e.current())):"="==i||("~"==i||"|"==i)&&e.eat("=")?r(null,"compare"):'"'==i||"'"==i?(t.tokenize=o(i),t.tokenize(e,t)):"#"==i?(e.eatWhile(/[\w\\\-]/),r("atom","hash")):"!"==i?(e.match(/^\s*\w*/),r("keyword","important")):/\d/.test(i)||"."==i&&e.eat(/\d/)?(e.eatWhile(/[\w.%]/),r("number","unit")):"-"!==i?/[,+>*\/]/.test(i)?r(null,"select-op"):"."==i&&e.match(/^-?[_a-z][_a-z0-9-]*/i)?r("qualifier","qualifier"):/[:;{}\[\]\(\)]/.test(i)?r(null,i):"u"==i&&e.match("rl(")?(e.backUp(1),t.tokenize=s,r("property","word")):/[\w\\\-]/.test(i)?(e.eatWhile(/[\w\\\-]/),r("property","word")):r(null,null):/[\d.]/.test(e.peek())?(e.eatWhile(/[\w.%]/),r("number","unit")):e.match(/^\w+-/)?r("meta","meta"):void 0}function o(e){return function(t,i){for(var n=!1,o;null!=(o=t.next());){if(o==e&&!n){")"==e&&t.backUp(1);break}n=!n&&"\\"==o}return(o==e||!n&&")"!=e)&&(i.tokenize=null),r("string","string")}}function s(e,t){return e.next(),e.match(/\s*[\"\')]/,!1)?t.tokenize=null:t.tokenize=o(")"),r(null,"(")}function a(e,t,i){this.type=e,this.indent=t,this.prev=i}function l(e,t,i){return e.context=new a(i,t.indentation()+f,e.context),i}function c(e){return e.context=e.context.prev,e.context.type}function d(e,t,i){return S[i.context.type](e,t,i)}function h(e,t,i,r){for(var n=r||1;n>0;n--)i.context=i.context.prev;return d(e,t,i)}function u(e){var t=e.current().toLowerCase();T=k.hasOwnProperty(t)?"atom":y.hasOwnProperty(t)?"keyword":"variable"}i.propertyKeywords||(i=e.resolveMode("text/css"));var f=t.indentUnit,p=i.tokenHooks,g=i.mediaTypes||{},m=i.mediaFeatures||{},v=i.propertyKeywords||{},b=i.nonStandardPropertyKeywords||{},y=i.colorKeywords||{},k=i.valueKeywords||{},w=i.fontProperties||{},x=i.allowNested,C,T,S={};return S.top=function(e,t,i){if("{"==e)return l(i,t,"block");if("}"==e&&i.context.prev)return c(i);if("@media"==e)return l(i,t,"media");if("@font-face"==e)return"font_face_before";if(/^@(-(moz|ms|o|webkit)-)?keyframes$/.test(e))return"keyframes";if(e&&"@"==e.charAt(0))return l(i,t,"at");if("hash"==e)T="builtin";else if("word"==e)T="tag";else{if("variable-definition"==e)return"maybeprop";if("interpolation"==e)return l(i,t,"interpolation");if(":"==e)return"pseudo";if(x&&"("==e)return l(i,t,"parens")}return i.context.type},S.block=function(e,t,i){if("word"==e){var r=t.current().toLowerCase();return v.hasOwnProperty(r)?(T="property","maybeprop"):b.hasOwnProperty(r)?(T="string-2","maybeprop"):x?(T=t.match(/^\s*:/,!1)?"property":"tag","block"):(T+=" error","maybeprop")}return"meta"==e?"block":x||"hash"!=e&&"qualifier"!=e?S.top(e,t,i):(T="error","block")},S.maybeprop=function(e,t,i){return":"==e?l(i,t,"prop"):d(e,t,i)},S.prop=function(e,t,i){if(";"==e)return c(i);if("{"==e&&x)return l(i,t,"propBlock");if("}"==e||"{"==e)return h(e,t,i);if("("==e)return l(i,t,"parens");if("hash"!=e||/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/.test(t.current())){if("word"==e)u(t);else if("interpolation"==e)return l(i,t,"interpolation")}else T+=" error";return"prop"},S.propBlock=function(e,t,i){return"}"==e?c(i):"word"==e?(T="property","maybeprop"):i.context.type},S.parens=function(e,t,i){return"{"==e||"}"==e?h(e,t,i):")"==e?c(i):"("==e?l(i,t,"parens"):("word"==e&&u(t),"parens")},S.pseudo=function(e,t,i){return"word"==e?(T="variable-3",i.context.type):d(e,t,i)},S.media=function(e,t,i){if("("==e)return l(i,t,"media_parens");if("}"==e)return h(e,t,i);if("{"==e)return c(i)&&l(i,t,x?"block":"top");if("word"==e){var r=t.current().toLowerCase();T="only"==r||"not"==r||"and"==r?"keyword":g.hasOwnProperty(r)?"attribute":m.hasOwnProperty(r)?"property":"error"}return i.context.type},S.media_parens=function(e,t,i){return")"==e?c(i):"{"==e||"}"==e?h(e,t,i,2):S.media(e,t,i)},S.font_face_before=function(e,t,i){return"{"==e?l(i,t,"font_face"):d(e,t,i)},S.font_face=function(e,t,i){return"}"==e?c(i):"word"==e?(T=w.hasOwnProperty(t.current().toLowerCase())?"property":"error","maybeprop"):"font_face"},S.keyframes=function(e,t,i){return"word"==e?(T="variable","keyframes"):"{"==e?l(i,t,"top"):d(e,t,i)},S.at=function(e,t,i){return";"==e?c(i):"{"==e||"}"==e?h(e,t,i):("word"==e?T="tag":"hash"==e&&(T="builtin"),"at")},S.interpolation=function(e,t,i){return"}"==e?c(i):"{"==e||";"==e?h(e,t,i):("variable"!=e&&(T="error"),"interpolation")},{startState:function(e){return{tokenize:null,state:"top",context:new a("top",e||0,null)}},token:function(e,t){if(!t.tokenize&&e.eatSpace())return null;var i=(t.tokenize||n)(e,t);return i&&"object"==typeof i&&(C=i[1],i=i[0]),T=i,t.state=S[t.state](C,e,t),T},indent:function(e,t){var i=e.context,r=t&&t.charAt(0),n=i.indent;return"prop"!=i.type||"}"!=r&&")"!=r||(i=i.prev),!i.prev||("}"!=r||"block"!=i.type&&"top"!=i.type&&"interpolation"!=i.type&&"font_face"!=i.type)&&(")"!=r||"parens"!=i.type&&"media_parens"!=i.type)&&("{"!=r||"at"!=i.type&&"media"!=i.type)||(n=i.indent-f,i=i.prev),n},electricChars:"}",blockCommentStart:"/*",blockCommentEnd:"*/",fold:"brace"}});var n=["all","aural","braille","handheld","print","projection","screen","tty","tv","embossed"],o=t(n),s=["width","min-width","max-width","height","min-height","max-height","device-width","min-device-width","max-device-width","device-height","min-device-height","max-device-height","aspect-ratio","min-aspect-ratio","max-aspect-ratio","device-aspect-ratio","min-device-aspect-ratio","max-device-aspect-ratio","color","min-color","max-color","color-index","min-color-index","max-color-index","monochrome","min-monochrome","max-monochrome","resolution","min-resolution","max-resolution","scan","grid"],a=t(s),l=["align-content","align-items","align-self","alignment-adjust","alignment-baseline","anchor-point","animation","animation-delay","animation-direction","animation-duration","animation-fill-mode","animation-iteration-count","animation-name","animation-play-state","animation-timing-function","appearance","azimuth","backface-visibility","background","background-attachment","background-clip","background-color","background-image","background-origin","background-position","background-repeat","background-size","baseline-shift","binding","bleed","bookmark-label","bookmark-level","bookmark-state","bookmark-target","border","border-bottom","border-bottom-color","border-bottom-left-radius","border-bottom-right-radius","border-bottom-style","border-bottom-width","border-collapse","border-color","border-image","border-image-outset","border-image-repeat","border-image-slice","border-image-source","border-image-width","border-left","border-left-color","border-left-style","border-left-width","border-radius","border-right","border-right-color","border-right-style","border-right-width","border-spacing","border-style","border-top","border-top-color","border-top-left-radius","border-top-right-radius","border-top-style","border-top-width","border-width","bottom","box-decoration-break","box-shadow","box-sizing","break-after","break-before","break-inside","caption-side","clear","clip","color","color-profile","column-count","column-fill","column-gap","column-rule","column-rule-color","column-rule-style","column-rule-width","column-span","column-width","columns","content","counter-increment","counter-reset","crop","cue","cue-after","cue-before","cursor","direction","display","dominant-baseline","drop-initial-after-adjust","drop-initial-after-align","drop-initial-before-adjust","drop-initial-before-align","drop-initial-size","drop-initial-value","elevation","empty-cells","fit","fit-position","flex","flex-basis","flex-direction","flex-flow","flex-grow","flex-shrink","flex-wrap","float","float-offset","flow-from","flow-into","font","font-feature-settings","font-family","font-kerning","font-language-override","font-size","font-size-adjust","font-stretch","font-style","font-synthesis","font-variant","font-variant-alternates","font-variant-caps","font-variant-east-asian","font-variant-ligatures","font-variant-numeric","font-variant-position","font-weight","grid","grid-area","grid-auto-columns","grid-auto-flow","grid-auto-position","grid-auto-rows","grid-column","grid-column-end","grid-column-start","grid-row","grid-row-end","grid-row-start","grid-template","grid-template-areas","grid-template-columns","grid-template-rows","hanging-punctuation","height","hyphens","icon","image-orientation","image-rendering","image-resolution","inline-box-align","justify-content","left","letter-spacing","line-break","line-height","line-stacking","line-stacking-ruby","line-stacking-shift","line-stacking-strategy","list-style","list-style-image","list-style-position","list-style-type","margin","margin-bottom","margin-left","margin-right","margin-top","marker-offset","marks","marquee-direction","marquee-loop","marquee-play-count","marquee-speed","marquee-style","max-height","max-width","min-height","min-width","move-to","nav-down","nav-index","nav-left","nav-right","nav-up","object-fit","object-position","opacity","order","orphans","outline","outline-color","outline-offset","outline-style","outline-width","overflow","overflow-style","overflow-wrap","overflow-x","overflow-y","padding","padding-bottom","padding-left","padding-right","padding-top","page","page-break-after","page-break-before","page-break-inside","page-policy","pause","pause-after","pause-before","perspective","perspective-origin","pitch","pitch-range","play-during","position","presentation-level","punctuation-trim","quotes","region-break-after","region-break-before","region-break-inside","region-fragment","rendering-intent","resize","rest","rest-after","rest-before","richness","right","rotation","rotation-point","ruby-align","ruby-overhang","ruby-position","ruby-span","shape-image-threshold","shape-inside","shape-margin","shape-outside","size","speak","speak-as","speak-header","speak-numeral","speak-punctuation","speech-rate","stress","string-set","tab-size","table-layout","target","target-name","target-new","target-position","text-align","text-align-last","text-decoration","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-style","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-height","text-indent","text-justify","text-outline","text-overflow","text-shadow","text-size-adjust","text-space-collapse","text-transform","text-underline-position","text-wrap","top","transform","transform-origin","transform-style","transition","transition-delay","transition-duration","transition-property","transition-timing-function","unicode-bidi","vertical-align","visibility","voice-balance","voice-duration","voice-family","voice-pitch","voice-range","voice-rate","voice-stress","voice-volume","volume","white-space","widows","width","word-break","word-spacing","word-wrap","z-index","clip-path","clip-rule","mask","enable-background","filter","flood-color","flood-opacity","lighting-color","stop-color","stop-opacity","pointer-events","color-interpolation","color-interpolation-filters","color-rendering","fill","fill-opacity","fill-rule","image-rendering","marker","marker-end","marker-mid","marker-start","shape-rendering","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke-width","text-rendering","baseline-shift","dominant-baseline","glyph-orientation-horizontal","glyph-orientation-vertical","text-anchor","writing-mode"],c=t(l),d=["scrollbar-arrow-color","scrollbar-base-color","scrollbar-dark-shadow-color","scrollbar-face-color","scrollbar-highlight-color","scrollbar-shadow-color","scrollbar-3d-light-color","scrollbar-track-color","shape-inside","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","zoom"],d=t(d),h=["aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","grey","green","greenyellow","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","tan","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen"],u=t(h),f=["above","absolute","activeborder","activecaption","afar","after-white-space","ahead","alias","all","all-scroll","alternate","always","amharic","amharic-abegede","antialiased","appworkspace","arabic-indic","armenian","asterisks","auto","avoid","avoid-column","avoid-page","avoid-region","background","backwards","baseline","below","bidi-override","binary","bengali","blink","block","block-axis","bold","bolder","border","border-box","both","bottom","break","break-all","break-word","button","button-bevel","buttonface","buttonhighlight","buttonshadow","buttontext","cambodian","capitalize","caps-lock-indicator","caption","captiontext","caret","cell","center","checkbox","circle","cjk-earthly-branch","cjk-heavenly-stem","cjk-ideographic","clear","clip","close-quote","col-resize","collapse","column","compact","condensed","contain","content","content-box","context-menu","continuous","copy","cover","crop","cross","crosshair","currentcolor","cursive","dashed","decimal","decimal-leading-zero","default","default-button","destination-atop","destination-in","destination-out","destination-over","devanagari","disc","discard","document","dot-dash","dot-dot-dash","dotted","double","down","e-resize","ease","ease-in","ease-in-out","ease-out","element","ellipse","ellipsis","embed","end","ethiopic","ethiopic-abegede","ethiopic-abegede-am-et","ethiopic-abegede-gez","ethiopic-abegede-ti-er","ethiopic-abegede-ti-et","ethiopic-halehame-aa-er","ethiopic-halehame-aa-et","ethiopic-halehame-am-et","ethiopic-halehame-gez","ethiopic-halehame-om-et","ethiopic-halehame-sid-et","ethiopic-halehame-so-et","ethiopic-halehame-ti-er","ethiopic-halehame-ti-et","ethiopic-halehame-tig","ew-resize","expanded","extra-condensed","extra-expanded","fantasy","fast","fill","fixed","flat","footnotes","forwards","from","geometricPrecision","georgian","graytext","groove","gujarati","gurmukhi","hand","hangul","hangul-consonant","hebrew","help","hidden","hide","higher","highlight","highlighttext","hiragana","hiragana-iroha","horizontal","hsl","hsla","icon","ignore","inactiveborder","inactivecaption","inactivecaptiontext","infinite","infobackground","infotext","inherit","initial","inline","inline-axis","inline-block","inline-table","inset","inside","intrinsic","invert","italic","justify","kannada","katakana","katakana-iroha","keep-all","khmer","landscape","lao","large","larger","left","level","lighter","line-through","linear","lines","list-item","listbox","listitem","local","logical","loud","lower","lower-alpha","lower-armenian","lower-greek","lower-hexadecimal","lower-latin","lower-norwegian","lower-roman","lowercase","ltr","malayalam","match","media-controls-background","media-current-time-display","media-fullscreen-button","media-mute-button","media-play-button","media-return-to-realtime-button","media-rewind-button","media-seek-back-button","media-seek-forward-button","media-slider","media-sliderthumb","media-time-remaining-display","media-volume-slider","media-volume-slider-container","media-volume-sliderthumb","medium","menu","menulist","menulist-button","menulist-text","menulist-textfield","menutext","message-box","middle","min-intrinsic","mix","mongolian","monospace","move","multiple","myanmar","n-resize","narrower","ne-resize","nesw-resize","no-close-quote","no-drop","no-open-quote","no-repeat","none","normal","not-allowed","nowrap","ns-resize","nw-resize","nwse-resize","oblique","octal","open-quote","optimizeLegibility","optimizeSpeed","oriya","oromo","outset","outside","outside-shape","overlay","overline","padding","padding-box","painted","page","paused","persian","plus-darker","plus-lighter","pointer","polygon","portrait","pre","pre-line","pre-wrap","preserve-3d","progress","push-button","radio","read-only","read-write","read-write-plaintext-only","rectangle","region","relative","repeat","repeat-x","repeat-y","reset","reverse","rgb","rgba","ridge","right","round","row-resize","rtl","run-in","running","s-resize","sans-serif","scroll","scrollbar","se-resize","searchfield","searchfield-cancel-button","searchfield-decoration","searchfield-results-button","searchfield-results-decoration","semi-condensed","semi-expanded","separate","serif","show","sidama","single","skip-white-space","slide","slider-horizontal","slider-vertical","sliderthumb-horizontal","sliderthumb-vertical","slow","small","small-caps","small-caption","smaller","solid","somali","source-atop","source-in","source-out","source-over","space","square","square-button","start","static","status-bar","stretch","stroke","sub","subpixel-antialiased","super","sw-resize","table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row","table-row-group","telugu","text","text-bottom","text-top","textarea","textfield","thai","thick","thin","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","tibetan","tigre","tigrinya-er","tigrinya-er-abegede","tigrinya-et","tigrinya-et-abegede","to","top","transparent","ultra-condensed","ultra-expanded","underline","up","upper-alpha","upper-armenian","upper-greek","upper-hexadecimal","upper-latin","upper-norwegian","upper-roman","uppercase","urdu","url","vertical","vertical-text","visible","visibleFill","visiblePainted","visibleStroke","visual","w-resize","wait","wave","wider","window","windowframe","windowtext","x-large","x-small","xor","xx-large","xx-small"],p=t(f),g=["font-family","src","unicode-range","font-variant","font-feature-settings","font-stretch","font-weight","font-style"],m=t(g),v=n.concat(s).concat(l).concat(d).concat(h).concat(f);e.registerHelper("hintWords","css",v),e.defineMIME("text/css",{mediaTypes:o,mediaFeatures:a,propertyKeywords:c,nonStandardPropertyKeywords:d,colorKeywords:u,valueKeywords:p,fontProperties:m,tokenHooks:{"<":function(e,t){return e.match("!--")?(t.tokenize=r,r(e,t)):!1},"/":function(e,t){return e.eat("*")?(t.tokenize=i,i(e,t)):!1}},name:"css"}),e.defineMIME("text/x-scss",{mediaTypes:o,mediaFeatures:a,propertyKeywords:c,nonStandardPropertyKeywords:d,colorKeywords:u,valueKeywords:p,fontProperties:m,allowNested:!0,tokenHooks:{"/":function(e,t){return e.eat("/")?(e.skipToEnd(),["comment","comment"]):e.eat("*")?(t.tokenize=i,i(e,t)):["operator","operator"]},":":function(e){return e.match(/\s*{/)?[null,"{"]:!1},$:function(e){return e.match(/^[\w-]+/),e.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"]},"#":function(e){return e.eat("{")?[null,"interpolation"]:!1}},name:"css",helperType:"scss"}),e.defineMIME("text/x-less",{mediaTypes:o,mediaFeatures:a,propertyKeywords:c,nonStandardPropertyKeywords:d,colorKeywords:u,valueKeywords:p,fontProperties:m,allowNested:!0,tokenHooks:{"/":function(e,t){return e.eat("/")?(e.skipToEnd(),["comment","comment"]):e.eat("*")?(t.tokenize=i,i(e,t)):["operator","operator"]},"@":function(e){return e.match(/^(charset|document|font-face|import|(-(moz|ms|o|webkit)-)?keyframes|media|namespace|page|supports)\b/,!1)?!1:(e.eatWhile(/[\w\\\-]/),e.match(/^\s*:/,!1)?["variable-2","variable-definition"]:["variable-2","variable"])},"&":function(){return["atom","atom"]}},name:"css",helperType:"less"})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){e.defineMode("xml",function(t,i){function r(e,t){function i(i){return t.tokenize=i,i(e,t)}var r=e.next();if("<"==r)return e.eat("!")?e.eat("[")?e.match("CDATA[")?i(s("atom","]]>")):null:e.match("--")?i(s("comment","-->")):e.match("DOCTYPE",!0,!0)?(e.eatWhile(/[\w\._\-]/),i(a(1))):null:e.eat("?")?(e.eatWhile(/[\w\._\-]/),t.tokenize=s("meta","?>"),"meta"):(S=e.eat("/")?"closeTag":"openTag",t.tokenize=n,"tag bracket");if("&"==r){var o;return o=e.eat("#")?e.eat("x")?e.eatWhile(/[a-fA-F\d]/)&&e.eat(";"):e.eatWhile(/[\d]/)&&e.eat(";"):e.eatWhile(/[\w\.\-:]/)&&e.eat(";"),o?"atom":"error"}return e.eatWhile(/[^&<]/),null}function n(e,t){var i=e.next();if(">"==i||"/"==i&&e.eat(">"))return t.tokenize=r,S=">"==i?"endTag":"selfcloseTag","tag bracket";if("="==i)return S="equals",null;if("<"==i){t.tokenize=r,t.state=h,t.tagName=t.tagStart=null;var n=t.tokenize(e,t);return n?n+" tag error":"tag error"}return/[\'\"]/.test(i)?(t.tokenize=o(i),t.stringStartCol=e.column(),t.tokenize(e,t)):(e.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word")}function o(e){var t=function(t,i){for(;!t.eol();)if(t.next()==e){i.tokenize=n;break}return"string"};return t.isInAttribute=!0,t}function s(e,t){return function(i,n){for(;!i.eol();){if(i.match(t)){n.tokenize=r;break}i.next()}return e}}function a(e){return function(t,i){for(var n;null!=(n=t.next());){if("<"==n)return i.tokenize=a(e+1),i.tokenize(t,i);if(">"==n){if(1==e){i.tokenize=r;break}return i.tokenize=a(e-1),i.tokenize(t,i)}}return"meta"}}function l(e,t,i){this.prev=e.context,this.tagName=t,this.indent=e.indented,this.startOfLine=i,(C.doNotIndent.hasOwnProperty(t)||e.context&&e.context.noIndent)&&(this.noIndent=!0)}function c(e){e.context&&(e.context=e.context.prev)}function d(e,t){for(var i;;){if(!e.context)return;if(i=e.context.tagName,!C.contextGrabbers.hasOwnProperty(i)||!C.contextGrabbers[i].hasOwnProperty(t))return;c(e)}}function h(e,t,i){return"openTag"==e?(i.tagStart=t.column(),u):"closeTag"==e?f:h}function u(e,t,i){return"word"==e?(i.tagName=t.current(),L="tag",m):(L="error",u)}function f(e,t,i){if("word"==e){var r=t.current();return i.context&&i.context.tagName!=r&&C.implicitlyClosed.hasOwnProperty(i.context.tagName)&&c(i),i.context&&i.context.tagName==r?(L="tag",p):(L="tag error",g)}return L="error",g}function p(e,t,i){return"endTag"!=e?(L="error",p):(c(i),h)}function g(e,t,i){return L="error",p(e,t,i)}function m(e,t,i){if("word"==e)return L="attribute",v;if("endTag"==e||"selfcloseTag"==e){var r=i.tagName,n=i.tagStart;return i.tagName=i.tagStart=null,"selfcloseTag"==e||C.autoSelfClosers.hasOwnProperty(r)?d(i,r):(d(i,r),i.context=new l(i,r,n==i.indented)),h}return L="error",m}function v(e,t,i){return"equals"==e?b:(C.allowMissing||(L="error"),m(e,t,i))}function b(e,t,i){return"string"==e?y:"word"==e&&C.allowUnquoted?(L="string",m):(L="error",m(e,t,i))}function y(e,t,i){return"string"==e?y:m(e,t,i)}var k=t.indentUnit,w=i.multilineTagIndentFactor||1,x=i.multilineTagIndentPastTag;null==x&&(x=!0);var C=i.htmlMode?{autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{
dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0}:{autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,caseFold:!1},T=i.alignCDATA,S,L;return{startState:function(){return{tokenize:r,state:h,indented:0,tagName:null,tagStart:null,context:null}},token:function(e,t){if(!t.tagName&&e.sol()&&(t.indented=e.indentation()),e.eatSpace())return null;S=null;var i=t.tokenize(e,t);return(i||S)&&"comment"!=i&&(L=null,t.state=t.state(S||i,e,t),L&&(i="error"==L?i+" error":L)),i},indent:function(t,i,o){var s=t.context;if(t.tokenize.isInAttribute)return t.tagStart==t.indented?t.stringStartCol+1:t.indented+k;if(s&&s.noIndent)return e.Pass;if(t.tokenize!=n&&t.tokenize!=r)return o?o.match(/^(\s*)/)[0].length:0;if(t.tagName)return x?t.tagStart+t.tagName.length+2:t.tagStart+k*w;if(T&&/<!\[CDATA\[/.test(i))return 0;var a=i&&/^<(\/)?([\w_:\.-]*)/.exec(i);if(a&&a[1])for(;s;){if(s.tagName==a[2]){s=s.prev;break}if(!C.implicitlyClosed.hasOwnProperty(s.tagName))break;s=s.prev}else if(a)for(;s;){var l=C.contextGrabbers[s.tagName];if(!l||!l.hasOwnProperty(a[2]))break;s=s.prev}for(;s&&!s.startOfLine;)s=s.prev;return s?s.indent+k:0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"<!--",blockCommentEnd:"-->",configuration:i.htmlMode?"html":"xml",helperType:i.htmlMode?"html":"xml"}}),e.defineMIME("text/xml","xml"),e.defineMIME("application/xml","xml"),e.mimeModes.hasOwnProperty("text/html")||e.defineMIME("text/html",{name:"xml",htmlMode:!0})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript"),require("../css/css")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../javascript/javascript","../css/css"],e):e(CodeMirror)}(function(e){e.defineMode("htmlmixed",function(t,i){function r(e,t){var i=t.htmlState.tagName,r=a.token(e,t.htmlState);if("script"==i&&/\btag\b/.test(r)&&">"==e.current()){var n=e.string.slice(Math.max(0,e.pos-100),e.pos).match(/\btype\s*=\s*("[^"]+"|'[^']+'|\S+)[^<]*$/i);n=n?n[1]:"",n&&/[\"\']/.test(n.charAt(0))&&(n=n.slice(1,n.length-1));for(var d=0;d<c.length;++d){var h=c[d];if("string"==typeof h.matches?n==h.matches:h.matches.test(n)){h.mode&&(t.token=o,t.localMode=h.mode,t.localState=h.mode.startState&&h.mode.startState(a.indent(t.htmlState,"")));break}}}else"style"==i&&/\btag\b/.test(r)&&">"==e.current()&&(t.token=s,t.localMode=l,t.localState=l.startState(a.indent(t.htmlState,"")));return r}function n(e,t,i){var r=e.current(),n=r.search(t),o;return n>-1?e.backUp(r.length-n):(o=r.match(/<\/?$/))&&(e.backUp(r.length),e.match(t,!1)||e.match(r)),i}function o(e,t){return e.match(/^<\/\s*script\s*>/i,!1)?(t.token=r,t.localState=t.localMode=null,r(e,t)):n(e,/<\/\s*script\s*>/,t.localMode.token(e,t.localState))}function s(e,t){return e.match(/^<\/\s*style\s*>/i,!1)?(t.token=r,t.localState=t.localMode=null,r(e,t)):n(e,/<\/\s*style\s*>/,l.token(e,t.localState))}var a=e.getMode(t,{name:"xml",htmlMode:!0,multilineTagIndentFactor:i.multilineTagIndentFactor,multilineTagIndentPastTag:i.multilineTagIndentPastTag}),l=e.getMode(t,"css"),c=[],d=i&&i.scriptTypes;if(c.push({matches:/^(?:text|application)\/(?:x-)?(?:java|ecma)script$|^$/i,mode:e.getMode(t,"javascript")}),d)for(var h=0;h<d.length;++h){var u=d[h];c.push({matches:u.matches,mode:u.mode&&e.getMode(t,u.mode)})}return c.push({matches:/./,mode:e.getMode(t,"text/plain")}),{startState:function(){var e=a.startState();return{token:r,localMode:null,localState:null,htmlState:e}},copyState:function(t){if(t.localState)var i=e.copyState(t.localMode,t.localState);return{token:t.token,localMode:t.localMode,localState:i,htmlState:e.copyState(a,t.htmlState)}},token:function(e,t){return t.token(e,t)},indent:function(t,i){return!t.localMode||/^\s*<\//.test(i)?a.indent(t.htmlState,i):t.localMode.indent?t.localMode.indent(t.localState,i):e.Pass},innerMode:function(e){return{state:e.localState||e.htmlState,mode:e.localMode||a}}}},"xml","javascript","css"),e.defineMIME("text/html","htmlmixed")});